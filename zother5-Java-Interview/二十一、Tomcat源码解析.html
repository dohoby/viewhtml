
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>二十一、Tomcat源码解析 · java实用笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="五、JVM.html" />
    
    
    <link rel="prev" href="二十、Spring源码解析.html" />
    


    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://blog.liangqingxiang.top/" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                        <b>1.2.</b>
                    
                    Base
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                        <b>1.2.1.</b>
                    
                    Assemble
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" >
            
                <span>
            
                    
                        <b>1.2.1.1.</b>
                    
                    Collection
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" >
            
                <span>
            
                    
                        <b>1.2.1.1.1.</b>
                    
                    List
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1.1" data-path="../base/assemble/collection/list/ArrayList源码学习.html">
            
                <a href="../base/assemble/collection/list/ArrayList源码学习.html">
            
                    
                        <b>1.2.1.1.1.1.</b>
                    
                    ArrayList源码学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.1.2" data-path="../base/assemble/collection/list/LinkList源码学习.html">
            
                <a href="../base/assemble/collection/list/LinkList源码学习.html">
            
                    
                        <b>1.2.1.1.1.2.</b>
                    
                    LinkList源码学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.2" >
            
                <span>
            
                    
                        <b>1.2.1.1.2.</b>
                    
                    Queue
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.2.1" data-path="../base/assemble/collection/queue/ArrayBlockingQueue源码学习.html">
            
                <a href="../base/assemble/collection/queue/ArrayBlockingQueue源码学习.html">
            
                    
                        <b>1.2.1.1.2.1.</b>
                    
                    ArrayBlockingQueue源码学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.3" >
            
                <span>
            
                    
                        <b>1.2.1.1.3.</b>
                    
                    Set
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.3.1" data-path="../base/assemble/collection/set/hashset源码学习.html">
            
                <a href="../base/assemble/collection/set/hashset源码学习.html">
            
                    
                        <b>1.2.1.1.3.1.</b>
                    
                    hashset源码学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.3.2" data-path="../base/assemble/collection/set/TreeSet源码学习.html">
            
                <a href="../base/assemble/collection/set/TreeSet源码学习.html">
            
                    
                        <b>1.2.1.1.3.2.</b>
                    
                    TreeSet源码学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" >
            
                <span>
            
                    
                        <b>1.2.1.2.</b>
                    
                    Hashmap
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1" data-path="../base/assemble/hashmap/ConcurrentHashMap相关.html">
            
                <a href="../base/assemble/hashmap/ConcurrentHashMap相关.html">
            
                    
                        <b>1.2.1.2.1.</b>
                    
                    ConcurrentHashMap相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.2" data-path="../base/assemble/hashmap/HashMap相关.html">
            
                <a href="../base/assemble/hashmap/HashMap相关.html">
            
                    
                        <b>1.2.1.2.2.</b>
                    
                    HashMap相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.3" data-path="../base/assemble/hashmap/HashMap相关2.html">
            
                <a href="../base/assemble/hashmap/HashMap相关2.html">
            
                    
                        <b>1.2.1.2.3.</b>
                    
                    HashMap相关2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.4" data-path="../base/assemble/hashmap/HashMap相关tx.html">
            
                <a href="../base/assemble/hashmap/HashMap相关tx.html">
            
                    
                        <b>1.2.1.2.4.</b>
                    
                    HashMap相关tx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.5" data-path="../base/assemble/hashmap/jdk1.7hashmap源码分析.html">
            
                <a href="../base/assemble/hashmap/jdk1.7hashmap源码分析.html">
            
                    
                        <b>1.2.1.2.5.</b>
                    
                    jdk1.7hashmap源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.6" data-path="../base/assemble/hashmap/jdk1.8ConcurrentHashMap源码分析.html">
            
                <a href="../base/assemble/hashmap/jdk1.8ConcurrentHashMap源码分析.html">
            
                    
                        <b>1.2.1.2.6.</b>
                    
                    jdk1.8ConcurrentHashMap源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.7" data-path="../base/assemble/hashmap/jdk1.8HashMap源码分析.html">
            
                <a href="../base/assemble/hashmap/jdk1.8HashMap源码分析.html">
            
                    
                        <b>1.2.1.2.7.</b>
                    
                    jdk1.8hashmap源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.8" data-path="../base/assemble/hashmap/Jdk1.8源码解析HashMap-putTreeVal.html">
            
                <a href="../base/assemble/hashmap/Jdk1.8源码解析HashMap-putTreeVal.html">
            
                    
                        <b>1.2.1.2.8.</b>
                    
                    Jdk1.8源码解析-java.util.HashMap#putTreeVal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.9" data-path="../base/assemble/hashmap/Jdk1.8源码解析HashMap-resize.html">
            
                <a href="../base/assemble/hashmap/Jdk1.8源码解析HashMap-resize.html">
            
                    
                        <b>1.2.1.2.9.</b>
                    
                    Jdk1.8源码解析-java.util.HashMap#resize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.10" data-path="../base/assemble/hashmap/Jdk1.8源码解析HashMap-treeifyBin.html">
            
                <a href="../base/assemble/hashmap/Jdk1.8源码解析HashMap-treeifyBin.html">
            
                    
                        <b>1.2.1.2.10.</b>
                    
                    Jdk1.8源码解析-java.util.HashMap#treeifyBin链表转化为红黑树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.11" data-path="../base/assemble/hashmap/LinkedHashMap.html">
            
                <a href="../base/assemble/hashmap/LinkedHashMap.html">
            
                    
                        <b>1.2.1.2.11.</b>
                    
                    Linked Hash Map
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" >
            
                <span>
            
                    
                        <b>1.2.1.3.</b>
                    
                    hashmap源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.3.1" data-path="../base/assemble/hashmap源码/jdk1.7ConcurrentHashMap源码.html">
            
                <a href="../base/assemble/hashmap源码/jdk1.7ConcurrentHashMap源码.html">
            
                    
                        <b>1.2.1.3.1.</b>
                    
                    jdk1.7ConcurrentHashMap源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.2" data-path="../base/assemble/hashmap源码/jdk1.7HashMap源码.html">
            
                <a href="../base/assemble/hashmap源码/jdk1.7HashMap源码.html">
            
                    
                        <b>1.2.1.3.2.</b>
                    
                    jdk1.7HashMap源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.3" data-path="../base/assemble/hashmap源码/jdk1.8ConcurrentHashMap源码.html">
            
                <a href="../base/assemble/hashmap源码/jdk1.8ConcurrentHashMap源码.html">
            
                    
                        <b>1.2.1.3.3.</b>
                    
                    jdk1.8ConcurrentHashMap源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.4" data-path="../base/assemble/hashmap源码/jdk1.8HashMap源码.html">
            
                <a href="../base/assemble/hashmap源码/jdk1.8HashMap源码.html">
            
                    
                        <b>1.2.1.3.4.</b>
                    
                    jdk1.8HashMap源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../base/assemble/集合类学习.html">
            
                <a href="../base/assemble/集合类学习.html">
            
                    
                        <b>1.2.1.4.</b>
                    
                    集合类学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                        <b>1.2.2.</b>
                    
                    Lambada
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../base/lambada/java8-求和.html">
            
                <a href="../base/lambada/java8-求和.html">
            
                    
                        <b>1.2.2.1.</b>
                    
                    java8-求和
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../base/lambada/java8-空指针Optional.html">
            
                <a href="../base/lambada/java8-空指针Optional.html">
            
                    
                        <b>1.2.2.2.</b>
                    
                    java8-空指针Optional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../base/lambada/Java8实战例子.html">
            
                <a href="../base/lambada/Java8实战例子.html">
            
                    
                        <b>1.2.2.3.</b>
                    
                    Java8实战例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../base/lambada/Java8新特性- 重复注解.html">
            
                <a href="../base/lambada/Java8新特性- 重复注解.html">
            
                    
                        <b>1.2.2.4.</b>
                    
                    Java8新特性- 重复注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../base/lambada/Java8新特性-jvm年老代参数参数变更.html">
            
                <a href="../base/lambada/Java8新特性-jvm年老代参数参数变更.html">
            
                    
                        <b>1.2.2.5.</b>
                    
                    Java8新特性-jvm年老代参数参数变更
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../base/lambada/Java8新特性-Lambda表达式-streams.html">
            
                <a href="../base/lambada/Java8新特性-Lambda表达式-streams.html">
            
                    
                        <b>1.2.2.6.</b>
                    
                    Java8新特性-Lambda表达式-streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="../base/lambada/Java8新特性-Lambda表达式与Functional接口.html">
            
                <a href="../base/lambada/Java8新特性-Lambda表达式与Functional接口.html">
            
                    
                        <b>1.2.2.7.</b>
                    
                    Java8新特性-Lambda表达式与Functional接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="../base/lambada/Java8新特性-接口的默认方法与静态方法.html">
            
                <a href="../base/lambada/Java8新特性-接口的默认方法与静态方法.html">
            
                    
                        <b>1.2.2.8.</b>
                    
                    Java8新特性-接口的默认方法与静态方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.9" data-path="../base/lambada/Java8新特性-方法引用.html">
            
                <a href="../base/lambada/Java8新特性-方法引用.html">
            
                    
                        <b>1.2.2.9.</b>
                    
                    Java8新特性-方法引用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.10" data-path="../base/lambada/Java8新特性——内建的功能性接口.html">
            
                <a href="../base/lambada/Java8新特性——内建的功能性接口.html">
            
                    
                        <b>1.2.2.10.</b>
                    
                    Java8新特性——内建的功能性接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.11" data-path="../base/lambada/java8用法.html">
            
                <a href="../base/lambada/java8用法.html">
            
                    
                        <b>1.2.2.11.</b>
                    
                    java8用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.12" data-path="../base/lambada/labada常用写法.html">
            
                <a href="../base/lambada/labada常用写法.html">
            
                    
                        <b>1.2.2.12.</b>
                    
                    labada常用写法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                        <b>1.2.3.</b>
                    
                    String
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../base/string/StringBuffer和StringBuilder.html">
            
                <a href="../base/string/StringBuffer和StringBuilder.html">
            
                    
                        <b>1.2.3.1.</b>
                    
                    集合StringBuffer和StringBuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../base/string/string源码.html">
            
                <a href="../base/string/string源码.html">
            
                    
                        <b>1.2.3.2.</b>
                    
                    string源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../base/string/string源码学习.html">
            
                <a href="../base/string/string源码学习.html">
            
                    
                        <b>1.2.3.3.</b>
                    
                    string源码学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../base/string/字符串string学习.html">
            
                <a href="../base/string/字符串string学习.html">
            
                    
                        <b>1.2.3.4.</b>
                    
                    字符串string学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../base/string/字符串string学习2-lg.html">
            
                <a href="../base/string/字符串string学习2-lg.html">
            
                    
                        <b>1.2.3.5.</b>
                    
                    字符串string学习2-lg
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" >
            
                <span>
            
                    
                        <b>1.2.4.</b>
                    
                    基本类型
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../base/基本类型/BigDecimal问题.html">
            
                <a href="../base/基本类型/BigDecimal问题.html">
            
                    
                        <b>1.2.4.1.</b>
                    
                    BigDecimal问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../base/基本类型/IntegerCache源码.html">
            
                <a href="../base/基本类型/IntegerCache源码.html">
            
                    
                        <b>1.2.4.2.</b>
                    
                    IntegerCache源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../base/基本类型/Integer源码.html">
            
                <a href="../base/基本类型/Integer源码.html">
            
                    
                        <b>1.2.4.3.</b>
                    
                    Integer源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../base/基本类型/Integer装箱拆箱int比较必看.html">
            
                <a href="../base/基本类型/Integer装箱拆箱int比较必看.html">
            
                    
                        <b>1.2.4.4.</b>
                    
                    Integer装箱拆箱int比较必看
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../base/基本类型/java强引用软引用弱引用虚引用.html">
            
                <a href="../base/基本类型/java强引用软引用弱引用虚引用.html">
            
                    
                        <b>1.2.4.5.</b>
                    
                    java强引用软引用弱引用虚引用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../base/基本类型/原码反码补码.html">
            
                <a href="../base/基本类型/原码反码补码.html">
            
                    
                        <b>1.2.4.6.</b>
                    
                    原码反码补码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="../base/基本类型/基本类型装箱拆箱.html">
            
                <a href="../base/基本类型/基本类型装箱拆箱.html">
            
                    
                        <b>1.2.4.7.</b>
                    
                    集合基本类型装箱拆箱
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.8" data-path="../base/基本类型/基本类型装箱拆箱2.html">
            
                <a href="../base/基本类型/基本类型装箱拆箱2.html">
            
                    
                        <b>1.2.4.8.</b>
                    
                    基本类型装箱拆箱2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.9" data-path="../base/基本类型/基本运算.html">
            
                <a href="../base/基本类型/基本运算.html">
            
                    
                        <b>1.2.4.9.</b>
                    
                    基本运算i++
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.10" data-path="../base/基本类型/日期学习.html">
            
                <a href="../base/基本类型/日期学习.html">
            
                    
                        <b>1.2.4.10.</b>
                    
                    日期学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.11" data-path="../base/基本类型/枚举类Enum学习.html">
            
                <a href="../base/基本类型/枚举类Enum学习.html">
            
                    
                        <b>1.2.4.11.</b>
                    
                    枚举类Enum学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.12" data-path="../base/基本类型/浅拷贝和深拷贝.html">
            
                <a href="../base/基本类型/浅拷贝和深拷贝.html">
            
                    
                        <b>1.2.4.12.</b>
                    
                    浅拷贝和深拷贝
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.13" data-path="../base/基本类型/静态static学习.html">
            
                <a href="../base/基本类型/静态static学习.html">
            
                    
                        <b>1.2.4.13.</b>
                    
                    静态static学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" >
            
                <span>
            
                    
                        <b>1.2.5.</b>
                    
                    异常
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../base/异常/异常处理.html">
            
                <a href="../base/异常/异常处理.html">
            
                    
                        <b>1.2.5.1.</b>
                    
                    异常处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../base/异常/异常学习.html">
            
                <a href="../base/异常/异常学习.html">
            
                    
                        <b>1.2.5.2.</b>
                    
                    异常学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" >
            
                <span>
            
                    
                        <b>1.2.6.</b>
                    
                    算法
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" >
            
                <span>
            
                    
                        <b>1.2.6.1.</b>
                    
                    排序
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1.1" data-path="../base/算法/排序/冒泡排序和选择排序.html">
            
                <a href="../base/算法/排序/冒泡排序和选择排序.html">
            
                    
                        <b>1.2.6.1.1.</b>
                    
                    冒泡排序和选择排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.1.2" data-path="../base/算法/排序/堆排序.html">
            
                <a href="../base/算法/排序/堆排序.html">
            
                    
                        <b>1.2.6.1.2.</b>
                    
                    堆排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.1.3" data-path="../base/算法/排序/快速排序.html">
            
                <a href="../base/算法/排序/快速排序.html">
            
                    
                        <b>1.2.6.1.3.</b>
                    
                    快速排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.1.4" data-path="../base/算法/排序/插入排序和归并排序.html">
            
                <a href="../base/算法/排序/插入排序和归并排序.html">
            
                    
                        <b>1.2.6.1.4.</b>
                    
                    插入排序和归并排序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../base/算法/二分查找.html">
            
                <a href="../base/算法/二分查找.html">
            
                    
                        <b>1.2.6.2.</b>
                    
                    二分查找
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../base/算法/数据结构-树-基础.html">
            
                <a href="../base/算法/数据结构-树-基础.html">
            
                    
                        <b>1.2.6.3.</b>
                    
                    数据结构-树-基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../base/算法/数据结构-链表.html">
            
                <a href="../base/算法/数据结构-链表.html">
            
                    
                        <b>1.2.6.4.</b>
                    
                    数据结构-链表
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" >
            
                <span>
            
                    
                        <b>1.2.7.</b>
                    
                    网络
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../base/网络/http和tcp.html">
            
                <a href="../base/网络/http和tcp.html">
            
                    
                        <b>1.2.7.1.</b>
                    
                    http和tcp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../base/网络/time_wait问题.html">
            
                <a href="../base/网络/time_wait问题.html">
            
                    
                        <b>1.2.7.2.</b>
                    
                    time_wait问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" >
            
                <span>
            
                    
                        <b>1.2.8.</b>
                    
                    设计
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../base/设计/接口相关.html">
            
                <a href="../base/设计/接口相关.html">
            
                    
                        <b>1.2.8.1.</b>
                    
                    接口相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../base/设计/接口返回统一封装.html">
            
                <a href="../base/设计/接口返回统一封装.html">
            
                    
                        <b>1.2.8.2.</b>
                    
                    接口返回统一封装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../base/设计/权限相关-security.html">
            
                <a href="../base/设计/权限相关-security.html">
            
                    
                        <b>1.2.8.3.</b>
                    
                    权限相关-security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.4" data-path="../base/设计/权限相关-shrio.html">
            
                <a href="../base/设计/权限相关-shrio.html">
            
                    
                        <b>1.2.8.4.</b>
                    
                    权限相关-shrio
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../base/面试题/面试题.html">
            
                <a href="../base/面试题/面试题.html">
            
                    
                        <b>1.2.9.</b>
                    
                    面试题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../base/test.html">
            
                <a href="../base/test.html">
            
                    
                        <b>1.2.10.</b>
                    
                    Test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                        <b>1.3.</b>
                    
                    Database
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                        <b>1.3.1.</b>
                    
                    sql题
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../database/sql题/常见sql用法.html">
            
                <a href="../database/sql题/常见sql用法.html">
            
                    
                        <b>1.3.1.1.</b>
                    
                    常见sql用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../database/sql题/数据库去重.html">
            
                <a href="../database/sql题/数据库去重.html">
            
                    
                        <b>1.3.1.2.</b>
                    
                    数据库去重
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../database/sql题/行转列.html">
            
                <a href="../database/sql题/行转列.html">
            
                    
                        <b>1.3.1.3.</b>
                    
                    行转列
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../database/mysql事务.html">
            
                <a href="../database/mysql事务.html">
            
                    
                        <b>1.3.2.</b>
                    
                    mysql事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../database/mysql存储引擎.html">
            
                <a href="../database/mysql存储引擎.html">
            
                    
                        <b>1.3.3.</b>
                    
                    mysql存储引擎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../database/mysql学习.html">
            
                <a href="../database/mysql学习.html">
            
                    
                        <b>1.3.4.</b>
                    
                    mysql学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../database/MySQL的ACID原理.html">
            
                <a href="../database/MySQL的ACID原理.html">
            
                    
                        <b>1.3.5.</b>
                    
                    MySQL的ACID原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../database/mysql聚簇索引和非聚簇索引.html">
            
                <a href="../database/mysql聚簇索引和非聚簇索引.html">
            
                    
                        <b>1.3.6.</b>
                    
                    mysql聚簇索引和非聚簇索引.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../database/MySQL读写分离主从复制原理.html">
            
                <a href="../database/MySQL读写分离主从复制原理.html">
            
                    
                        <b>1.3.7.</b>
                    
                    MySQL读写分离主从复制原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../database/postgres和mysql.html">
            
                <a href="../database/postgres和mysql.html">
            
                    
                        <b>1.3.8.</b>
                    
                    postgres和mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../database/sql优化.html">
            
                <a href="../database/sql优化.html">
            
                    
                        <b>1.3.9.</b>
                    
                    sql优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../database/数据库学习.html">
            
                <a href="../database/数据库学习.html">
            
                    
                        <b>1.3.10.</b>
                    
                    数据库学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="../database/索引种类.html">
            
                <a href="../database/索引种类.html">
            
                    
                        <b>1.3.11.</b>
                    
                    索引种类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                        <b>1.4.</b>
                    
                    Design Patterns
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                        <b>1.4.1.</b>
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../designPatterns/spring/spring享元模式.html">
            
                <a href="../designPatterns/spring/spring享元模式.html">
            
                    
                        <b>1.4.1.1.</b>
                    
                    spring享元模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../designPatterns/spring/spring代理模式.html">
            
                <a href="../designPatterns/spring/spring代理模式.html">
            
                    
                        <b>1.4.1.2.</b>
                    
                    spring代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../designPatterns/spring/spring工厂模式.html">
            
                <a href="../designPatterns/spring/spring工厂模式.html">
            
                    
                        <b>1.4.1.3.</b>
                    
                    spring工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../designPatterns/spring/spring策略模式.html">
            
                <a href="../designPatterns/spring/spring策略模式.html">
            
                    
                        <b>1.4.1.4.</b>
                    
                    spring策略模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                        <b>1.4.2.</b>
                    
                    单例
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../designPatterns/单例/单例模式.html">
            
                <a href="../designPatterns/单例/单例模式.html">
            
                    
                        <b>1.4.2.1.</b>
                    
                    单例模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" >
            
                <span>
            
                    
                        <b>1.4.3.</b>
                    
                    策略
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../designPatterns/策略/jdk用到的策略模式.html">
            
                <a href="../designPatterns/策略/jdk用到的策略模式.html">
            
                    
                        <b>1.4.3.1.</b>
                    
                    jdk用到的策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../designPatterns/策略/mybatis用到的策略模式.html">
            
                <a href="../designPatterns/策略/mybatis用到的策略模式.html">
            
                    
                        <b>1.4.3.2.</b>
                    
                    mybatis用到的策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="../designPatterns/策略/策略模式-实战例子1.html">
            
                <a href="../designPatterns/策略/策略模式-实战例子1.html">
            
                    
                        <b>1.4.3.3.</b>
                    
                    策略模式-实战例子1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.4" data-path="../designPatterns/策略/策略模式-实战例子2.html">
            
                <a href="../designPatterns/策略/策略模式-实战例子2.html">
            
                    
                        <b>1.4.3.4.</b>
                    
                    策略模式-实战例子2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.5" data-path="../designPatterns/策略/策略模式-实战例子3.html">
            
                <a href="../designPatterns/策略/策略模式-实战例子3.html">
            
                    
                        <b>1.4.3.5.</b>
                    
                    策略模式-实战例子3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                        <b>1.5.</b>
                    
                    Devops
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                        <b>1.5.1.</b>
                    
                    Docker
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../devops/docker/k8s配置.html">
            
                <a href="../devops/docker/k8s配置.html">
            
                    
                        <b>1.5.1.1.</b>
                    
                    k8s配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                        <b>1.5.2.</b>
                    
                    Elasticsearch
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../devops/elasticsearch/elasticsearch学习.html">
            
                <a href="../devops/elasticsearch/elasticsearch学习.html">
            
                    
                        <b>1.5.2.1.</b>
                    
                    elasticsearch学习
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <span>
            
                    
                        <b>1.5.3.</b>
                    
                    Jenkins
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../devops/jenkins/jenkinsfile配置.html">
            
                <a href="../devops/jenkins/jenkinsfile配置.html">
            
                    
                        <b>1.5.3.1.</b>
                    
                    jenkinsfile配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                        <b>1.6.</b>
                    
                    Distributed
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../distributed/dubbo学习1.html">
            
                <a href="../distributed/dubbo学习1.html">
            
                    
                        <b>1.6.1.</b>
                    
                    dubbo学习1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../distributed/分布式事务.html">
            
                <a href="../distributed/分布式事务.html">
            
                    
                        <b>1.6.2.</b>
                    
                    分布式事务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                        <b>1.7.</b>
                    
                    Jvm
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../jvm/jvm内存模型.html">
            
                <a href="../jvm/jvm内存模型.html">
            
                    
                        <b>1.7.1.</b>
                    
                    jvm内存模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../jvm/jvm参数.html">
            
                <a href="../jvm/jvm参数.html">
            
                    
                        <b>1.7.2.</b>
                    
                    jvm参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../jvm/jvm对象.html">
            
                <a href="../jvm/jvm对象.html">
            
                    
                        <b>1.7.3.</b>
                    
                    jvm对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../jvm/jvm相关.html">
            
                <a href="../jvm/jvm相关.html">
            
                    
                        <b>1.7.4.</b>
                    
                    jvm相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../jvm/垃圾收集算法和收集器.html">
            
                <a href="../jvm/垃圾收集算法和收集器.html">
            
                    
                        <b>1.7.5.</b>
                    
                    垃圾收集算法和收集器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../jvm/类加载过程.html">
            
                <a href="../jvm/类加载过程.html">
            
                    
                        <b>1.7.6.</b>
                    
                    类加载过程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                        <b>1.8.</b>
                    
                    Mq
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../mq/mq相关.html">
            
                <a href="../mq/mq相关.html">
            
                    
                        <b>1.8.1.</b>
                    
                    mq相关
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                        <b>1.9.</b>
                    
                    Muti Thread
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" >
            
                <span>
            
                    
                        <b>1.9.1.</b>
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../mutiThread/源码/AbstractQueuedSynchronizer.html">
            
                <a href="../mutiThread/源码/AbstractQueuedSynchronizer.html">
            
                    
                        <b>1.9.1.1.</b>
                    
                    AbstractQueuedSynchronizer源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../mutiThread/源码/ReadWriteLock.html">
            
                <a href="../mutiThread/源码/ReadWriteLock.html">
            
                    
                        <b>1.9.1.2.</b>
                    
                    ReadWriteLock源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="../mutiThread/源码/ReenTrantLock.html">
            
                <a href="../mutiThread/源码/ReenTrantLock.html">
            
                    
                        <b>1.9.1.3.</b>
                    
                    ReenTrantLock源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="../mutiThread/源码/ThreadLocal源码.html">
            
                <a href="../mutiThread/源码/ThreadLocal源码.html">
            
                    
                        <b>1.9.1.4.</b>
                    
                    ThreadLocal源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" >
            
                <span>
            
                    
                        <b>1.9.2.</b>
                    
                    生产者消费者案例
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../mutiThread/生产者消费者案例/生产者消费者例子1.html">
            
                <a href="../mutiThread/生产者消费者案例/生产者消费者例子1.html">
            
                    
                        <b>1.9.2.1.</b>
                    
                    生产者消费者例子1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../mutiThread/生产者消费者案例/生产者消费者例子2.html">
            
                <a href="../mutiThread/生产者消费者案例/生产者消费者例子2.html">
            
                    
                        <b>1.9.2.2.</b>
                    
                    生产者消费者例子2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../mutiThread/生产者消费者案例/生产者消费者例子3.html">
            
                <a href="../mutiThread/生产者消费者案例/生产者消费者例子3.html">
            
                    
                        <b>1.9.2.3.</b>
                    
                    生产者消费者例子3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../mutiThread/AQS.html">
            
                <a href="../mutiThread/AQS.html">
            
                    
                        <b>1.9.3.</b>
                    
                    AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../mutiThread/CAS.html">
            
                <a href="../mutiThread/CAS.html">
            
                    
                        <b>1.9.4.</b>
                    
                    CAS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../mutiThread/CountDownLatch和CyclicBarrier.html">
            
                <a href="../mutiThread/CountDownLatch和CyclicBarrier.html">
            
                    
                        <b>1.9.5.</b>
                    
                    CountDownLatch和CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../mutiThread/Executors.html">
            
                <a href="../mutiThread/Executors.html">
            
                    
                        <b>1.9.6.</b>
                    
                    Executors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../mutiThread/OOM.html">
            
                <a href="../mutiThread/OOM.html">
            
                    
                        <b>1.9.7.</b>
                    
                    OOM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../mutiThread/synchronized和ReentrantLock的实现原理.html">
            
                <a href="../mutiThread/synchronized和ReentrantLock的实现原理.html">
            
                    
                        <b>1.9.8.</b>
                    
                    synchronized和ReentrantLock的实现原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../mutiThread/ThreadLocal原理.html">
            
                <a href="../mutiThread/ThreadLocal原理.html">
            
                    
                        <b>1.9.9.</b>
                    
                    ThreadLocal原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../mutiThread/ThreadLocal原理2.html">
            
                <a href="../mutiThread/ThreadLocal原理2.html">
            
                    
                        <b>1.9.10.</b>
                    
                    ThreadLocal原理2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../mutiThread/ThreadPoolExecutor-lg.html">
            
                <a href="../mutiThread/ThreadPoolExecutor-lg.html">
            
                    
                        <b>1.9.11.</b>
                    
                    ThreadPoolExecutor详解 ThreadPoolExecutor 的参数含义及源码执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../mutiThread/ThreadPoolExecutor相关.html">
            
                <a href="../mutiThread/ThreadPoolExecutor相关.html">
            
                    
                        <b>1.9.12.</b>
                    
                    ThreadPoolExecutor相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="../mutiThread/Volatile实现原理.html">
            
                <a href="../mutiThread/Volatile实现原理.html">
            
                    
                        <b>1.9.13.</b>
                    
                    Volatiile实现原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="../mutiThread/死锁.html">
            
                <a href="../mutiThread/死锁.html">
            
                    
                        <b>1.9.14.</b>
                    
                    死锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="../mutiThread/线程学习1.html">
            
                <a href="../mutiThread/线程学习1.html">
            
                    
                        <b>1.9.15.</b>
                    
                    线程学习1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="../mutiThread/线程学习2.html">
            
                <a href="../mutiThread/线程学习2.html">
            
                    
                        <b>1.9.16.</b>
                    
                    线程学习2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="../mutiThread/线程的状态-lg.html">
            
                <a href="../mutiThread/线程的状态-lg.html">
            
                    
                        <b>1.9.17.</b>
                    
                    线程的状态-lg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="../mutiThread/线程间通信的实现方式1.html">
            
                <a href="../mutiThread/线程间通信的实现方式1.html">
            
                    
                        <b>1.9.18.</b>
                    
                    线程间通信的几种实现方式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="../mutiThread/线程间通信的实现方式2.html">
            
                <a href="../mutiThread/线程间通信的实现方式2.html">
            
                    
                        <b>1.9.19.</b>
                    
                    线程间通信的实现方式2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                        <b>1.10.</b>
                    
                    Mybatis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" >
            
                <span>
            
                    
                        <b>1.10.1.</b>
                    
                    mybatis分页插件
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="../mybatis/mybatis分页插件/mybatis插件引入.html">
            
                <a href="../mybatis/mybatis分页插件/mybatis插件引入.html">
            
                    
                        <b>1.10.1.1.</b>
                    
                    mybatis插件引入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="../mybatis/mybatis分页插件/Page.html">
            
                <a href="../mybatis/mybatis分页插件/Page.html">
            
                    
                        <b>1.10.1.2.</b>
                    
                    Page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.3" data-path="../mybatis/mybatis分页插件/PagePlugin.html">
            
                <a href="../mybatis/mybatis分页插件/PagePlugin.html">
            
                    
                        <b>1.10.1.3.</b>
                    
                    Page Plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.4" data-path="../mybatis/mybatis分页插件/ReflectHelper.html">
            
                <a href="../mybatis/mybatis分页插件/ReflectHelper.html">
            
                    
                        <b>1.10.1.4.</b>
                    
                    Reflect Helper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" >
            
                <span>
            
                    
                        <b>1.10.2.</b>
                    
                    mybatis分页插件2
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="../mybatis/mybatis分页插件2/mybatis插件引入.html">
            
                <a href="../mybatis/mybatis分页插件2/mybatis插件引入.html">
            
                    
                        <b>1.10.2.1.</b>
                    
                    mybatis插件引入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="../mybatis/mybatis分页插件2/PageInterceptor.html">
            
                <a href="../mybatis/mybatis分页插件2/PageInterceptor.html">
            
                    
                        <b>1.10.2.2.</b>
                    
                    Page Interceptor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3" data-path="../mybatis/mybatis分页插件2/Pagination.html">
            
                <a href="../mybatis/mybatis分页插件2/Pagination.html">
            
                    
                        <b>1.10.2.3.</b>
                    
                    Pagination
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" >
            
                <span>
            
                    
                        <b>1.10.3.</b>
                    
                    mybatis源码解析
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.3.1" data-path="../mybatis/mybatis源码解析/mybatis源码-mapper接口流程分析.html">
            
                <a href="../mybatis/mybatis源码解析/mybatis源码-mapper接口流程分析.html">
            
                    
                        <b>1.10.3.1.</b>
                    
                    mybatis源码-mapper接口流程分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.2" data-path="../mybatis/mybatis源码解析/mybatis源码学习总结1.html">
            
                <a href="../mybatis/mybatis源码解析/mybatis源码学习总结1.html">
            
                    
                        <b>1.10.3.2.</b>
                    
                    mybatis源码学习总结1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.3" data-path="../mybatis/mybatis源码解析/mybatis源码学习总结2.html">
            
                <a href="../mybatis/mybatis源码解析/mybatis源码学习总结2.html">
            
                    
                        <b>1.10.3.3.</b>
                    
                    mybatis源码学习总结2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.4" data-path="../mybatis/mybatis源码解析/spring管理mybatis事务分析.html">
            
                <a href="../mybatis/mybatis源码解析/spring管理mybatis事务分析.html">
            
                    
                        <b>1.10.3.4.</b>
                    
                    spring管理mybatis事务分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.5" data-path="../mybatis/mybatis源码解析/SqlSessionFactoryBean源码分析.html">
            
                <a href="../mybatis/mybatis源码解析/SqlSessionFactoryBean源码分析.html">
            
                    
                        <b>1.10.3.5.</b>
                    
                    SqlSessionFactoryBean源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.4" >
            
                <span>
            
                    
                        <b>1.10.4.</b>
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.4.1" data-path="../mybatis/源码/SqlSessionManager源码.html">
            
                <a href="../mybatis/源码/SqlSessionManager源码.html">
            
                    
                        <b>1.10.4.1.</b>
                    
                    SqlSessionManager源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../mybatis/mybatis-view1.html">
            
                <a href="../mybatis/mybatis-view1.html">
            
                    
                        <b>1.10.5.</b>
                    
                    Mybatis View 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../mybatis/mybatis学习.html">
            
                <a href="../mybatis/mybatis学习.html">
            
                    
                        <b>1.10.6.</b>
                    
                    mybatis学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../mybatis/MyBatis框架面试常见问题.html">
            
                <a href="../mybatis/MyBatis框架面试常见问题.html">
            
                    
                        <b>1.10.7.</b>
                    
                    MyBatis框架面试常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../mybatis/mybatis用法.html">
            
                <a href="../mybatis/mybatis用法.html">
            
                    
                        <b>1.10.8.</b>
                    
                    mybatis用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="../mybatis/mybatis相关.html">
            
                <a href="../mybatis/mybatis相关.html">
            
                    
                        <b>1.10.9.</b>
                    
                    mybatis相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="../mybatis/常见mybatis用法.html">
            
                <a href="../mybatis/常见mybatis用法.html">
            
                    
                        <b>1.10.10.</b>
                    
                    常见mybatis用法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                        <b>1.11.</b>
                    
                    Mybatis Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../mybatis-spring/Mybatis-Spring源码分析.html">
            
                <a href="../mybatis-spring/Mybatis-Spring源码分析.html">
            
                    
                        <b>1.11.1.</b>
                    
                    Mybatis-Spring源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                        <b>1.12.</b>
                    
                    Redis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" >
            
                <span>
            
                    
                        <b>1.12.1.</b>
                    
                    Redis Datastructure
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1.1" data-path="../redis/redis-datastructure/redis数据结构-hash.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-hash.html">
            
                    
                        <b>1.12.1.1.</b>
                    
                    redis数据结构hash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.2" data-path="../redis/redis-datastructure/redis数据结构-list.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-list.html">
            
                    
                        <b>1.12.1.2.</b>
                    
                    redis数据结构list
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.3" data-path="../redis/redis-datastructure/redis数据结构-redisDB主体数据结构.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-redisDB主体数据结构.html">
            
                    
                        <b>1.12.1.3.</b>
                    
                    redis数据结构redisDB主体数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.4" data-path="../redis/redis-datastructure/redis数据结构-string.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-string.html">
            
                    
                        <b>1.12.1.4.</b>
                    
                    redis数据结构string
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.5" data-path="../redis/redis-datastructure/redis数据结构-zset.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-zset.html">
            
                    
                        <b>1.12.1.5.</b>
                    
                    redis数据结构zset
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.6" data-path="../redis/redis-datastructure/redis数据结构-压缩列表ziplist.html">
            
                <a href="../redis/redis-datastructure/redis数据结构-压缩列表ziplist.html">
            
                    
                        <b>1.12.1.6.</b>
                    
                    redis数据结构压缩列表ziplist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.7" data-path="../redis/redis-datastructure/深究Redis的底层结构.html">
            
                <a href="../redis/redis-datastructure/深究Redis的底层结构.html">
            
                    
                        <b>1.12.1.7.</b>
                    
                    深究Redis的底层结构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.2" >
            
                <span>
            
                    
                        <b>1.12.2.</b>
                    
                    redis命令
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.2.1" data-path="../redis/redis命令/redis-set命令.html">
            
                <a href="../redis/redis命令/redis-set命令.html">
            
                    
                        <b>1.12.2.1.</b>
                    
                    redis-set命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2.2" data-path="../redis/redis命令/redis-string命令.html">
            
                <a href="../redis/redis命令/redis-string命令.html">
            
                    
                        <b>1.12.2.2.</b>
                    
                    redis-string命令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../redis/redis应用/redis应用.html">
            
                <a href="../redis/redis应用/redis应用.html">
            
                    
                        <b>1.12.3.</b>
                    
                    redis应用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.3.1" data-path="../redis/redis应用/cys-redis微信异步关注（队列）.html">
            
                <a href="../redis/redis应用/cys-redis微信异步关注（队列）.html">
            
                    
                        <b>1.12.3.1.</b>
                    
                    cys-redis队列实现微信异步关注
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.2" data-path="../redis/redis应用/cys-redis直播点击数（计数应用）.html">
            
                <a href="../redis/redis应用/cys-redis直播点击数（计数应用）.html">
            
                    
                        <b>1.12.3.2.</b>
                    
                    cys-redis直播点击数-计数应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.3" data-path="../redis/redis应用/cys-redis积分（列出今天项目或最新项目，最新评论的）.html">
            
                <a href="../redis/redis应用/cys-redis积分（列出今天项目或最新项目，最新评论的）.html">
            
                    
                        <b>1.12.3.3.</b>
                    
                    cys-redis积分-最新列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.4" data-path="../redis/redis应用/cys-redis队列.html">
            
                <a href="../redis/redis应用/cys-redis队列.html">
            
                    
                        <b>1.12.3.4.</b>
                    
                    cys-redis队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.5" data-path="../redis/redis应用/cys-redis验证码（临时性的，设计过期时间的应用）.html">
            
                <a href="../redis/redis应用/cys-redis验证码（临时性的，设计过期时间的应用）.html">
            
                    
                        <b>1.12.3.5.</b>
                    
                    cys-redis验证码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.6" data-path="../redis/redis应用/redis-string应用.html">
            
                <a href="../redis/redis应用/redis-string应用.html">
            
                    
                        <b>1.12.3.6.</b>
                    
                    redis-string应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.7" data-path="../redis/redis应用/redis-zset应用.html">
            
                <a href="../redis/redis应用/redis-zset应用.html">
            
                    
                        <b>1.12.3.7.</b>
                    
                    redis-zset应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../redis/jedis模板.html">
            
                <a href="../redis/jedis模板.html">
            
                    
                        <b>1.12.4.</b>
                    
                    jedis模板
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../redis/redis协议测试.html">
            
                <a href="../redis/redis协议测试.html">
            
                    
                        <b>1.12.5.</b>
                    
                    redis协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../redis/redis数据结构.html">
            
                <a href="../redis/redis数据结构.html">
            
                    
                        <b>1.12.6.</b>
                    
                    redis数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../redis/redis相关.html">
            
                <a href="../redis/redis相关.html">
            
                    
                        <b>1.12.7.</b>
                    
                    redis相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../redis/缓存.html">
            
                <a href="../redis/缓存.html">
            
                    
                        <b>1.12.8.</b>
                    
                    缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../redis/缓存和数据库一致性问题.html">
            
                <a href="../redis/缓存和数据库一致性问题.html">
            
                    
                        <b>1.12.9.</b>
                    
                    缓存和数据库一致性问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                        <b>1.13.</b>
                    
                    Servlet
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" >
            
                <span>
            
                    
                        <b>1.13.1.</b>
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1.1" data-path="../servlet/源码/ServerProperites源码.html">
            
                <a href="../servlet/源码/ServerProperites源码.html">
            
                    
                        <b>1.13.1.1.</b>
                    
                    ServerProperites源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../servlet/nio-bio-aio学习.html">
            
                <a href="../servlet/nio-bio-aio学习.html">
            
                    
                        <b>1.13.2.</b>
                    
                    Nio Bio Aio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../servlet/tomcat优化.html">
            
                <a href="../servlet/tomcat优化.html">
            
                    
                        <b>1.13.3.</b>
                    
                    Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../servlet/tomcat原理.html">
            
                <a href="../servlet/tomcat原理.html">
            
                    
                        <b>1.13.4.</b>
                    
                    tomcat原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.5" data-path="../servlet/tomcat在springboot中配置.html">
            
                <a href="../servlet/tomcat在springboot中配置.html">
            
                    
                        <b>1.13.5.</b>
                    
                    tomcat在springboot中配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                        <b>1.14.</b>
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" >
            
                <span>
            
                    
                        <b>1.14.1.</b>
                    
                    Aop
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1.1" >
            
                <span>
            
                    
                        <b>1.14.1.1.</b>
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1.1.1" data-path="../spring/aop/源码/JdkDanymicAopProxy源码.html">
            
                <a href="../spring/aop/源码/JdkDanymicAopProxy源码.html">
            
                    
                        <b>1.14.1.1.1.</b>
                    
                    JdkDanymicAopProxy源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.1.2" data-path="../spring/aop/aop动态代理学习.html">
            
                <a href="../spring/aop/aop动态代理学习.html">
            
                    
                        <b>1.14.1.2.</b>
                    
                    aop动态代理学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.1.3" data-path="../spring/aop/aop学习.html">
            
                <a href="../spring/aop/aop学习.html">
            
                    
                        <b>1.14.1.3.</b>
                    
                    mybatis学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.1.4" data-path="../spring/aop/cglib代理.html">
            
                <a href="../spring/aop/cglib代理.html">
            
                    
                        <b>1.14.1.4.</b>
                    
                    cglib代理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.2" >
            
                <span>
            
                    
                        <b>1.14.2.</b>
                    
                    Ioc
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.2.1" data-path="../spring/ioc/bean实例化过程.html">
            
                <a href="../spring/ioc/bean实例化过程.html">
            
                    
                        <b>1.14.2.1.</b>
                    
                    bean实例化过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.2" data-path="../spring/ioc/spring-ioc原理.html">
            
                <a href="../spring/ioc/spring-ioc原理.html">
            
                    
                        <b>1.14.2.2.</b>
                    
                    spring-ioc原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.3" data-path="../spring/ioc/spring循环依赖.html">
            
                <a href="../spring/ioc/spring循环依赖.html">
            
                    
                        <b>1.14.2.3.</b>
                    
                    spring循环依赖
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.3" >
            
                <span>
            
                    
                        <b>1.14.3.</b>
                    
                    Mvc
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.3.1" data-path="../spring/mvc/cookie.html">
            
                <a href="../spring/mvc/cookie.html">
            
                    
                        <b>1.14.3.1.</b>
                    
                    Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.2" data-path="../spring/mvc/spring-controller单例问题.html">
            
                <a href="../spring/mvc/spring-controller单例问题.html">
            
                    
                        <b>1.14.3.2.</b>
                    
                    spring-controller单例问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.3" data-path="../spring/mvc/spring-mvc.html">
            
                <a href="../spring/mvc/spring-mvc.html">
            
                    
                        <b>1.14.3.3.</b>
                    
                    Spring Mvc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.4" >
            
                <span>
            
                    
                        <b>1.14.4.</b>
                    
                    事务
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.4.1" data-path="../spring/事务/spring事务管理.html">
            
                <a href="../spring/事务/spring事务管理.html">
            
                    
                        <b>1.14.4.1.</b>
                    
                    spring事务管理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="../spring/动态数据源/动态数据源.html">
            
                <a href="../spring/动态数据源/动态数据源.html">
            
                    
                        <b>1.14.5.</b>
                    
                    动态数据源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.5.1" data-path="../spring/动态数据源/AbstractRoutingDataSource源码.html">
            
                <a href="../spring/动态数据源/AbstractRoutingDataSource源码.html">
            
                    
                        <b>1.14.5.1.</b>
                    
                    AbstractRoutingDataSource源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="../spring/Spring和SpringAOP源码总结.html">
            
                <a href="../spring/Spring和SpringAOP源码总结.html">
            
                    
                        <b>1.14.6.</b>
                    
                    Spring和SpringAOP源码总结
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                        <b>1.15.</b>
                    
                    Springboot
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" >
            
                <span>
            
                    
                        <b>1.15.1.</b>
                    
                    springboot配置
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1.1" data-path="../springboot/springboot配置/springboot配置文件加载分析.html">
            
                <a href="../springboot/springboot配置/springboot配置文件加载分析.html">
            
                    
                        <b>1.15.1.1.</b>
                    
                    springboot配置文件加载分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.1.2" data-path="../springboot/springboot配置/修改springboot默认加载application-properties文件.html">
            
                <a href="../springboot/springboot配置/修改springboot默认加载application-properties文件.html">
            
                    
                        <b>1.15.1.2.</b>
                    
                    修改springboot默认加载application.properties文件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.2" >
            
                <span>
            
                    
                        <b>1.15.2.</b>
                    
                    监听器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.2.1" data-path="../springboot/监听器/springboot监听器.html">
            
                <a href="../springboot/监听器/springboot监听器.html">
            
                    
                        <b>1.15.2.1.</b>
                    
                    springboot监听器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../springboot/SpringApplication源码分析.html">
            
                <a href="../springboot/SpringApplication源码分析.html">
            
                    
                        <b>1.15.3.</b>
                    
                    SpringApplication源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="../springboot/springboot-run方法源码分析.html">
            
                <a href="../springboot/springboot-run方法源码分析.html">
            
                    
                        <b>1.15.4.</b>
                    
                    springboot-run方法源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="../springboot/springboot使用外部服务器的启动流程.html">
            
                <a href="../springboot/springboot使用外部服务器的启动流程.html">
            
                    
                        <b>1.15.5.</b>
                    
                    springboot使用外部服务器的启动流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="../springboot/SpringBoot启动流程分析.html">
            
                <a href="../springboot/SpringBoot启动流程分析.html">
            
                    
                        <b>1.15.6.</b>
                    
                    SpringBoot启动流程分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="../springboot/springboot整合tomcat原理.html">
            
                <a href="../springboot/springboot整合tomcat原理.html">
            
                    
                        <b>1.15.7.</b>
                    
                    springboot整合Tomcat原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="../springboot/SpringBoot注解.html">
            
                <a href="../springboot/SpringBoot注解.html">
            
                    
                        <b>1.15.8.</b>
                    
                    SpringBoot注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="../springboot/springboot自动装配.html">
            
                <a href="../springboot/springboot自动装配.html">
            
                    
                        <b>1.15.9.</b>
                    
                    springboot自动装配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="../springboot/springboot配置DispatcherServlet.html">
            
                <a href="../springboot/springboot配置DispatcherServlet.html">
            
                    
                        <b>1.15.10.</b>
                    
                    springboot配置DispatcherServlet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="../springboot/springboot配置类configuration解析.html">
            
                <a href="../springboot/springboot配置类configuration解析.html">
            
                    
                        <b>1.15.11.</b>
                    
                    springboot配置类configuration解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <span>
            
                    
                        <b>1.16.</b>
                    
                    Zother 1 Java Face Notes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../zother1-JavaFaceNotes/Dubbo.html">
            
                <a href="../zother1-JavaFaceNotes/Dubbo.html">
            
                    
                        <b>1.16.1.</b>
                    
                    Dubbo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../zother1-JavaFaceNotes/IO&NIO.html">
            
                <a href="../zother1-JavaFaceNotes/IO&NIO.html">
            
                    
                        <b>1.16.2.</b>
                    
                    IO NIO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="../zother1-JavaFaceNotes/Java基础.html">
            
                <a href="../zother1-JavaFaceNotes/Java基础.html">
            
                    
                        <b>1.16.3.</b>
                    
                    Java基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="../zother1-JavaFaceNotes/java集合.html">
            
                <a href="../zother1-JavaFaceNotes/java集合.html">
            
                    
                        <b>1.16.4.</b>
                    
                    java集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="../zother1-JavaFaceNotes/JVM.html">
            
                <a href="../zother1-JavaFaceNotes/JVM.html">
            
                    
                        <b>1.16.5.</b>
                    
                    JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="../zother1-JavaFaceNotes/Kafka.html">
            
                <a href="../zother1-JavaFaceNotes/Kafka.html">
            
                    
                        <b>1.16.6.</b>
                    
                    Kafka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="../zother1-JavaFaceNotes/Linux.html">
            
                <a href="../zother1-JavaFaceNotes/Linux.html">
            
                    
                        <b>1.16.7.</b>
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="../zother1-JavaFaceNotes/Mybatis.html">
            
                <a href="../zother1-JavaFaceNotes/Mybatis.html">
            
                    
                        <b>1.16.8.</b>
                    
                    Mybatis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9" data-path="../zother1-JavaFaceNotes/MySql.html">
            
                <a href="../zother1-JavaFaceNotes/MySql.html">
            
                    
                        <b>1.16.9.</b>
                    
                    My Sql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="../zother1-JavaFaceNotes/Nginx.html">
            
                <a href="../zother1-JavaFaceNotes/Nginx.html">
            
                    
                        <b>1.16.10.</b>
                    
                    Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.11" data-path="../zother1-JavaFaceNotes/Redis.html">
            
                <a href="../zother1-JavaFaceNotes/Redis.html">
            
                    
                        <b>1.16.11.</b>
                    
                    Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12" data-path="../zother1-JavaFaceNotes/Spring.html">
            
                <a href="../zother1-JavaFaceNotes/Spring.html">
            
                    
                        <b>1.16.12.</b>
                    
                    Spring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.13" data-path="../zother1-JavaFaceNotes/SpringBoot.html">
            
                <a href="../zother1-JavaFaceNotes/SpringBoot.html">
            
                    
                        <b>1.16.13.</b>
                    
                    Spring Boot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.14" data-path="../zother1-JavaFaceNotes/SpringCloud.html">
            
                <a href="../zother1-JavaFaceNotes/SpringCloud.html">
            
                    
                        <b>1.16.14.</b>
                    
                    Spring Cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.15" data-path="../zother1-JavaFaceNotes/多线程.html">
            
                <a href="../zother1-JavaFaceNotes/多线程.html">
            
                    
                        <b>1.16.15.</b>
                    
                    多线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.16" data-path="../zother1-JavaFaceNotes/异常&反射.html">
            
                <a href="../zother1-JavaFaceNotes/异常&反射.html">
            
                    
                        <b>1.16.16.</b>
                    
                    异常&反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.17" data-path="../zother1-JavaFaceNotes/简历.html">
            
                <a href="../zother1-JavaFaceNotes/简历.html">
            
                    
                        <b>1.16.17.</b>
                    
                    简历
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.17.</b>
                    
                    Zother 5 Java Interview
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="Java基础学习.html">
            
                <a href="Java基础学习.html">
            
                    
                        <b>1.17.1.</b>
                    
                    Java基础学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="Java集合面试题及答案.html">
            
                <a href="Java集合面试题及答案.html">
            
                    
                        <b>1.17.2.</b>
                    
                    Java集合面试题及答案
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="一、Java基础.html">
            
                <a href="一、Java基础.html">
            
                    
                        <b>1.17.3.</b>
                    
                    一、Java基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="七、JavaWeb.html">
            
                <a href="七、JavaWeb.html">
            
                    
                        <b>1.17.4.</b>
                    
                    七、JavaWeb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5" data-path="三、Java 集合.html">
            
                <a href="三、Java 集合.html">
            
                    
                        <b>1.17.5.</b>
                    
                    三、Java 集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.6" data-path="九、操作系统.html">
            
                <a href="九、操作系统.html">
            
                    
                        <b>1.17.6.</b>
                    
                    九、操作系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.7" data-path="二、设计模式.html">
            
                <a href="二、设计模式.html">
            
                    
                        <b>1.17.7.</b>
                    
                    二、设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.8" data-path="二十、Spring源码解析.html">
            
                <a href="二十、Spring源码解析.html">
            
                    
                        <b>1.17.8.</b>
                    
                    二十、Spring源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.17.9" data-path="二十一、Tomcat源码解析.html">
            
                <a href="二十一、Tomcat源码解析.html">
            
                    
                        <b>1.17.9.</b>
                    
                    二十一、Tomcat源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.10" data-path="五、JVM.html">
            
                <a href="五、JVM.html">
            
                    
                        <b>1.17.10.</b>
                    
                    五、JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.11" data-path="八、Mysql.html">
            
                <a href="八、Mysql.html">
            
                    
                        <b>1.17.11.</b>
                    
                    八、Mysql
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <span>
            
                    
                        <b>1.18.</b>
                    
                    Zother 7 Java Interview
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" >
            
                <span>
            
                    
                        <b>1.18.1.</b>
                    
                    Data Structures Algorithms
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1.1" data-path="../zother7-JavaInterview/dataStructures-algorithms/算法面试真题汇总.html">
            
                <a href="../zother7-JavaInterview/dataStructures-algorithms/算法面试真题汇总.html">
            
                    
                        <b>1.18.1.1.</b>
                    
                    算法面试真题汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.1.2" data-path="../zother7-JavaInterview/dataStructures-algorithms/算法题目难点题目总结.html">
            
                <a href="../zother7-JavaInterview/dataStructures-algorithms/算法题目难点题目总结.html">
            
                    
                        <b>1.18.1.2.</b>
                    
                    算法题目难点题目总结
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.1.3" data-path="../zother7-JavaInterview/dataStructures-algorithms/递归套路总结.html">
            
                <a href="../zother7-JavaInterview/dataStructures-algorithms/递归套路总结.html">
            
                    
                        <b>1.18.1.3.</b>
                    
                    递归套路总结
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.2" >
            
                <span>
            
                    
                        <b>1.18.2.</b>
                    
                    Interview
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.2.1" data-path="../zother7-JavaInterview/interview/已投公司情况.html">
            
                <a href="../zother7-JavaInterview/interview/已投公司情况.html">
            
                    
                        <b>1.18.2.1.</b>
                    
                    已投公司情况
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2.2" data-path="../zother7-JavaInterview/interview/自我介绍和项目介绍.html">
            
                <a href="../zother7-JavaInterview/interview/自我介绍和项目介绍.html">
            
                    
                        <b>1.18.2.2.</b>
                    
                    自我介绍和项目介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.3" >
            
                <span>
            
                    
                        <b>1.18.3.</b>
                    
                    Interview Experience
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.3.1" data-path="../zother7-JavaInterview/interview-experience/各大公司面经.html">
            
                <a href="../zother7-JavaInterview/interview-experience/各大公司面经.html">
            
                    
                        <b>1.18.3.1.</b>
                    
                    各大公司面经
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3.2" data-path="../zother7-JavaInterview/interview-experience/面试常见知识.html">
            
                <a href="../zother7-JavaInterview/interview-experience/面试常见知识.html">
            
                    
                        <b>1.18.3.2.</b>
                    
                    面试常见知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3.3" data-path="../zother7-JavaInterview/interview-experience/面试常见问题分类汇总.html">
            
                <a href="../zother7-JavaInterview/interview-experience/面试常见问题分类汇总.html">
            
                    
                        <b>1.18.3.3.</b>
                    
                    面试常见问题分类汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.4" >
            
                <span>
            
                    
                        <b>1.18.4.</b>
                    
                    Microservice
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.4.1" data-path="../zother7-JavaInterview/microservice/微服务相关资料.html">
            
                <a href="../zother7-JavaInterview/microservice/微服务相关资料.html">
            
                    
                        <b>1.18.4.1.</b>
                    
                    微服务相关资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.5" >
            
                <span>
            
                    
                        <b>1.18.5.</b>
                    
                    Network
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.5.1" data-path="../zother7-JavaInterview/network/http面试问题全解析.html">
            
                <a href="../zother7-JavaInterview/network/http面试问题全解析.html">
            
                    
                        <b>1.18.5.1.</b>
                    
                    http面试问题全解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.6" >
            
                <span>
            
                    
                        <b>1.18.6.</b>
                    
                    Operating System
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.6.1" data-path="../zother7-JavaInterview/operating-system/后端程序员必备的Linux基础知识.html">
            
                <a href="../zother7-JavaInterview/operating-system/后端程序员必备的Linux基础知识.html">
            
                    
                        <b>1.18.6.1.</b>
                    
                    后端程序员必备的Linux基础知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.6.2" data-path="../zother7-JavaInterview/operating-system/操作系统、计算机网络相关知识.html">
            
                <a href="../zother7-JavaInterview/operating-system/操作系统、计算机网络相关知识.html">
            
                    
                        <b>1.18.6.2.</b>
                    
                    操作系统、计算机网络相关知识
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.7" >
            
                <span>
            
                    
                        <b>1.18.7.</b>
                    
                    Project
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.7.1" data-path="../zother7-JavaInterview/project/消息中间件面试题.html">
            
                <a href="../zother7-JavaInterview/project/消息中间件面试题.html">
            
                    
                        <b>1.18.7.1.</b>
                    
                    消息中间件面试题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.7.2" data-path="../zother7-JavaInterview/project/秒杀项目总结.html">
            
                <a href="../zother7-JavaInterview/project/秒杀项目总结.html">
            
                    
                        <b>1.18.7.2.</b>
                    
                    秒杀项目总结
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" >
            
                <span>
            
                    
                        <b>1.19.</b>
                    
                    Zother 8 Java Book
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" >
            
                <span>
            
                    
                        <b>1.19.1.</b>
                    
                    Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1.1" data-path="../zother8-JavaBook/Basics/Java面试基础常见问题.html">
            
                <a href="../zother8-JavaBook/Basics/Java面试基础常见问题.html">
            
                    
                        <b>1.19.1.1.</b>
                    
                    Java面试基础常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.1.2" data-path="../zother8-JavaBook/Basics/Java面试基础知识.html">
            
                <a href="../zother8-JavaBook/Basics/Java面试基础知识.html">
            
                    
                        <b>1.19.1.2.</b>
                    
                    Java面试基础知识
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.2" >
            
                <span>
            
                    
                        <b>1.19.2.</b>
                    
                    Collections
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.2.1" data-path="../zother8-JavaBook/Collections/HashMap-ConcurrentHashMap面试必问.html">
            
                <a href="../zother8-JavaBook/Collections/HashMap-ConcurrentHashMap面试必问.html">
            
                    
                        <b>1.19.2.1.</b>
                    
                    HashMap-ConcurrentHashMap面试必问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.2" data-path="../zother8-JavaBook/Collections/Java面经-ArrayList源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-ArrayList源码解析.html">
            
                    
                        <b>1.19.2.2.</b>
                    
                    Java面经-ArrayList源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.3" data-path="../zother8-JavaBook/Collections/Java面经-HashSet-HashMap源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-HashSet-HashMap源码解析.html">
            
                    
                        <b>1.19.2.3.</b>
                    
                    Java面经-HashSet-HashMap源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.4" data-path="../zother8-JavaBook/Collections/Java面经-Java集合框架.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-Java集合框架.html">
            
                    
                        <b>1.19.2.4.</b>
                    
                    Java面经-Java集合框架
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.5" data-path="../zother8-JavaBook/Collections/Java面经-LinkedHashSet-Map源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-LinkedHashSet-Map源码解析.html">
            
                    
                        <b>1.19.2.5.</b>
                    
                    Java面经-LinkedHashSet-Map源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.6" data-path="../zother8-JavaBook/Collections/Java面经-LinkedList源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-LinkedList源码解析.html">
            
                    
                        <b>1.19.2.6.</b>
                    
                    Java面经-LinkedList源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.7" data-path="../zother8-JavaBook/Collections/Java面经-PriorityQueue源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-PriorityQueue源码解析.html">
            
                    
                        <b>1.19.2.7.</b>
                    
                    Java面经-PriorityQueue源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.8" data-path="../zother8-JavaBook/Collections/Java面经-Stack-Queue源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-Stack-Queue源码解析.html">
            
                    
                        <b>1.19.2.8.</b>
                    
                    Java面经-Stack-Queue源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2.9" data-path="../zother8-JavaBook/Collections/Java面经-TreeSet-TreeMap源码解析.html">
            
                <a href="../zother8-JavaBook/Collections/Java面经-TreeSet-TreeMap源码解析.html">
            
                    
                        <b>1.19.2.9.</b>
                    
                    Java面经-TreeSet-TreeMap源码解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3" >
            
                <span>
            
                    
                        <b>1.19.3.</b>
                    
                    Interview
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.1" >
            
                <span>
            
                    
                        <b>1.19.3.1.</b>
                    
                    Bishi
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.1.1" data-path="../zother8-JavaBook/Interview/bishi/pdd.html">
            
                <a href="../zother8-JavaBook/Interview/bishi/pdd.html">
            
                    
                        <b>1.19.3.1.1.</b>
                    
                    Pdd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2" >
            
                <span>
            
                    
                        <b>1.19.3.2.</b>
                    
                    Codes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.1" >
            
                <span>
            
                    
                        <b>1.19.3.2.1.</b>
                    
                    Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.1.1" data-path="../zother8-JavaBook/Interview/codes/basics/equals和hashcode.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/equals和hashcode.html">
            
                    
                        <b>1.19.3.2.1.1.</b>
                    
                    equals和hashcode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.2" data-path="../zother8-JavaBook/Interview/codes/basics/IO的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/IO的一些问题.html">
            
                    
                        <b>1.19.3.2.1.2.</b>
                    
                    IO的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.3" data-path="../zother8-JavaBook/Interview/codes/basics/Java值传递的问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/Java值传递的问题.html">
            
                    
                        <b>1.19.3.2.1.3.</b>
                    
                    Java值传递的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.4" data-path="../zother8-JavaBook/Interview/codes/basics/String的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/String的一些问题.html">
            
                    
                        <b>1.19.3.2.1.4.</b>
                    
                    String的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.5" data-path="../zother8-JavaBook/Interview/codes/basics/反射的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/反射的一些问题.html">
            
                    
                        <b>1.19.3.2.1.5.</b>
                    
                    反射的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.6" data-path="../zother8-JavaBook/Interview/codes/basics/常见关键字问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/常见关键字问题.html">
            
                    
                        <b>1.19.3.2.1.6.</b>
                    
                    常见关键字问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.7" data-path="../zother8-JavaBook/Interview/codes/basics/异常的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/异常的一些问题.html">
            
                    
                        <b>1.19.3.2.1.7.</b>
                    
                    异常的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.8" data-path="../zother8-JavaBook/Interview/codes/basics/浅拷贝和深拷贝例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/浅拷贝和深拷贝例子.html">
            
                    
                        <b>1.19.3.2.1.8.</b>
                    
                    浅拷贝和深拷贝例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.9" data-path="../zother8-JavaBook/Interview/codes/basics/类型转换的问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/类型转换的问题.html">
            
                    
                        <b>1.19.3.2.1.9.</b>
                    
                    类型转换的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.1.10" data-path="../zother8-JavaBook/Interview/codes/basics/面向对象的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/basics/面向对象的一些问题.html">
            
                    
                        <b>1.19.3.2.1.10.</b>
                    
                    面向对象的一些问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2" >
            
                <span>
            
                    
                        <b>1.19.3.2.2.</b>
                    
                    Bus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.2.1" data-path="../zother8-JavaBook/Interview/codes/bus/Redis的key过期事件.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/Redis的key过期事件.html">
            
                    
                        <b>1.19.3.2.2.1.</b>
                    
                    Redis的key过期事件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.2" data-path="../zother8-JavaBook/Interview/codes/bus/Redis绑定Token.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/Redis绑定Token.html">
            
                    
                        <b>1.19.3.2.2.2.</b>
                    
                    Redis绑定Token
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.3" data-path="../zother8-JavaBook/Interview/codes/bus/RocketMQ最终一致性.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/RocketMQ最终一致性.html">
            
                    
                        <b>1.19.3.2.2.3.</b>
                    
                    RocketMQ最终一致性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.4" data-path="../zother8-JavaBook/Interview/codes/bus/上线遇到的bug.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/上线遇到的bug.html">
            
                    
                        <b>1.19.3.2.2.4.</b>
                    
                    上线遇到的bug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.5" data-path="../zother8-JavaBook/Interview/codes/bus/业务逻辑SQL语句.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/业务逻辑SQL语句.html">
            
                    
                        <b>1.19.3.2.2.5.</b>
                    
                    业务逻辑SQL语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.6" data-path="../zother8-JavaBook/Interview/codes/bus/支付服务.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/支付服务.html">
            
                    
                        <b>1.19.3.2.2.6.</b>
                    
                    支付服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.7" data-path="../zother8-JavaBook/Interview/codes/bus/环境搭建文档.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/环境搭建文档.html">
            
                    
                        <b>1.19.3.2.2.7.</b>
                    
                    环境搭建文档
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.8" data-path="../zother8-JavaBook/Interview/codes/bus/班车服务.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/班车服务.html">
            
                    
                        <b>1.19.3.2.2.8.</b>
                    
                    班车服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.9" data-path="../zother8-JavaBook/Interview/codes/bus/用户服务.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/用户服务.html">
            
                    
                        <b>1.19.3.2.2.9.</b>
                    
                    用户服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.2.10" data-path="../zother8-JavaBook/Interview/codes/bus/订单服务.html">
            
                <a href="../zother8-JavaBook/Interview/codes/bus/订单服务.html">
            
                    
                        <b>1.19.3.2.2.10.</b>
                    
                    订单服务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3" >
            
                <span>
            
                    
                        <b>1.19.3.2.3.</b>
                    
                    Collection
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.3.1" data-path="../zother8-JavaBook/Interview/codes/collection/ArrayList的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/ArrayList的一些问题.html">
            
                    
                        <b>1.19.3.2.3.1.</b>
                    
                    ArrayList的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.2" data-path="../zother8-JavaBook/Interview/codes/collection/BlockingQueue的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/BlockingQueue的一些问题.html">
            
                    
                        <b>1.19.3.2.3.2.</b>
                    
                    BlockingQueue的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.3" data-path="../zother8-JavaBook/Interview/codes/collection/ConcurrentHashMap的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/ConcurrentHashMap的一些问题.html">
            
                    
                        <b>1.19.3.2.3.3.</b>
                    
                    ConcurrentHashMap的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.4" data-path="../zother8-JavaBook/Interview/codes/collection/HashMap的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/HashMap的一些问题.html">
            
                    
                        <b>1.19.3.2.3.4.</b>
                    
                    HashMap的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.5" data-path="../zother8-JavaBook/Interview/codes/collection/LinkedList的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/LinkedList的一些问题.html">
            
                    
                        <b>1.19.3.2.3.5.</b>
                    
                    LinkedList的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.6" data-path="../zother8-JavaBook/Interview/codes/collection/手写LRU算法.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/手写LRU算法.html">
            
                    
                        <b>1.19.3.2.3.6.</b>
                    
                    手写LRU算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.3.7" data-path="../zother8-JavaBook/Interview/codes/collection/集合总览.html">
            
                <a href="../zother8-JavaBook/Interview/codes/collection/集合总览.html">
            
                    
                        <b>1.19.3.2.3.7.</b>
                    
                    集合总览
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.4" >
            
                <span>
            
                    
                        <b>1.19.3.2.4.</b>
                    
                    Jvm
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.4.1" data-path="../zother8-JavaBook/Interview/codes/jvm/堆溢出的小例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/jvm/堆溢出的小例子.html">
            
                    
                        <b>1.19.3.2.4.1.</b>
                    
                    堆溢出的小例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.4.2" data-path="../zother8-JavaBook/Interview/codes/jvm/循环引用的小例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/jvm/循环引用的小例子.html">
            
                    
                        <b>1.19.3.2.4.2.</b>
                    
                    循环引用的小例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.4.3" data-path="../zother8-JavaBook/Interview/codes/jvm/查看反编译源码.html">
            
                <a href="../zother8-JavaBook/Interview/codes/jvm/查看反编译源码.html">
            
                    
                        <b>1.19.3.2.4.3.</b>
                    
                    查看反编译源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.4.4" data-path="../zother8-JavaBook/Interview/codes/jvm/栈溢出的小例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/jvm/栈溢出的小例子.html">
            
                    
                        <b>1.19.3.2.4.4.</b>
                    
                    栈溢出的小例子
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5" >
            
                <span>
            
                    
                        <b>1.19.3.2.5.</b>
                    
                    Modes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.5.1" data-path="../zother8-JavaBook/Interview/codes/modes/代理模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/代理模式.html">
            
                    
                        <b>1.19.3.2.5.1.</b>
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5.2" data-path="../zother8-JavaBook/Interview/codes/modes/单例模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/单例模式.html">
            
                    
                        <b>1.19.3.2.5.2.</b>
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5.3" data-path="../zother8-JavaBook/Interview/codes/modes/工厂模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/工厂模式.html">
            
                    
                        <b>1.19.3.2.5.3.</b>
                    
                    工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5.4" data-path="../zother8-JavaBook/Interview/codes/modes/模板方法模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/模板方法模式.html">
            
                    
                        <b>1.19.3.2.5.4.</b>
                    
                    模板方法模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5.5" data-path="../zother8-JavaBook/Interview/codes/modes/装饰器模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/装饰器模式.html">
            
                    
                        <b>1.19.3.2.5.5.</b>
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.5.6" data-path="../zother8-JavaBook/Interview/codes/modes/观察者模式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/modes/观察者模式.html">
            
                    
                        <b>1.19.3.2.5.6.</b>
                    
                    观察者模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6" >
            
                <span>
            
                    
                        <b>1.19.3.2.6.</b>
                    
                    Mysql
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.6.1" data-path="../zother8-JavaBook/Interview/codes/mysql/InnoDB和MyISAM.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/InnoDB和MyISAM.html">
            
                    
                        <b>1.19.3.2.6.1.</b>
                    
                    InnoDB和MyISAM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.2" data-path="../zother8-JavaBook/Interview/codes/mysql/MVCC的缺点.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/MVCC的缺点.html">
            
                    
                        <b>1.19.3.2.6.2.</b>
                    
                    MVCC的缺点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.3" data-path="../zother8-JavaBook/Interview/codes/mysql/MySQL是如何执行一条SQL语句的.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/MySQL是如何执行一条SQL语句的.html">
            
                    
                        <b>1.19.3.2.6.3.</b>
                    
                    MySQL是如何执行一条SQL语句的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.4" data-path="../zother8-JavaBook/Interview/codes/mysql/MySQL的ACID原理.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/MySQL的ACID原理.html">
            
                    
                        <b>1.19.3.2.6.4.</b>
                    
                    MySQL的ACID原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.5" data-path="../zother8-JavaBook/Interview/codes/mysql/MySQL读写分离主从复制原理.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/MySQL读写分离主从复制原理.html">
            
                    
                        <b>1.19.3.2.6.5.</b>
                    
                    MySQL读写分离主从复制原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.6" data-path="../zother8-JavaBook/Interview/codes/mysql/并发事务带来的问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/并发事务带来的问题.html">
            
                    
                        <b>1.19.3.2.6.6.</b>
                    
                    并发事务带来的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.7" data-path="../zother8-JavaBook/Interview/codes/mysql/数据库结构优化.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/数据库结构优化.html">
            
                    
                        <b>1.19.3.2.6.7.</b>
                    
                    数据库结构优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.8" data-path="../zother8-JavaBook/Interview/codes/mysql/数据库范式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/数据库范式.html">
            
                    
                        <b>1.19.3.2.6.8.</b>
                    
                    数据库范式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.9" data-path="../zother8-JavaBook/Interview/codes/mysql/索引种类.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/索引种类.html">
            
                    
                        <b>1.19.3.2.6.9.</b>
                    
                    索引种类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.6.10" data-path="../zother8-JavaBook/Interview/codes/mysql/红黑树、B树和B+树.html">
            
                <a href="../zother8-JavaBook/Interview/codes/mysql/红黑树、B树和B+树.html">
            
                    
                        <b>1.19.3.2.6.10.</b>
                    
                    红黑树、B树和B+树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.7" >
            
                <span>
            
                    
                        <b>1.19.3.2.7.</b>
                    
                    Other
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.7.1" data-path="../zother8-JavaBook/Interview/codes/other/Sentinel相关概念.html">
            
                <a href="../zother8-JavaBook/Interview/codes/other/Sentinel相关概念.html">
            
                    
                        <b>1.19.3.2.7.1.</b>
                    
                    Sentinel相关概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.8" >
            
                <span>
            
                    
                        <b>1.19.3.2.8.</b>
                    
                    Redis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.8.1" data-path="../zother8-JavaBook/Interview/codes/redis/Redis做延迟队列.html">
            
                <a href="../zother8-JavaBook/Interview/codes/redis/Redis做延迟队列.html">
            
                    
                        <b>1.19.3.2.8.1.</b>
                    
                    Redis做延迟队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.8.2" data-path="../zother8-JavaBook/Interview/codes/redis/深究Redis的底层结构.html">
            
                <a href="../zother8-JavaBook/Interview/codes/redis/深究Redis的底层结构.html">
            
                    
                        <b>1.19.3.2.8.2.</b>
                    
                    深究Redis的底层结构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.9" >
            
                <span>
            
                    
                        <b>1.19.3.2.9.</b>
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.9.1" data-path="../zother8-JavaBook/Interview/codes/spring/手写SpringAOP代码.html">
            
                <a href="../zother8-JavaBook/Interview/codes/spring/手写SpringAOP代码.html">
            
                    
                        <b>1.19.3.2.9.1.</b>
                    
                    手写SpringAOP代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.9.2" data-path="../zother8-JavaBook/Interview/codes/spring/手写SpringIoc容器.html">
            
                <a href="../zother8-JavaBook/Interview/codes/spring/手写SpringIoc容器.html">
            
                    
                        <b>1.19.3.2.9.2.</b>
                    
                    手写SpringIoc容器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10" >
            
                <span>
            
                    
                        <b>1.19.3.2.10.</b>
                    
                    Thread
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.2.10.1" data-path="../zother8-JavaBook/Interview/codes/thread/AQS的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/AQS的一些问题.html">
            
                    
                        <b>1.19.3.2.10.1.</b>
                    
                    AQS的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.2" data-path="../zother8-JavaBook/Interview/codes/thread/CAS的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/CAS的一些问题.html">
            
                    
                        <b>1.19.3.2.10.2.</b>
                    
                    CAS的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.3" data-path="../zother8-JavaBook/Interview/codes/thread/Java锁的介绍.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/Java锁的介绍.html">
            
                    
                        <b>1.19.3.2.10.3.</b>
                    
                    Java锁的介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.4" data-path="../zother8-JavaBook/Interview/codes/thread/Runnable、Callable和FutureTask.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/Runnable、Callable和FutureTask.html">
            
                    
                        <b>1.19.3.2.10.4.</b>
                    
                    Runnable、Callable和FutureTask
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.5" data-path="../zother8-JavaBook/Interview/codes/thread/synchronized的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/synchronized的一些问题.html">
            
                    
                        <b>1.19.3.2.10.5.</b>
                    
                    synchronized的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.6" data-path="../zother8-JavaBook/Interview/codes/thread/ThreadLocal的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/ThreadLocal的一些问题.html">
            
                    
                        <b>1.19.3.2.10.6.</b>
                    
                    ThreadLocal的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.7" data-path="../zother8-JavaBook/Interview/codes/thread/volatile的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/volatile的一些问题.html">
            
                    
                        <b>1.19.3.2.10.7.</b>
                    
                    volatile的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.8" data-path="../zother8-JavaBook/Interview/codes/thread/主线程等待多个子线程的例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/主线程等待多个子线程的例子.html">
            
                    
                        <b>1.19.3.2.10.8.</b>
                    
                    主线程等待多个子线程的例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.9" data-path="../zother8-JavaBook/Interview/codes/thread/举个多线程的小例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/举个多线程的小例子.html">
            
                    
                        <b>1.19.3.2.10.9.</b>
                    
                    举个多线程的小例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.10" data-path="../zother8-JavaBook/Interview/codes/thread/死锁例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/死锁例子.html">
            
                    
                        <b>1.19.3.2.10.10.</b>
                    
                    死锁例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.11" data-path="../zother8-JavaBook/Interview/codes/thread/生产者和消费者的三种例子.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/生产者和消费者的三种例子.html">
            
                    
                        <b>1.19.3.2.10.11.</b>
                    
                    生产者和消费者的三种例子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.12" data-path="../zother8-JavaBook/Interview/codes/thread/线程池的一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/线程池的一些问题.html">
            
                    
                        <b>1.19.3.2.10.12.</b>
                    
                    线程池的一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.13" data-path="../zother8-JavaBook/Interview/codes/thread/线程生命周期一些问题.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/线程生命周期一些问题.html">
            
                    
                        <b>1.19.3.2.10.13.</b>
                    
                    线程生命周期一些问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.2.10.14" data-path="../zother8-JavaBook/Interview/codes/thread/线程的启动方式.html">
            
                <a href="../zother8-JavaBook/Interview/codes/thread/线程的启动方式.html">
            
                    
                        <b>1.19.3.2.10.14.</b>
                    
                    线程的启动方式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.3" >
            
                <span>
            
                    
                        <b>1.19.3.3.</b>
                    
                    Crazy
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.3.1" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Dubbo.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Dubbo.html">
            
                    
                        <b>1.19.3.3.1.</b>
                    
                    个人吐血系列-总结Dubbo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.2" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java基础.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java基础.html">
            
                    
                        <b>1.19.3.3.2.</b>
                    
                    个人吐血系列-总结Java基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.3" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java多线程.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java多线程.html">
            
                    
                        <b>1.19.3.3.3.</b>
                    
                    个人吐血系列-总结Java多线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.4" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java集合.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Java集合.html">
            
                    
                        <b>1.19.3.3.4.</b>
                    
                    个人吐血系列-总结Java集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.5" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结JVM.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结JVM.html">
            
                    
                        <b>1.19.3.3.5.</b>
                    
                    个人吐血系列-总结JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.6" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Mybatis.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Mybatis.html">
            
                    
                        <b>1.19.3.3.6.</b>
                    
                    个人吐血系列-总结Mybatis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.7" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结MySQL.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结MySQL.html">
            
                    
                        <b>1.19.3.3.7.</b>
                    
                    个人吐血系列-总结Mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.8" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Redis.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Redis.html">
            
                    
                        <b>1.19.3.3.8.</b>
                    
                    个人吐血系列-总结Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.9" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结RocketMQ.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结RocketMQ.html">
            
                    
                        <b>1.19.3.3.9.</b>
                    
                    个人吐血系列-总结RocketMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.10" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Spring.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结Spring.html">
            
                    
                        <b>1.19.3.3.10.</b>
                    
                    个人吐血系列-总结Spring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.3.11" data-path="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结计算机网络.html">
            
                <a href="../zother8-JavaBook/Interview/crazy/个人吐血系列-总结计算机网络.html">
            
                    
                        <b>1.19.3.3.11.</b>
                    
                    个人吐血系列-总结计算机网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.4" >
            
                <span>
            
                    
                        <b>1.19.3.4.</b>
                    
                    Linux
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.4.1" data-path="../zother8-JavaBook/Interview/linux/linux-基础.html">
            
                <a href="../zother8-JavaBook/Interview/linux/linux-基础.html">
            
                    
                        <b>1.19.3.4.1.</b>
                    
                    linux-基础
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5" >
            
                <span>
            
                    
                        <b>1.19.3.5.</b>
                    
                    Mianjing
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.1" >
            
                <span>
            
                    
                        <b>1.19.3.5.1.</b>
                    
                    Jingdong
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.1.1" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong01.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong01.html">
            
                    
                        <b>1.19.3.5.1.1.</b>
                    
                    Jingdong 01
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.2" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong02.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong02.html">
            
                    
                        <b>1.19.3.5.1.2.</b>
                    
                    Jingdong 02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.3" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong03.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong03.html">
            
                    
                        <b>1.19.3.5.1.3.</b>
                    
                    Jingdong 03
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.4" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong04.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong04.html">
            
                    
                        <b>1.19.3.5.1.4.</b>
                    
                    Jingdong 04
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.5" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong05.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/jingdong05.html">
            
                    
                        <b>1.19.3.5.1.5.</b>
                    
                    Jingdong 05
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.6" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/京东所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/京东所有问题汇总.html">
            
                    
                        <b>1.19.3.5.1.6.</b>
                    
                    京东所有问题汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.1.7" data-path="../zother8-JavaBook/Interview/mianjing/jingdong/本人京东面经.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/jingdong/本人京东面经.html">
            
                    
                        <b>1.19.3.5.1.7.</b>
                    
                    本人京东面经
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2" >
            
                <span>
            
                    
                        <b>1.19.3.5.2.</b>
                    
                    Meituan
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.2.1" data-path="../zother8-JavaBook/Interview/mianjing/meituan/meituan01.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/meituan01.html">
            
                    
                        <b>1.19.3.5.2.1.</b>
                    
                    Meituan 01
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2.2" data-path="../zother8-JavaBook/Interview/mianjing/meituan/meituan02.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/meituan02.html">
            
                    
                        <b>1.19.3.5.2.2.</b>
                    
                    Meituan 02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2.3" data-path="../zother8-JavaBook/Interview/mianjing/meituan/meituan03.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/meituan03.html">
            
                    
                        <b>1.19.3.5.2.3.</b>
                    
                    Meituan 03
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2.4" data-path="../zother8-JavaBook/Interview/mianjing/meituan/meituan04.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/meituan04.html">
            
                    
                        <b>1.19.3.5.2.4.</b>
                    
                    Meituan 04
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2.5" data-path="../zother8-JavaBook/Interview/mianjing/meituan/meituan05.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/meituan05.html">
            
                    
                        <b>1.19.3.5.2.5.</b>
                    
                    Meituan 05
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.2.6" data-path="../zother8-JavaBook/Interview/mianjing/meituan/美团所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/meituan/美团所有问题汇总.html">
            
                    
                        <b>1.19.3.5.2.6.</b>
                    
                    美团所有问题汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.3" >
            
                <span>
            
                    
                        <b>1.19.3.5.3.</b>
                    
                    Pinxx
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.3.1" data-path="../zother8-JavaBook/Interview/mianjing/pinxx/拼多多所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/pinxx/拼多多所有问题汇总.html">
            
                    
                        <b>1.19.3.5.3.1.</b>
                    
                    拼多多所有问题汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.4" data-path="../zother8-JavaBook/Interview/mianjing/sql/sql.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/sql/sql.html">
            
                    
                        <b>1.19.3.5.4.</b>
                    
                    Sql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.5" >
            
                <span>
            
                    
                        <b>1.19.3.5.5.</b>
                    
                    Wangyi
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.5.1" data-path="../zother8-JavaBook/Interview/mianjing/wangyi/网易所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/wangyi/网易所有问题汇总.html">
            
                    
                        <b>1.19.3.5.5.1.</b>
                    
                    网易所有问题汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.6" >
            
                <span>
            
                    
                        <b>1.19.3.5.6.</b>
                    
                    Yuanjing
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.6.1" data-path="../zother8-JavaBook/Interview/mianjing/yuanjing/远景所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/yuanjing/远景所有问题汇总.html">
            
                    
                        <b>1.19.3.5.6.1.</b>
                    
                    远景所有问题汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.7" >
            
                <span>
            
                    
                        <b>1.19.3.5.7.</b>
                    
                    Zhaoyin
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.7.1" data-path="../zother8-JavaBook/Interview/mianjing/zhaoyin/招银所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/zhaoyin/招银所有问题汇总.html">
            
                    
                        <b>1.19.3.5.7.1.</b>
                    
                    招银所有问题汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.7.2" data-path="../zother8-JavaBook/Interview/mianjing/zhaoyin/本人招银面经.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/zhaoyin/本人招银面经.html">
            
                    
                        <b>1.19.3.5.7.2.</b>
                    
                    本人招银面经
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.5.8" >
            
                <span>
            
                    
                        <b>1.19.3.5.8.</b>
                    
                    Zijie
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.5.8.1" data-path="../zother8-JavaBook/Interview/mianjing/zijie/字节所有问题汇总.html">
            
                <a href="../zother8-JavaBook/Interview/mianjing/zijie/字节所有问题汇总.html">
            
                    
                        <b>1.19.3.5.8.1.</b>
                    
                    字节所有问题汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.6" >
            
                <span>
            
                    
                        <b>1.19.3.6.</b>
                    
                    Mybatis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.6.1" data-path="../zother8-JavaBook/Interview/mybatis/MyBatis面试常见问题.html">
            
                <a href="../zother8-JavaBook/Interview/mybatis/MyBatis面试常见问题.html">
            
                    
                        <b>1.19.3.6.1.</b>
                    
                    MyBatis面试常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.7" >
            
                <span>
            
                    
                        <b>1.19.3.7.</b>
                    
                    Mysql
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.7.1" data-path="../zother8-JavaBook/Interview/mysql/Mysql-面试常见的问题.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/Mysql-面试常见的问题.html">
            
                    
                        <b>1.19.3.7.1.</b>
                    
                    Mysql-面试常见的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.7.2" data-path="../zother8-JavaBook/Interview/mysql/Mysql中ACID的原理.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/Mysql中ACID的原理.html">
            
                    
                        <b>1.19.3.7.2.</b>
                    
                    Mysql中ACID的原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.7.3" data-path="../zother8-JavaBook/Interview/mysql/MySQL面试常见问题.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/MySQL面试常见问题.html">
            
                    
                        <b>1.19.3.7.3.</b>
                    
                    MySQL面试常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.7.4" data-path="../zother8-JavaBook/Interview/mysql/sql-存储引擎.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/sql-存储引擎.html">
            
                    
                        <b>1.19.3.7.4.</b>
                    
                    sql-存储引擎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.7.5" data-path="../zother8-JavaBook/Interview/mysql/sql-数据库系统原理.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/sql-数据库系统原理.html">
            
                    
                        <b>1.19.3.7.5.</b>
                    
                    sql-数据库系统原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.7.6" data-path="../zother8-JavaBook/Interview/mysql/sql-索引-B-树.html">
            
                <a href="../zother8-JavaBook/Interview/mysql/sql-索引-B-树.html">
            
                    
                        <b>1.19.3.7.6.</b>
                    
                    sql-索引-B-树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.8" >
            
                <span>
            
                    
                        <b>1.19.3.8.</b>
                    
                    Network
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.8.1" data-path="../zother8-JavaBook/Interview/network/计算机网络原理-DNS是干什么的.html">
            
                <a href="../zother8-JavaBook/Interview/network/计算机网络原理-DNS是干什么的.html">
            
                    
                        <b>1.19.3.8.1.</b>
                    
                    计算机网络原理-DNS是干什么的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.8.2" data-path="../zother8-JavaBook/Interview/network/计算机网络原理-http那些事儿.html">
            
                <a href="../zother8-JavaBook/Interview/network/计算机网络原理-http那些事儿.html">
            
                    
                        <b>1.19.3.8.2.</b>
                    
                    计算机网络原理-http那些事儿
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3.8.3" data-path="../zother8-JavaBook/Interview/network/计算机网络面试常见问题.html">
            
                <a href="../zother8-JavaBook/Interview/network/计算机网络面试常见问题.html">
            
                    
                        <b>1.19.3.8.3.</b>
                    
                    计算机网络面试常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.9" >
            
                <span>
            
                    
                        <b>1.19.3.9.</b>
                    
                    Redis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.9.1" data-path="../zother8-JavaBook/Interview/redis/Redis-面试常见的问题.html">
            
                <a href="../zother8-JavaBook/Interview/redis/Redis-面试常见的问题.html">
            
                    
                        <b>1.19.3.9.1.</b>
                    
                    Redis-面试常见的问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.3.10" >
            
                <span>
            
                    
                        <b>1.19.3.10.</b>
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.3.10.1" data-path="../zother8-JavaBook/Interview/spring/Spring面试常见问题.html">
            
                <a href="../zother8-JavaBook/Interview/spring/Spring面试常见问题.html">
            
                    
                        <b>1.19.3.10.1.</b>
                    
                    Spring面试常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.4" >
            
                <span>
            
                    
                        <b>1.19.4.</b>
                    
                    Jvm
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.4.1" data-path="../zother8-JavaBook/Jvm/Java面经-JVM调优参数.html">
            
                <a href="../zother8-JavaBook/Jvm/Java面经-JVM调优参数.html">
            
                    
                        <b>1.19.4.1.</b>
                    
                    Java面经-JVM调优参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.2" data-path="../zother8-JavaBook/Jvm/Java面经-内存模型.html">
            
                <a href="../zother8-JavaBook/Jvm/Java面经-内存模型.html">
            
                    
                        <b>1.19.4.2.</b>
                    
                    Java面经-内存模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.3" data-path="../zother8-JavaBook/Jvm/Java面经-类加载机制.html">
            
                <a href="../zother8-JavaBook/Jvm/Java面经-类加载机制.html">
            
                    
                        <b>1.19.4.3.</b>
                    
                    Java面经-类加载机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.4" data-path="../zother8-JavaBook/Jvm/JVM-垃圾回收.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM-垃圾回收.html">
            
                    
                        <b>1.19.4.4.</b>
                    
                    JVM-垃圾回收
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.5" data-path="../zother8-JavaBook/Jvm/JVM-对象创建.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM-对象创建.html">
            
                    
                        <b>1.19.4.5.</b>
                    
                    JVM-对象创建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.6" data-path="../zother8-JavaBook/Jvm/JVM-类加载器.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM-类加载器.html">
            
                    
                        <b>1.19.4.6.</b>
                    
                    JVM-类加载器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.7" data-path="../zother8-JavaBook/Jvm/JVM-类加载过程.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM-类加载过程.html">
            
                    
                        <b>1.19.4.7.</b>
                    
                    JVM-类加载过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.8" data-path="../zother8-JavaBook/Jvm/JVM-类文件结构.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM-类文件结构.html">
            
                    
                        <b>1.19.4.8.</b>
                    
                    JVM-类文件结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4.9" data-path="../zother8-JavaBook/Jvm/JVM面试常见问题.html">
            
                <a href="../zother8-JavaBook/Jvm/JVM面试常见问题.html">
            
                    
                        <b>1.19.4.9.</b>
                    
                    JVM面试常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.5" data-path="../zother8-JavaBook/LeetCode/">
            
                <a href="../zother8-JavaBook/LeetCode/">
            
                    
                        <b>1.19.5.</b>
                    
                    Leet Code
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.5.1" data-path="../zother8-JavaBook/LeetCode/专题.html">
            
                <a href="../zother8-JavaBook/LeetCode/专题.html">
            
                    
                        <b>1.19.5.1.</b>
                    
                    专题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.2" data-path="../zother8-JavaBook/LeetCode/数据结构-二分法.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-二分法.html">
            
                    
                        <b>1.19.5.2.</b>
                    
                    数据结构-二分法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.3" data-path="../zother8-JavaBook/LeetCode/数据结构-位运算.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-位运算.html">
            
                    
                        <b>1.19.5.3.</b>
                    
                    数据结构-位运算
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.4" data-path="../zother8-JavaBook/LeetCode/数据结构-动态规划.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-动态规划.html">
            
                    
                        <b>1.19.5.4.</b>
                    
                    数据结构-动态规划
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.5" data-path="../zother8-JavaBook/LeetCode/数据结构-双指针.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-双指针.html">
            
                    
                        <b>1.19.5.5.</b>
                    
                    数据结构-双指针
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.6" data-path="../zother8-JavaBook/LeetCode/数据结构-哈希表.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-哈希表.html">
            
                    
                        <b>1.19.5.6.</b>
                    
                    数据结构-哈希表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.7" data-path="../zother8-JavaBook/LeetCode/数据结构-排序.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-排序.html">
            
                    
                        <b>1.19.5.7.</b>
                    
                    数据结构-排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.8" data-path="../zother8-JavaBook/LeetCode/数据结构-栈和队列.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-栈和队列.html">
            
                    
                        <b>1.19.5.8.</b>
                    
                    数据结构-栈和队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.9" data-path="../zother8-JavaBook/LeetCode/数据结构-树-基础.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-树-基础.html">
            
                    
                        <b>1.19.5.9.</b>
                    
                    数据结构-树-基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5.10" data-path="../zother8-JavaBook/LeetCode/数据结构-链表.html">
            
                <a href="../zother8-JavaBook/LeetCode/数据结构-链表.html">
            
                    
                        <b>1.19.5.10.</b>
                    
                    数据结构-链表
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19.6" data-path="../zother8-JavaBook/Multithread/">
            
                <a href="../zother8-JavaBook/Multithread/">
            
                    
                        <b>1.19.6.</b>
                    
                    Multithread
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.6.1" data-path="../zother8-JavaBook/Multithread/CAS底层解析.html">
            
                <a href="../zother8-JavaBook/Multithread/CAS底层解析.html">
            
                    
                        <b>1.19.6.1.</b>
                    
                    CAS底层解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.2" data-path="../zother8-JavaBook/Multithread/Java多线程-AQS.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-AQS.html">
            
                    
                        <b>1.19.6.2.</b>
                    
                    Java多线程-AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.3" data-path="../zother8-JavaBook/Multithread/Java多线程-Atomic原子类.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-Atomic原子类.html">
            
                    
                        <b>1.19.6.3.</b>
                    
                    Java多线程-Atomic原子类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.4" data-path="../zother8-JavaBook/Multithread/Java多线程-synchronized.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-synchronized.html">
            
                    
                        <b>1.19.6.4.</b>
                    
                    Java多线程-synchronized
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.5" data-path="../zother8-JavaBook/Multithread/Java多线程-ThreadLocal.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-ThreadLocal.html">
            
                    
                        <b>1.19.6.5.</b>
                    
                    Java多线程-ThreadLocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.6" data-path="../zother8-JavaBook/Multithread/Java多线程-并发基础常见面试题总结.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-并发基础常见面试题总结.html">
            
                    
                        <b>1.19.6.6.</b>
                    
                    Java多线程-并发基础常见面试题总结
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.7" data-path="../zother8-JavaBook/Multithread/Java多线程-并发进阶常见面试题总结.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-并发进阶常见面试题总结.html">
            
                    
                        <b>1.19.6.7.</b>
                    
                    Java多线程-并发进阶常见面试题总结
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.8" data-path="../zother8-JavaBook/Multithread/Java多线程-线程池.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程-线程池.html">
            
                    
                        <b>1.19.6.8.</b>
                    
                    Java多线程-线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.9" data-path="../zother8-JavaBook/Multithread/Java多线程常见问题.html">
            
                <a href="../zother8-JavaBook/Multithread/Java多线程常见问题.html">
            
                    
                        <b>1.19.6.9.</b>
                    
                    Java多线程常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.10" data-path="../zother8-JavaBook/Multithread/Java锁机制.html">
            
                <a href="../zother8-JavaBook/Multithread/Java锁机制.html">
            
                    
                        <b>1.19.6.10.</b>
                    
                    Java锁机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.11" data-path="../zother8-JavaBook/Multithread/为什么说ArrayList是线程不安全.html">
            
                <a href="../zother8-JavaBook/Multithread/为什么说ArrayList是线程不安全.html">
            
                    
                        <b>1.19.6.11.</b>
                    
                    为什么说ArrayList是线程不安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6.12" data-path="../zother8-JavaBook/Multithread/深刻理解volatile的一切.html">
            
                <a href="../zother8-JavaBook/Multithread/深刻理解volatile的一切.html">
            
                    
                        <b>1.19.6.12.</b>
                    
                    深刻理解volatile的一切
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../学习路线.html">
            
                <a href="../学习路线.html">
            
                    
                        <b>1.20.</b>
                    
                    学习路线
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >二十一、Tomcat源码解析</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tomcat"><a name="tomcat" class="plugin-anchor" href="#tomcat"><i class="fa fa-link" aria-hidden="true"></i></a>Tomcat</h1>
<h1 id="tomcat-&#x53C2;&#x6570;&#x8C03;&#x4F18;"><a name="tomcat-&#x53C2;&#x6570;&#x8C03;&#x4F18;" class="plugin-anchor" href="#tomcat-&#x53C2;&#x6570;&#x8C03;&#x4F18;"><i class="fa fa-link" aria-hidden="true"></i></a>Tomcat &#x53C2;&#x6570;&#x8C03;&#x4F18;</h1>
<ul>
<li>&#x9ED8;&#x8BA4;&#x503C;&#xFF1A;</li>
<li>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;  </li>
<li>connectionTimeout=&quot;20000&quot;  </li>
<li><p>redirectPort=&quot;8443&quot; /&gt;  </p>
</li>
<li><p>&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#xFF1A;</p>
</li>
<li>&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11Nio2Protocol&quot;  </li>
<li>connectionTimeout=&quot;20000&quot;  </li>
<li>redirectPort=&quot;8443&quot;   </li>
<li>executor=&quot;TomcatThreadPool&quot;  </li>
<li>enableLookups=&quot;false&quot;   </li>
<li>acceptCount=&quot;100&quot;   </li>
<li>maxPostSize=&quot;10485760&quot;   </li>
<li>compression=&quot;on&quot;   </li>
<li>disableUploadTimeout=&quot;true&quot;   </li>
<li>compressionMinSize=&quot;2048&quot;   </li>
<li>noCompressionUserAgents=&quot;gozilla, traviata&quot;   </li>
<li>acceptorThreadCount=&quot;2&quot;   </li>
<li>compressableMimeType=&quot;text/html,text/xml,text/plain,text/css,text/javascript,application/javascript&quot; </li>
<li>URIEncoding=&quot;utf-8&quot;/&gt;  </li>
<li></li>
</ul>
<h1 id="connector"><a name="connector" class="plugin-anchor" href="#connector"><i class="fa fa-link" aria-hidden="true"></i></a>Connector</h1>
<ul>
<li><p>Tomcat&#x6709;&#x4E00;&#x4E2A;acceptor&#x7EBF;&#x7A0B;&#x6765;accept socket&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x6709;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;&#x5BF9;&#x4E8E;client&#x7AEF;&#x7684;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x8FDB;&#x6765;&#xFF0C;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;tcp&#x7684;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;OS&#x7EF4;&#x62A4;&#x4E86;&#x534A;&#x8FDE;&#x63A5;&#x961F;&#x5217;(syn&#x961F;&#x5217;)&#x4EE5;&#x53CA;&#x5B8C;&#x5168;&#x8FDE;&#x63A5;&#x961F;&#x5217;(accept&#x961F;&#x5217;)&#xFF0C;&#x5728;&#x7B2C;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x4E4B;&#x540E;&#xFF0C;server&#x6536;&#x5230;&#x4E86;client&#x7684;ack&#xFF0C;&#x5219;&#x8FDB;&#x5165;establish&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E;&#x8BE5;&#x8FDE;&#x63A5;&#x7531;syn&#x961F;&#x5217;&#x79FB;&#x52A8;&#x5230;accept&#x961F;&#x5217;&#x3002;</p>
</li>
<li><p>Tomcat&#x7684;acceptor&#x7EBF;&#x7A0B;&#x5219;&#x8D1F;&#x8D23;&#x4ECE;accept&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x8BE5;connection&#xFF0C;&#x63A5;&#x53D7;&#x8BE5;connection&#xFF0C;&#x7136;&#x540E;&#x4EA4;&#x7ED9;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x53BB;&#x5904;&#x7406;(&#x8BFB;&#x53D6;&#x8BF7;&#x6C42;&#x53C2;&#x6570;&#x3001;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3001;&#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x7B49;&#x7B49;&#xFF1B;&#x5982;&#x679C;&#x8BE5;&#x8FDE;&#x63A5;&#x4E0D;&#x662F;keep alived&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x8BE5;&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x8BE5;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x56DE;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5982;&#x679C;&#x662F;keep alived&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x5230;&#x6765;&#x76F4;&#x5230;keepAliveTimeout&#xFF0C;&#x7136;&#x540E;&#x5173;&#x95ED;&#x8BE5;&#x8FDE;&#x63A5;&#x91CA;&#x653E;&#x56DE;&#x7EBF;&#x7A0B;&#x6C60;)&#xFF0C;</p>
</li>
<li>&#x7136;&#x540E;&#x81EA;&#x5DF1;&#x63A5;&#x7740;&#x53BB;accept&#x961F;&#x5217;&#x53D6;connection(&#x5F53;&#x5F53;&#x524D;socket&#x8FDE;&#x63A5;&#x8D85;&#x8FC7;maxConnections&#x7684;&#x65F6;&#x5019;&#xFF0C;acceptor&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x4F1A;&#x963B;&#x585E;&#x7B49;&#x5F85;&#xFF0C;&#x7B49;&#x8FDE;&#x63A5;&#x964D;&#x4E0B;&#x53BB;&#x4E4B;&#x540E;&#xFF0C;&#x624D;&#x53BB;&#x5904;&#x7406;accept&#x961F;&#x5217;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;)&#x3002;acceptCount&#x6307;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;accept&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#x3002;</li>
</ul>
<h1 id="protocol&#xFF08;io&#x65B9;&#x5F0F;"><a name="protocol&#xFF08;io&#x65B9;&#x5F0F;" class="plugin-anchor" href="#protocol&#xFF08;io&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>protocol&#xFF08;IO&#x65B9;&#x5F0F;)</h1>
<ul>
<li>Tomcat 8 &#x8BBE;&#x7F6E; nio2 &#x66F4;&#x597D;&#xFF1A;org.apache.coyote.http11.Http11Nio2Protocol&#xFF08;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x7528;&#x4E0D;&#x4E86;&#xFF0C;&#x5C31;&#x7528;&#x4E0B;&#x9762;&#x90A3;&#x4E2A;)</li>
<li>Tomcat 6&#x3001;7 &#x8BBE;&#x7F6E; nio &#x66F4;&#x597D;&#xFF1A;org.apache.coyote.http11.Http11NioProtocol</li>
<li>apr&#xFF1A;&#x8C03;&#x7528;httpd&#x6838;&#x5FC3;&#x94FE;&#x63A5;&#x5E93;&#x6765;&#x8BFB;&#x53D6;&#x6216;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;tomat&#x5BF9;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x6027;&#x80FD;&#x3002;Tomcat APR&#x6A21;&#x5F0F;&#x4E5F;&#x662F;Tomcat&#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x4E0B;&#x7684;&#x9996;&#x9009;&#x8FD0;&#x884C;&#x6A21;&#x5F0F;<h1 id="uriencoding&#xFF08;url&#x7F16;&#x7801;"><a name="uriencoding&#xFF08;url&#x7F16;&#x7801;" class="plugin-anchor" href="#uriencoding&#xFF08;url&#x7F16;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>URIEncoding&#xFF08;URL&#x7F16;&#x7801;)</h1>
</li>
<li><p>URIEncoding=&#x201D;UTF-8&#x201D;</p>
</li>
<li><p>&#x4F7F;&#x5F97;Tomcat&#x53EF;&#x4EE5;&#x89E3;&#x6790;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x540D;&#x7684;&#x6587;&#x4EF6;&#x7684;url</p>
<h1 id="executor&#xFF08;&#x542F;&#x7528;worker&#x7EBF;&#x7A0B;&#x6C60;"><a name="executor&#xFF08;&#x542F;&#x7528;worker&#x7EBF;&#x7A0B;&#x6C60;" class="plugin-anchor" href="#executor&#xFF08;&#x542F;&#x7528;worker&#x7EBF;&#x7A0B;&#x6C60;"><i class="fa fa-link" aria-hidden="true"></i></a>Executor&#xFF08;&#x542F;&#x7528;Worker&#x7EBF;&#x7A0B;&#x6C60;)</h1>
</li>
<li>&lt;Executor name=&quot;TomcatThreadPool&quot; namePrefix=&quot;catalina-exec-&quot;  </li>
<li>maxThreads=&quot;150&quot; minSpareThreads=&quot;100&quot;   </li>
<li>prestartminSpareThreads=&quot;true&quot; maxQueueSize=&quot;100&quot;/&gt;   <h2 id="minsparethreads&#xFF08;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;corepoolsize"><a name="minsparethreads&#xFF08;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;corepoolsize" class="plugin-anchor" href="#minsparethreads&#xFF08;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;corepoolsize"><i class="fa fa-link" aria-hidden="true"></i></a>minSpareThreads&#xFF08;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;corePoolSize)</h2>
</li>
<li>&#x6700;&#x5C0F;&#x5907;&#x7528;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;Tomcat&#x542F;&#x52A8;&#x65F6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x3002;<h2 id="maxthreads&#xFF08;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;maxpoolsize"><a name="maxthreads&#xFF08;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;maxpoolsize" class="plugin-anchor" href="#maxthreads&#xFF08;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;maxpoolsize"><i class="fa fa-link" aria-hidden="true"></i></a>maxThreads&#xFF08;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;maxPoolSize)</h2>
</li>
<li>maxThreads Tomcat&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6765;&#x5904;&#x7406;&#x63A5;&#x6536;&#x7684;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x8868;&#x793A;Tomcat&#x53EF;&#x521B;&#x5EFA;&#x7684;&#x6700;&#x5927;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5373;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#x3002;</li>
<li>&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E; 200&#xFF0C;&#x4E00;&#x822C;&#x5EFA;&#x8BAE;&#x5728; 500 ~ 800&#xFF0C;&#x6839;&#x636E;&#x786C;&#x4EF6;&#x8BBE;&#x65BD;&#x548C;&#x4E1A;&#x52A1;&#x6765;&#x5224;&#x65AD;&#x3002;</li>
<li>&#x867D;&#x7136;client&#x7684;socket&#x8FDE;&#x63A5;&#x4E0A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x90FD;&#x5728;Tomcat&#x7684;task queue&#x91CC;&#x5934;&#xFF0C;&#x7B49;&#x5F85;worker&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x3002;<h2 id="maxqueuesize&#xFF08;task&#x961F;&#x5217;&#x5927;&#x5C0F;"><a name="maxqueuesize&#xFF08;task&#x961F;&#x5217;&#x5927;&#x5C0F;" class="plugin-anchor" href="#maxqueuesize&#xFF08;task&#x961F;&#x5217;&#x5927;&#x5C0F;"><i class="fa fa-link" aria-hidden="true"></i></a>maxQueueSize&#xFF08;Task&#x961F;&#x5217;&#x5927;&#x5C0F;)</h2>
</li>
<li>&#x6307;&#x5B9A;&#x5F53;&#x6240;&#x6709;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x90FD;&#x88AB;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x653E;&#x5230;&#x5904;&#x7406;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#xFF0C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x4E0D;&#x4E88;&#x5904;&#x7406;&#xFF0C;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E; 100&#x3002;<h1 id="connectiontimeout&#xFF08;&#x8D85;&#x65F6;&#x65F6;&#x95F4;"><a name="connectiontimeout&#xFF08;&#x8D85;&#x65F6;&#x65F6;&#x95F4;" class="plugin-anchor" href="#connectiontimeout&#xFF08;&#x8D85;&#x65F6;&#x65F6;&#x95F4;"><i class="fa fa-link" aria-hidden="true"></i></a>connectionTimeout&#xFF08;&#x8D85;&#x65F6;&#x65F6;&#x95F4;)</h1>
</li>
<li>connectionTimeout&#x4E3A;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x6BEB;&#x79D2;&#x6570;&#x3002;<h1 id="enablelookups&#xFF08;&#x662F;&#x5426;&#x5141;&#x8BB8;dns&#x67E5;&#x8BE2;"><a name="enablelookups&#xFF08;&#x662F;&#x5426;&#x5141;&#x8BB8;dns&#x67E5;&#x8BE2;" class="plugin-anchor" href="#enablelookups&#xFF08;&#x662F;&#x5426;&#x5141;&#x8BB8;dns&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>enableLookups&#xFF08;&#x662F;&#x5426;&#x5141;&#x8BB8;DNS&#x67E5;&#x8BE2;)</h1>
</li>
<li>enableLookups=&quot;false&quot; &#x4E3A;&#x4E86;&#x6D88;&#x9664;DNS&#x67E5;&#x8BE2;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5173;&#x95ED;DNS&#x67E5;&#x8BE2;&#xFF0C;&#x65B9;&#x5F0F;&#x662F;&#x4FEE;&#x6539; server.xml&#x6587;&#x4EF6;&#x4E2D;&#x7684;enableLookups&#x53C2;&#x6570;&#x503C;&#x3002;<h1 id="maxconnections&#xFF08;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;"><a name="maxconnections&#xFF08;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;" class="plugin-anchor" href="#maxconnections&#xFF08;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>maxConnections&#xFF08;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;)</h1>
</li>
<li>&#x8FD9;&#x4E2A;&#x503C;&#x8868;&#x793A;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x5C11;&#x4E2A;socket&#x8FDE;&#x63A5;&#x5230;Tomcat&#x4E0A;&#x3002;NIO&#x6A21;&#x5F0F;&#x4E0B;&#x9ED8;&#x8BA4;&#x662F;10000.</li>
<li>&#x5F53;&#x8FDE;&#x63A5;&#x6570;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x503C;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x7EE7;&#x7EED;&#x63A5;&#x6536;&#x8FDE;&#x63A5;&#x4F46;&#x4E0D;&#x4F1A;&#x8D85;&#x8FC7;acceptCount&#x7684;&#x503C;&#x3002;<h1 id="acceptcount&#xFF08;accept&#x961F;&#x5217;&#x5927;&#x5C0F;"><a name="acceptcount&#xFF08;accept&#x961F;&#x5217;&#x5927;&#x5C0F;" class="plugin-anchor" href="#acceptcount&#xFF08;accept&#x961F;&#x5217;&#x5927;&#x5C0F;"><i class="fa fa-link" aria-hidden="true"></i></a>acceptCount&#xFF08;accept&#x961F;&#x5217;&#x5927;&#x5C0F;)</h1>
</li>
<li><p>&#x5F53;accept&#x961F;&#x5217;&#x6EE1;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x5373;&#x4F7F;client&#x7EE7;&#x7EED;&#x5411;server&#x53D1;&#x9001;ACK&#x7684;&#x5305;&#xFF0C;&#x4E5F;&#x4F1A;&#x4E0D;&#x88AB;&#x54CD;&#x5E94;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;server&#x901A;&#x8FC7;/proc/sys/net/ipv4/tcp_abort_on_overflow&#x6765;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x8FD4;&#x56DE;&#xFF0C;0&#x8868;&#x793A;&#x76F4;&#x63A5;&#x4E22;&#x4E22;&#x5F03;&#x8BE5;ACK&#xFF0C;1&#x8868;&#x793A;&#x53D1;&#x9001;RST&#x901A;&#x77E5;client&#xFF1B;&#x76F8;&#x5E94;&#x7684;&#xFF0C;client&#x5219;&#x4F1A;&#x5206;&#x522B;&#x8FD4;&#x56DE;read timeout &#x6216;&#x8005; connection reset by peer&#x3002;</p>
</li>
<li><p>acceptCount&#x5728;&#x6E90;&#x7801;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x662F;backlog&#x53C2;&#x6570;&#x3002;backlog&#x53C2;&#x6570;&#x63D0;&#x793A;&#x5185;&#x6838;&#x76D1;&#x542C;&#x961F;&#x5217;&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x3002;&#x76D1;&#x542C;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x5982;&#x679C;&#x8D85;&#x8FC7;backlog&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x4E0D;&#x53D7;&#x7406;&#x65B0;&#x7684;&#x5BA2;&#x6237;&#x8FDE;&#x63A5;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x5C06;&#x6536;&#x5230;ECONNREFUSED&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;Linux&#x81EA;&#x5185;&#x6838;&#x7248;&#x672C;2.2&#x4E4B;&#x540E;&#xFF0C;&#x5B83;&#x53EA;&#x8868;&#x793A;&#x5904;&#x4E8E;&#x5B8C;&#x5168;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;socket&#x7684;&#x4E0A;&#x9650;&#xFF0C;&#x5904;&#x4E8E;&#x534A;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;socket&#x7684;&#x4E0A;&#x9650;&#x5219;&#x7531;/proc/sys/net/ipv4/tcp_max_syn_backlog&#x5185;&#x6838;&#x53C2;&#x6570;&#x5B9A;&#x4E49;&#x3002;</p>
</li>
<li><p>client&#x7AEF;&#x7684;socket&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF1A;</p>
</li>
<li><p>&#x5F53;&#x7B2C;&#x4E00;&#x6B21;&#x63E1;&#x624B;&#xFF0C;&#x5EFA;&#x7ACB;&#x534A;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#xFF1A;client &#x901A;&#x8FC7; connect &#x5411; server &#x53D1;&#x51FA; SYN &#x5305;&#x65F6;&#xFF0C;client &#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A; socket &#x961F;&#x5217;&#xFF0C;&#x5982;&#x679C; socket &#x7B49;&#x5F85;&#x961F;&#x5217;&#x6EE1;&#x4E86;&#xFF0C;&#x800C; client &#x4E5F;&#x4F1A;&#x7531;&#x6B64;&#x8FD4;&#x56DE; connection time out&#xFF0C;&#x53EA;&#x8981;&#x662F; client &#x6CA1;&#x6709;&#x6536;&#x5230; &#x7B2C;&#x4E8C;&#x6B21;&#x63E1;&#x624B;SYN+ACK&#xFF0C;3s &#x4E4B;&#x540E;&#xFF0C;client &#x4F1A;&#x518D;&#x6B21;&#x53D1;&#x9001;&#xFF0C;&#x5982;&#x679C;&#x4F9D;&#x7136;&#x6CA1;&#x6709;&#x6536;&#x5230;&#xFF0C;9s &#x4E4B;&#x540E;&#x4F1A;&#x7EE7;&#x7EED;&#x53D1;&#x9001;&#x3002;</p>
</li>
<li><p>server&#x7AEF;&#x7684;&#x534A;&#x8FDE;&#x63A5;&#x961F;&#x5217;(syn&#x961F;&#x5217;)&#xFF1A;</p>
</li>
<li><p>&#x6B64;&#x65F6;server &#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A; SYN &#x961F;&#x5217;&#xFF0C;&#x534A;&#x8FDE;&#x63A5; syn &#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x4E3A; max(64, /proc/sys/net/ipv4/tcp_max_syn_backlog)  &#xFF0C;&#x5728;&#x673A;&#x5668;&#x7684;tcp_max_syn_backlog&#x503C;&#x5728;/proc/sys/net/ipv4/tcp_max_syn_backlog&#x4E0B;&#x914D;&#x7F6E;&#xFF0C;&#x5F53; server &#x6536;&#x5230; client &#x7684; SYN &#x5305;&#x540E;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x7B2C;&#x4E8C;&#x6B21;&#x63E1;&#x624B;&#x53D1;&#x9001;SYN&#xFF0B;ACK &#x7684;&#x5305;&#x52A0;&#x4EE5;&#x786E;&#x8BA4;&#xFF0C;client &#x7684; TCP &#x534F;&#x8BAE;&#x6808;&#x4F1A;&#x5524;&#x9192; socket &#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF0C;&#x53D1;&#x51FA; connect &#x8C03;&#x7528;&#x3002;</p>
</li>
<li><p>server&#x7AEF;&#x7684;&#x5B8C;&#x5168;&#x8FDE;&#x63A5;&#x961F;&#x5217;(accpet&#x961F;&#x5217;)&#xFF1A;</p>
</li>
<li>&#x5F53;&#x7B2C;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x65F6;&#xFF0C;&#x5F53;server&#x63A5;&#x6536;&#x5230;ACK &#x62A5;&#x4E4B;&#x540E;&#xFF0C; &#x4F1A;&#x8FDB;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53EB; accept &#x7684;&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x4E3A; min(backlog, somaxconn)&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;somaxconn &#x7684;&#x503C;&#x4E3A; 128&#xFF0C;&#x8868;&#x793A;&#x6700;&#x591A;&#x6709; 129 &#x7684; ESTAB &#x7684;&#x8FDE;&#x63A5;&#x7B49;&#x5F85; accept()&#xFF0C;&#x800C; backlog &#x7684;&#x503C;&#x5219;&#x5E94;&#x8BE5;&#x662F;&#x7531; int listen(int sockfd, int backlog) &#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#xFF0C;listen &#x91CC;&#x9762;&#x7684; backlog &#x53EF;&#x4EE5;&#x6709;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53BB;&#x5B9A;&#x4E49;&#x7684;&#x3002;</li>
</ul>
<h1 id="acceptorthreadcount&#xFF08;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;"><a name="acceptorthreadcount&#xFF08;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;" class="plugin-anchor" href="#acceptorthreadcount&#xFF08;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>acceptorThreadCount&#xFF08;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;)</h1>
<ul>
<li>&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8FDE;&#x63A5;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F;1&#x3002;&#x4E00;&#x822C;&#x8FD9;&#x4E2A;&#x6307;&#x9700;&#x8981;&#x6539;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x662F;&#x56E0;&#x4E3A;&#x8BE5;&#x670D;&#x52A1;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x591A;&#x6838;CPU&#xFF0C;&#x5982;&#x679C;&#x662F;&#x591A;&#x6838; CPU &#x4E00;&#x822C;&#x914D;&#x7F6E;&#x4E3A; 2&#x3002;<h1 id="http&#x538B;&#x7F29;"><a name="http&#x538B;&#x7F29;" class="plugin-anchor" href="#http&#x538B;&#x7F29;"><i class="fa fa-link" aria-hidden="true"></i></a>HTTP&#x538B;&#x7F29;</h1>
compression=&quot;on&quot; compressionMinSize=&quot;2048&quot;<br>compressableMimeType=&quot;text/html,text/xml,text/javascript,text/css,text/plain&quot;</li>
<li>HTTP &#x538B;&#x7F29;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x6D4F;&#x89C8;&#x7F51;&#x7AD9;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x5B83;&#x7684;&#x539F;&#x7406;&#x662F;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7F51;&#x9875;&#x540E;&#xFF0C;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C06;&#x7F51;&#x9875;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#xFF0C;&#x518D;&#x4E0B;&#x8F7D;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8D1F;&#x8D23;&#x89E3;&#x538B;&#x7F29;&#x5E76;&#x6D4F;&#x89C8;&#x3002;&#x76F8;&#x5BF9;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x6D4F;&#x89C8;&#x8FC7;&#x7A0B;HTML,CSS,Javascript , Text &#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8282;&#x7701;40%&#x5DE6;&#x53F3;&#x7684;&#x6D41;&#x91CF;&#x3002;&#x66F4;&#x4E3A;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5BF9;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x5305;&#x62EC;CGI&#x3001;PHP , JSP , ASP , Servlet,SHTML&#x7B49;&#x8F93;&#x51FA;&#x7684;&#x7F51;&#x9875;&#x4E5F;&#x80FD;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x538B;&#x7F29;&#x6548;&#x7387;&#x60CA;&#x4EBA;&#x3002;<ul>
<li>1)compression=&quot;on&quot; &#x6253;&#x5F00;&#x538B;&#x7F29;&#x529F;&#x80FD;</li>
<li>2)compressionMinSize=&quot;2048&quot; &#x542F;&#x7528;&#x538B;&#x7F29;&#x7684;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x9ED8;&#x8BA4;&#x4E3A;2KB</li>
<li>3)noCompressionUserAgents=&quot;gozilla, traviata&quot; &#x5BF9;&#x4E8E;&#x4EE5;&#x4E0B;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x4E0D;&#x542F;&#x7528;&#x538B;&#x7F29;</li>
<li>4)compressableMimeType=&quot;text/html,text/xml&quot;&#x3000;&#x538B;&#x7F29;&#x7C7B;&#x578B;</li>
</ul>
</li>
<li></li>
</ul>
<h1 id="&#x7EC4;&#x4EF6;&#x4E0E;&#x6846;&#x67B6;"><a name="&#x7EC4;&#x4EF6;&#x4E0E;&#x6846;&#x67B6;" class="plugin-anchor" href="#&#x7EC4;&#x4EF6;&#x4E0E;&#x6846;&#x67B6;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EC4;&#x4EF6;&#x4E0E;&#x6846;&#x67B6;</h1>
<p>&#xF06C;- Bootstrap&#xFF1A;&#x4F5C;&#x4E3A; Tomcat &#x5BF9;&#x5916;&#x754C;&#x7684;&#x542F;&#x52A8;&#x7C7B;,&#x5728; $CATALINA_BASE/bin &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x521B;&#x5EFA; Catalina &#x7684;&#x5B9E;&#x4F8B;&#x5E76;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x53CA;&#x542F;&#x52A8;&#x3002;
&#xF06C;- Catalina&#xFF1A;&#x89E3;&#x6790; $CATALINA_BASE/conf/server.xml &#x6587;&#x4EF6;&#x5E76;&#x521B;&#x5EFA; StandardServer&#x3001;StandardService&#x3001;StandardEngine&#x3001;StandardHost &#x7B49;
&#xF06C;- Server&#xFF1A;&#x4EE3;&#x8868;&#x6574;&#x4E2A;Catalina Servlet&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;Service
&#xF06C;- Service&#xFF1A;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A; Connector&#xFF0C;&#x548C;&#x4E00;&#x4E2A; Engine&#xFF0C;Connector &#x548C; Engine &#x90FD;&#x662F;&#x5728;&#x89E3;&#x6790; conf/server.xml &#x6587;&#x4EF6;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#xFF0C;Engine &#x5728; Tomcat &#x7684;&#x6807;&#x51C6;&#x5B9E;&#x73B0;&#x662F; StandardEngine
&#xF06C;- Connector&#xFF1A;&#x5B9E;&#x73B0;&#x67D0;&#x4E00;&#x534F;&#x8BAE;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6765;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x5982;&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;&#x534F;&#x8BAE;&#x6709;HTTP&#x3001;HTTPS&#x3001;AJP&#x3002;</p>
<ul>
<li>&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x6709;&#xFF1A;
&#xF06E;- &#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x534F;&#x8BAE;&#x89E3;&#x6790;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;
&#xF06E;- &#x5C06;&#x89E3;&#x6790;&#x5B8C;&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;Connector&#x5173;&#x8054;&#x7684;Engine&#x5BB9;&#x5668;&#x5904;&#x7406;</li>
</ul>
<p>1.- Mapper &#x7EF4;&#x62A4;&#x4E86; URL &#x5230;&#x5BB9;&#x5668;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;&#x5F53;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#x4F1A;&#x6839;&#x636E; Mapper &#x4E2D;&#x7684;&#x6620;&#x5C04;&#x4FE1;&#x606F;&#x51B3;&#x5B9A;&#x5C06;&#x8BF7;&#x6C42;&#x6620;&#x5C04;&#x5230;&#x54EA;&#x4E00;&#x4E2A; Host&#x3001;Context&#x3001;Wrapper&#x3002;
2.- Http11NioProtocol &#x7528;&#x4E8E;&#x5904;&#x7406; HTTP/1.1 &#x7684;&#x8BF7;&#x6C42;
3.- NioEndpoint &#x662F;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x70B9;&#xFF0C;&#x5728;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x4E2D;&#x8BE5;&#x7C7B;&#x662F;&#x6838;&#x5FC3;&#x7C7B;&#xFF0C;&#x4F1A;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x3002;
4.- CoyoteAdapter &#x7528;&#x4E8E;&#x5C06;&#x8BF7;&#x6C42;&#x4ECE; Connctor &#x4EA4;&#x7ED9; Container &#x5904;&#x7406;&#xFF0C;&#x4F7F; Connctor &#x548C; Container &#x89E3;&#x8026;&#x3002;
&#xF06C;- MapperListener &#x5B9E;&#x73B0;&#x4E86; LifecycleListener &#x548C; ContainerListener &#x63A5;&#x53E3;&#x7528;&#x4E8E;&#x76D1;&#x542C;&#x5BB9;&#x5668;&#x4E8B;&#x4EF6;&#x548C;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E8B;&#x4EF6;&#x3002;&#x8BE5;&#x76D1;&#x542C;&#x5668;&#x5B9E;&#x4F8B;&#x76D1;&#x542C;&#x6240;&#x6709;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5305;&#x62EC; StandardEngine&#x3001;StandardHost&#x3001;StandardContext&#x3001;StandardWrapper&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x6709;&#x53D8;&#x52A8;&#x65F6;&#xFF0C;&#x6CE8;&#x518C;&#x5BB9;&#x5668;&#x5230; Mapper&#x3002;
&#xF06C;- Engine&#xFF1A;&#x4EE3;&#x8868;&#x7684;&#x662F;Servlet&#x5F15;&#x64CE;&#xFF0C;&#x63A5;&#x6536;&#x6765;&#x81EA;&#x4E0D;&#x540C;Connector&#x8BF7;&#x6C42;&#xFF0C;&#x5904;&#x7406;&#x540E;&#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9;Connector&#x3002;Engine&#x662F;&#x4E00;&#x4E2A;&#x903B;&#x8F91;&#x5BB9;&#x5668;&#xFF0C;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;Host&#x3002;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;StandardEngine&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x6A21;&#x5757;&#xFF1A;
&#xF06E;- Cluster&#xFF1A;&#x5B9E;&#x73B0;Tomcat&#x7BA1;&#x7406;
&#xF06E;- Realm&#xFF1A;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x6A21;&#x5757;
&#xF06E;- Pipeline&#x548C;Valve&#xFF08;&#x9600;&#x95E8;)&#xFF1A;&#x5904;&#x7406;Pipeline&#x4E0A;&#x7684;&#x5404;&#x4E2A;Valve&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;&#x3002;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5C06;Connector&#x4F20;&#x8FC7;&#x6765;&#x7684;&#x53D8;&#x91CF;&#x4F20;&#x7ED9;Host&#x5BB9;&#x5668;</p>
<p>&#xF06C;- Host&#xFF1A;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF0C;&#x5373;&#x57DF;&#x540D;&#x6216;&#x7F51;&#x7EDC;&#x540D;&#xFF0C;&#x7528;&#x4E8E;&#x90E8;&#x7F72;&#x8BE5;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x901A;&#x5E38;&#x5305;&#x542B;&#x591A;&#x4E2A; Context (Context &#x5728; Tomcat &#x4E2D;&#x4EE3;&#x8868;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;)&#x3002;Context &#x5728; Tomcat &#x4E2D;&#x7684;&#x6807;&#x51C6;&#x5B9E;&#x73B0;&#x662F; StandardContext&#x3002;
&#xF06C;- Context&#xFF1A;&#x90E8;&#x7F72;&#x7684;&#x5177;&#x4F53;Web&#x5E94;&#x7528;&#xFF0C;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x5728;&#x662F;&#x76F8;&#x5E94;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x91CC;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x4E00;&#x4E2A;war&#x5305;&#x3002;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;StandardContext&#xFF0C;&#x901A;&#x5E38;&#x5305;&#x542B;&#x591A;&#x4E2A; Wrapper&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x6A21;&#x5757;&#xFF1A;
&#xF06E;- Realm&#xFF1A;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x6A21;&#x5757;
&#xF06E;- Pipeline&#x548C;Valve&#xFF1A;&#x5904;&#x7406;Pipeline&#x4E0A;&#x7684;&#x5404;&#x4E2A;Valve&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;
&#xF06E;- Manager: &#x5B83;&#x4E3B;&#x8981;&#x662F;&#x5E94;&#x7528;&#x7684;session&#x7BA1;&#x7406;&#x6A21;&#x5757;
&#xF06E;- Resources: &#x5B83;&#x662F;&#x6BCF;&#x4E2A;web app&#x5BF9;&#x5E94;&#x7684;&#x90E8;&#x7F72;&#x7ED3;&#x6784;&#x7684;&#x5C01;&#x88C5;
&#xF06E;- Loader&#xFF1A;&#x5B83;&#x662F;&#x5BF9;&#x6BCF;&#x4E2A;web app&#x7684;&#x81EA;&#x6709;&#x7684;classloader&#x7684;&#x5C01;&#x88C5;
&#xF06E;- Mapper&#xFF1A;&#x5B83;&#x5C01;&#x88C5;&#x4E86;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;URI&#x4E0E;&#x6BCF;&#x4E2A;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;wrapper&#x5BB9;&#x5668;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;
&#xF06C;- Wrapper&#xFF1A;&#x5BF9;&#x5E94;&#x5B9A;&#x4E49;&#x7684;Servlet&#xFF0C;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;StandardWrapper&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x6A21;&#x5757;&#xFF1A;
&#xF06E;- Pipeline&#x548C;Valve&#xFF1A;&#x5904;&#x7406;Pipeline&#x4E0A;&#x7684;&#x5404;&#x4E2A;Valve&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;
&#xF06E;- Servlet&#x548C;Servlet Stack&#xFF1A;&#x4FDD;&#x5B58;Wrapper&#x5305;&#x88C5;&#x7684;Servlet
&#xF06C;- StandardPipeline &#x7EC4;&#x4EF6;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x4E0E; Valve&#xFF08;&#x9600;)&#x7ED3;&#x5408;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x3002; StandardPipeline &#x4E2D;&#x542B;&#x6709;&#x591A;&#x4E2A; Valve&#xFF0C; &#x5F53;&#x9700;&#x8981;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4F1A;&#x9010;&#x4E00;&#x8C03;&#x7528; Valve &#x7684; invoke &#x65B9;&#x6CD5;&#x5BF9; Request &#x548C; Response &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x7279;&#x522B;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684; Valve &#x53EB; basicValve,&#x6BCF;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x5BB9;&#x5668;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684; BasicValve&#xFF0C;&#x4ED6;&#x4EEC;&#x505A;&#x7684;&#x662F;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5DE5;&#x4F5C;&#x3002;
&#xF06E;- StandardEngine &#x7684;&#x662F; StandardEngineValve&#xFF0C;&#x4ED6;&#x7528;&#x6765;&#x5C06; Request &#x6620;&#x5C04;&#x5230;&#x6307;&#x5B9A;&#x7684; Host;
&#xF06E;- StandardHost &#x7684;&#x662F; StandardHostValve, &#x4ED6;&#x7528;&#x6765;&#x5C06; Request &#x6620;&#x5C04;&#x5230;&#x6307;&#x5B9A;&#x7684; Context;
&#xF06E;- StandardContext &#x7684;&#x662F; StandardContextValve&#xFF0C;&#x5B83;&#x7528;&#x6765;&#x5C06; Request &#x6620;&#x5C04;&#x5230;&#x6307;&#x5B9A;&#x7684; Wrapper&#xFF1B;
&#xF06E;- StandardWrapper &#x7684;&#x662F; StandardWrapperValve&#xFF0C;&#x4ED6;&#x7528;&#x6765;&#x52A0;&#x8F7D; Rquest &#x6240;&#x6307;&#x5B9A;&#x7684; Servlet,&#x5E76;&#x8C03;&#x7528; Servlet &#x7684; Service &#x65B9;&#x6CD5;&#x3002;</p>
<ul>
<li><p>&#x7531;&#x4E0A;&#x53EF;&#x77E5;&#xFF0C;Catalina&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x6A21;&#x5757;&#xFF1A;&#x8FDE;&#x63A5;&#x5668;&#xFF08;Connector)&#x548C;&#x5BB9;&#x5668;&#xFF08;Container)&#x3001;</p>
</li>
<li><p>&#x4EE5; Tomcat &#x4E3A;&#x4F8B;&#xFF0C;&#x5B83;&#x7684;&#x4E3B;&#x7EBF;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x53EF;&#x4EE5;&#x5206;&#x4E3A; 3 &#x4E2A;&#xFF1A;&#x542F;&#x52A8;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x3002;&#x5165;&#x53E3;&#x70B9;&#x5C31;&#x662F; Bootstrap &#x7C7B;&#x548C; &#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x7684; Acceptor &#x7C7B;&#xFF01;</p>
</li>
</ul>
<h1 id="&#x751F;&#x547D;&#x5468;&#x671F;"><a name="&#x751F;&#x547D;&#x5468;&#x671F;" class="plugin-anchor" href="#&#x751F;&#x547D;&#x5468;&#x671F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x751F;&#x547D;&#x5468;&#x671F;</h1>
<ul>
<li>&#x5728;Tomcat&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4F1A;&#x8BFB;&#x53D6;server.xml&#x6587;&#x4EF6;&#x521B;&#x5EFA;Server, Service, Connector, Engine, Host, Context, Wrapper&#x7B49;&#x7EC4;&#x4EF6;&#x3002;<h1 id="lifestyle"><a name="lifestyle" class="plugin-anchor" href="#lifestyle"><i class="fa fa-link" aria-hidden="true"></i></a>Lifestyle</h1>
</li>
<li><p>Tomcat&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x90FD;&#x7EE7;&#x627F;&#x4E86;Lifecycle&#x63A5;&#x53E3;&#xFF0C;Lifecycle&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x6574;&#x5957;&#x751F;&#x547D;&#x5468;&#x671F;&#x7BA1;&#x7406;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x7EC4;&#x4EF6;&#x7684;&#x65B0;&#x5EFA;&#x3001;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x3001;&#x542F;&#x52A8;&#x3001;&#x505C;&#x6B62;&#x3001;&#x5931;&#x8D25;&#x5230;&#x9500;&#x6BC1;&#xFF0C;&#x90FD;&#x9075;&#x5B88;&#x540C;&#x6837;&#x7684;&#x89C4;&#x5219;&#xFF0C;Lifecycle&#x7EC4;&#x4EF6;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x56FE;&#x5982;&#x4E0B;&#x3002;</p>
</li>
<li><p>&#x6B63;&#x5E38;&#x7684;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x662F;init()-&gt;start()-&gt;destroy()&#xFF0C;&#x7236;&#x7EC4;&#x4EF6;&#x7684;init()&#x548C;start()&#x4F1A;&#x89E6;&#x53D1;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;init()&#x548C;start()&#xFF0C;&#x6240;&#x4EE5;Tomcat&#x4E2D;&#x53EA;&#x9700;&#x8C03;&#x7528;Server&#x7EC4;&#x4EF6;&#x7684;init()&#x548C;start()&#x5373;&#x53EF;&#x3002;
&#x6BCF;&#x4E2A;&#x5B9E;&#x73B0;&#x7EC4;&#x4EF6;&#x90FD;&#x7EE7;&#x627F;&#x81EA;LifecycleBase&#xFF0C;LifecycleBase&#x5B9E;&#x73B0;&#x4E86;Lifecycle&#x63A5;&#x53E3;&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;fireLifecycleEvent&#x65B9;&#x6CD5;&#xFF0C;&#x751F;&#x6210;LifecycleEvent&#xFF0C;&#x5E76;&#x4E14;&#x4EA4;&#x7531;&#x6B64;&#x5BB9;&#x5668;&#x7684;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x5904;&#x7406;&#x3002;</p>
<h1 id="&#x542F;&#x52A8;"><a name="&#x542F;&#x52A8;" class="plugin-anchor" href="#&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x542F;&#x52A8;</h1>
</li>
<li><p>tomcat/bin/startup.sh&#x811A;&#x672C;&#x662F;&#x542F;&#x52A8;&#x4E86;org.apache.catalina.startup.Bootstra&#x7C7B;&#x7684;main&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4F20;&#x5165;start&#x53C2;&#x6570;&#x3002;</p>
</li>
<li></li>
<li><p>&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;
1.- &#x65B0;&#x5EFA;Bootstrap&#x5BF9;&#x8C61;daemon&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x5176;init()&#x65B9;&#x6CD5; 
2.- &#x521D;&#x59CB;&#x5316;Tomcat&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF08;init)
3.- &#x7528;&#x53CD;&#x5C04;&#x5B9E;&#x4F8B;&#x5316;org.apache.catalina.startup.Catalina&#x5BF9;&#x8C61;catalinaDaemon&#xFF08;init)
4.- &#x8C03;&#x7528;daemon&#x7684;load&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x8D28;&#x4E0A;&#x8C03;&#x7528;&#x4E86;catalinaDaemon&#x7684;load&#x65B9;&#x6CD5;&#xFF08;load) 
5.- &#x52A0;&#x8F7D;&#x548C;&#x89E3;&#x6790;server.xml&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;load)
6.- &#x8C03;&#x7528;daemon&#x7684;start&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x8D28;&#x4E0A;&#x8C03;&#x7528;&#x4E86;catalinaDaemon&#x7684;start&#x65B9;&#x6CD5; &#xFF08;start)
7.- &#x542F;&#x52A8;Server&#x7EC4;&#x4EF6;&#xFF0C;Server&#x7684;&#x542F;&#x52A8;&#x4F1A;&#x5E26;&#x52A8;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#xFF0C;&#x5982;Service, Container, Connector&#xFF08;start)
8.- &#x8C03;&#x7528;catalinaDaemon&#x7684;await&#x65B9;&#x6CD5;&#x5FAA;&#x73AF;&#x7B49;&#x5F85;&#x63A5;&#x6536;Tomcat&#x7684;shutdown&#x547D;&#x4EE4;</p>
</li>
<li>BootStrap#main</li>
</ul>
<pre><code>public static void main(String args[]) {

    if (daemon == null) {
        // Don&apos;t set daemon until init() has completed
        Bootstrap bootstrap = new Bootstrap();
        try {
            bootstrap.init();
        } catch (Throwable t) {
            handleThrowable(t);
            t.printStackTrace();
            return;
        }
        daemon = bootstrap;
    } else {
        // When running as a service the call to stop will be on a new
        // thread so make sure the correct class loader is used to prevent
        // a range of class not found exceptions.
        Thread.currentThread().setContextClassLoader(daemon.catalinaLoader);
    }

    try {
        String command = &quot;start&quot;;
        if (args.length &gt; 0) {
            command = args[args.length - 1];
        }

        if (command.equals(&quot;startd&quot;)) {
            args[args.length - 1] = &quot;start&quot;;
            daemon.load(args);
            daemon.start();
        } else if (command.equals(&quot;stopd&quot;)) {
            args[args.length - 1] = &quot;stop&quot;;
            daemon.stop();
        } else if (command.equals(&quot;start&quot;)) {
</code></pre><pre><code>- // &#x8BBE;&#x7F6E; Catalina &#x7684; await &#x5C5E;&#x6027;&#x4E3A; true&#x3002;&#x5728; Start &#x9636;&#x6BB5;&#x5C3E;&#x90E8;&#xFF0C;&#x82E5;&#x8BE5;&#x5C5E;&#x6027;&#x4E3A; true&#xFF0C;Tomcat &#x4F1A;&#x5728; main &#x7EBF;&#x7A0B;&#x4E2D;&#x76D1;&#x542C; SHUTDOWN &#x547D;&#x4EE4;&#xFF0C;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x662F; 8005.&#x5F53;&#x6536;&#x5230;&#x8BE5;&#x547D;&#x4EE4;&#x540E;&#x6267;&#x884C; Catalina &#x7684; stop() &#x65B9;&#x6CD5;&#x5173;&#x95ED; Tomcat &#x670D;&#x52A1;&#x5668;&#x3002;
        daemon.setAwait(true);
        daemon.load(args);
        daemon.start();
    } else if (command.equals(&quot;stop&quot;)) {
        daemon.stopServer(args);
    } else if (command.equals(&quot;configtest&quot;)) {
        daemon.load(args);
        if (null==daemon.getServer()) {
            System.exit(1);
        }
        System.exit(0);
    } else {
        log.warn(&quot;Bootstrap: command \&quot;&quot; + command + &quot;\&quot; does not exist.&quot;);
    }
} catch (Throwable t) {
    // Unwrap the Exception for clearer error reporting
    if (t instanceof InvocationTargetException &amp;&amp;
            t.getCause() != null) {
        t = t.getCause();
    }
    handleThrowable(t);
    t.printStackTrace();
    System.exit(1);
}
</code></pre><p>}</p>
<pre><code>- 1) BootStrap#init
</code></pre><ul>
<li>&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x53BB;&#x5B9E;&#x4F8B;&#x5316;Catalina&#x5BF9;&#x8C61;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Tomcat&#x81EA;&#x5DF1;&#x7684;Classloader&#x3002;&#x5426;&#x5219;&#x4F1A;&#x4F7F;&#x7528;Java&#x7684;Classloader&#x53BB;&#x52A0;&#x8F7D;Catalina&#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<pre><code>public void init() throws Exception {
</code></pre><ul>
<li><p>// &#x521D;&#x59CB;&#x5316;commonLoader&#x3001;catalinaLoader&#x548C;sharedLoader;
  initClassLoaders();
  // &#x5C06;catalinaLoader&#x8BBE;&#x7F6E;&#x4E3A;Tomcat&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1B;
  Thread.currentThread().setContextClassLoader(catalinaLoader);</p>
<p>  SecurityClassLoad.securityClassLoad(catalinaLoader);</p>
<p>  // Load our startup class and call its process() method
  if (log.isDebugEnabled())</p>
<pre><code>  log.debug(&quot;Loading startup class&quot;);
</code></pre><p>  Class&lt;?&gt; startupClass = catalinaLoader.loadClass(&quot;org.apache.catalina.startup.Catalina&quot;);
  Object startupInstance = startupClass.getConstructor().newInstance();</p>
<p>  // Set the shared extensions class loader
  if (log.isDebugEnabled())</p>
<pre><code>  log.debug(&quot;Setting startup class properties&quot;);
</code></pre><p>  String methodName = &quot;setParentClassLoader&quot;;
  Class&lt;?&gt; paramTypes[] = new Class[1];
  paramTypes[0] = Class.forName(&quot;java.lang.ClassLoader&quot;);
  Object paramValues[] = new Object[1];
  paramValues[0] = sharedLoader;
  Method method =</p>
<pre><code>  startupInstance.getClass().getMethod(methodName, paramTypes);
</code></pre><p>  method.invoke(startupInstance, paramValues);</p>
<p>  catalinaDaemon = startupInstance;</p>
</li>
</ul>
<p>}</p>
<pre><code>- 1.1) BootStrap#initClassLoaders()
</code></pre><ul>
<li>commonLoader&#x3001;catalinaLoader&#x548C;sharedLoader&#x662F;&#x5728;Tomcat&#x5BB9;&#x5668;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7684;&#x8FC7;&#x7A0B;&#x521A;&#x521A;&#x5F00;&#x59CB;&#xFF08;&#x5373;&#x8C03;&#x7528;Bootstrap&#x7684;init&#x65B9;&#x6CD5;&#x65F6;)&#x521B;&#x5EFA;&#x7684;&#x3002;catalinaLoader&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;Tomcat&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;catalinaLoader&#x52A0;&#x8F7D;Tomcat&#x5BB9;&#x5668;&#x81EA;&#x8EAB;&#x7684;class&#x3002;</li>
</ul>
<pre><code>
private void initClassLoaders() {
    try {
        commonLoader = createClassLoader(&quot;common&quot;, null);
        if( commonLoader == null ) {
            // no config file, default to this loader - we might be in a &apos;single&apos; env.
            commonLoader=this.getClass().getClassLoader();
        }
        catalinaLoader = createClassLoader(&quot;server&quot;, commonLoader);
        sharedLoader = createClassLoader(&quot;shared&quot;, commonLoader);
    } catch (Throwable t) {
        handleThrowable(t);
        log.error(&quot;Class loader creation threw exception&quot;, t);
        System.exit(1);
    }
}
</code></pre><h4 id="111-createclassloader"><a name="111-createclassloader" class="plugin-anchor" href="#111-createclassloader"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1) createClassLoader</h4>
<ul>
<li><p>createClassLoader&#x7684;&#x5904;&#x7406;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
</li>
<li><p>&#x5B9A;&#x4F4D;&#x8D44;&#x6E90;&#x8DEF;&#x5F84;&#x4E0E;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#xFF1B;</p>
</li>
<li>&#x4F7F;&#x7528;ClassLoaderFactory&#x521B;&#x5EFA;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;org.apache.catalina.loader.StandardClassLoader&#xFF0C;&#x8FD9;&#x4E2A;StandardClassLoader&#x4EC5;&#x4EC5;&#x7EE7;&#x627F;&#x4E86;URLClassLoader&#x800C;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x66F4;&#x591A;&#x6539;&#x52A8;&#x3002;</li>
<li>Tomcat&#x9ED8;&#x8BA4;&#x53EA;&#x4F1A;&#x6307;&#x5B9A;commonLoader&#xFF0C;catalinaLoader&#x548C;sharedLoader&#x5B9E;&#x9645;&#x4E5F;&#x662F;commonLoader&#x3002;&#xFF08;&#x5728;catalina.properties&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;common&#x5C5E;&#x6027;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;{catalina.base}/lib/.jar,{catalina.home}/lib/.jar&#xFF0C;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x6240;&#x793A;&#xFF0C;&#x5C5E;&#x6027;catalina.home&#x9ED8;&#x8BA4;&#x4E3A;Tomcat&#x7684;&#x6839;&#x76EE;&#x5F55;&#x3002;)</li>
</ul>
<pre><code>common.loader=${catalina.home}/lib,${catalina.home}/lib/*.jar
</code></pre><pre><code>private ClassLoader createClassLoader(String name, ClassLoader parent)
    throws Exception {

    String value = CatalinaProperties.getProperty(name + &quot;.loader&quot;);
    if ((value == null) || (value.equals(&quot;&quot;)))
        return parent;

    value = replace(value);

    List&lt;Repository&gt; repositories = new ArrayList&lt;&gt;();

    String[] repositoryPaths = getPaths(value);

    for (String repository : repositoryPaths) {
        // Check for a JAR URL repository
        try {
            @SuppressWarnings(&quot;unused&quot;)
            URL url = new URL(repository);
            repositories.add(
                    new Repository(repository, RepositoryType.URL));
            continue;
        } catch (MalformedURLException e) {
            // Ignore
        }

        // Local repository
        if (repository.endsWith(&quot;*.jar&quot;)) {
            repository = repository.substring
                (0, repository.length() - &quot;*.jar&quot;.length());
            repositories.add(
                    new Repository(repository, RepositoryType.GLOB));
        } else if (repository.endsWith(&quot;.jar&quot;)) {
            repositories.add(
                    new Repository(repository, RepositoryType.JAR));
        } else {
            repositories.add(
                    new Repository(repository, RepositoryType.DIR));
        }
    }

    return ClassLoaderFactory.createClassLoader(repositories, parent);
}
</code></pre><pre><code>- 1.1.1.1) ClassLoaderFactory#createClassLoader
</code></pre><pre><code>public static ClassLoader createClassLoader(List&lt;Repository&gt; repositories,
                                            final ClassLoader parent)
    throws Exception {

    if (log.isDebugEnabled())
        log.debug(&quot;Creating new class loader&quot;);

    // Construct the &quot;class path&quot; for this class loader
    Set&lt;URL&gt; set = new LinkedHashSet&lt;&gt;();

    if (repositories != null) {
        for (Repository repository : repositories)  {
            if (repository.getType() == RepositoryType.URL) {
                URL url = buildClassLoaderUrl(repository.getLocation());
                if (log.isDebugEnabled())
                    log.debug(&quot;  Including URL &quot; + url);
                set.add(url);
            } else if (repository.getType() == RepositoryType.DIR) {
                File directory = new File(repository.getLocation());
                directory = directory.getCanonicalFile();
                if (!validateFile(directory, RepositoryType.DIR)) {
                    continue;
                }
                URL url = buildClassLoaderUrl(directory);
                if (log.isDebugEnabled())
                    log.debug(&quot;  Including directory &quot; + url);
                set.add(url);
            } else if (repository.getType() == RepositoryType.JAR) {
                File file=new File(repository.getLocation());
                file = file.getCanonicalFile();
                if (!validateFile(file, RepositoryType.JAR)) {
                    continue;
                }
                URL url = buildClassLoaderUrl(file);
                if (log.isDebugEnabled())
                    log.debug(&quot;  Including jar file &quot; + url);
                set.add(url);
            } else if (repository.getType() == RepositoryType.GLOB) {
                File directory=new File(repository.getLocation());
                directory = directory.getCanonicalFile();
                if (!validateFile(directory, RepositoryType.GLOB)) {
                    continue;
                }
                if (log.isDebugEnabled())
                    log.debug(&quot;  Including directory glob &quot;
                        + directory.getAbsolutePath());
                String filenames[] = directory.list();
                if (filenames == null) {
                    continue;
                }
                for (int j = 0; j &lt; filenames.length; j++) {
                    String filename = filenames[j].toLowerCase(Locale.ENGLISH);
                    if (!filename.endsWith(&quot;.jar&quot;))
                        continue;
                    File file = new File(directory, filenames[j]);
                    file = file.getCanonicalFile();
                    if (!validateFile(file, RepositoryType.JAR)) {
                        continue;
                    }
                    if (log.isDebugEnabled())
                        log.debug(&quot;    Including glob jar file &quot;
                            + file.getAbsolutePath());
                    URL url = buildClassLoaderUrl(file);
                    set.add(url);
                }
            }
        }
    }

    // Construct the class loader itself
    final URL[] array = set.toArray(new URL[set.size()]);
    if (log.isDebugEnabled())
        for (int i = 0; i &lt; array.length; i++) {
            log.debug(&quot;  location &quot; + i + &quot; is &quot; + array[i]);
        }

    return AccessController.doPrivileged(
            new PrivilegedAction&lt;URLClassLoader&gt;() {
                @Override
                public URLClassLoader run() {
                    if (parent == null)
                        return new URLClassLoader(array);
                    else
                        return new URLClassLoader(array, parent);
                }
            });
}
</code></pre><pre><code>- 2) BootStrap#load
</code></pre><pre><code>private void load(String[] arguments)
    throws Exception {

    // Call the load() method
    String methodName = &quot;load&quot;;
    Object param[];
    Class&lt;?&gt; paramTypes[];
    if (arguments==null || arguments.length==0) {
        paramTypes = null;
        param = null;
    } else {
        paramTypes = new Class[1];
        paramTypes[0] = arguments.getClass();
        param = new Object[1];
        param[0] = arguments;
    }
    Method method =
        catalinaDaemon.getClass().getMethod(methodName, paramTypes);
    if (log.isDebugEnabled())
        log.debug(&quot;Calling startup class &quot; + method);
    method.invoke(catalinaDaemon, param);

}
</code></pre><pre><code>- 2.1) Catalina#load
</code></pre><pre><code>public void load() {

    if (loaded) {
        return;
    }
    loaded = true;

    long t1 = System.nanoTime();

    initDirs();

    // Before digester - it may be needed
    initNaming();

    // Create and execute our Digester
    Digester digester = createStartDigester();

    InputSource inputSource = null;
    InputStream inputStream = null;
    File file = null;
    try {
        try {
            file = configFile();
            inputStream = new FileInputStream(file);
            inputSource = new InputSource(file.toURI().toURL().toString());
        } catch (Exception e) {
            if (log.isDebugEnabled()) {
                log.debug(sm.getString(&quot;catalina.configFail&quot;, file), e);
            }
        }
        if (inputStream == null) {
            try {
                inputStream = getClass().getClassLoader()
                    .getResourceAsStream(getConfigFile());
                inputSource = new InputSource
                    (getClass().getClassLoader()
                     .getResource(getConfigFile()).toString());
            } catch (Exception e) {
                if (log.isDebugEnabled()) {
                    log.debug(sm.getString(&quot;catalina.configFail&quot;,
                            getConfigFile()), e);
                }
            }
        }

        // This should be included in catalina.jar
        // Alternative: don&apos;t bother with xml, just create it manually.
        if (inputStream == null) {
            try {
                inputStream = getClass().getClassLoader()
                        .getResourceAsStream(&quot;server-embed.xml&quot;);
                inputSource = new InputSource
                (getClass().getClassLoader()
                        .getResource(&quot;server-embed.xml&quot;).toString());
            } catch (Exception e) {
                if (log.isDebugEnabled()) {
                    log.debug(sm.getString(&quot;catalina.configFail&quot;,
                            &quot;server-embed.xml&quot;), e);
                }
            }
        }


        if (inputStream == null || inputSource == null) {
            if  (file == null) {
                log.warn(sm.getString(&quot;catalina.configFail&quot;,
                        getConfigFile() + &quot;] or [server-embed.xml]&quot;));
            } else {
                log.warn(sm.getString(&quot;catalina.configFail&quot;,
                        file.getAbsolutePath()));
                if (file.exists() &amp;&amp; !file.canRead()) {
                    log.warn(&quot;Permissions incorrect, read permission is not allowed on the file.&quot;);
                }
            }
            return;
        }

        try {
            inputSource.setByteStream(inputStream);
            digester.push(this);
            digester.parse(inputSource);
        } catch (SAXParseException spe) {
            log.warn(&quot;Catalina.start using &quot; + getConfigFile() + &quot;: &quot; +
                    spe.getMessage());
            return;
        } catch (Exception e) {
            log.warn(&quot;Catalina.start using &quot; + getConfigFile() + &quot;: &quot; , e);
            return;
        }
    } finally {
        if (inputStream != null) {
            try {
                inputStream.close();
            } catch (IOException e) {
                // Ignore
            }
        }
    }

    getServer().setCatalina(this);
    getServer().setCatalinaHome(Bootstrap.getCatalinaHomeFile());
    getServer().setCatalinaBase(Bootstrap.getCatalinaBaseFile());

    // Stream redirection
    initStreams();

    // Start the new server
    try {
        getServer().init();
    } catch (LifecycleException e) {
        if (Boolean.getBoolean(&quot;org.apache.catalina.startup.EXIT_ON_INIT_FAILURE&quot;)) {
            throw new java.lang.Error(e);
        } else {
            log.error(&quot;Catalina.start&quot;, e);
        }
    }

    long t2 = System.nanoTime();
    if(log.isInfoEnabled()) {
        log.info(&quot;Initialization processed in &quot; + ((t2 - t1) / 1000000) + &quot; ms&quot;);
    }
}
</code></pre><pre><code>- 2.1.1) Digester#parse&#xFF08;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x89E3;&#x6790;&#xFF0C;&#x521B;&#x5EFA;&#x5B50;&#x5BB9;&#x5668;)
</code></pre><pre><code>public Object parse(InputSource input) throws IOException, SAXException {
    configure();
    getXMLReader().parse(input);
    return root;
}
</code></pre><ul>
<li>org.apache.commons.digester</li>
<li><p>&#x8BE5;&#x5305;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x4E8E;&#x89C4;&#x5219;&#x7684;&#xFF0C;&#x53EF;&#x4EFB;&#x610F;&#x5904;&#x7406;XML&#x6587;&#x6863;&#x7684;&#x7C7B;</p>
</li>
<li><p>org.apache.commons.digester.Digester&#x662F;Digester&#x7C7B;&#x5E93;&#x7684;&#x4E3B;&#x7C7B;&#xFF0C;&#x8BE5;&#x7C7B;&#x53EF;&#x7528;&#x4E8E;&#x89E3;&#x6790;XML&#x6587;&#x6863;&#x3002;</p>
</li>
<li>&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#x5206;&#x4E3A;&#x4E24;&#x6B65;: </li>
<li>&#x5B9A;&#x4E49;&#x597D;&#x6A21;&#x5F0F;(&#x5B9A;&#x4E49;&#x8981;&#x5339;&#x914D;&#x7684;&#x6807;&#x7B7E;)</li>
<li><p>&#x5C06;&#x6A21;&#x5F0F;&#x4E0E;&#x89C4;&#x5219;(&#x5B9A;&#x4E49;&#x5339;&#x914D;&#x5230;&#x6807;&#x7B7E;&#x540E;&#x7684;&#x884C;&#x4E3A;&#x7684;&#x5BF9;&#x8C61;)&#x76F8;&#x5173;&#x8054;</p>
</li>
<li><p>&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;startElement&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x6309;&#x7167;&#x65E2;&#x5B9A;&#x7684;&#x4E00;&#x4E9B;&#x89C4;&#x5219;&#xFF0C;&#x5728;&#x8BFB;&#x53D6;&#x7684;&#x540C;&#x65F6;&#x53BB;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li>&#x6BD4;&#x5982;&#xFF1A;</li>
<li><p>digester.addRule(&quot;Server/Service/Connector&quot;,</p>
<pre><code>           new ConnectorCreateRule());
</code></pre><ul>
<li>2.1.1.1) ConnectorCreateRule#begin</li>
</ul>
</li>
</ul>
<pre><code>public void begin(String namespace, String name, Attributes attributes)
        throws Exception {
    Service svc = (Service)digester.peek();
    Executor ex = null;
    if ( attributes.getValue(&quot;executor&quot;)!=null ) {
        ex = svc.getExecutor(attributes.getValue(&quot;executor&quot;));
    }
    Connector con = new Connector(attributes.getValue(&quot;protocol&quot;));
    if (ex != null) {
        setExecutor(con, ex);
    }
    String sslImplementationName = attributes.getValue(&quot;sslImplementationName&quot;);
    if (sslImplementationName != null) {
        setSSLImplementationName(con, sslImplementationName);
    }
    digester.push(con);
}
</code></pre><pre><code>- 2.1.1.1.1) Connector#constructor&#xFF08;&#x4ECE;Connector&#x5F00;&#x59CB;&#x7684;&#x521D;&#x59CB;&#x5316;)
</code></pre><pre><code>public Connector(String protocol) {
    boolean aprConnector = AprLifecycleListener.isAprAvailable() &amp;&amp;
            AprLifecycleListener.getUseAprConnector();

    if (&quot;HTTP/1.1&quot;.equals(protocol) || protocol == null) {
        if (aprConnector) {
            protocolHandlerClassName = &quot;org.apache.coyote.http11.Http11AprProtocol&quot;;
        } else {
            protocolHandlerClassName = &quot;org.apache.coyote.http11.Http11NioProtocol&quot;;
        }
    } else if (&quot;AJP/1.3&quot;.equals(protocol)) {
        if (aprConnector) {
            protocolHandlerClassName = &quot;org.apache.coyote.ajp.AjpAprProtocol&quot;;
        } else {
            protocolHandlerClassName = &quot;org.apache.coyote.ajp.AjpNioProtocol&quot;;
        }
    } else {
        protocolHandlerClassName = protocol;
    }

    // Instantiate protocol handler
    ProtocolHandler p = null;
    try {
</code></pre><ul>
<li><p>// &#x53CD;&#x5C04;&#x521B;&#x5EFA;Http11NioProtocol</p>
<pre><code>  Class&lt;?&gt; clazz = Class.forName(protocolHandlerClassName);
  p = (ProtocolHandler) clazz.getConstructor().newInstance();
</code></pre><p>  } catch (Exception e) {</p>
<pre><code>  log.error(sm.getString(
          &quot;coyoteConnector.protocolHandlerInstantiationFailed&quot;), e);
</code></pre><p>  } finally {</p>
<pre><code>  this.protocolHandler = p;
</code></pre><p>  }</p>
<p>  // Default for Connector depends on this system property
  setThrowOnFailure(Boolean.getBoolean(&quot;org.apache.catalina.startup.EXIT_ON_INIT_FAILURE&quot;));
}</p>
<ul>
<li>2.1.1.1.1.1) Http11NioProtocol#constructor</li>
</ul>
</li>
</ul>
<pre><code>public Http11NioProtocol() {
    super(new NioEndpoint());
}
</code></pre><pre><code>public AbstractHttp11JsseProtocol(AbstractJsseEndpoint&lt;S,?&gt; endpoint) {
    super(endpoint);
}
</code></pre><pre><code>public AbstractHttp11Protocol(AbstractEndpoint&lt;S,?&gt; endpoint) {
    super(endpoint);
    setConnectionTimeout(Constants.DEFAULT_CONNECTION_TIMEOUT);
    ConnectionHandler&lt;S&gt; cHandler = new ConnectionHandler&lt;&gt;(this);
    setHandler(cHandler);
    getEndpoint().setHandler(cHandler);
}
</code></pre><pre><code>public AbstractProtocol(AbstractEndpoint&lt;S,?&gt; endpoint) {
    this.endpoint = endpoint;
    setConnectionLinger(Constants.DEFAULT_CONNECTION_LINGER);
    setTcpNoDelay(Constants.DEFAULT_TCP_NO_DELAY);
}
</code></pre><pre><code>- 2.1.1.1.1.1.1) ConnectionHandler#constructor
</code></pre><pre><code>public ConnectionHandler(AbstractProtocol&lt;S&gt; proto) {
    this.proto = proto;
}
</code></pre><h3 id=""><a name="" class="plugin-anchor" href="#"><i class="fa fa-link" aria-hidden="true"></i></a> </h3>
<pre><code>- 2.1.2) StandardServer#init
</code></pre><ul>
<li>&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#xFF0C;&#x8C03;&#x7528;&#x7684;&#x662F;&#x81EA;&#x5DF1;&#x91CD;&#x5199;&#x7684;initInternal&#x3002;</li>
<li><p>protected void initInternal() throws LifecycleException {</p>
<p>  super.initInternal();</p>
<p>  // Register global String cache
  // Note although the cache is global, if there are multiple Servers
  // present in the JVM (may happen when embedding) then the same cache
  // will be registered under multiple names
  onameStringCache = register(new StringCache(), &quot;type=StringCache&quot;);</p>
<p>  // Register the MBeanFactory
  MBeanFactory factory = new MBeanFactory();
  factory.setContainer(this);
  onameMBeanFactory = register(factory, &quot;type=MBeanFactory&quot;);</p>
<p>  // Register the naming resources
  globalNamingResources.init();</p>
<p>  // Populate the extension validator with JARs from common and shared
  // class loaders
  if (getCatalina() != null) {</p>
<pre><code>  ClassLoader cl = getCatalina().getParentClassLoader();
  // Walk the class loader hierarchy. Stop at the system class loader.
  // This will add the shared (if present) and common class loaders
  while (cl != null &amp;&amp; cl != ClassLoader.getSystemClassLoader()) {
      if (cl instanceof URLClassLoader) {
          URL[] urls = ((URLClassLoader) cl).getURLs();
          for (URL url : urls) {
              if (url.getProtocol().equals(&quot;file&quot;)) {
                  try {
                      File f = new File (url.toURI());
                      if (f.isFile() &amp;&amp;
                              f.getName().endsWith(&quot;.jar&quot;)) {
                          ExtensionValidator.addSystemResource(f);
                      }
                  } catch (URISyntaxException e) {
                      // Ignore
                  } catch (IOException e) {
                      // Ignore
                  }
              }
          }
      }
      cl = cl.getParent();
  }
</code></pre><p>  }
  // Initialize our defined Services
  for (int i = 0; i &lt; services.length; i++) {</p>
<pre><code>  services[i].init();
</code></pre><p>  }
}</p>
</li>
<li><p>&#x521D;&#x59CB;&#x5316;StandardService</p>
<ul>
<li>2.1.2.1) StandardService#init</li>
</ul>
</li>
<li><p>protected void initInternal() throws LifecycleException {</p>
<p>  super.initInternal();</p>
<p>  if (engine != null) {</p>
<pre><code>  engine.init();
</code></pre><p>  }</p>
<p>  // Initialize any Executors
  for (Executor executor : findExecutors()) {</p>
<pre><code>  if (executor instanceof JmxEnabled) {
      ((JmxEnabled) executor).setDomain(getDomain());
  }
  executor.init();
</code></pre><p>  }</p>
<p>  // Initialize mapper listener
  mapperListener.init();</p>
<p>  // Initialize our defined Connectors
  synchronized (connectorsLock) {</p>
<pre><code>  for (Connector connector : connectors) {
      connector.init();
  }
</code></pre><p>  }
}</p>
<ul>
<li>2.1.2.1.1) Connector#init</li>
</ul>
</li>
<li><p>protected void initInternal() throws LifecycleException {</p>
<p>  super.initInternal();</p>
<p>  if (protocolHandler == null) {</p>
<pre><code>  throw new LifecycleException(
          sm.getString(&quot;coyoteConnector.protocolHandlerInstantiationFailed&quot;));
</code></pre><p>  }</p>
<p>  // Initialize adapter
  adapter = new CoyoteAdapter(this);</p>
</li>
<li><p>// protocolHandler &#x5373; Http11NioProtocol
  protocolHandler.setAdapter(adapter);</p>
<p>  // Make sure parseBodyMethodsSet has a default
  if (null == parseBodyMethodsSet) {</p>
<pre><code>  setParseBodyMethods(getParseBodyMethods());
</code></pre><p>  }</p>
<p>  if (protocolHandler.isAprRequired() &amp;&amp; !AprLifecycleListener.isAprAvailable()) {</p>
<pre><code>  throw new LifecycleException(sm.getString(&quot;coyoteConnector.protocolHandlerNoApr&quot;,
          getProtocolHandlerClassName()));
</code></pre><p>  }
  if (AprLifecycleListener.isAprAvailable() &amp;&amp; AprLifecycleListener.getUseOpenSSL() &amp;&amp;</p>
<pre><code>      protocolHandler instanceof AbstractHttp11JsseProtocol) {
  AbstractHttp11JsseProtocol&lt;?&gt; jsseProtocolHandler =
          (AbstractHttp11JsseProtocol&lt;?&gt;) protocolHandler;
  if (jsseProtocolHandler.isSSLEnabled() &amp;&amp;
          jsseProtocolHandler.getSslImplementationName() == null) {
      // OpenSSL is compatible with the JSSE configuration, so use it if APR is available
      jsseProtocolHandler.setSslImplementationName(OpenSSLImplementation.class.getName());
  }
</code></pre><p>  }</p>
<p>  try {</p>
<pre><code>  protocolHandler.init();
</code></pre><p>  } catch (Exception e) {</p>
<pre><code>  throw new LifecycleException(
          sm.getString(&quot;coyoteConnector.protocolHandlerInitializationFailed&quot;), e);
</code></pre><p>  }
}</p>
<ul>
<li>2.1.2.1.1.1) AbstractHttp11Protocol#init</li>
</ul>
</li>
</ul>
<pre><code>public void init() throws Exception {
    // Upgrade protocols have to be configured first since the endpoint
    // init (triggered via super.init() below) uses this list to configure
    // the list of ALPN protocols to advertise
    for (UpgradeProtocol upgradeProtocol : upgradeProtocols) {
        configureUpgradeProtocol(upgradeProtocol);
    }

    super.init();
}
</code></pre><ul>
<li>AbstractProtocol#init</li>
</ul>
<pre><code>public void init() throws Exception {
    if (getLog().isInfoEnabled()) {
        getLog().info(sm.getString(&quot;abstractProtocolHandler.init&quot;, getName()));
    }

    if (oname == null) {
        // Component not pre-registered so register it
        oname = createObjectName();
        if (oname != null) {
            Registry.getRegistry(null, null).registerComponent(this, oname, null);
        }
    }

    if (this.domain != null) {
        rgOname = new ObjectName(domain + &quot;:type=GlobalRequestProcessor,name=&quot; + getName());
        Registry.getRegistry(null, null).registerComponent(
                getHandler().getGlobal(), rgOname, null);
    }

    String endpointName = getName();
    endpoint.setName(endpointName.substring(1, endpointName.length()-1));
    endpoint.setDomain(domain);

    endpoint.init();
}
</code></pre><pre><code>- 2.1.2.1.1.1.1) AbstractEndPoint#init
</code></pre><pre><code>public final void init() throws Exception {
    if (bindOnInit) {
        bind();
        bindState = BindState.BOUND_ON_INIT;
    }
    if (this.domain != null) {
        // Register endpoint (as ThreadPool - historical name)
        oname = new ObjectName(domain + &quot;:type=ThreadPool,name=\&quot;&quot; + getName() + &quot;\&quot;&quot;);
        Registry.getRegistry(null, null).registerComponent(this, oname, null);

        for (SSLHostConfig sslHostConfig : findSslHostConfigs()) {
            registerJmx(sslHostConfig);
        }
    }
}
</code></pre><pre><code>- 2.1.2.1.1.1.1.1) NioEndpoint#init
</code></pre><pre><code>public void bind() throws Exception {
    initServerSocket();

    // Initialize thread count defaults for acceptor, poller
    if (acceptorThreadCount == 0) {
        // FIXME: Doesn&apos;t seem to work that well with multiple accept threads
        acceptorThreadCount = 1;
    }
    if (pollerThreadCount &lt;= 0) {
        //minimum one poller thread
        pollerThreadCount = 1;
    }
    setStopLatch(new CountDownLatch(pollerThreadCount));

    // Initialize SSL if needed
    initialiseSsl();

    selectorPool.open();
}
</code></pre><pre><code>- 2.1.2.1.1.1.1.1.1) NioEndpoint#initServerSocket&#xFF08;&#x521B;&#x5EFA;&#x963B;&#x585E;&#x7684;ServerSocket)
</code></pre><ul>
<li>protected void initServerSocket() throws Exception {
  serverSock = ServerSocketChannel.open();
  socketProperties.setProperties(serverSock.socket());
  InetSocketAddress addr = (getAddress()!=null?new InetSocketAddress(getAddress(),getPort()):new InetSocketAddress(getPort()));
  serverSock.socket().bind(addr,getAcceptCount());
  serverSock.configureBlocking(true); //mimic APR behavior
}</li>
<li>&#x6253;&#x5F00;&#x4E00;&#x4E2A; ServerSocket&#xFF0C;&#x9ED8;&#x8BA4;&#x7ED1;&#x5B9A;&#x5230; 8080 &#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x8FDE;&#x63A5;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x662F; 100&#xFF0C; &#x5F53;&#x8D85;&#x8FC7; 100 &#x4E2A;&#x65F6;&#x4F1A;&#x62D2;&#x7EDD;&#x670D;&#x52A1;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E; conf/server.xml &#x4E2D; Connector &#x7684; acceptCount &#x5C5E;&#x6027;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#x3002;<ul>
<li>2.1.2.1.1.1.1.1.2) NioSelectorPool#open&#xFF08;&#x8F85;&#x52A9;selector)</li>
</ul>
</li>
<li>protected static final boolean SHARED =
  Boolean.parseBoolean(System.getProperty(&quot;org.apache.tomcat.util.net.NioSelectorShared&quot;, &quot;true&quot;));</li>
</ul>
<pre><code>public void open() throws IOException {
    enabled = true;
    getSharedSelector();
    if (SHARED) {
        blockingSelector = new NioBlockingSelector();
        blockingSelector.open(getSharedSelector());
    }
}
</code></pre><h3 id=""><a name="" class="plugin-anchor" href="#"><i class="fa fa-link" aria-hidden="true"></i></a> </h3>
<pre><code>- 2.1.2.1.1.1.1.1.2.1) NioSelectorPool#getSharedSelector&#xFF08;&#x5F00;&#x542F;selector)
</code></pre><ul>
<li><p>protected Selector getSharedSelector() throws IOException {
  if (SHARED &amp;&amp; SHARED_SELECTOR == null) {</p>
<pre><code>  synchronized ( NioSelectorPool.class ) {
      if ( SHARED_SELECTOR == null )  {
          SHARED_SELECTOR = Selector.open();
          log.info(&quot;Using a shared selector for servlet write/read&quot;);
      }
  }
</code></pre><p>  }
  return  SHARED_SELECTOR;
}</p>
<ul>
<li>2.1.2.1.1.1.1.1.2.2) NioBlockingSelector#open&#xFF08;&#x542F;&#x52A8;blockPoller&#x7EBF;&#x7A0B;)</li>
</ul>
</li>
</ul>
<pre><code>public void open(Selector selector) {
    sharedSelector = selector;
    poller = new BlockPoller();
    poller.selector = sharedSelector;
    poller.setDaemon(true);
    poller.setName(&quot;NioBlockingSelector.BlockPoller-&quot;+(++threadCounter));
    poller.start();
}
</code></pre><pre><code>- 3) BootStrap#start
</code></pre><pre><code>public void start()
    throws Exception {
    if( catalinaDaemon==null ) init();

    Method method = catalinaDaemon.getClass().getMethod(&quot;start&quot;, (Class [] )null);
    method.invoke(catalinaDaemon, (Object [])null);

}
</code></pre><pre><code>- 3.1) Catalina#start
</code></pre><pre><code>public void start() {

    if (getServer() == null) {
        load();
    }

    if (getServer() == null) {
        log.fatal(&quot;Cannot start server. Server instance is not configured.&quot;);
        return;
    }

    long t1 = System.nanoTime();

    // Start the new server
    try {
        getServer().start();
    } catch (LifecycleException e) {
        log.fatal(sm.getString(&quot;catalina.serverStartFail&quot;), e);
        try {
            getServer().destroy();
        } catch (LifecycleException e1) {
            log.debug(&quot;destroy() failed for failed Server &quot;, e1);
        }
        return;
    }

    long t2 = System.nanoTime();
    if(log.isInfoEnabled()) {
        log.info(&quot;Server startup in &quot; + ((t2 - t1) / 1000000) + &quot; ms&quot;);
    }

    // Register shutdown hook
    if (useShutdownHook) {
        if (shutdownHook == null) {
            shutdownHook = new CatalinaShutdownHook();
        }
        Runtime.getRuntime().addShutdownHook(shutdownHook);

        // If JULI is being used, disable JULI&apos;s shutdown hook since
        // shutdown hooks run in parallel and log messages may be lost
        // if JULI&apos;s hook completes before the CatalinaShutdownHook()
        LogManager logManager = LogManager.getLogManager();
        if (logManager instanceof ClassLoaderLogManager) {
            ((ClassLoaderLogManager) logManager).setUseShutdownHook(
                    false);
        }
    }

    if (await) {
        await();
        stop();
    }
}
</code></pre><pre><code>- 3.1.1) StandardServer#start
</code></pre><ul>
<li>start&#x540C;&#x6837;&#x4E5F;&#x662F;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#x3002;</li>
<li><p>protected void startInternal() throws LifecycleException {</p>
<p>  fireLifecycleEvent(CONFIGURE_START_EVENT, null);
  setState(LifecycleState.STARTING);</p>
<p>  globalNamingResources.start();</p>
<p>  // Start our defined Services
  synchronized (servicesLock) {</p>
<pre><code>  for (int i = 0; i &lt; services.length; i++) {
      services[i].start();
  }
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1.1) StandardService#start</li>
</ul>
</li>
<li><p>protected void startInternal() throws LifecycleException {</p>
<p>  if(log.isInfoEnabled())</p>
<pre><code>  log.info(sm.getString(&quot;standardService.start.name&quot;, this.name));
</code></pre><p>  setState(LifecycleState.STARTING);</p>
<p>  // Start our defined Container first
  if (engine != null) {</p>
<pre><code>  synchronized (engine) {
      engine.start();
  }
</code></pre><p>  }</p>
<p>  synchronized (executors) {</p>
<pre><code>  for (Executor executor: executors) {
      executor.start();
  }
</code></pre><p>  }</p>
<p>  mapperListener.start();</p>
<p>  // Start our defined Connectors second
  synchronized (connectorsLock) {</p>
<pre><code>  for (Connector connector: connectors) {
      // If it has already failed, don&apos;t try and start it
      if (connector.getState() != LifecycleState.FAILED) {
          connector.start();
      }
  }
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1.1.1) StandardEngine#start</li>
</ul>
</li>
</ul>
<ul>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>  // Log our server identification information
  if(log.isInfoEnabled())</p>
<pre><code>  log.info( &quot;Starting Servlet Engine: &quot; + ServerInfo.getServerInfo());
</code></pre><p>  // Standard container startup
  super.startInternal();
}</p>
</li>
</ul>
<pre><code>- 3.1.1.1.1.1) ContainerBase#startInternal
</code></pre><ul>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>  // Start our subordinate components, if any
  logger = null;
  getLogger();
  Cluster cluster = getClusterInternal();
  if (cluster instanceof Lifecycle) {</p>
<pre><code>  ((Lifecycle) cluster).start();
</code></pre><p>  }
  Realm realm = getRealmInternal();
  if (realm instanceof Lifecycle) {</p>
<pre><code>  ((Lifecycle) realm).start();
</code></pre><p>  }</p>
<p>  // Start our child containers, if any
  Container children[] = findChildren();
  List<future<void>&gt; results = new ArrayList&lt;&gt;();
  for (int i = 0; i &lt; children.length; i++) {</future<void></p>
<pre><code>  results.add(startStopExecutor.submit(new StartChild(children[i])));
</code></pre><p>  }</p>
<p>  boolean fail = false;
  for (Future<void> result : results) {</void></p>
<pre><code>  try {
      result.get();
  } catch (Exception e) {
      log.error(sm.getString(&quot;containerBase.threadedStartFailed&quot;), e);
      fail = true;
  }
</code></pre><p>  }
  if (fail) {</p>
<pre><code>  throw new LifecycleException(
          sm.getString(&quot;containerBase.threadedStartFailed&quot;));
</code></pre><p>  }</p>
<p>  // Start the Valves in our pipeline (including the basic), if any
  if (pipeline instanceof Lifecycle)</p>
<pre><code>  ((Lifecycle) pipeline).start();
</code></pre></li>
</ul>
<pre><code>setState(LifecycleState.STARTING);

// Start our thread
threadStart();
</code></pre><p>}</p>
<pre><code>- 3.1.1.1.1.1.1) StandardHost#start
</code></pre><ul>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>  // Set error report valve
  String errorValve = getErrorReportValveClass();
  if ((errorValve != null) &amp;&amp; (!errorValve.equals(&quot;&quot;))) {</p>
<pre><code>  try {
      boolean found = false;
      Valve[] valves = getPipeline().getValves();
      for (Valve valve : valves) {
          if (errorValve.equals(valve.getClass().getName())) {
              found = true;
              break;
          }
      }
      if(!found) {
          Valve valve =
              (Valve) Class.forName(errorValve).getConstructor().newInstance();
          getPipeline().addValve(valve);
      }
  } catch (Throwable t) {
      ExceptionUtils.handleThrowable(t);
      log.error(sm.getString(
              &quot;standardHost.invalidErrorReportValveClass&quot;,
              errorValve), t);
  }
</code></pre><p>  }
  super.startInternal();
}</p>
<ul>
<li>3.1.1.1.1.1.1.1) StandardContext#start&#xFF08;&#x4F1A;&#x521D;&#x59CB;&#x5316;loadOnStartup&#x7684;servlet)</li>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>if(log.isDebugEnabled())
  log.debug(&quot;Starting &quot; + getBaseName());</p>
<p>// Send j2ee.state.starting notification
if (this.getObjectName() != null) {
  Notification notification = new Notification(&quot;j2ee.state.starting&quot;,</p>
<pre><code>      this.getObjectName(), sequenceNumber.getAndIncrement());
</code></pre><p>  broadcaster.sendNotification(notification);
}</p>
<p>setConfigured(false);
boolean ok = true;</p>
<p>// Currently this is effectively a NO-OP but needs to be called to
// ensure the NamingResources follows the correct lifecycle
if (namingResources != null) {
  namingResources.start();
}</p>
<p>// Post work directory
postWorkDirectory();</p>
<p>// Add missing components as necessary
if (getResources() == null) {   // (1) Required by Loader
  if (log.isDebugEnabled())</p>
<pre><code>  log.debug(&quot;Configuring default Resources&quot;);
</code></pre><p>  try {</p>
<pre><code>  setResources(new StandardRoot(this));
</code></pre><p>  } catch (IllegalArgumentException e) {</p>
<pre><code>  log.error(sm.getString(&quot;standardContext.resourcesInit&quot;), e);
  ok = false;
</code></pre><p>  }
}
if (ok) {
  resourcesStart();
}
// &#x521D;&#x59CB;&#x5316;WebappLoader
if (getLoader() == null) {
  WebappLoader webappLoader = new WebappLoader(getParentClassLoader());
  webappLoader.setDelegate(getDelegate());
  setLoader(webappLoader);
}</p>
<p>// An explicit cookie processor hasn&apos;t been specified; use the default
if (cookieProcessor == null) {
  cookieProcessor = new Rfc6265CookieProcessor();
}</p>
<p>// Initialize character set mapper
getCharsetMapper();</p>
<p>// Validate required extensions
boolean dependencyCheck = true;
try {
  dependencyCheck = ExtensionValidator.validateApplication</p>
<pre><code>  (getResources(), this);
</code></pre><p>} catch (IOException ioe) {
  log.error(sm.getString(&quot;standardContext.extensionValidationError&quot;), ioe);
  dependencyCheck = false;
}</p>
<p>if (!dependencyCheck) {
  // do not make application available if dependency check fails
  ok = false;
}</p>
<p>// Reading the &quot;catalina.useNaming&quot; environment variable
String useNamingProperty = System.getProperty(&quot;catalina.useNaming&quot;);
if ((useNamingProperty != null)
  &amp;&amp; (useNamingProperty.equals(&quot;false&quot;))) {
  useNaming = false;
}</p>
<p>if (ok &amp;&amp; isUseNaming()) {
  if (getNamingContextListener() == null) {</p>
<pre><code>  NamingContextListener ncl = new NamingContextListener();
  ncl.setName(getNamingContextName());
  ncl.setExceptionOnFailedWrite(getJndiExceptionOnFailedWrite());
  addLifecycleListener(ncl);
  setNamingContextListener(ncl);
</code></pre><p>  }
}</p>
<p>// Standard container startup
if (log.isDebugEnabled())
  log.debug(&quot;Processing standard container startup&quot;);</p>
</li>
</ul>
</li>
</ul>
<pre><code>// Binding thread
ClassLoader oldCCL = bindThread();

try {
    if (ok) {
        // Start our subordinate components, if any
        Loader loader = getLoader();
        if (loader instanceof Lifecycle) {
</code></pre><pre><code>// &#x542F;&#x52A8;WebappClassLoader
                ((Lifecycle) loader).start();
            }

            // since the loader just started, the webapp classloader is now
            // created.
            setClassLoaderProperty(&quot;clearReferencesRmiTargets&quot;,
                    getClearReferencesRmiTargets());
            setClassLoaderProperty(&quot;clearReferencesStopThreads&quot;,
                    getClearReferencesStopThreads());
            setClassLoaderProperty(&quot;clearReferencesStopTimerThreads&quot;,
                    getClearReferencesStopTimerThreads());
            setClassLoaderProperty(&quot;clearReferencesHttpClientKeepAliveThread&quot;,
                    getClearReferencesHttpClientKeepAliveThread());

            // By calling unbindThread and bindThread in a row, we setup the
            // current Thread CCL to be the webapp classloader
            unbindThread(oldCCL);
            oldCCL = bindThread();

            // Initialize logger again. Other components might have used it
            // too early, so it should be reset.
            logger = null;
            getLogger();

            Realm realm = getRealmInternal();
            if(null != realm) {
                if (realm instanceof Lifecycle) {
                    ((Lifecycle) realm).start();
                }

                // Place the CredentialHandler into the ServletContext so
                // applications can have access to it. Wrap it in a &quot;safe&quot;
                // handler so application&apos;s can&apos;t modify it.
                CredentialHandler safeHandler = new CredentialHandler() {
                    @Override
                    public boolean matches(String inputCredentials, String storedCredentials) {
                        return getRealmInternal().getCredentialHandler().matches(inputCredentials, storedCredentials);
                    }

                    @Override
                    public String mutate(String inputCredentials) {
                        return getRealmInternal().getCredentialHandler().mutate(inputCredentials);
                    }
                };
                context.setAttribute(Globals.CREDENTIAL_HANDLER, safeHandler);
            }

            // Notify our interested LifecycleListeners
            fireLifecycleEvent(Lifecycle.CONFIGURE_START_EVENT, null);

            // Start our child containers, if not already started
            for (Container child : findChildren()) {
                if (!child.getState().isAvailable()) {
                    child.start();
                }
            }

            // Start the Valves in our pipeline (including the basic),
            // if any
            if (pipeline instanceof Lifecycle) {
                ((Lifecycle) pipeline).start();
            }

            // Acquire clustered manager
            Manager contextManager = null;
            Manager manager = getManager();
            if (manager == null) {
                if (log.isDebugEnabled()) {
                    log.debug(sm.getString(&quot;standardContext.cluster.noManager&quot;,
                            Boolean.valueOf((getCluster() != null)),
                            Boolean.valueOf(distributable)));
                }
                if ( (getCluster() != null) &amp;&amp; distributable) {
                    try {
                        contextManager = getCluster().createManager(getName());
                    } catch (Exception ex) {
                        log.error(&quot;standardContext.clusterFail&quot;, ex);
                        ok = false;
                    }
                } else {
                    contextManager = new StandardManager();
                }
            }

            // Configure default manager if none was specified
            if (contextManager != null) {
                if (log.isDebugEnabled()) {
                    log.debug(sm.getString(&quot;standardContext.manager&quot;,
                            contextManager.getClass().getName()));
                }
                setManager(contextManager);
            }

            if (manager!=null &amp;&amp; (getCluster() != null) &amp;&amp; distributable) {
                //let the cluster know that there is a context that is distributable
                //and that it has its own manager
                getCluster().registerManager(manager);
            }
        }

        if (!getConfigured()) {
            log.error(sm.getString(&quot;standardContext.configurationFail&quot;));
            ok = false;
        }

        // We put the resources into the servlet context
        if (ok)
            getServletContext().setAttribute
                (Globals.RESOURCES_ATTR, getResources());

        if (ok ) {
            if (getInstanceManager() == null) {
                javax.naming.Context context = null;
                if (isUseNaming() &amp;&amp; getNamingContextListener() != null) {
                    context = getNamingContextListener().getEnvContext();
                }
                Map&lt;String, Map&lt;String, String&gt;&gt; injectionMap = buildInjectionMap(
                        getIgnoreAnnotations() ? new NamingResourcesImpl(): getNamingResources());
                setInstanceManager(new DefaultInstanceManager(context,
                        injectionMap, this, this.getClass().getClassLoader()));
            }
            getServletContext().setAttribute(
                    InstanceManager.class.getName(), getInstanceManager());
            InstanceManagerBindings.bind(getLoader().getClassLoader(), getInstanceManager());
        }

        // Create context attributes that will be required
        if (ok) {
            getServletContext().setAttribute(
                    JarScanner.class.getName(), getJarScanner());
        }

        // Set up the context init params
        mergeParameters();

        // Call ServletContainerInitializers
        for (Map.Entry&lt;ServletContainerInitializer, Set&lt;Class&lt;?&gt;&gt;&gt; entry :
            initializers.entrySet()) {
            try {
                entry.getKey().onStartup(entry.getValue(),
                        getServletContext());
            } catch (ServletException e) {
                log.error(sm.getString(&quot;standardContext.sciFail&quot;), e);
                ok = false;
                break;
            }
        }

        // Configure and call application event listeners
        if (ok) {
            if (!listenerStart()) {
                log.error(sm.getString(&quot;standardContext.listenerFail&quot;));
                ok = false;
            }
        }

        // Check constraints for uncovered HTTP methods
        // Needs to be after SCIs and listeners as they may programmatically
        // change constraints
        if (ok) {
            checkConstraintsForUncoveredMethods(findConstraints());
        }

        try {
            // Start manager
            Manager manager = getManager();
            if (manager instanceof Lifecycle) {
                ((Lifecycle) manager).start();
            }
        } catch(Exception e) {
            log.error(sm.getString(&quot;standardContext.managerFail&quot;), e);
            ok = false;
        }

        // Configure and call application filters
        if (ok) {
            if (!filterStart()) {
                log.error(sm.getString(&quot;standardContext.filterFail&quot;));
                ok = false;
            }
        }

        // Load and initialize all &quot;load on startup&quot; servlets
        if (ok) {
            if (!loadOnStartup(findChildren())){
                log.error(sm.getString(&quot;standardContext.servletFail&quot;));
                ok = false;
            }
        }

        // Start ContainerBackgroundProcessor thread
        super.threadStart();
    } finally {
        // Unbinding thread
        unbindThread(oldCCL);
    }

    // Set available status depending upon startup success
    if (ok) {
        if (log.isDebugEnabled())
            log.debug(&quot;Starting completed&quot;);
    } else {
        log.error(sm.getString(&quot;standardContext.startFailed&quot;, getName()));
    }

    startTime=System.currentTimeMillis();

    // Send j2ee.state.running notification
    if (ok &amp;&amp; (this.getObjectName() != null)) {
        Notification notification =
            new Notification(&quot;j2ee.state.running&quot;, this.getObjectName(),
                             sequenceNumber.getAndIncrement());
        broadcaster.sendNotification(notification);
    }

    // The WebResources implementation caches references to JAR files. On
    // some platforms these references may lock the JAR files. Since web
    // application start is likely to have read from lots of JARs, trigger
    // a clean-up now.
    getResources().gc();

    // Reinitializing if something went wrong
    if (!ok) {
        setState(LifecycleState.FAILED);
    } else {
        setState(LifecycleState.STARTING);
    }
}
</code></pre><pre><code>- 3.1.1.1.1.1.1.1.1) StandardWrapper#start
</code></pre><ul>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>  // Send j2ee.state.starting notification
  if (this.getObjectName() != null) {</p>
<pre><code>  Notification notification = new Notification(&quot;j2ee.state.starting&quot;,
                                              this.getObjectName(),
                                              sequenceNumber++);
  broadcaster.sendNotification(notification);
</code></pre><p>  }</p>
<p>  // Start up this component
  super.startInternal();</p>
<p>  setAvailable(0L);</p>
<p>  // Send j2ee.state.running notification
  if (this.getObjectName() != null) {</p>
<pre><code>  Notification notification =
      new Notification(&quot;j2ee.state.running&quot;, this.getObjectName(),
                      sequenceNumber++);
  broadcaster.sendNotification(notification);
</code></pre><p>  }</p>
</li>
</ul>
<p>}</p>
<pre><code>- 3.1.1.1.1.1.1.1.2) WebappLoader#constructor
</code></pre><ul>
<li>if (getLoader() == null) {<pre><code>  WebappLoader webappLoader = new WebappLoader(getParentClassLoader());
  webappLoader.setDelegate(getDelegate());
  setLoader(webappLoader);
</code></pre>  }</li>
</ul>
<pre><code>/**
 * Construct a new WebappLoader with the specified class loader
 * to be defined as the parent of the ClassLoader we ultimately create.
 *
 * @param parent The parent class loader
 */
public WebappLoader(ClassLoader parent) {
    super();
    this.parentClassLoader = parent;
}
</code></pre><pre><code>@Override
public void setLoader(Loader loader) {

    Lock writeLock = loaderLock.writeLock();
    writeLock.lock();
    Loader oldLoader = null;
    try {
        // Change components if necessary
        oldLoader = this.loader;
        if (oldLoader == loader)
            return;
        this.loader = loader;

        // Stop the old component if necessary
        if (getState().isAvailable() &amp;&amp; (oldLoader != null) &amp;&amp;
            (oldLoader instanceof Lifecycle)) {
            try {
                ((Lifecycle) oldLoader).stop();
            } catch (LifecycleException e) {
                log.error(&quot;StandardContext.setLoader: stop: &quot;, e);
            }
        }

        // Start the new component if necessary
        if (loader != null)
            loader.setContext(this);
        if (getState().isAvailable() &amp;&amp; (loader != null) &amp;&amp;
            (loader instanceof Lifecycle)) {
            try {
                ((Lifecycle) loader).start();
            } catch (LifecycleException e) {
                log.error(&quot;StandardContext.setLoader: start: &quot;, e);
            }
        }
    } finally {
        writeLock.unlock();
    }

    // Report this property change to interested listeners
    support.firePropertyChange(&quot;loader&quot;, oldLoader, loader);
}
</code></pre><pre><code>- 3.1.1.1.1.1.1.1.3) WebappLoader#start
</code></pre><ul>
<li><p>protected void startInternal() throws LifecycleException {</p>
<p>  if (log.isDebugEnabled())</p>
<pre><code>  log.debug(sm.getString(&quot;webappLoader.starting&quot;));
</code></pre><p>  if (context.getResources() == null) {</p>
<pre><code>  log.info(&quot;No resources for &quot; + context);
  setState(LifecycleState.STARTING);
  return;
</code></pre><p>  }</p>
<p>  // Construct a class loader based on our current repositories list
  try {</p>
<pre><code>  classLoader = createClassLoader();
  classLoader.setResources(context.getResources());
  classLoader.setDelegate(this.delegate);

  // Configure our repositories
  setClassPath();

  setPermissions();

  classLoader.start();

  String contextName = context.getName();
  if (!contextName.startsWith(&quot;/&quot;)) {
      contextName = &quot;/&quot; + contextName;
  }
  ObjectName cloname = new ObjectName(context.getDomain() + &quot;:type=&quot; +
          classLoader.getClass().getSimpleName() + &quot;,host=&quot; +
          context.getParent().getName() + &quot;,context=&quot; + contextName);
  Registry.getRegistry(null, null)
      .registerComponent(classLoader, cloname, null);
</code></pre><p>  } catch (Throwable t) {</p>
<pre><code>  t = ExceptionUtils.unwrapInvocationTargetException(t);
  ExceptionUtils.handleThrowable(t);
  log.error( &quot;LifecycleException &quot;, t );
  throw new LifecycleException(&quot;start: &quot;, t);
</code></pre><p>  }</p>
<p>  setState(LifecycleState.STARTING);
}</p>
<ul>
<li>3.1.1.1.1.1.1.1.3.1) WebappLoader#createClassLoader</li>
</ul>
</li>
</ul>
<pre><code>private WebappClassLoaderBase createClassLoader()
    throws Exception {

    Class&lt;?&gt; clazz = Class.forName(loaderClass);
    WebappClassLoaderBase classLoader = null;
    // parentClassLoader&#x5B9E;&#x9645;&#x5C31;&#x662F;sharedLoader&#xFF0C;&#x5373;org.apache.catalina.loader.StandardClassLoader
    if (parentClassLoader == null) {
        parentClassLoader = context.getParentClassLoader();
    }
    Class&lt;?&gt;[] argTypes = { ClassLoader.class };
    Object[] args = { parentClassLoader };
    Constructor&lt;?&gt; constr = clazz.getConstructor(argTypes);
    classLoader = (WebappClassLoaderBase) constr.newInstance(args);

    return classLoader;
}
</code></pre><pre><code>- 3.1.1.1.1.1.2) StandardPipeline#start
</code></pre><ul>
<li><p>protected synchronized void startInternal() throws LifecycleException {</p>
<p>  // Start the Valves in our pipeline (including the basic), if any
  Valve current = first;
  if (current == null) {</p>
<pre><code>  current = basic;
</code></pre><p>  }
  while (current != null) {</p>
<pre><code>  if (current instanceof Lifecycle)
      ((Lifecycle) current).start();
  current = current.getNext();
</code></pre><p>  }</p>
<p>  setState(LifecycleState.STARTING);
}</p>
<ul>
<li>3.1.1.1.1.1.2) ContainerBase#threadStart&#xFF08;&#x542F;&#x52A8;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#xFF0C;&#x68C0;&#x67E5;session&#x8FC7;&#x671F;)</li>
</ul>
</li>
</ul>
<pre><code>/**
 * Start the background thread that will periodically check for
 * session timeouts.
 */
protected void threadStart() {

    if (thread != null)
        return;
    if (backgroundProcessorDelay &lt;= 0)
        return;

    threadDone = false;
    String threadName = &quot;ContainerBackgroundProcessor[&quot; + toString() + &quot;]&quot;;
    thread = new Thread(new ContainerBackgroundProcessor(), threadName);
    thread.setDaemon(true);
    thread.start();

}
</code></pre><pre><code>- 3.1.1.1.2) Connector#start
</code></pre><ul>
<li><p>protected void startInternal() throws LifecycleException {</p>
<p>  // Validate settings before starting
  if (getPort() &lt; 0) {</p>
<pre><code>  throw new LifecycleException(sm.getString(
          &quot;coyoteConnector.invalidPort&quot;, Integer.valueOf(getPort())));
</code></pre><p>  }</p>
<p>  setState(LifecycleState.STARTING);</p>
<p>  try {</p>
<pre><code>  protocolHandler.start();
</code></pre><p>  } catch (Exception e) {</p>
<pre><code>  throw new LifecycleException(
          sm.getString(&quot;coyoteConnector.protocolHandlerStartFailed&quot;), e);
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1.1.2.1) AbstractProtocol#start</li>
</ul>
</li>
</ul>
<pre><code>public void start() throws Exception {
    if (getLog().isInfoEnabled()) {
        getLog().info(sm.getString(&quot;abstractProtocolHandler.start&quot;, getName()));
    }

    endpoint.start();

    // Start async timeout thread
    asyncTimeout = new AsyncTimeout();
    Thread timeoutThread = new Thread(asyncTimeout, getNameInternal() + &quot;-AsyncTimeout&quot;);
    int priority = endpoint.getThreadPriority();
    if (priority &lt; Thread.MIN_PRIORITY || priority &gt; Thread.MAX_PRIORITY) {
        priority = Thread.NORM_PRIORITY;
    }
    timeoutThread.setPriority(priority);
    timeoutThread.setDaemon(true);
    timeoutThread.start();
}
</code></pre><pre><code>- 3.1.1.1.2.1.1) NioEndpoint#start
</code></pre><pre><code>public void startInternal() throws Exception {

    if (!running) {
        running = true;
        paused = false;

        processorCache = new SynchronizedStack&lt;&gt;(SynchronizedStack.DEFAULT_SIZE,
                socketProperties.getProcessorCache());
        eventCache = new SynchronizedStack&lt;&gt;(SynchronizedStack.DEFAULT_SIZE,
                        socketProperties.getEventCache());
        nioChannels = new SynchronizedStack&lt;&gt;(SynchronizedStack.DEFAULT_SIZE,
                socketProperties.getBufferPool());

        // Create worker collection
        if ( getExecutor() == null ) {
            createExecutor();
        }

        initializeConnectionLatch();

        // Start poller threads
        pollers = new Poller[getPollerThreadCount()];
        for (int i=0; i&lt;pollers.length; i++) {
            pollers[i] = new Poller();
            Thread pollerThread = new Thread(pollers[i], getName() + &quot;-ClientPoller-&quot;+i);
            pollerThread.setPriority(threadPriority);
            pollerThread.setDaemon(true);
            pollerThread.start();
        }

        startAcceptorThreads();
    }
}
</code></pre><pre><code>- 3.1.1.1.2.1.1.1) NioEndpoint#createExecutor&#xFF08;&#x521B;&#x5EFA;Worker&#x7EBF;&#x7A0B;&#x6C60;)
</code></pre><ul>
<li>&#x7528;&#x4E8E;&#x521B;&#x5EFA; Worker &#x7EBF;&#x7A0B;&#x6C60;&#x3002;&#x9ED8;&#x8BA4;&#x4F1A;&#x542F;&#x52A8; 10 &#x4E2A; Worker &#x7EBF;&#x7A0B;&#xFF0C;Tomcat &#x5904;&#x7406;&#x8BF7;&#x6C42;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;Woker &#x6700;&#x591A;&#x4E0D;&#x8D85;&#x8FC7; 200 &#x4E2A;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E; conf/server.xml &#x4E2D; Connector &#x7684; minSpareThreads &#x548C; maxThreads &#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#x3002;</li>
</ul>
<pre><code>public void createExecutor() {
    internalExecutor = true;
    TaskQueue taskqueue = new TaskQueue();
    TaskThreadFactory tf = new TaskThreadFactory(getName() + &quot;-exec-&quot;, daemon, getThreadPriority());
    executor = new ThreadPoolExecutor(getMinSpareThreads(), getMaxThreads(), 60, TimeUnit.SECONDS,taskqueue, tf);
    taskqueue.setParent( (ThreadPoolExecutor) executor);
}
</code></pre><pre><code>- 3.1.1.1.2.1.1.1.1) ThreadPoolExecutor#constructor&#xFF08;&#x542F;&#x52A8;Worker)
</code></pre><pre><code>public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory) {
    super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, new RejectHandler());
    prestartAllCoreThreads();
}
</code></pre><pre><code>public int prestartAllCoreThreads() {
    int n = 0;
    while (addWorker(null, true))
        ++n;
    return n;
}
</code></pre><pre><code>private boolean addWorker(Runnable firstTask, boolean core) {
    retry:
    for (;;) {
        int c = ctl.get();
        int rs = runStateOf(c);

        // Check if queue empty only if necessary.
        if (rs &gt;= SHUTDOWN &amp;&amp;
            ! (rs == SHUTDOWN &amp;&amp;
               firstTask == null &amp;&amp;
               ! workQueue.isEmpty()))
            return false;

        for (;;) {
            int wc = workerCountOf(c);
            if (wc &gt;= CAPACITY ||
                wc &gt;= (core ? corePoolSize : maximumPoolSize))
                return false;
            if (compareAndIncrementWorkerCount(c))
                break retry;
            c = ctl.get();  // Re-read ctl
            if (runStateOf(c) != rs)
                continue retry;
            // else CAS failed due to workerCount change; retry inner loop
        }
    }

    boolean workerStarted = false;
    boolean workerAdded = false;
    Worker w = null;
    try {
        w = new Worker(firstTask);
        final Thread t = w.thread;
        if (t != null) {
            final ReentrantLock mainLock = this.mainLock;
            mainLock.lock();
            try {
                // Recheck while holding lock.
                // Back out on ThreadFactory failure or if
                // shut down before lock acquired.
                int rs = runStateOf(ctl.get());

                if (rs &lt; SHUTDOWN ||
                    (rs == SHUTDOWN &amp;&amp; firstTask == null)) {
                    if (t.isAlive()) // precheck that t is startable
                        throw new IllegalThreadStateException();
                    workers.add(w);
                    int s = workers.size();
                    if (s &gt; largestPoolSize)
                        largestPoolSize = s;
                    workerAdded = true;
                }
            } finally {
                mainLock.unlock();
            }
            if (workerAdded) {
                t.start();
                workerStarted = true;
            }
        }
    } finally {
        if (! workerStarted)
            addWorkerFailed(w);
    }
    return workerStarted;
}
</code></pre><ul>
<li><p>&#x6BCF;&#x4E2A;Worker&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x662F;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<ul>
<li>3.1.1.1.1.1.1.2) Poller(Runnable)#run&#xFF08;&#x542F;&#x52A8;Poller)</li>
</ul>
</li>
<li>&#x4EE5;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x3002;</li>
<li>&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x5DF2;&#x5C31;&#x7EEA;&#x7684; Socket&#x3002; &#x9ED8;&#x8BA4;&#x6700;&#x591A;&#x4E0D;&#x8D85;&#x8FC7; 2 &#x4E2A;&#xFF0C;</li>
<li>Math.min(2,Runtime.getRuntime().availableProcessors());&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E; pollerThreadCount &#x6765;&#x5B9A;&#x5236;&#x3002;<ul>
<li>3.1.1.1.1.1.1.3) NioEndpoint#startAcceptorThreads&#xFF08;&#x542F;&#x52A8;Acceptors)</li>
</ul>
</li>
<li>Acceptors&#x4EE5;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;</li>
<li>&#x7528;&#x4E8E;&#x63A5;&#x53D7;&#x65B0;&#x8FDE;&#x63A5;&#x3002;&#x9ED8;&#x8BA4;&#x662F; 1 &#x4E2A;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E; acceptorThreadCount &#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#x3002;</li>
<li><p>protected final void startAcceptorThreads() {
  int count = getAcceptorThreadCount();
  acceptors = new ArrayList&lt;&gt;(count);</p>
<p>  for (int i = 0; i &lt; count; i++) {</p>
<pre><code>  Acceptor&lt;U&gt; acceptor = new Acceptor&lt;&gt;(this);
  String threadName = getName() + &quot;-Acceptor-&quot; + i;
  acceptor.setThreadName(threadName);
  acceptors.add(acceptor);
  Thread t = new Thread(acceptor, threadName);
  t.setPriority(getAcceptorThreadPriority());
  t.setDaemon(getDaemon());
  t.start();
</code></pre><p>  }
}</p>
<ul>
<li>3.1.2) StandardServer#await</li>
</ul>
</li>
</ul>
<pre><code>public void await() {
    // Negative values - don&apos;t wait on port - tomcat is embedded or we just don&apos;t like ports
    if( port == -2 ) {
        // undocumented yet - for embedding apps that are around, alive.
        return;
    }
    if( port==-1 ) {
        try {
            awaitThread = Thread.currentThread();
            while(!stopAwait) {
                try {
                    Thread.sleep( 10000 );
                } catch( InterruptedException ex ) {
                    // continue and check the flag
                }
            }
        } finally {
            awaitThread = null;
        }
        return;
    }

    // Set up a server socket to wait on
    try {
        awaitSocket = new ServerSocket(port, 1,
                InetAddress.getByName(address));
    } catch (IOException e) {
        log.error(&quot;StandardServer.await: create[&quot; + address
                           + &quot;:&quot; + port
                           + &quot;]: &quot;, e);
        return;
    }

    try {
        awaitThread = Thread.currentThread();

        // Loop waiting for a connection and a valid command
        while (!stopAwait) {
            ServerSocket serverSocket = awaitSocket;
            if (serverSocket == null) {
                break;
            }

            // Wait for the next connection
            Socket socket = null;
            StringBuilder command = new StringBuilder();
            try {
                InputStream stream;
                long acceptStartTime = System.currentTimeMillis();
                try {
                    socket = serverSocket.accept();
                    socket.setSoTimeout(10 * 1000);  // Ten seconds
                    stream = socket.getInputStream();
                } catch (SocketTimeoutException ste) {
                    // This should never happen but bug 56684 suggests that
                    // it does.
                    log.warn(sm.getString(&quot;standardServer.accept.timeout&quot;,
                            Long.valueOf(System.currentTimeMillis() - acceptStartTime)), ste);
                    continue;
                } catch (AccessControlException ace) {
                    log.warn(&quot;StandardServer.accept security exception: &quot;
                            + ace.getMessage(), ace);
                    continue;
                } catch (IOException e) {
                    if (stopAwait) {
                        // Wait was aborted with socket.close()
                        break;
                    }
                    log.error(&quot;StandardServer.await: accept: &quot;, e);
                    break;
                }

                // Read a set of characters from the socket
                int expected = 1024; // Cut off to avoid DoS attack
                while (expected &lt; shutdown.length()) {
                    if (random == null)
                        random = new Random();
                    expected += (random.nextInt() % 1024);
                }
                while (expected &gt; 0) {
                    int ch = -1;
                    try {
                        ch = stream.read();
                    } catch (IOException e) {
                        log.warn(&quot;StandardServer.await: read: &quot;, e);
                        ch = -1;
                    }
                    // Control character or EOF (-1) terminates loop
                    if (ch &lt; 32 || ch == 127) {
                        break;
                    }
                    command.append((char) ch);
                    expected--;
                }
            } finally {
                // Close the socket now that we are done with it
                try {
                    if (socket != null) {
                        socket.close();
                    }
                } catch (IOException e) {
                    // Ignore
                }
            }

            // Match against our command string
            boolean match = command.toString().equals(shutdown);
            if (match) {
                log.info(sm.getString(&quot;standardServer.shutdownViaPort&quot;));
                break;
            } else
                log.warn(&quot;StandardServer.await: Invalid command &apos;&quot;
                        + command.toString() + &quot;&apos; received&quot;);
        }
    } finally {
        ServerSocket serverSocket = awaitSocket;
        awaitThread = null;
        awaitSocket = null;

        // Close the server socket and return
        if (serverSocket != null) {
            try {
                serverSocket.close();
            } catch (IOException e) {
                // Ignore
            }
        }
    }
}
</code></pre><h1 id="&#x505C;&#x6B62;"><a name="&#x505C;&#x6B62;" class="plugin-anchor" href="#&#x505C;&#x6B62;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x505C;&#x6B62;</h1>
<ul>
<li>catalinaDaemon&#x8C03;&#x7528;await&#x7B49;&#x5F85;&#x505C;&#x6B62;&#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x662F;&#x901A;&#x8FC7;&#x6267;&#x884C;tomcat/bin/shutdown.sh&#x6765;&#x5173;&#x95ED;Tomcat&#xFF0C;&#x7B49;&#x4EF7;&#x4E8E;&#x6267;&#x884C;org.apache.catalina.startup.Bootstra&#x7C7B;&#x7684;main&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4F20;&#x5165;stop&#x53C2;&#x6570;&#x3002;</li>
<li><p>&#x903B;&#x8F91;&#xFF1A;
1.- &#x65B0;&#x5EFA;Bootstrap&#x5BF9;&#x8C61;daemon&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x5176;init()&#x65B9;&#x6CD5; 
2.- &#x521D;&#x59CB;&#x5316;Tomcat&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;
3.- &#x7528;&#x53CD;&#x5C04;&#x5B9E;&#x4F8B;&#x5316;org.apache.catalina.startup.Catalina&#x5BF9;&#x8C61;catalinaDaemon
4.- &#x8C03;&#x7528;daemon&#x7684;stopServer&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x8D28;&#x4E0A;&#x8C03;&#x7528;&#x4E86;catalinaDaemon&#x7684;stopServer&#x65B9;&#x6CD5; 
5.- &#x89E3;&#x6790;server.xml&#x6587;&#x4EF6;&#xFF0C;&#x6784;&#x9020;&#x51FA;Server&#x5BB9;&#x5668;
6.- &#x83B7;&#x53D6;Server&#x7684;socket&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x548C;&#x5730;&#x5740;&#xFF0C;&#x521B;&#x5EFA;Socket&#x5BF9;&#x8C61;&#x8FDE;&#x63A5;&#x542F;&#x52A8;Tomcat&#x65F6;&#x521B;&#x5EFA;&#x7684;ServerSocket&#xFF0C;&#x6700;&#x540E;&#x5411;ServerSocket&#x53D1;&#x9001;SHUTDOWN&#x547D;&#x4EE4;
7.- &#x8FD0;&#x884C;&#x4E2D;&#x7684;Server&#x8C03;&#x7528;stop&#x65B9;&#x6CD5;&#x505C;&#x6B62;</p>
</li>
<li><p>BootStrap#stopServer</p>
</li>
</ul>
<pre><code>public void stopServer(String[] arguments)
    throws Exception {

    Object param[];
    Class&lt;?&gt; paramTypes[];
    if (arguments==null || arguments.length==0) {
        paramTypes = null;
        param = null;
    } else {
        paramTypes = new Class[1];
        paramTypes[0] = arguments.getClass();
        param = new Object[1];
        param[0] = arguments;
    }
    Method method =
        catalinaDaemon.getClass().getMethod(&quot;stopServer&quot;, paramTypes);
    method.invoke(catalinaDaemon, param);

}
</code></pre><pre><code>- 1) Catalina#stopServer
</code></pre><pre><code>public void stopServer() {
    stopServer(null);
}
</code></pre><pre><code>public void stopServer(String[] arguments) {

    if (arguments != null) {
        arguments(arguments);
    }

    Server s = getServer();
    if (s == null) {
        // Create and execute our Digester
        Digester digester = createStopDigester();
        File file = configFile();
        try (FileInputStream fis = new FileInputStream(file)) {
            InputSource is =
                new InputSource(file.toURI().toURL().toString());
            is.setByteStream(fis);
            digester.push(this);
            digester.parse(is);
        } catch (Exception e) {
            log.error(&quot;Catalina.stop: &quot;, e);
            System.exit(1);
        }
    } else {
        // Server object already present. Must be running as a service
        try {
            s.stop();
        } catch (LifecycleException e) {
            log.error(&quot;Catalina.stop: &quot;, e);
        }
        return;
    }

    // Stop the existing server
    s = getServer();
    if (s.getPort()&gt;0) {
        try (Socket socket = new Socket(s.getAddress(), s.getPort());
                OutputStream stream = socket.getOutputStream()) {
            String shutdown = s.getShutdown();
            for (int i = 0; i &lt; shutdown.length(); i++) {
                stream.write(shutdown.charAt(i));
            }
            stream.flush();
        } catch (ConnectException ce) {
            log.error(sm.getString(&quot;catalina.stopServer.connectException&quot;,
                                   s.getAddress(),
                                   String.valueOf(s.getPort())));
            log.error(&quot;Catalina.stop: &quot;, ce);
            System.exit(1);
        } catch (IOException e) {
            log.error(&quot;Catalina.stop: &quot;, e);
            System.exit(1);
        }
    } else {
        log.error(sm.getString(&quot;catalina.stopServer&quot;));
        System.exit(1);
    }
}
</code></pre><ul>
<li><h1 id="&#x8BF7;&#x6C42;&#x5904;&#x7406;"><a name="&#x8BF7;&#x6C42;&#x5904;&#x7406;" class="plugin-anchor" href="#&#x8BF7;&#x6C42;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8BF7;&#x6C42;&#x5904;&#x7406;</h1>
<h1 id="connector"><a name="connector" class="plugin-anchor" href="#connector"><i class="fa fa-link" aria-hidden="true"></i></a>Connector</h1>
</li>
<li>&#x5728;Tomcat9&#x4E2D;&#xFF0C;Connector&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#x662F;HTTP&#x548C;AJP&#xFF0C;&#x534F;&#x8BAE;&#x5904;&#x7406;&#x7C7B;&#x5206;&#x522B;&#x5BF9;&#x5E94;org.apache.coyote.http11.Http11NioProtocol&#x548C;</li>
<li>org.apache.coyote.http11.Http11AprProtocol&#xFF08;&#x5DF2;&#x7ECF;&#x53D6;&#x6D88;BIO&#x6A21;&#x5F0F;)&#x3002;</li>
<li>Connector&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4E09;&#x4E2A;&#x6A21;&#x5757;&#xFF1A;Http11NioProtocol, Mapper, CoyoteAdapter&#xFF0C;http&#x8BF7;&#x6C42;&#x5728;Connector&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<p>1.- Acceptor&#x4E3A;&#x76D1;&#x542C;&#x7EBF;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;serverSocketAccept()&#x963B;&#x585E;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x8C03;&#x7528;ServerSocketChannel.accept()
2.- Acceptor&#x5C06;&#x63A5;&#x6536;&#x5230;&#x7684;Socket&#x6DFB;&#x52A0;&#x5230;Poller&#x6C60;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;Poller
3.- Poller&#x901A;&#x8FC7;worker&#x7EBF;&#x7A0B;&#x628A;socket&#x5305;&#x88C5;&#x6210;SocketProcessor
4.- SocketProcessor&#x8C03;&#x7528;getHandler()&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;ConnectionHandler
5.- ConnectionHandler&#x628A;socket&#x4EA4;&#x7531;Http11Processor&#x5904;&#x7406;&#xFF0C;&#x89E3;&#x6790;http&#x7684;Header&#x548C;Body
6.- Http11Processor&#x8C03;&#x7528;service()&#x628A;&#x5305;&#x88C5;&#x597D;&#x7684;request&#x548C;response&#x4F20;&#x7ED9;CoyoteAdapter
7.- CoyoteAdapter&#x4F1A;&#x901A;&#x8FC7;Mapper&#x628A;&#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;session&#x3001;servlet&#x7B49;&#x5173;&#x8054;&#x597D;&#xFF0C;&#x51C6;&#x5907;&#x4F20;&#x7ED9;Container</p>
<h1 id="container"><a name="container" class="plugin-anchor" href="#container"><i class="fa fa-link" aria-hidden="true"></i></a>Container</h1>
<ul>
<li>&#x6709;4&#x4E2A;Container&#xFF0C;&#x91C7;&#x7528;&#x4E86;&#x8D23;&#x4EFB;&#x94FE;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;</li>
<li>Pipeline&#x5C31;&#x50CF;&#x662F;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x903B;&#x8F91;&#x603B;&#x7EBF;&#xFF0C;&#x5728;Pipeline&#x4E0A;&#x6309;&#x7167;&#x914D;&#x7F6E;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x52A0;&#x8F7D;&#x5404;&#x4E2A;Valve&#x3002;&#x901A;&#x8FC7;Pipeline&#x5B8C;&#x6210;&#x5404;&#x4E2A;Valve&#x4E4B;&#x95F4;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5404;&#x4E2A;Valve&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x5E94;&#x7528;&#x903B;&#x8F91;&#x3002;</li>
<li>&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x5728;pipeline&#x4E0A;&#x6D41;&#x52A8;&#xFF0C;&#x7ECF;&#x8FC7;&#x6BCF;&#x4E2A;Container&#xFF08;&#x5BF9;&#x5E94;&#x7740;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;Valve&#x9600;&#x95E8;)&#xFF0C;&#x5404;&#x4E2A;Container&#x6309;&#x987A;&#x5E8F;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x6700;&#x7EC8;&#x5728;Wrapper&#x7ED3;&#x675F;&#x3002;</li>
<li></li>
<li><p>Connector&#x4E2D;&#x7684;CoyoteAdapter&#x4F1A;&#x8C03;&#x7528;invoke()&#x628A;request&#x548C;response&#x4F20;&#x7ED9;Container&#xFF0C;Container&#x4E2D;&#x4F9D;&#x6B21;&#x8C03;&#x7528;&#x5404;&#x4E2A;Valve&#xFF0C;&#x6BCF;&#x4E2A;Valve&#x7684;&#x4F5C;&#x7528;&#x5982;&#x4E0B;&#xFF1A;
1.- StandardEngineValve&#xFF1A;StandardEngine&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x4ECE;request&#x4E2D;&#x9009;&#x62E9;&#x5176;host&#x6620;&#x5C04;&#x7684;Host&#x5BB9;&#x5668;StandardHost
2.- AccessLogValve&#xFF1A;StandardHost&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x7BA1;&#x9053;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;
3.- ErrorReportValve&#xFF1A;StandardHost&#x4E2D;&#x7D27;&#x8DDF;AccessLogValve&#x7684;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x7BA1;&#x9053;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x4ECE;request&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x53D6;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5C01;&#x88C5;&#x5230;response&#x4E2D;&#x4EE5;&#x4FBF;&#x5C06;&#x95EE;&#x9898;&#x5C55;&#x73B0;&#x7ED9;&#x8BBF;&#x95EE;&#x8005;
4.- StandardHostValve&#xFF1A; StandardHost&#x4E2D;&#x6700;&#x540E;&#x7684;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x4ECE;request&#x4E2D;&#x9009;&#x62E9;&#x5176;context&#x6620;&#x5C04;&#x7684;Context&#x5BB9;&#x5668;StandardContext&#x4EE5;&#x53CA;&#x8BBF;&#x95EE;request&#x4E2D;&#x7684;Session&#x4EE5;&#x66F4;&#x65B0;&#x4F1A;&#x8BDD;&#x7684;&#x6700;&#x540E;&#x8BBF;&#x95EE;&#x65F6;&#x95F4;
5.- StandardContextValve&#xFF1A;StandardContext&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x7981;&#x6B62;&#x4EFB;&#x4F55;&#x5BF9;WEB-INF&#x6216;META-INF&#x76EE;&#x5F55;&#x4E0B;&#x8D44;&#x6E90;&#x7684;&#x91CD;&#x5B9A;&#x5411;&#x8BBF;&#x95EE;&#xFF0C;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x70ED;&#x90E8;&#x7F72;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4ECE;request&#x4E2D;&#x83B7;&#x5F97;StandardWrapper
6.- StandardWrapperValve&#xFF1A;StandardWrapper&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x9600;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5305;&#x62EC;&#x8C03;&#x7528;StandardWrapper&#x7684;loadServlet&#x65B9;&#x6CD5;&#x751F;&#x6210;Servlet&#x5B9E;&#x4F8B;&#x548C;&#x8C03;&#x7528;ApplicationFilterFactory&#x751F;&#x6210;Filter&#x94FE;</p>
</li>
<li><p>&#x6700;&#x7EC8;&#x5C06;Response&#x8FD4;&#x56DE;&#x7ED9;Connector&#x5B8C;&#x6210;&#x4E00;&#x6B21;http&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
</li>
<li></li>
</ul>
<h1 id="nioendpoint&#x804C;&#x8D23;"><a name="nioendpoint&#x804C;&#x8D23;" class="plugin-anchor" href="#nioendpoint&#x804C;&#x8D23;"><i class="fa fa-link" aria-hidden="true"></i></a>NioEndPoint&#x804C;&#x8D23;</h1>
<ul>
<li><p>&#x5728;Tomcat&#x4E2D;Endpoint&#x4E3B;&#x8981;&#x7528;&#x6765;&#x63A5;&#x6536;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x5904;&#x7406;&#x5219;&#x7531;ConnectionHandler&#x6765;&#x6267;&#x884C;&#x3002;</p>
</li>
<li><p>&#x5305;&#x542B;&#x4E86;&#x4E09;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF1A;</p>
</li>
<li>Acceptor&#xFF1A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#xFF0C;&#x8D1F;&#x8D23;&#x76D1;&#x542C;&#x8BF7;&#x6C42;&#xFF0C;&#x5C06;&#x63A5;&#x6536;&#x5230;&#x7684;Socket&#x8BF7;&#x6C42;&#x653E;&#x5230;Poller&#x961F;&#x5217;&#x4E2D;</li>
<li>Poller&#xFF1A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#xFF0C;&#x5F53;Socket&#x5C31;&#x7EEA;&#x65F6;&#xFF0C;&#x5C06;Poller&#x961F;&#x5217;&#x4E2D;&#x7684;Socket&#x4EA4;&#x7ED9;Worker&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;</li>
<li><p>SocketProcessor&#xFF08;Worker)&#xFF1A;&#x5904;&#x7406;socket&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x59D4;&#x6258;ConnectionHandler&#x5904;&#x7406;</p>
</li>
<li><p>Connector &#x542F;&#x52A8;&#x4EE5;&#x540E;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x7EC4;&#x7EBF;&#x7A0B;&#x7528;&#x4E8E;&#x4E0D;&#x540C;&#x9636;&#x6BB5;&#x7684;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x3002;</p>
</li>
<li>Acceptor &#x7EBF;&#x7A0B;&#x7EC4;&#x3002;&#x7528;&#x4E8E;&#x63A5;&#x53D7;&#x65B0;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x5C06;&#x65B0;&#x8FDE;&#x63A5;&#x5C01;&#x88C5;&#x4E00;&#x4E0B;&#xFF0C;&#x9009;&#x62E9;&#x4E00;&#x4E2A; Poller &#x5C06;&#x65B0;&#x8FDE;&#x63A5;&#x6DFB;&#x52A0;&#x5230; Poller &#x7684;&#x4E8B;&#x4EF6;&#x961F;&#x5217;&#x4E2D;&#x3002;</li>
<li>Poller &#x7EBF;&#x7A0B;&#x7EC4;&#x3002;&#x7528;&#x4E8E;&#x76D1;&#x542C; Socket &#x4E8B;&#x4EF6;&#xFF0C;&#x5F53; Socket &#x53EF;&#x8BFB;&#x6216;&#x53EF;&#x5199;&#x7B49;&#x7B49;&#x65F6;&#xFF0C;&#x5C06; Socket &#x5C01;&#x88C5;&#x4E00;&#x4E0B;&#x6DFB;&#x52A0;&#x5230; worker &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x3002;</li>
<li><p>worker &#x7EBF;&#x7A0B;&#x7EC4;&#x3002;&#x7528;&#x4E8E;&#x5BF9;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5305;&#x62EC;&#x5206;&#x6790;&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x5E76;&#x521B;&#x5EFA; Request &#x5BF9;&#x8C61;&#xFF0C;&#x8C03;&#x7528;&#x5BB9;&#x5668;&#x7684; pipeline &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
</li>
<li><p>Acceptor&#x3001;Poller&#x3001;worker &#x6240;&#x5728;&#x7684; ThreadPoolExecutor &#x90FD;&#x7EF4;&#x62A4;&#x5728; NioEndpoint &#x4E2D;&#x3002;</p>
</li>
<li><p>&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x7C7B;&#x4F3C;&#x4E8E;Reactor&#x7684;&#x4E3B;&#x4ECE;&#x591A;&#x7EBF;&#x7A0B;&#x65B9;&#x5F0F;&#x3002;</p>
</li>
<li><ul>
<li>1) Acceptor#run&#xFF08;BIO,&#x963B;&#x585E;&#x63A5;&#x6536;Socket&#x8FDE;&#x63A5;,mainReactor)</li>
</ul>
</li>
</ul>
<p>1.- Acceptor &#x5728;&#x542F;&#x52A8;&#x540E;&#x4F1A;&#x963B;&#x585E;&#x5728; ServerSocketChannel.accept(); &#x65B9;&#x6CD5;&#x5904;&#xFF0C;&#x5F53;&#x6709;&#x65B0;&#x8FDE;&#x63A5;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; SocketChannel&#x3002;</p>
<ol>
<li><ul>
<li>&#x914D;&#x7F6E;&#x5B8C; Socket &#x4EE5;&#x540E;&#x5C06; Socket &#x5C01;&#x88C5;&#x5230; NioChannel &#x4E2D;&#xFF0C;&#x5E76;&#x6CE8;&#x518C;&#x5230; Poller,&#x503C;&#x7684;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x542F;&#x52A8;&#x4E86;&#x591A;&#x4E2A; Poller &#x7EBF;&#x7A0B;&#xFF0C;&#x6CE8;&#x518C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDE;&#x63A5;&#x662F;&#x516C;&#x5E73;&#x7684;&#x5206;&#x914D;&#x5230;&#x6BCF;&#x4E2A; Poller &#x7684;&#x3002;NioEndpoint &#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A; Poller &#x6570;&#x7EC4;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5206;&#x914D;&#x7ED9; pollers[index] &#x65F6;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5C31;&#x4F1A;&#x5206;&#x914D;&#x7ED9; pollers[(index+1)%pollers.length].
3.- addEvent() &#x65B9;&#x6CD5;&#x4F1A;&#x5C06; Socket &#x6DFB;&#x52A0;&#x5230;&#x8BE5; Poller &#x7684; PollerEvent &#x961F;&#x5217;&#x4E2D;&#x3002;&#x5230;&#x6B64; Acceptor &#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</li>
</ul>
</li>
<li><p>&#x6301;&#x6709;Endpoint</p>
</li>
</ol>
<pre><code>private final AbstractEndpoint&lt;?,U&gt; endpoint;
</code></pre><ul>
<li>&#x5728;&#x542F;&#x52A8;&#x540E;&#x4F1A;&#x963B;&#x585E;&#x5728; ServerSocketChannel.accept(); &#x65B9;&#x6CD5;&#x5904;&#xFF0C;&#x5F53;&#x6709;&#x65B0;&#x8FDE;&#x63A5;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; SocketChannel&#x3002;</li>
</ul>
<pre><code>public void run() {

    int errorDelay = 0;

    // Loop until we receive a shutdown command
    while (endpoint.isRunning()) {

        // Loop if endpoint is paused
        while (endpoint.isPaused() &amp;&amp; endpoint.isRunning()) {
            state = AcceptorState.PAUSED;
            try {
                Thread.sleep(50);
            } catch (InterruptedException e) {
                // Ignore
            }
        }

        if (!endpoint.isRunning()) {
            break;
        }
        state = AcceptorState.RUNNING;

        try {
            //if we have reached max connections, wait
            endpoint.countUpOrAwaitConnection();

            // Endpoint might have been paused while waiting for latch
            // If that is the case, don&apos;t accept new connections
            if (endpoint.isPaused()) {
                continue;
            }

            U socket = null;
            try {
                // Accept the next incoming connection from the server
                // socket
                socket = endpoint.serverSocketAccept();
            } catch (Exception ioe) {
                // We didn&apos;t get a socket
                endpoint.countDownConnection();
                if (endpoint.isRunning()) {
                    // Introduce delay if necessary
                    errorDelay = handleExceptionWithDelay(errorDelay);
                    // re-throw
                    throw ioe;
                } else {
                    break;
                }
            }
            // Successful accept, reset the error delay
            errorDelay = 0;

            // Configure the socket
            if (endpoint.isRunning() &amp;&amp; !endpoint.isPaused()) {
                // setSocketOptions() will hand the socket off to
                // an appropriate processor if successful
                if (!endpoint.setSocketOptions(socket)) {
                    endpoint.closeSocket(socket);
                }
            } else {
                endpoint.destroySocket(socket);
            }
        } catch (Throwable t) {
            ExceptionUtils.handleThrowable(t);
            String msg = sm.getString(&quot;endpoint.accept.fail&quot;);
            // APR specific.
            // Could push this down but not sure it is worth the trouble.
            if (t instanceof Error) {
                Error e = (Error) t;
                if (e.getError() == 233) {
                    // Not an error on HP-UX so log as a warning
                    // so it can be filtered out on that platform
                    // See bug 50273
                    log.warn(msg, t);
                } else {
                    log.error(msg, t);
                }
            } else {
                    log.error(msg, t);
            }
        }
    }
    state = AcceptorState.ENDED;
}
</code></pre><pre><code>- 1.1) NioEndpoint#setSocketOptions&#xFF08;&#x5904;&#x7406;Socket)
- &#x914D;&#x7F6E;&#x5B8C; Socket &#x4EE5;&#x540E;&#x5C06; Socket &#x5C01;&#x88C5;&#x5230; NioChannel &#x4E2D;&#xFF0C;&#x5E76;&#x6CE8;&#x518C;&#x5230; Poller,&#x503C;&#x7684;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x542F;&#x52A8;&#x4E86;&#x591A;&#x4E2A; Poller &#x7EBF;&#x7A0B;&#xFF0C;&#x6CE8;&#x518C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDE;&#x63A5;&#x662F;&#x516C;&#x5E73;&#x7684;&#x5206;&#x914D;&#x5230;&#x6BCF;&#x4E2A; Poller &#x7684;&#x3002;NioEndpoint &#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A; Poller &#x6570;&#x7EC4;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5206;&#x914D;&#x7ED9; pollers[index] &#x65F6;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5C31;&#x4F1A;&#x5206;&#x914D;&#x7ED9; pollers[(index+1)%pollers.length].
</code></pre><ul>
<li><p>protected boolean setSocketOptions(SocketChannel socket) {
  // Process the connection
  try {</p>
<pre><code>  //disable blocking, APR style, we are gonna be polling it
  socket.configureBlocking(false);
  Socket sock = socket.socket();
  socketProperties.setProperties(sock);

  NioChannel channel = nioChannels.pop();
  if (channel == null) {
      SocketBufferHandler bufhandler = new SocketBufferHandler(
              socketProperties.getAppReadBufSize(),
              socketProperties.getAppWriteBufSize(),
              socketProperties.getDirectBuffer());
      if (isSSLEnabled()) {
          channel = new SecureNioChannel(socket, bufhandler, selectorPool, this);
      } else {
          channel = new NioChannel(socket, bufhandler);
      }
  } else {
      channel.setIOChannel(socket);
      channel.reset();
  }
  getPoller0().register(channel);
</code></pre><p>  } catch (Throwable t) {</p>
<pre><code>  ExceptionUtils.handleThrowable(t);
  try {
      log.error(&quot;&quot;,t);
  } catch (Throwable tt) {
      ExceptionUtils.handleThrowable(tt);
  }
  // Tell to close the socket
  return false;
</code></pre><p>  }
  return true;
}</p>
</li>
</ul>
<pre><code>public Poller getPoller0() {
    int idx = Math.abs(pollerRotater.incrementAndGet()) % pollers.length;
    return pollers[idx];
}
</code></pre><pre><code>- 1.1.1) Poller#register&#xFF08;&#x5C06;Socket&#x653E;&#x5165;Poller&#x961F;&#x5217;)
</code></pre><ul>
<li>addEvent() &#x65B9;&#x6CD5;&#x4F1A;&#x5C06; Socket &#x6DFB;&#x52A0;&#x5230;&#x8BE5; Poller &#x7684; PollerEvent &#x961F;&#x5217;&#x4E2D;&#x3002;&#x5230;&#x6B64; Acceptor &#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</li>
</ul>
<pre><code>public void register(final NioChannel socket) {
    socket.setPoller(this);
    NioSocketWrapper ka = new NioSocketWrapper(socket, NioEndpoint.this);
    socket.setSocketWrapper(ka);
    ka.setPoller(this);
    ka.setReadTimeout(getConnectionTimeout());
    ka.setWriteTimeout(getConnectionTimeout());
    ka.setKeepAliveLeft(NioEndpoint.this.getMaxKeepAliveRequests());
    ka.setSecure(isSSLEnabled());
    PollerEvent r = eventCache.pop();
    ka.interestOps(SelectionKey.OP_READ);//this is what OP_REGISTER turns into.
    if ( r==null) r = new PollerEvent(socket,ka,OP_REGISTER);
    else r.reset(socket,ka,OP_REGISTER);
    addEvent(r);
}
</code></pre><pre><code>- 1.1.1.1) NioSocketWrapper#constructor&#xFF08;&#x6301;&#x6709;NioEndpoint&#x7684;SelectorPool)
</code></pre><pre><code>public NioSocketWrapper(NioChannel channel, NioEndpoint endpoint) {
    super(channel, endpoint);
    pool = endpoint.getSelectorPool();
    socketBufferHandler = channel.getBufHandler();
}
</code></pre><pre><code>public SocketWrapperBase(E socket, AbstractEndpoint&lt;E&gt; endpoint) {
    this.socket = socket;
    this.endpoint = endpoint;
    ReentrantReadWriteLock lock = new ReentrantReadWriteLock();
    this.blockingStatusReadLock = lock.readLock();
    this.blockingStatusWriteLock = lock.writeLock();
}
</code></pre><pre><code>- 1.1.1.2) Poller#addEvent
</code></pre><pre><code>private void addEvent(PollerEvent event) {
    events.offer(event);
    if ( wakeupCounter.incrementAndGet() == 0 ) selector.wakeup();
}
</code></pre><pre><code>private final SynchronizedQueue&lt;PollerEvent&gt; events =
        new SynchronizedQueue&lt;&gt;();
</code></pre><ul>
<li><ul>
<li>2) Poller#run&#xFF08;NIO,&#x628A;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x5C31;&#x7EEA;&#x7684;Socket&#x5C01;&#x88C5;&#x4E3A;SocketProcessor&#x4EA4;&#x7ED9;Worker&#x7EBF;&#x7A0B;&#x6C60;,subReactor)</li>
</ul>
</li>
</ul>
<p>1.- selector.select(1000)&#x3002;&#x5F53; Poller &#x542F;&#x52A8;&#x540E;&#x56E0;&#x4E3A; selector &#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x5DF2;&#x6CE8;&#x518C;&#x7684; Channel&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x6267;&#x884C;&#x5230;&#x8BE5;&#x65B9;&#x6CD5;&#x65F6;&#x53EA;&#x80FD;&#x963B;&#x585E;&#x3002;&#x6240;&#x6709;&#x7684; Poller &#x5171;&#x7528;&#x4E00;&#x4E2A; Selector&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;&#x662F; sun.nio.ch.EPollSelectorImpl
2.- events() &#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x901A;&#x8FC7; addEvent() &#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;&#x4E8B;&#x4EF6;&#x961F;&#x5217;&#x4E2D;&#x7684; Socket &#x6CE8;&#x518C;&#x5230; EPollSelectorImpl&#xFF0C;&#x5F53; Socket &#x53EF;&#x8BFB;&#x65F6;&#xFF0C;Poller &#x624D;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5904;&#x7406;
3.- createSocketProcessor() &#x65B9;&#x6CD5;&#x5C06; Socket &#x5C01;&#x88C5;&#x5230; SocketProcessor &#x4E2D;&#xFF0C;SocketProcessor &#x5B9E;&#x73B0;&#x4E86; Runnable &#x63A5;&#x53E3;&#x3002;worker &#x7EBF;&#x7A0B;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5176; run() &#x65B9;&#x6CD5;&#x6765;&#x5BF9; Socket &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;
4.- execute(SocketProcessor) &#x65B9;&#x6CD5;&#x5C06; SocketProcessor &#x63D0;&#x4EA4;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x653E;&#x5165;&#x7EBF;&#x7A0B;&#x6C60;&#x7684; workQueue &#x4E2D;&#x3002;workQueue &#x662F; BlockingQueue &#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5230;&#x6B64; Poller &#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
<p>&#xF06C;- &#x8C03;&#x7528;selector&#x7684;select()&#x51FD;&#x6570;&#xFF0C;&#x76D1;&#x542C;&#x5C31;&#x7EEA;&#x4E8B;&#x4EF6;
&#xF06C;- &#x6839;&#x636E;&#x5411;selector&#x4E2D;&#x6CE8;&#x518C;&#x7684;key&#x904D;&#x5386;channel&#x4E2D;&#x5DF2;&#x7ECF;&#x5C31;&#x7EEA;&#x7684;keys&#xFF0C;&#x5E76;&#x5904;&#x7406;key
&#xF06C;- &#x5904;&#x7406;key&#x5BF9;&#x5E94;&#x7684;channel&#xFF0C;&#x8C03;&#x7528;NioEndPoint&#x7684;processSocket()
&#xF06C;- &#x4ECE;SocketProcessor&#x6C60;&#x4E2D;&#x53D6;&#x51FA;&#x7A7A;&#x95F2;&#x7684;SocketProcessor&#xFF0C;&#x5173;&#x8054;socketWrapper&#xFF0C;&#x63D0;&#x4EA4;&#x8FD0;&#x884C;SocketProcessor</p>
<pre><code>public Poller() throws IOException {
    this.selector = Selector.open();
}
</code></pre><ul>
<li>&#x5B83;&#x7684;selector&#x662F;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x5F00;&#x542F;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;Poller&#x5BF9;&#x5E94;&#x7740;&#x81EA;&#x5DF1;&#x7684;Selector&#xFF0C;&#x76D1;&#x542C;&#x8BE5;Poller&#x5BF9;&#x5E94;&#x7684;SocketChannel&#x7684;Read&#x4E8B;&#x4EF6;&#x3002;&#x5F53;Poller&#x961F;&#x5217;&#x4E2D;&#x52A0;&#x5165;&#x65B0;&#x7684;Socket&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;Socket&#x6CE8;&#x518C;&#x5728;selector&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;selector&#x5C31;&#x53EF;&#x4EE5;&#x76D1;&#x6D4B;socket&#x5C31;&#x7EEA;&#x4E8B;&#x4EF6;&#x4E86;&#x3002;</li>
</ul>
<pre><code>public void run() {
    // Loop until destroy() is called
    while (true) {

        boolean hasEvents = false;

        try {
            if (!close) {
                hasEvents = events();
                if (wakeupCounter.getAndSet(-1) &gt; 0) {
                    //if we are here, means we have other stuff to do
                    //do a non blocking select
                    keyCount = selector.selectNow();
                } else {
                    keyCount = selector.select(selectorTimeout);
                }
                wakeupCounter.set(0);
            }
            if (close) {
                events();
                timeout(0, false);
                try {
                    selector.close();
                } catch (IOException ioe) {
                    log.error(sm.getString(&quot;endpoint.nio.selectorCloseFail&quot;), ioe);
                }
                break;
            }
        } catch (Throwable x) {
            ExceptionUtils.handleThrowable(x);
            log.error(&quot;&quot;,x);
            continue;
        }
        //either we timed out or we woke up, process events first
        if ( keyCount == 0 ) hasEvents = (hasEvents | events());

        Iterator&lt;SelectionKey&gt; iterator =
            keyCount &gt; 0 ? selector.selectedKeys().iterator() : null;
        // Walk through the collection of ready keys and dispatch
        // any active event.
        while (iterator != null &amp;&amp; iterator.hasNext()) {
            SelectionKey sk = iterator.next();
            NioSocketWrapper attachment = (NioSocketWrapper)sk.attachment();
            // Attachment may be null if another thread has called
            // cancelledKey()
            if (attachment == null) {
                iterator.remove();
            } else {
                // &#x6709;Socket&#x51FA;&#x73B0;&#x8BFB;&#x4E8B;&#x4EF6;
                iterator.remove();
                processKey(sk, attachment);
            }
        }//while

        //process timeouts
        timeout(keyCount,hasEvents);
    }//while

    getStopLatch().countDown();
}
</code></pre><pre><code>- 2.1) Poller#events&#xFF08;&#x5C06;&#x961F;&#x5217;&#x4E2D;&#x7684;Socket&#x6CE8;&#x518C;&#x5230;Selector)
</code></pre><ul>
<li>events() &#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x901A;&#x8FC7; addEvent() &#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;&#x4E8B;&#x4EF6;&#x961F;&#x5217;&#x4E2D;&#x7684; Socket &#x6CE8;&#x518C;&#x5230; EPollSelectorImpl&#xFF0C;&#x5F53; Socket &#x53EF;&#x8BFB;&#x65F6;&#xFF0C;Poller &#x624D;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li>
</ul>
<pre><code>public boolean events() {
    boolean result = false;

    PollerEvent pe = null;
    for (int i = 0, size = events.size(); i &lt; size &amp;&amp; (pe = events.poll()) != null; i++ ) {
        result = true;
        try {
            pe.run();
            pe.reset();
            if (running &amp;&amp; !paused) {
                eventCache.push(pe);
            }
        } catch ( Throwable x ) {
            log.error(&quot;&quot;,x);
        }
    }

    return result;
}
</code></pre><pre><code>- 2.1.1) PollerEvent#run&#xFF08;&#x6CE8;&#x518C;&#x5230;Selector)
</code></pre><pre><code>public void run() {
    if (interestOps == OP_REGISTER) {
        try {
            socket.getIOChannel().register(
                    socket.getPoller().getSelector(), SelectionKey.OP_READ, socketWrapper);
        } catch (Exception x) {
            log.error(sm.getString(&quot;endpoint.nio.registerFail&quot;), x);
        }
    } else {
        final SelectionKey key = socket.getIOChannel().keyFor(socket.getPoller().getSelector());
        try {
            if (key == null) {
                // The key was cancelled (e.g. due to socket closure)
                // and removed from the selector while it was being
                // processed. Count down the connections at this point
                // since it won&apos;t have been counted down when the socket
                // closed.
                socket.socketWrapper.getEndpoint().countDownConnection();
            } else {
                final NioSocketWrapper socketWrapper = (NioSocketWrapper) key.attachment();
                if (socketWrapper != null) {
                    //we are registering the key to start with, reset the fairness counter.
                    int ops = key.interestOps() | interestOps;
                    socketWrapper.interestOps(ops);
                    key.interestOps(ops);
                } else {
                    socket.getPoller().cancelledKey(key);
                }
            }
        } catch (CancelledKeyException ckx) {
            try {
                socket.getPoller().cancelledKey(key);
            } catch (Exception ignore) {}
        }
    }
}
</code></pre><pre><code>- 2.2) Poller#processKey&#xFF08;&#x5C06;&#x5C31;&#x7EEA;&#x7684;Socket&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;)
</code></pre><ul>
<li><p>protected void processKey(SelectionKey sk, NioSocketWrapper attachment) {
  try {</p>
<pre><code>  if ( close ) {
      cancelledKey(sk);
  } else if ( sk.isValid() &amp;&amp; attachment != null ) {
      if (sk.isReadable() || sk.isWritable() ) {
          if ( attachment.getSendfileData() != null ) {
              processSendfile(sk,attachment, false);
          } else {
              unreg(sk, attachment, sk.readyOps());
              boolean closeSocket = false;
              // Read goes before write
              if (sk.isReadable()) {
                  if (!processSocket(attachment, SocketEvent.OPEN_READ, true)) {
                      closeSocket = true;
                  }
              }
              if (!closeSocket &amp;&amp; sk.isWritable()) {
                  if (!processSocket(attachment, SocketEvent.OPEN_WRITE, true)) {
                      closeSocket = true;
                  }
              }
              if (closeSocket) {
                  cancelledKey(sk);
              }
          }
      }
  } else {
      //invalid key
      cancelledKey(sk);
  }
</code></pre><p>  } catch ( CancelledKeyException ckx ) {</p>
<pre><code>  cancelledKey(sk);
</code></pre><p>  } catch (Throwable t) {</p>
<pre><code>  ExceptionUtils.handleThrowable(t);
  log.error(&quot;&quot;,t);
</code></pre><p>  }
}</p>
<ul>
<li>2.2.1) AbstractEndpoint#processSocket</li>
</ul>
</li>
<li>createSocketProcessor() &#x65B9;&#x6CD5;&#x5C06; Socket &#x5C01;&#x88C5;&#x5230; SocketProcessor &#x4E2D;&#xFF0C;SocketProcessor &#x5B9E;&#x73B0;&#x4E86; Runnable &#x63A5;&#x53E3;&#x3002;worker &#x7EBF;&#x7A0B;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5176; run() &#x65B9;&#x6CD5;&#x6765;&#x5BF9; Socket &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li>
</ul>
<pre><code>public boolean processSocket(SocketWrapperBase&lt;S&gt; socketWrapper,
        SocketEvent event, boolean dispatch) {
    try {
        if (socketWrapper == null) {
            return false;
        }
        SocketProcessorBase&lt;S&gt; sc = processorCache.pop();
        if (sc == null) {
            sc = createSocketProcessor(socketWrapper, event);
        } else {
            sc.reset(socketWrapper, event);
        }
        Executor executor = getExecutor();
        if (dispatch &amp;&amp; executor != null) {
            executor.execute(sc);
        } else {
            sc.run();
        }
    } catch (RejectedExecutionException ree) {
        getLog().warn(sm.getString(&quot;endpoint.executor.fail&quot;, socketWrapper) , ree);
        return false;
    } catch (Throwable t) {
        ExceptionUtils.handleThrowable(t);
        // This means we got an OOM or similar creating a thread, or that
        // the pool and its queue are full
        getLog().error(sm.getString(&quot;endpoint.process.fail&quot;), t);
        return false;
    }
    return true;
}
</code></pre><pre><code>- 2.2.1.1) NioEndpoint#createSocketProcessor
</code></pre><ul>
<li>protected SocketProcessorBase<niochannel> createSocketProcessor(<pre><code>  SocketWrapperBase&lt;NioChannel&gt; socketWrapper, SocketEvent event) {
</code></pre>  return new SocketProcessor(socketWrapper, event);
}</niochannel></li>
</ul>
<pre><code>public SocketProcessor(SocketWrapperBase&lt;NioChannel&gt; socketWrapper, SocketEvent event) {
    super(socketWrapper, event);
}
</code></pre><pre><code>public SocketProcessorBase(SocketWrapperBase&lt;S&gt; socketWrapper, SocketEvent event) {
    reset(socketWrapper, event);
}
</code></pre><pre><code>public void reset(SocketWrapperBase&lt;S&gt; socketWrapper, SocketEvent event) {
    Objects.requireNonNull(event);
    this.socketWrapper = socketWrapper;
    this.event = event;
}
</code></pre><ul>
<li><ul>
<li>3) Worker#run&#xFF08;&#x5C06;SocketProcessor&#x5C01;&#x88C5;&#x4E3A;Request,IO Handler)</li>
</ul>
</li>
</ul>
<p>1.- worker &#x7EBF;&#x7A0B;&#x88AB;&#x521B;&#x5EFA;&#x4EE5;&#x540E;&#x5C31;&#x6267;&#x884C; ThreadPoolExecutor &#x7684; runWorker() &#x65B9;&#x6CD5;&#xFF0C;&#x8BD5;&#x56FE;&#x4ECE; workQueue &#x4E2D;&#x53D6;&#x5F85;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x5F00;&#x59CB; workQueue &#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x6240;&#x4EE5; worker &#x7EBF;&#x7A0B;&#x4F1A;&#x963B;&#x585E;&#x5728; workQueue.take() &#x65B9;&#x6CD5;&#x3002;
2.- &#x5F53;&#x65B0;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230; workQueue&#x540E;&#xFF0C;workQueue.take() &#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; Runnable&#xFF0C;&#x901A;&#x5E38;&#x662F; SocketProcessor,&#x7136;&#x540E; worker &#x7EBF;&#x7A0B;&#x8C03;&#x7528; SocketProcessor &#x7684; run() &#x65B9;&#x6CD5;&#x5BF9; Socket &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;
3.- createProcessor() &#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Http11Processor, &#x5B83;&#x7528;&#x6765;&#x89E3;&#x6790; Socket&#xFF0C;&#x5C06; Socket &#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5C01;&#x88C5;&#x5230; Request &#x4E2D;&#x3002;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A; Request &#x662F;&#x4E34;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5B83;&#x7684;&#x5168;&#x7C7B;&#x540D;&#x662F; org.apache.coyote.Request&#xFF0C;
4.- postParseRequest() &#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x4E00;&#x4E0B; Request&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x4E00;&#x4E0B;&#x6620;&#x5C04;&#x5173;&#x7CFB;(&#x4ECE; URL &#x6620;&#x5C04;&#x5230;&#x76F8;&#x5E94;&#x7684; Host&#x3001;Context&#x3001;Wrapper)&#x3002;
5.- CoyoteAdapter &#x5C06; Rquest &#x63D0;&#x4EA4;&#x7ED9; Container &#x5904;&#x7406;&#x4E4B;&#x524D;&#xFF0C;&#x5E76;&#x5C06; org.apache.coyote.Request &#x5C01;&#x88C5;&#x5230; org.apache.catalina.connector.Request&#xFF0C;&#x4F20;&#x9012;&#x7ED9; Container &#x5904;&#x7406;&#x7684; Request &#x662F; org.apache.catalina.connector.Request&#x3002;
6.- connector.getService().getMapper().map()&#xFF0C;&#x7528;&#x6765;&#x5728; Mapper &#x4E2D;&#x67E5;&#x8BE2; URL &#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x4F1A;&#x4FDD;&#x7559;&#x5230; org.apache.catalina.connector.Request &#x4E2D;&#xFF0C;Container &#x5904;&#x7406;&#x9636;&#x6BB5; request.getHost() &#x662F;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x9636;&#x6BB5;&#x67E5;&#x8BE2;&#x5230;&#x7684;&#x6620;&#x5C04;&#x4E3B;&#x673A;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8; request.getContext()&#x3001;request.getWrapper() &#x90FD;&#x662F;&#x3002;
7.- connector.getService().getContainer().getPipeline().getFirst().invoke() &#x4F1A;&#x5C06;&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x5230; Container &#x5904;&#x7406;&#xFF0C;&#x5F53;&#x7136;&#x4E86; Container &#x5904;&#x7406;&#x4E5F;&#x662F;&#x5728; Worker &#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x6240;&#x4EE5;&#x5355;&#x72EC;&#x5206;&#x51FA;&#x6765;&#x4E00;&#x8282;&#x3002;</p>
<pre><code>/** Delegates main run loop to outer runWorker  */
public void run() {
    runWorker(this);
}
</code></pre><ul>
<li><p>final void runWorker(Worker w) {
  Thread wt = Thread.currentThread();
  Runnable task = w.firstTask;
  w.firstTask = null;
  w.unlock(); // allow interrupts
  boolean completedAbruptly = true;
  try {</p>
<pre><code>  while (task != null || (task = getTask()) != null) {
      w.lock();
      // If pool is stopping, ensure thread is interrupted;
      // if not, ensure thread is not interrupted.  This
      // requires a recheck in second case to deal with
      // shutdownNow race while clearing interrupt
      if ((runStateAtLeast(ctl.get(), STOP) ||
           (Thread.interrupted() &amp;&amp;
            runStateAtLeast(ctl.get(), STOP))) &amp;&amp;
          !wt.isInterrupted())
          wt.interrupt();
      try {
          beforeExecute(wt, task);
          Throwable thrown = null;
          try {
              task.run();
          } catch (RuntimeException x) {
              thrown = x; throw x;
          } catch (Error x) {
              thrown = x; throw x;
          } catch (Throwable x) {
              thrown = x; throw new Error(x);
          } finally {
              afterExecute(task, thrown);
          }
      } finally {
          task = null;
          w.completedTasks++;
          w.unlock();
      }
  }
  completedAbruptly = false;
</code></pre><p>  } finally {</p>
<pre><code>  processWorkerExit(w, completedAbruptly);
</code></pre><p>  }
}</p>
</li>
<li><p>task&#x662F;SocketProcessor&#x7C7B;&#x578B;</p>
<ul>
<li>3.1) SocketProcessor#run</li>
</ul>
</li>
</ul>
<pre><code>public final void run() {
    synchronized (socketWrapper) {
        // It is possible that processing may be triggered for read and
        // write at the same time. The sync above makes sure that processing
        // does not occur in parallel. The test below ensures that if the
        // first event to be processed results in the socket being closed,
        // the subsequent events are not processed.
        if (socketWrapper.isClosed()) {
            return;
        }
        doRun();
    }
}
</code></pre><ul>
<li><p>protected void doRun() {
  NioChannel socket = socketWrapper.getSocket();
  SelectionKey key = socket.getIOChannel().keyFor(socket.getPoller().getSelector());</p>
<p>  try {</p>
<pre><code>  int handshake = -1;

  try {
      if (key != null) {
          if (socket.isHandshakeComplete()) {
              // No TLS handshaking required. Let the handler
              // process this socket / event combination.
              handshake = 0;
          } else if (event == SocketEvent.STOP || event == SocketEvent.DISCONNECT ||
                  event == SocketEvent.ERROR) {
              // Unable to complete the TLS handshake. Treat it as
              // if the handshake failed.
              handshake = -1;
          } else {
              handshake = socket.handshake(key.isReadable(), key.isWritable());
              // The handshake process reads/writes from/to the
              // socket. status may therefore be OPEN_WRITE once
              // the handshake completes. However, the handshake
              // happens when the socket is opened so the status
              // must always be OPEN_READ after it completes. It
              // is OK to always set this as it is only used if
              // the handshake completes.
              event = SocketEvent.OPEN_READ;
          }
      }
  } catch (IOException x) {
      handshake = -1;
      if (log.isDebugEnabled()) log.debug(&quot;Error during SSL handshake&quot;,x);
  } catch (CancelledKeyException ckx) {
      handshake = -1;
  }
  if (handshake == 0) {
      SocketState state = SocketState.OPEN;
      // Process the request from this socket
      if (event == null) {
          state = getHandler().process(socketWrapper, SocketEvent.OPEN_READ);
      } else {
          state = getHandler().process(socketWrapper, event);
      }
      if (state == SocketState.CLOSED) {
          close(socket, key);
      }
  } else if (handshake == -1 ) {
      close(socket, key);
  } else if (handshake == SelectionKey.OP_READ){
      socketWrapper.registerReadInterest();
  } else if (handshake == SelectionKey.OP_WRITE){
      socketWrapper.registerWriteInterest();
  }
</code></pre><p>  } catch (CancelledKeyException cx) {</p>
<pre><code>  socket.getPoller().cancelledKey(key);
</code></pre><p>  } catch (VirtualMachineError vme) {</p>
<pre><code>  ExceptionUtils.handleThrowable(vme);
</code></pre><p>  } catch (Throwable t) {</p>
<pre><code>  log.error(&quot;&quot;, t);
  socket.getPoller().cancelledKey(key);
</code></pre><p>  } finally {</p>
<pre><code>  socketWrapper = null;
  event = null;
  //return to cache
</code></pre></li>
<li><p>// keep-alive&#x7684;&#x5B9E;&#x73B0;</p>
<pre><code>  if (running &amp;&amp; !paused) {
      processorCache.push(this);
  }
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1) AbstractProtocol#process</li>
</ul>
</li>
<li>&#x5148;&#x8BD5;&#x56FE;&#x4ECE;connections&#x4E2D;&#x83B7;&#x53D6;&#x5F53;&#x524D;Socket&#x5BF9;&#x5E94;&#x7684;Processor&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x7684;&#x8BDD;&#x4ECE;recycledProcessors&#x4E2D;&#x83B7;&#x53D6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x8FC7;&#x8FDE;&#x63A5;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x88AB;&#x9500;&#x6BC1;&#x7684;Processor&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x907F;&#x514D;&#x9891;&#x7E41;&#x5730;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x5BF9;&#x8C61;&#x3002;processor&#x8FD8;&#x662F;&#x4E3A;&#x7A7A;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5C31;&#x4F7F;&#x7528;createProcessor&#x521B;&#x5EFA;&#x3002;</li>
</ul>
<pre><code>public SocketState process(SocketWrapperBase&lt;S&gt; wrapper, SocketEvent status) {
    if (getLog().isDebugEnabled()) {
        getLog().debug(sm.getString(&quot;abstractConnectionHandler.process&quot;,
                wrapper.getSocket(), status));
    }
    if (wrapper == null) {
        // Nothing to do. Socket has been closed.
        return SocketState.CLOSED;
    }

    S socket = wrapper.getSocket();

    Processor processor = connections.get(socket);
    if (getLog().isDebugEnabled()) {
        getLog().debug(sm.getString(&quot;abstractConnectionHandler.connectionsGet&quot;,
                processor, socket));
    }

    if (processor != null) {
        // Make sure an async timeout doesn&apos;t fire
        getProtocol().removeWaitingProcessor(processor);
    } else if (status == SocketEvent.DISCONNECT || status == SocketEvent.ERROR) {
        // Nothing to do. Endpoint requested a close and there is no
        // longer a processor associated with this socket.
        return SocketState.CLOSED;
    }

    ContainerThreadMarker.set();

    try {
        if (processor == null) {
            String negotiatedProtocol = wrapper.getNegotiatedProtocol();
            if (negotiatedProtocol != null) {
                UpgradeProtocol upgradeProtocol =
                        getProtocol().getNegotiatedProtocol(negotiatedProtocol);
                if (upgradeProtocol != null) {
                    processor = upgradeProtocol.getProcessor(
                            wrapper, getProtocol().getAdapter());
                } else if (negotiatedProtocol.equals(&quot;http/1.1&quot;)) {
                    // Explicitly negotiated the default protocol.
                    // Obtain a processor below.
                } else {
                    // TODO:
                    // OpenSSL 1.0.2&apos;s ALPN callback doesn&apos;t support
                    // failing the handshake with an error if no
                    // protocol can be negotiated. Therefore, we need to
                    // fail the connection here. Once this is fixed,
                    // replace the code below with the commented out
                    // block.
                    if (getLog().isDebugEnabled()) {
                        getLog().debug(sm.getString(
                            &quot;abstractConnectionHandler.negotiatedProcessor.fail&quot;,
                            negotiatedProtocol));
                    }
                    return SocketState.CLOSED;
                    /*
                     * To replace the code above once OpenSSL 1.1.0 is
                     * used.
                    // Failed to create processor. This is a bug.
                    throw new IllegalStateException(sm.getString(
                            &quot;abstractConnectionHandler.negotiatedProcessor.fail&quot;,
                            negotiatedProtocol));
                    */
                }
            }
        }
        if (processor == null) {
            processor = recycledProcessors.pop();
            if (getLog().isDebugEnabled()) {
                getLog().debug(sm.getString(&quot;abstractConnectionHandler.processorPop&quot;,
                        processor));
            }
        }
        if (processor == null) {
            processor = getProtocol().createProcessor();
            register(processor);
        }

        processor.setSslSupport(
                wrapper.getSslSupport(getProtocol().getClientCertProvider()));

        // Associate the processor with the connection
        connections.put(socket, processor);

        SocketState state = SocketState.CLOSED;
        do {
            state = processor.process(wrapper, status);

            if (state == SocketState.UPGRADING) {
                // Get the HTTP upgrade handler
                UpgradeToken upgradeToken = processor.getUpgradeToken();
                // Retrieve leftover input
                ByteBuffer leftOverInput = processor.getLeftoverInput();
                if (upgradeToken == null) {
                    // Assume direct HTTP/2 connection
                    UpgradeProtocol upgradeProtocol = getProtocol().getUpgradeProtocol(&quot;h2c&quot;);
                    if (upgradeProtocol != null) {
                        processor = upgradeProtocol.getProcessor(
                                wrapper, getProtocol().getAdapter());
                        wrapper.unRead(leftOverInput);
                        // Associate with the processor with the connection
                        connections.put(socket, processor);
                    } else {
                        if (getLog().isDebugEnabled()) {
                            getLog().debug(sm.getString(
                                &quot;abstractConnectionHandler.negotiatedProcessor.fail&quot;,
                                &quot;h2c&quot;));
                        }
                        return SocketState.CLOSED;
                    }
                } else {
                    HttpUpgradeHandler httpUpgradeHandler = upgradeToken.getHttpUpgradeHandler();
                    // Release the Http11 processor to be re-used
                    release(processor);
                    // Create the upgrade processor
                    processor = getProtocol().createUpgradeProcessor(wrapper, upgradeToken);
                    if (getLog().isDebugEnabled()) {
                        getLog().debug(sm.getString(&quot;abstractConnectionHandler.upgradeCreate&quot;,
                                processor, wrapper));
                    }
                    wrapper.unRead(leftOverInput);
                    // Mark the connection as upgraded
                    wrapper.setUpgraded(true);
                    // Associate with the processor with the connection
                    connections.put(socket, processor);
                    // Initialise the upgrade handler (which may trigger
                    // some IO using the new protocol which is why the lines
                    // above are necessary)
                    // This cast should be safe. If it fails the error
                    // handling for the surrounding try/catch will deal with
                    // it.
                    if (upgradeToken.getInstanceManager() == null) {
                        httpUpgradeHandler.init((WebConnection) processor);
                    } else {
                        ClassLoader oldCL = upgradeToken.getContextBind().bind(false, null);
                        try {
                            httpUpgradeHandler.init((WebConnection) processor);
                        } finally {
                            upgradeToken.getContextBind().unbind(false, oldCL);
                        }
                    }
                }
            }
        } while ( state == SocketState.UPGRADING);

        if (state == SocketState.LONG) {
            // In the middle of processing a request/response. Keep the
            // socket associated with the processor. Exact requirements
            // depend on type of long poll
            longPoll(wrapper, processor);
            if (processor.isAsync()) {
                getProtocol().addWaitingProcessor(processor);
            }
        } else if (state == SocketState.OPEN) {
            // In keep-alive but between requests. OK to recycle
            // processor. Continue to poll for the next request.
            connections.remove(socket);
            release(processor);
            wrapper.registerReadInterest();
        } else if (state == SocketState.SENDFILE) {
            // Sendfile in progress. If it fails, the socket will be
            // closed. If it works, the socket either be added to the
            // poller (or equivalent) to await more data or processed
            // if there are any pipe-lined requests remaining.
        } else if (state == SocketState.UPGRADED) {
            // Don&apos;t add sockets back to the poller if this was a
            // non-blocking write otherwise the poller may trigger
            // multiple read events which may lead to thread starvation
            // in the connector. The write() method will add this socket
            // to the poller if necessary.
            if (status != SocketEvent.OPEN_WRITE) {
                longPoll(wrapper, processor);
            }
        } else if (state == SocketState.SUSPENDED) {
            // Don&apos;t add sockets back to the poller.
            // The resumeProcessing() method will add this socket
            // to the poller.
        } else {
            // Connection closed. OK to recycle the processor. Upgrade
            // processors are not recycled.
            connections.remove(socket);
            if (processor.isUpgrade()) {
                UpgradeToken upgradeToken = processor.getUpgradeToken();
                HttpUpgradeHandler httpUpgradeHandler = upgradeToken.getHttpUpgradeHandler();
                InstanceManager instanceManager = upgradeToken.getInstanceManager();
                if (instanceManager == null) {
                    httpUpgradeHandler.destroy();
                } else {
                    ClassLoader oldCL = upgradeToken.getContextBind().bind(false, null);
                    try {
                        httpUpgradeHandler.destroy();
                    } finally {
                        try {
                            instanceManager.destroyInstance(httpUpgradeHandler);
                        } catch (Throwable e) {
                            ExceptionUtils.handleThrowable(e);
                            getLog().error(sm.getString(&quot;abstractConnectionHandler.error&quot;), e);
                        }
                        upgradeToken.getContextBind().unbind(false, oldCL);
                    }
                }
            } else {
                release(processor);
            }
        }
        return state;
    } catch(java.net.SocketException e) {
        // SocketExceptions are normal
        getLog().debug(sm.getString(
                &quot;abstractConnectionHandler.socketexception.debug&quot;), e);
    } catch (java.io.IOException e) {
        // IOExceptions are normal
        getLog().debug(sm.getString(
                &quot;abstractConnectionHandler.ioexception.debug&quot;), e);
    } catch (ProtocolException e) {
        // Protocol exceptions normally mean the client sent invalid or
        // incomplete data.
        getLog().debug(sm.getString(
                &quot;abstractConnectionHandler.protocolexception.debug&quot;), e);
    }
    // Future developers: if you discover any other
    // rare-but-nonfatal exceptions, catch them here, and log as
    // above.
    catch (Throwable e) {
        ExceptionUtils.handleThrowable(e);
        // any other exception or error is odd. Here we log it
        // with &quot;ERROR&quot; level, so it will show up even on
        // less-than-verbose logs.
        getLog().error(sm.getString(&quot;abstractConnectionHandler.error&quot;), e);
    } finally {
        ContainerThreadMarker.clear();
    }

    // Make sure socket/processor is removed from the list of current
    // connections
    connections.remove(socket);
    release(processor);
    return SocketState.CLOSED;
}
</code></pre><pre><code>- 3.1.1.1) AbstractHttp11Protocol#createProcessor
</code></pre><ul>
<li>createProcessor() &#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Http11Processor, &#x5B83;&#x7528;&#x6765;&#x89E3;&#x6790; Socket&#xFF0C;&#x5C06; Socket &#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5C01;&#x88C5;&#x5230; Request &#x4E2D;&#x3002;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A; Request &#x662F;&#x4E34;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5B83;&#x7684;&#x5168;&#x7C7B;&#x540D;&#x662F; org.apache.coyote.Request&#x3002;</li>
<li>protected Processor createProcessor() {
  Http11Processor processor = new Http11Processor(this, adapter);
  return processor;
}<ul>
<li>3.1.1.1.1) Http11Processor#constructor&#xFF08;&#x521B;&#x5EFA;req&#x548C;resp&#x7F13;&#x51B2;&#x533A;)</li>
</ul>
</li>
</ul>
<pre><code>public Http11Processor(AbstractHttp11Protocol&lt;?&gt; protocol, Adapter adapter) {
    super(adapter);
    this.protocol = protocol;

    userDataHelper = new UserDataHelper(log);

    inputBuffer = new Http11InputBuffer(request, protocol.getMaxHttpHeaderSize(),
            protocol.getRejectIllegalHeaderName());
    request.setInputBuffer(inputBuffer);

    outputBuffer = new Http11OutputBuffer(response, protocol.getMaxHttpHeaderSize());
    response.setOutputBuffer(outputBuffer);

    // Create and add the identity filters.
    inputBuffer.addFilter(new IdentityInputFilter(protocol.getMaxSwallowSize()));
    outputBuffer.addFilter(new IdentityOutputFilter());

    // Create and add the chunked filters.
    inputBuffer.addFilter(new ChunkedInputFilter(protocol.getMaxTrailerSize(),
            protocol.getAllowedTrailerHeadersInternal(), protocol.getMaxExtensionSize(),
            protocol.getMaxSwallowSize()));
    outputBuffer.addFilter(new ChunkedOutputFilter());

    // Create and add the void filters.
    inputBuffer.addFilter(new VoidInputFilter());
    outputBuffer.addFilter(new VoidOutputFilter());

    // Create and add buffered input filter
    inputBuffer.addFilter(new BufferedInputFilter());

    // Create and add the chunked filters.
    //inputBuffer.addFilter(new GzipInputFilter());
    outputBuffer.addFilter(new GzipOutputFilter());

    pluggableFilterIndex = inputBuffer.getFilters().length;
}
</code></pre><pre><code>public AbstractProcessor(Adapter adapter) {
    this(adapter, new Request(), new Response());
}
</code></pre><ul>
<li>protected AbstractProcessor(Adapter adapter, Request coyoteRequest, Response coyoteResponse) {
  this.adapter = adapter;
  asyncStateMachine = new AsyncStateMachine(this);
  request = coyoteRequest;
  response = coyoteResponse;
  response.setHook(this);
  request.setResponse(response);
  request.setHook(this);
}<ul>
<li>3.1.1.1.1.1) Http11InputBuffer#constructor&#xFF08;&#x5B58;&#x653E;&#x89E3;&#x6790;&#x540E;&#x7684;Request&#x4FE1;&#x606F;)</li>
</ul>
</li>
</ul>
<pre><code>public Http11InputBuffer(Request request, int headerBufferSize,
        boolean rejectIllegalHeaderName) {

    this.request = request;
    headers = request.getMimeHeaders();

    this.headerBufferSize = headerBufferSize;
    this.rejectIllegalHeaderName = rejectIllegalHeaderName;

    filterLibrary = new InputFilter[0];
    activeFilters = new InputFilter[0];
    lastActiveFilter = -1;

    parsingHeader = true;
    parsingRequestLine = true;
    parsingRequestLinePhase = 0;
    parsingRequestLineEol = false;
    parsingRequestLineStart = 0;
    parsingRequestLineQPos = -1;
    headerParsePos = HeaderParsePosition.HEADER_START;
    swallowInput = true;

    inputStreamInputBuffer = new SocketInputBuffer();
}
</code></pre><pre><code>- 3.1.1.2) ConnectionHandler#register&#xFF08;&#x6CE8;&#x518C;Http11Processor)
</code></pre><ul>
<li><p>protected void register(Processor processor) {
  if (getProtocol().getDomain() != null) {</p>
<pre><code>  synchronized (this) {
      try {
          long count = registerCount.incrementAndGet();
          RequestInfo rp =
              processor.getRequest().getRequestProcessor();
          rp.setGlobalProcessor(global);
          ObjectName rpName = new ObjectName(
                  getProtocol().getDomain() +
                  &quot;:type=RequestProcessor,worker=&quot;
                  + getProtocol().getName() +
                  &quot;,name=&quot; + getProtocol().getProtocolName() +
                  &quot;Request&quot; + count);
          if (getLog().isDebugEnabled()) {
              getLog().debug(&quot;Register &quot; + rpName);
          }
          Registry.getRegistry(null, null).registerComponent(rp,
                  rpName, null);
          rp.setRpName(rpName);
      } catch (Exception e) {
          getLog().warn(&quot;Error registering request&quot;);
      }
  }
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1.3) AbstractProcessorLight#process&#xFF08;Http11Processor&#x8FDB;&#x884C;&#x5904;&#x7406;)</li>
</ul>
</li>
</ul>
<pre><code>public SocketState process(SocketWrapperBase&lt;?&gt; socketWrapper, SocketEvent status)
        throws IOException {

    SocketState state = SocketState.CLOSED;
    Iterator&lt;DispatchType&gt; dispatches = null;
    do {
        if (dispatches != null) {
            DispatchType nextDispatch = dispatches.next();
            state = dispatch(nextDispatch.getSocketStatus());
        } else if (status == SocketEvent.DISCONNECT) {
            // Do nothing here, just wait for it to get recycled
        } else if (isAsync() || isUpgrade() || state == SocketState.ASYNC_END) {
            state = dispatch(status);
            if (state == SocketState.OPEN) {
                // There may be pipe-lined data to read. If the data isn&apos;t
                // processed now, execution will exit this loop and call
                // release() which will recycle the processor (and input
                // buffer) deleting any pipe-lined data. To avoid this,
                // process it now.
                state = service(socketWrapper);
            }
        } else if (status == SocketEvent.OPEN_WRITE) {
            // Extra write event likely after async, ignore
            state = SocketState.LONG;
        } else if (status == SocketEvent.OPEN_READ){
            state = service(socketWrapper);
        } else {
            // Default to closing the socket if the SocketEvent passed in
            // is not consistent with the current state of the Processor
            state = SocketState.CLOSED;
        }

        if (state != SocketState.CLOSED &amp;&amp; isAsync()) {
            state = asyncPostProcess();
        }

        if (getLog().isDebugEnabled()) {
            getLog().debug(&quot;Socket: [&quot; + socketWrapper +
                    &quot;], Status in: [&quot; + status +
                    &quot;], State out: [&quot; + state + &quot;]&quot;);
        }

        if (dispatches == null || !dispatches.hasNext()) {
            // Only returns non-null iterator if there are
            // dispatches to process.
            dispatches = getIteratorAndClearDispatches();
        }
    } while (state == SocketState.ASYNC_END ||
            dispatches != null &amp;&amp; state != SocketState.CLOSED);

    return state;
}
</code></pre><pre><code>- 3.1.1.3.1) &#xFF08;service&#x9AA8;&#x67B6;)Http11Processor#service&#xFF08;&#x5305;&#x542B;servlet&#x540E;&#x7EED;&#x5904;&#x7406;&#xFF0C;keep-alive&#x7684;&#x5B9E;&#x73B0;)
</code></pre><ul>
<li>1&#xFF0C;org.apache.coyote.Request &#x662F;tomcat&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x5173;&#x4E8E;request&#x6D88;&#x606F;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</li>
<li>2&#xFF0C;org.apache.tomcat.util.buf.MessageBytes &#x7528;&#x4E8E;&#x5B58;&#x653E;&#x6D88;&#x606F;&#xFF0C;&#x5728;org.apache.coyote.Request&#x4E2D;&#x5927;&#x91CF;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x89E3;&#x6790;&#x540E;&#x7684;byte&#x5B57;&#x7B26;</li>
<li><p>3&#xFF0C;org.apache.tomcat.util.buf.ByteChunk &#x771F;&#x6B63;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x6570;&#x636E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5B58;&#x653E;&#x7684;&#x662F;byte[],org.apache.tomcat.util.buf.MessageBytes&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
</li>
<li><p>Request&#x5B58;&#x653E;&#x7740;&#x89E3;&#x6790;&#x540E;&#x7684;Request&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6765;&#x81EA;&#x4E8E;InputBuffer&#x3002;</p>
</li>
<li>http&#x6D88;&#x606F;&#x901A;&#x8FC7;inputBuffer&#x89E3;&#x6790;&#x540E;&#x653E;&#x5230;Request&#x4E2D;&#xFF0C;Request&#x628A;&#x5B83;&#x653E;&#x5230;&#x76F8;&#x5E94;&#x7684;MessageBytes&#xFF0C;&#x6700;&#x540E;MessageBytes&#x628A;&#x5B83;&#x5B58;&#x5230;ByteChunk&#x91CC;&#x3002;</li>
</ul>
<pre><code>public SocketState service(SocketWrapperBase&lt;?&gt; socketWrapper)
    throws IOException {
    RequestInfo rp = request.getRequestProcessor();
    rp.setStage(org.apache.coyote.Constants.STAGE_PARSE);

    // Setting up the I/O
    setSocketWrapper(socketWrapper);
    inputBuffer.init(socketWrapper);
    outputBuffer.init(socketWrapper);

    // Flags
    keepAlive = true;
    openSocket = false;
    readComplete = true;
    boolean keptAlive = false;
    SendfileState sendfileState = SendfileState.DONE;

    while (!getErrorState().isError() &amp;&amp; keepAlive &amp;&amp; !isAsync() &amp;&amp; upgradeToken == null &amp;&amp;
            sendfileState == SendfileState.DONE &amp;&amp; !protocol.isPaused()) {

        // Parsing the request header
        try {
            if (!inputBuffer.parseRequestLine(keptAlive, protocol.getConnectionTimeout(),
                    protocol.getKeepAliveTimeout())) {
                if (inputBuffer.getParsingRequestLinePhase() == -1) {
                    return SocketState.UPGRADING;
                } else if (handleIncompleteRequestLineRead()) {
                    break;
                }
            }

            if (protocol.isPaused()) {
                // 503 - Service unavailable
                response.setStatus(503);
                setErrorState(ErrorState.CLOSE_CLEAN, null);
            } else {
                keptAlive = true;
                // Set this every time in case limit has been changed via JMX
                request.getMimeHeaders().setLimit(protocol.getMaxHeaderCount());
                if (!inputBuffer.parseHeaders()) {
                    // We&apos;ve read part of the request, don&apos;t recycle it
                    // instead associate it with the socket
                    openSocket = true;
                    readComplete = false;
                    break;
                }
                if (!protocol.getDisableUploadTimeout()) {
                    socketWrapper.setReadTimeout(protocol.getConnectionUploadTimeout());
                }
            }
        } catch (IOException e) {
            if (log.isDebugEnabled()) {
                log.debug(sm.getString(&quot;http11processor.header.parse&quot;), e);
            }
            setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
            break;
        } catch (Throwable t) {
            ExceptionUtils.handleThrowable(t);
            UserDataHelper.Mode logMode = userDataHelper.getNextMode();
            if (logMode != null) {
                String message = sm.getString(&quot;http11processor.header.parse&quot;);
                switch (logMode) {
                    case INFO_THEN_DEBUG:
                        message += sm.getString(&quot;http11processor.fallToDebug&quot;);
                        //$FALL-THROUGH$
                    case INFO:
                        log.info(message, t);
                        break;
                    case DEBUG:
                        log.debug(message, t);
                }
            }
            // 400 - Bad Request
            response.setStatus(400);
            setErrorState(ErrorState.CLOSE_CLEAN, t);
            getAdapter().log(request, response, 0);
        }

        // Has an upgrade been requested?
        Enumeration&lt;String&gt; connectionValues = request.getMimeHeaders().values(&quot;Connection&quot;);
        boolean foundUpgrade = false;
        while (connectionValues.hasMoreElements() &amp;&amp; !foundUpgrade) {
            foundUpgrade = connectionValues.nextElement().toLowerCase(
                    Locale.ENGLISH).contains(&quot;upgrade&quot;);
        }

        if (foundUpgrade) {
            // Check the protocol
            String requestedProtocol = request.getHeader(&quot;Upgrade&quot;);

            UpgradeProtocol upgradeProtocol = protocol.getUpgradeProtocol(requestedProtocol);
            if (upgradeProtocol != null) {
                if (upgradeProtocol.accept(request)) {
                    // TODO Figure out how to handle request bodies at this
                    // point.
                    response.setStatus(HttpServletResponse.SC_SWITCHING_PROTOCOLS);
                    response.setHeader(&quot;Connection&quot;, &quot;Upgrade&quot;);
                    response.setHeader(&quot;Upgrade&quot;, requestedProtocol);
                    action(ActionCode.CLOSE,  null);
                    getAdapter().log(request, response, 0);

                    InternalHttpUpgradeHandler upgradeHandler =
                            upgradeProtocol.getInternalUpgradeHandler(
                                    socketWrapper, getAdapter(), cloneRequest(request));
                    UpgradeToken upgradeToken = new UpgradeToken(upgradeHandler, null, null);
                    action(ActionCode.UPGRADE, upgradeToken);
                    return SocketState.UPGRADING;
                }
            }
        }

        if (!getErrorState().isError()) {
            // Setting up filters, and parse some request headers
            rp.setStage(org.apache.coyote.Constants.STAGE_PREPARE);
            try {
                prepareRequest();
            } catch (Throwable t) {
                ExceptionUtils.handleThrowable(t);
                if (log.isDebugEnabled()) {
                    log.debug(sm.getString(&quot;http11processor.request.prepare&quot;), t);
                }
                // 500 - Internal Server Error
                response.setStatus(500);
                setErrorState(ErrorState.CLOSE_CLEAN, t);
                getAdapter().log(request, response, 0);
            }
        }

        int maxKeepAliveRequests = protocol.getMaxKeepAliveRequests();
        if (maxKeepAliveRequests == 1) {
            keepAlive = false;
        } else if (maxKeepAliveRequests &gt; 0 &amp;&amp;
                socketWrapper.decrementKeepAlive() &lt;= 0) {
            keepAlive = false;
        }

        // Process the request in the adapter
        if (!getErrorState().isError()) {
            try {
                rp.setStage(org.apache.coyote.Constants.STAGE_SERVICE);
getAdapter().service(request, response);
                // Handle when the response was committed before a serious
                // error occurred.  Throwing a ServletException should both
                // set the status to 500 and set the errorException.
                // If we fail here, then the response is likely already
                // committed, so we can&apos;t try and set headers.
                if(keepAlive &amp;&amp; !getErrorState().isError() &amp;&amp; !isAsync() &amp;&amp;
                        statusDropsConnection(response.getStatus())) {
                    setErrorState(ErrorState.CLOSE_CLEAN, null);
                }
            } catch (InterruptedIOException e) {
                setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
            } catch (HeadersTooLargeException e) {
                log.error(sm.getString(&quot;http11processor.request.process&quot;), e);
                // The response should not have been committed but check it
                // anyway to be safe
                if (response.isCommitted()) {
                    setErrorState(ErrorState.CLOSE_NOW, e);
                } else {
                    response.reset();
                    response.setStatus(500);
                    setErrorState(ErrorState.CLOSE_CLEAN, e);
                    response.setHeader(&quot;Connection&quot;, &quot;close&quot;); // TODO: Remove
                }
            } catch (Throwable t) {
                ExceptionUtils.handleThrowable(t);
                log.error(sm.getString(&quot;http11processor.request.process&quot;), t);
                // 500 - Internal Server Error
                response.setStatus(500);
                setErrorState(ErrorState.CLOSE_CLEAN, t);
                getAdapter().log(request, response, 0);
            }
        }

        // Finish the handling of the request
        rp.setStage(org.apache.coyote.Constants.STAGE_ENDINPUT);
        if (!isAsync()) {
            // If this is an async request then the request ends when it has
            // been completed. The AsyncContext is responsible for calling
            // endRequest() in that case.
            endRequest();
        }
        rp.setStage(org.apache.coyote.Constants.STAGE_ENDOUTPUT);

        // If there was an error, make sure the request is counted as
        // and error, and update the statistics counter
        if (getErrorState().isError()) {
            response.setStatus(500);
        }

        if (!isAsync() || getErrorState().isError()) {
            request.updateCounters();
            if (getErrorState().isIoAllowed()) {
                inputBuffer.nextRequest();
                outputBuffer.nextRequest();
            }
        }

        if (!protocol.getDisableUploadTimeout()) {
            int connectionTimeout = protocol.getConnectionTimeout();
            if(connectionTimeout &gt; 0) {
                socketWrapper.setReadTimeout(connectionTimeout);
            } else {
                socketWrapper.setReadTimeout(0);
            }
        }

        rp.setStage(org.apache.coyote.Constants.STAGE_KEEPALIVE);

        sendfileState = processSendfile(socketWrapper);
    }

    rp.setStage(org.apache.coyote.Constants.STAGE_ENDED);

    if (getErrorState().isError() || protocol.isPaused()) {
        return SocketState.CLOSED;
    } else if (isAsync()) {
        return SocketState.LONG;
    } else if (isUpgrade()) {
        return SocketState.UPGRADING;
    } else {
        if (sendfileState == SendfileState.PENDING) {
            return SocketState.SENDFILE;
        } else {
            if (openSocket) {
                if (readComplete) {
                    return SocketState.OPEN;
                } else {
                    return SocketState.LONG;
                }
            } else {
                return SocketState.CLOSED;
            }
        }
    }
}
</code></pre><pre><code>- 3.1.1.3.1.1) Http11inputBuffer#init&#xFF08;&#x521D;&#x59CB;&#x5316;InputBuffer)
</code></pre><ul>
<li><p>void init(SocketWrapperBase&lt;?&gt; socketWrapper) {</p>
<p>  wrapper = socketWrapper;
  wrapper.setAppReadBufHandler(this);</p>
<p>  int bufLength = headerBufferSize +</p>
<pre><code>      wrapper.getSocketBufferHandler().getReadBuffer().capacity();
</code></pre><p>  if (byteBuffer == null || byteBuffer.capacity() &lt; bufLength) {</p>
<pre><code>  byteBuffer = ByteBuffer.allocate(bufLength);
  byteBuffer.position(0).limit(0);
</code></pre><p>  }
}</p>
<ul>
<li>3.1.1.3.1.2) Http11inputBuffer#parseRequestLine&#xFF08;&#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x884C;)</li>
</ul>
</li>
<li><p>&#x5C06;SocketBufferHandler&#x4E2D;&#x7684;readBuffer&#x7684;&#x90E8;&#x5206;&#x6570;&#x636E;&#x586B;&#x5145;&#x5230;byteBuffer&#x4E2D;&#xFF0C;&#x8BFB;&#x53D6;byteBuffer&#xFF0C;&#x89E3;&#x6790;&#xFF0C;&#x5C06;&#x7ED3;&#x679C;&#x5B58;&#x5165;Request</p>
<ul>
<li><p>boolean parseRequestLine(boolean keptAlive) throws IOException {</p>
<p>// check state
if (!parsingRequestLine) {
  return true;
}
//
// Skipping blank lines
//
if (parsingRequestLinePhase &lt; 2) {
  byte chr = 0;
  do {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (keptAlive) {
          // Haven&apos;t read any request data yet so use the keep-alive
          // timeout.
          wrapper.setReadTimeout(wrapper.getEndpoint().getKeepAliveTimeout());
      }
      if (!fill(false)) {
          // A read is pending, so no longer in initial state
          parsingRequestLinePhase = 1;
          return false;
      }
      // At least one byte of the request has been received.
      // Switch to the socket timeout.
      wrapper.setReadTimeout(wrapper.getEndpoint().getSoTimeout());
  }
  if (!keptAlive &amp;&amp; byteBuffer.position() == 0 &amp;&amp; byteBuffer.limit() &gt;= CLIENT_PREFACE_START.length - 1) {
      boolean prefaceMatch = true;
      for (int i = 0; i &lt; CLIENT_PREFACE_START.length &amp;&amp; prefaceMatch; i++) {
          if (CLIENT_PREFACE_START[i] != byteBuffer.get(i)) {
              prefaceMatch = false;
          }
      }
      if (prefaceMatch) {
          // HTTP/2 preface matched
          parsingRequestLinePhase = -1;
          return false;
      }
  }
  // Set the start time once we start reading data (even if it is
  // just skipping blank lines)
  if (request.getStartTime() &lt; 0) {
      request.setStartTime(System.currentTimeMillis());
  }
  chr = byteBuffer.get();
</code></pre><p>  } while ((chr == Constants.CR) || (chr == Constants.LF));
  byteBuffer.position(byteBuffer.position() - 1);</p>
<p>  parsingRequestLineStart = byteBuffer.position();
  parsingRequestLinePhase = 2;
  if (log.isDebugEnabled()) {</p>
<pre><code>  log.debug(&quot;Received [&quot;
          + new String(byteBuffer.array(), byteBuffer.position(), byteBuffer.remaining(), StandardCharsets.ISO_8859_1) + &quot;]&quot;);
</code></pre><p>  }
}
if (parsingRequestLinePhase == 2) {
  //
  // Reading the method name
  // Method name is a token
  //
  boolean space = false;
  while (!space) {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (!fill(false)) // request line parsing
          return false;
  }
  // Spec says method name is a token followed by a single SP but
  // also be tolerant of multiple SP and/or HT.
  int pos = byteBuffer.position();
  byte chr = byteBuffer.get();
  if (chr == Constants.SP || chr == Constants.HT) {
      space = true;
      request.method().setBytes(byteBuffer.array(), parsingRequestLineStart,
              pos - parsingRequestLineStart);
  } else if (!HttpParser.isToken(chr)) {
      byteBuffer.position(byteBuffer.position() - 1);
      throw new IllegalArgumentException(sm.getString(&quot;iib.invalidmethod&quot;));
  }
</code></pre><p>  }
  parsingRequestLinePhase = 3;
}
if (parsingRequestLinePhase == 3) {
  // Spec says single SP but also be tolerant of multiple SP and/or HT
  boolean space = true;
  while (space) {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (!fill(false)) // request line parsing
          return false;
  }
  byte chr = byteBuffer.get();
  if (!(chr == Constants.SP || chr == Constants.HT)) {
      space = false;
      byteBuffer.position(byteBuffer.position() - 1);
  }
</code></pre><p>  }
  parsingRequestLineStart = byteBuffer.position();
  parsingRequestLinePhase = 4;
}
if (parsingRequestLinePhase == 4) {
  // Mark the current buffer position</p>
<p>  int end = 0;
  //
  // Reading the URI
  //
  boolean space = false;
  while (!space) {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (!fill(false)) // request line parsing
          return false;
  }
  int pos = byteBuffer.position();
  byte chr = byteBuffer.get();
  if (chr == Constants.SP || chr == Constants.HT) {
      space = true;
      end = pos;
  } else if (chr == Constants.CR || chr == Constants.LF) {
      // HTTP/0.9 style request
      parsingRequestLineEol = true;
      space = true;
      end = pos;
  } else if (chr == Constants.QUESTION &amp;&amp; parsingRequestLineQPos == -1) {
      parsingRequestLineQPos = pos;
  } else if (HttpParser.isNotRequestTarget(chr)) {
      throw new IllegalArgumentException(sm.getString(&quot;iib.invalidRequestTarget&quot;));
  }
</code></pre><p>  }
  if (parsingRequestLineQPos &gt;= 0) {</p>
<pre><code>  request.queryString().setBytes(byteBuffer.array(), parsingRequestLineQPos + 1,
          end - parsingRequestLineQPos - 1);
  request.requestURI().setBytes(byteBuffer.array(), parsingRequestLineStart,
          parsingRequestLineQPos - parsingRequestLineStart);
</code></pre><p>  } else {</p>
<pre><code>  request.requestURI().setBytes(byteBuffer.array(), parsingRequestLineStart,
          end - parsingRequestLineStart);
</code></pre><p>  }
  parsingRequestLinePhase = 5;
}
if (parsingRequestLinePhase == 5) {
  // Spec says single SP but also be tolerant of multiple and/or HT
  boolean space = true;
  while (space) {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (!fill(false)) // request line parsing
          return false;
  }
  byte chr = byteBuffer.get();
  if (!(chr == Constants.SP || chr == Constants.HT)) {
      space = false;
      byteBuffer.position(byteBuffer.position() - 1);
  }
</code></pre><p>  }
  parsingRequestLineStart = byteBuffer.position();
  parsingRequestLinePhase = 6;</p>
<p>  // Mark the current buffer position
  end = 0;
}
if (parsingRequestLinePhase == 6) {
  //
  // Reading the protocol
  // Protocol is always &quot;HTTP/&quot; DIGIT &quot;.&quot; DIGIT
  //
  while (!parsingRequestLineEol) {</p>
<pre><code>  // Read new bytes if needed
  if (byteBuffer.position() &gt;= byteBuffer.limit()) {
      if (!fill(false)) // request line parsing
          return false;
  }

  int pos = byteBuffer.position();
  byte chr = byteBuffer.get();
  if (chr == Constants.CR) {
      end = pos;
  } else if (chr == Constants.LF) {
      if (end == 0) {
          end = pos;
      }
      parsingRequestLineEol = true;
  } else if (!HttpParser.isHttpProtocol(chr)) {
      throw new IllegalArgumentException(sm.getString(&quot;iib.invalidHttpProtocol&quot;));
  }
</code></pre><p>  }</p>
<p>  if ((end - parsingRequestLineStart) &gt; 0) {</p>
<pre><code>  request.protocol().setBytes(byteBuffer.array(), parsingRequestLineStart,
          end - parsingRequestLineStart);
</code></pre><p>  } else {</p>
<pre><code>  request.protocol().setString(&quot;&quot;);
</code></pre><p>  }
  parsingRequestLine = false;
  parsingRequestLinePhase = 0;
  parsingRequestLineEol = false;
  parsingRequestLineStart = 0;
  return true;
}
throw new IllegalStateException(</p>
<pre><code>  &quot;Invalid request line parse phase:&quot; + parsingRequestLinePhase);
</code></pre><p>}</p>
</li>
<li>3.1.1.3.1.2.1) Http11InputBuffer#fill&#xFF08;)</li>
</ul>
</li>
</ul>
<pre><code>
/**
 * Attempts to read some data into the input buffer.
 *
 * @return &lt;code&gt;true&lt;/code&gt; if more data was added to the input buffer
 *         otherwise &lt;code&gt;false&lt;/code&gt;
 */
private boolean fill(boolean block) throws IOException {

    if (parsingHeader) {
        if (byteBuffer.limit() &gt;= headerBufferSize) {
            throw new IllegalArgumentException(sm.getString(&quot;iib.requestheadertoolarge.error&quot;));
        }
    } else {
        byteBuffer.limit(end).position(end);
    }

    byteBuffer.mark();
    if (byteBuffer.position() &lt; byteBuffer.limit()) {
        byteBuffer.position(byteBuffer.limit());
    }
    byteBuffer.limit(byteBuffer.capacity());
    int nRead = wrapper.read(block, byteBuffer);
    byteBuffer.limit(byteBuffer.position()).reset();
    if (nRead &gt; 0) {
        return true;
    } else if (nRead == -1) {
        throw new EOFException(sm.getString(&quot;iib.eof.error&quot;));
    } else {
        return false;
    }

}
</code></pre><pre><code>- 3.1.1.3.1.2.1.1) NioEndpoint#read
</code></pre><pre><code>public int read(boolean block, ByteBuffer to) throws IOException {
    int nRead = populateReadBuffer(to);
    if (nRead &gt; 0) {
        return nRead;
        /*
         * Since more bytes may have arrived since the buffer was last
         * filled, it is an option at this point to perform a
         * non-blocking read. However correctly handling the case if
         * that read returns end of stream adds complexity. Therefore,
         * at the moment, the preference is for simplicity.
         */
    }

    // The socket read buffer capacity is socket.appReadBufSize
    int limit = socketBufferHandler.getReadBuffer().capacity();
</code></pre><ul>
<li><p>// &#x5982;&#x679C;to&#x7684;&#x5269;&#x4F59;&#x53EF;&#x7528;&#x6BD4;read buffer&#x8FD8;&#x8981;&#x5927;&#x3002;&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x4ECE;socketchannel&#x8BFB;&#x5230;to
  if (to.remaining() &gt;= limit) {</p>
<pre><code>  to.limit(to.position() + limit);
  nRead = fillReadBuffer(block, to);
  updateLastRead();
</code></pre><p>  } else {</p>
<pre><code>  // Fill the read buffer as best we can.
  nRead = fillReadBuffer(block);
  updateLastRead();

  // Fill as much of the remaining byte array as possible with the
  // data that was just read
  if (nRead &gt; 0) {
      nRead = populateReadBuffer(to);
  }
</code></pre><p>  }
  return nRead;
}</p>
<ul>
<li>3.1.1.3.1.2.1.1.1) SocketWrapperBase#populateReadBuffer&#xFF08;&#x5C06;SocketBufferHandler&#x4E2D;&#x7684;ByteBuffer&#x62F7;&#x8D1D;&#x5230;Http11InputBuffer&#x4E2D;&#x7684;ByteBuffer)</li>
</ul>
</li>
<li><p>protected int populateReadBuffer(ByteBuffer to) {
  // Is there enough data in the read buffer to satisfy this request?
  // Copy what data there is in the read buffer to the byte array
  socketBufferHandler.configureReadBufferForRead();
  int nRead = transfer(socketBufferHandler.getReadBuffer(), to);</p>
<p>  if (log.isDebugEnabled()) {</p>
<pre><code>  log.debug(&quot;Socket: [&quot; + this + &quot;], Read from buffer: [&quot; + nRead + &quot;]&quot;);
</code></pre><p>  }
  return nRead;
}</p>
</li>
</ul>
<ul>
<li><p>protected static int transfer(ByteBuffer from, ByteBuffer to) {
  int max = Math.min(from.remaining(), to.remaining());
  if (max &gt; 0) {</p>
<pre><code>  int fromLimit = from.limit();
  from.limit(from.position() + max);
  to.put(from);
  from.limit(fromLimit);
</code></pre><p>  }
  return max;
}</p>
<ul>
<li>3.1.1.3.1.2.1.1.2) NioEndpoint#fillReadBuffer&#xFF08;&#x4ECE;channel&#x6216;&#x8005;selectorPool&#x4E2D;&#x8BFB;&#x5230;ByteBuffer&#x4E2D;)</li>
</ul>
</li>
</ul>
<pre><code>private int fillReadBuffer(boolean block, ByteBuffer to) throws IOException {
    int nRead;
    NioChannel channel = getSocket();
    if (block) {
        Selector selector = null;
        try {
            selector = pool.get();
        } catch (IOException x) {
            // Ignore
        }
        try {
            NioEndpoint.NioSocketWrapper att = (NioEndpoint.NioSocketWrapper) channel
                    .getAttachment();
            if (att == null) {
                throw new IOException(&quot;Key must be cancelled.&quot;);
            }
            nRead = pool.read(to, channel, selector, att.getReadTimeout());
        } finally {
            if (selector != null) {
                pool.put(selector);
            }
        }
    } else {
        nRead = channel.read(to);
        if (nRead == -1) {
            throw new EOFException();
        }
    }
    return nRead;
}
</code></pre><pre><code>- 3.1.1.3.1.3) Http11inputBuffer#parseHeaders&#xFF08;&#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x5934;)
</code></pre><ul>
<li><p>&#x8BFB;&#x53D6;byteBuffer&#xFF0C;&#x89E3;&#x6790;&#xFF0C;&#x5C06;&#x7ED3;&#x679C;&#x5B58;&#x5165;Request</p>
<ul>
<li>3.1.1.3.1.4) prepareRequest&#xFF08;&#x5C01;&#x88C5;InputFilter)</li>
</ul>
</li>
</ul>
<pre><code>private void prepareRequest() {

    http11 = true;
    http09 = false;
    contentDelimitation = false;

    if (protocol.isSSLEnabled()) {
        request.scheme().setString(&quot;https&quot;);
    }
    MessageBytes protocolMB = request.protocol();
    if (protocolMB.equals(Constants.HTTP_11)) {
        http11 = true;
        protocolMB.setString(Constants.HTTP_11);
    } else if (protocolMB.equals(Constants.HTTP_10)) {
        http11 = false;
        keepAlive = false;
        protocolMB.setString(Constants.HTTP_10);
    } else if (protocolMB.equals(&quot;&quot;)) {
        // HTTP/0.9
        http09 = true;
        http11 = false;
        keepAlive = false;
    } else {
        // Unsupported protocol
        http11 = false;
        // Send 505; Unsupported HTTP version
        response.setStatus(505);
        setErrorState(ErrorState.CLOSE_CLEAN, null);
        if (log.isDebugEnabled()) {
            log.debug(sm.getString(&quot;http11processor.request.prepare&quot;)+
                      &quot; Unsupported HTTP version \&quot;&quot;+protocolMB+&quot;\&quot;&quot;);
        }
    }

    MimeHeaders headers = request.getMimeHeaders();

    // Check connection header
    MessageBytes connectionValueMB = headers.getValue(Constants.CONNECTION);
    if (connectionValueMB != null) {
        ByteChunk connectionValueBC = connectionValueMB.getByteChunk();
        if (findBytes(connectionValueBC, Constants.CLOSE_BYTES) != -1) {
            keepAlive = false;
        } else if (findBytes(connectionValueBC,
                             Constants.KEEPALIVE_BYTES) != -1) {
            keepAlive = true;
        }
    }

    if (http11) {
        MessageBytes expectMB = headers.getValue(&quot;expect&quot;);
        if (expectMB != null) {
            if (expectMB.indexOfIgnoreCase(&quot;100-continue&quot;, 0) != -1) {
                inputBuffer.setSwallowInput(false);
                request.setExpectation(true);
            } else {
                response.setStatus(HttpServletResponse.SC_EXPECTATION_FAILED);
                setErrorState(ErrorState.CLOSE_CLEAN, null);
            }
        }
    }

    // Check user-agent header
    Pattern restrictedUserAgents = protocol.getRestrictedUserAgentsPattern();
    if (restrictedUserAgents != null &amp;&amp; (http11 || keepAlive)) {
        MessageBytes userAgentValueMB = headers.getValue(&quot;user-agent&quot;);
        // Check in the restricted list, and adjust the http11
        // and keepAlive flags accordingly
        if(userAgentValueMB != null) {
            String userAgentValue = userAgentValueMB.toString();
            if (restrictedUserAgents.matcher(userAgentValue).matches()) {
                http11 = false;
                keepAlive = false;
            }
        }
    }


    // Check host header
    MessageBytes hostValueMB = null;
    try {
        hostValueMB = headers.getUniqueValue(&quot;host&quot;);
    } catch (IllegalArgumentException iae) {
        // Multiple Host headers are not permitted
        // 400 - Bad request
        response.setStatus(400);
        setErrorState(ErrorState.CLOSE_CLEAN, null);
        if (log.isDebugEnabled()) {
            log.debug(sm.getString(&quot;http11processor.request.multipleHosts&quot;));
        }
    }
    if (http11 &amp;&amp; hostValueMB == null) {
        // 400 - Bad request
        response.setStatus(400);
        setErrorState(ErrorState.CLOSE_CLEAN, null);
        if (log.isDebugEnabled()) {
            log.debug(sm.getString(&quot;http11processor.request.prepare&quot;)+
                      &quot; host header missing&quot;);
        }
    }

    // Check for a full URI (including protocol://host:port/)
    ByteChunk uriBC = request.requestURI().getByteChunk();
    if (uriBC.startsWithIgnoreCase(&quot;http&quot;, 0)) {

        int pos = uriBC.indexOf(&quot;://&quot;, 0, 3, 4);
        int uriBCStart = uriBC.getStart();
        int slashPos = -1;
        if (pos != -1) {
            pos += 3;
            byte[] uriB = uriBC.getBytes();
            slashPos = uriBC.indexOf(&apos;/&apos;, pos);
            int atPos = uriBC.indexOf(&apos;@&apos;, pos);
            if (slashPos == -1) {
                slashPos = uriBC.getLength();
                // Set URI as &quot;/&quot;
                request.requestURI().setBytes
                    (uriB, uriBCStart + pos - 2, 1);
            } else {
                request.requestURI().setBytes
                    (uriB, uriBCStart + slashPos,
                     uriBC.getLength() - slashPos);
            }
            // Skip any user info
            if (atPos != -1) {
                pos = atPos + 1;
            }
            if (http11) {
                // Missing host header is illegal but handled above
                if (hostValueMB != null) {
                    // Any host in the request line must be consistent with
                    // the Host header
                    if (!hostValueMB.getByteChunk().equals(
                            uriB, uriBCStart + pos, slashPos - pos)) {
                        if (protocol.getAllowHostHeaderMismatch()) {
                            // The requirements of RFC 2616 are being
                            // applied. If the host header and the request
                            // line do not agree, the request line takes
                            // precedence
                            hostValueMB = headers.setValue(&quot;host&quot;);
                            hostValueMB.setBytes(uriB, uriBCStart + pos, slashPos - pos);
                        } else {
                            // The requirements of RFC 7230 are being
                            // applied. If the host header and the request
                            // line do not agree, trigger a 400 response.
                            response.setStatus(400);
                            setErrorState(ErrorState.CLOSE_CLEAN, null);
                            if (log.isDebugEnabled()) {
                                log.debug(sm.getString(&quot;http11processor.request.inconsistentHosts&quot;));
                            }
                        }
                    }
                }
            } else {
                // Not HTTP/1.1 - no Host header so generate one since
                // Tomcat internals assume it is set
                hostValueMB = headers.setValue(&quot;host&quot;);
                hostValueMB.setBytes(uriB, uriBCStart + pos, slashPos - pos);
            }
        }
    }

    // Input filter setup
    InputFilter[] inputFilters = inputBuffer.getFilters();

    // Parse transfer-encoding header
    if (http11) {
        MessageBytes transferEncodingValueMB = headers.getValue(&quot;transfer-encoding&quot;);
        if (transferEncodingValueMB != null) {
            String transferEncodingValue = transferEncodingValueMB.toString();
            // Parse the comma separated list. &quot;identity&quot; codings are ignored
            int startPos = 0;
            int commaPos = transferEncodingValue.indexOf(&apos;,&apos;);
            String encodingName = null;
            while (commaPos != -1) {
                encodingName = transferEncodingValue.substring(startPos, commaPos);
                addInputFilter(inputFilters, encodingName);
                startPos = commaPos + 1;
                commaPos = transferEncodingValue.indexOf(&apos;,&apos;, startPos);
            }
            encodingName = transferEncodingValue.substring(startPos);
            addInputFilter(inputFilters, encodingName);
        }
    }

    // Parse content-length header
    long contentLength = request.getContentLengthLong();
    if (contentLength &gt;= 0) {
        if (contentDelimitation) {
            // contentDelimitation being true at this point indicates that
            // chunked encoding is being used but chunked encoding should
            // not be used with a content length. RFC 2616, section 4.4,
            // bullet 3 states Content-Length must be ignored in this case -
            // so remove it.
            headers.removeHeader(&quot;content-length&quot;);
            request.setContentLength(-1);
        } else {
            inputBuffer.addActiveFilter
                    (inputFilters[Constants.IDENTITY_FILTER]);
            contentDelimitation = true;
        }
    }

    parseHost(hostValueMB);

    if (!contentDelimitation) {
        // If there&apos;s no content length
        // (broken HTTP/1.0 or HTTP/1.1), assume
        // the client is not broken and didn&apos;t send a body
        inputBuffer.addActiveFilter
                (inputFilters[Constants.VOID_FILTER]);
        contentDelimitation = true;
    }

    if (getErrorState().isError()) {
        getAdapter().log(request, response, 0);
    }
}
</code></pre><pre><code>- 3.1.1.3.1.4)&#xFF08;service&#x9AA8;&#x67B6;) CoyoteAdapter#service&#xFF08;&#x5C06;coyote&#x7684;req&#x548C;resp&#x8F6C;&#x4E3A;catalina&#x7684;req&#x548C;resp)
</code></pre><pre><code>public void service(org.apache.coyote.Request req, org.apache.coyote.Response res)
        throws Exception {

    Request request = (Request) req.getNote(ADAPTER_NOTES);
    Response response = (Response) res.getNote(ADAPTER_NOTES);

    if (request == null) {
        // Create objects
        request = connector.createRequest();
        request.setCoyoteRequest(req);
        response = connector.createResponse();
        response.setCoyoteResponse(res);

        // Link objects
        request.setResponse(response);
        response.setRequest(request);

        // Set as notes
        req.setNote(ADAPTER_NOTES, request);
        res.setNote(ADAPTER_NOTES, response);

        // Set query string encoding
        req.getParameters().setQueryStringCharset(connector.getURICharset());
    }

    if (connector.getXpoweredBy()) {
        response.addHeader(&quot;X-Powered-By&quot;, POWERED_BY);
    }

    boolean async = false;
    boolean postParseSuccess = false;

    req.getRequestProcessor().setWorkerThreadName(THREAD_NAME.get());

    try {
        // Parse and set Catalina and configuration specific
        // request parameters
        postParseSuccess = postParseRequest(req, request, res, response);
        if (postParseSuccess) {
            //check valves if we support async
            request.setAsyncSupported(
                    connector.getService().getContainer().getPipeline().isAsyncSupported());
            // Calling the container
        // &#x52A0;&#x5165;&#x5230;pipeline&#x4E2D;&#x8FDB;&#x884C;&#x8C03;&#x7528;  connector.getService().getContainer().getPipeline().getFirst().invoke(
                    request, response);
        }
        if (request.isAsync()) {
            async = true;
            ReadListener readListener = req.getReadListener();
            if (readListener != null &amp;&amp; request.isFinished()) {
                // Possible the all data may have been read during service()
                // method so this needs to be checked here
                ClassLoader oldCL = null;
                try {
                    oldCL = request.getContext().bind(false, null);
                    if (req.sendAllDataReadEvent()) {
                        req.getReadListener().onAllDataRead();
                    }
                } finally {
                    request.getContext().unbind(false, oldCL);
                }
            }

            Throwable throwable =
                    (Throwable) request.getAttribute(RequestDispatcher.ERROR_EXCEPTION);

            // If an async request was started, is not going to end once
            // this container thread finishes and an error occurred, trigger
            // the async error process
            if (!request.isAsyncCompleting() &amp;&amp; throwable != null) {
                request.getAsyncContextInternal().setErrorState(throwable, true);
            }
        } else {
            request.finishRequest();
            response.finishResponse();
        }

    } catch (IOException e) {
        // Ignore
    } finally {
        AtomicBoolean error = new AtomicBoolean(false);
        res.action(ActionCode.IS_ERROR, error);

        if (request.isAsyncCompleting() &amp;&amp; error.get()) {
            // Connection will be forcibly closed which will prevent
            // completion happening at the usual point. Need to trigger
            // call to onComplete() here.
            res.action(ActionCode.ASYNC_POST_PROCESS,  null);
            async = false;
        }

        // Access log
        if (!async &amp;&amp; postParseSuccess) {
            // Log only if processing was invoked.
            // If postParseRequest() failed, it has already logged it.
            Context context = request.getContext();
            // If the context is null, it is likely that the endpoint was
            // shutdown, this connection closed and the request recycled in
            // a different thread. That thread will have updated the access
            // log so it is OK not to update the access log here in that
            // case.
            if (context != null) {
                context.logAccess(request, response,
                        System.currentTimeMillis() - req.getStartTime(), false);
            }
        }

        req.getRequestProcessor().setWorkerThreadName(null);

        // Recycle the wrapper request and response
        if (!async) {
            request.recycle();
            response.recycle();
        }
    }
}
</code></pre><pre><code>- 3.1.1.3.1.4.1)&#xFF08;Mapper#map) CoyoteAdapter#postParseRequest&#xFF08;req&#x548C;resp&#x7684;&#x8F6C;&#x6362;)
</code></pre><ul>
<li>postParseRequest() &#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x4E00;&#x4E0B; Request&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x4E00;&#x4E0B;&#x6620;&#x5C04;&#x5173;&#x7CFB;(&#x4ECE; URL &#x6620;&#x5C04;&#x5230;&#x76F8;&#x5E94;&#x7684; Host&#x3001;Context&#x3001;Wrapper)&#x3002;</li>
<li>CoyoteAdapter &#x5C06; Rquest &#x63D0;&#x4EA4;&#x7ED9; Container &#x5904;&#x7406;&#x4E4B;&#x524D;&#xFF0C;&#x5E76;&#x5C06; org.apache.coyote.Request &#x5C01;&#x88C5;&#x5230; org.apache.catalina.connector.Request&#xFF0C;&#x4F20;&#x9012;&#x7ED9; Container &#x5904;&#x7406;&#x7684; Request &#x662F; org.apache.catalina.connector.Request&#x3002;</li>
<li>connector.getService().getMapper().map()&#xFF0C;&#x7528;&#x6765;&#x5728; Mapper &#x4E2D;&#x67E5;&#x8BE2; URL &#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x4F1A;&#x4FDD;&#x7559;&#x5230; org.apache.catalina.connector.Request &#x4E2D;&#xFF0C;Container &#x5904;&#x7406;&#x9636;&#x6BB5; request.getHost() &#x662F;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x9636;&#x6BB5;&#x67E5;&#x8BE2;&#x5230;&#x7684;&#x6620;&#x5C04;&#x4E3B;&#x673A;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8; request.getContext()&#x3001;request.getWrapper() &#x90FD;&#x662F;&#x3002;</li>
</ul>
<pre><code>protected boolean postParseRequest(org.apache.coyote.Request req, Request request,
        org.apache.coyote.Response res, Response response) throws IOException, ServletException {

    // If the processor has set the scheme (AJP does this, HTTP does this if
    // SSL is enabled) use this to set the secure flag as well. If the
    // processor hasn&apos;t set it, use the settings from the connector
    if (req.scheme().isNull()) {
        // Use connector scheme and secure configuration, (defaults to
        // &quot;http&quot; and false respectively)
        req.scheme().setString(connector.getScheme());
        request.setSecure(connector.getSecure());
    } else {
        // Use processor specified scheme to determine secure state
        request.setSecure(req.scheme().equals(&quot;https&quot;));
    }

    // At this point the Host header has been processed.
    // Override if the proxyPort/proxyHost are set
    String proxyName = connector.getProxyName();
    int proxyPort = connector.getProxyPort();
    if (proxyPort != 0) {
        req.setServerPort(proxyPort);
    } else if (req.getServerPort() == -1) {
        // Not explicitly set. Use default ports based on the scheme
        if (req.scheme().equals(&quot;https&quot;)) {
            req.setServerPort(443);
        } else {
            req.setServerPort(80);
        }
    }
    if (proxyName != null) {
        req.serverName().setString(proxyName);
    }

    MessageBytes undecodedURI = req.requestURI();

    // Check for ping OPTIONS * request
    if (undecodedURI.equals(&quot;*&quot;)) {
        if (req.method().equalsIgnoreCase(&quot;OPTIONS&quot;)) {
            StringBuilder allow = new StringBuilder();
            allow.append(&quot;GET, HEAD, POST, PUT, DELETE, OPTIONS&quot;);
            // Trace if allowed
            if (connector.getAllowTrace()) {
                allow.append(&quot;, TRACE&quot;);
            }
            // Always allow options
            res.setHeader(&quot;Allow&quot;, allow.toString());
            // Access log entry as processing won&apos;t reach AccessLogValve
            connector.getService().getContainer().logAccess(request, response, 0, true);
            return false;
        } else {
            response.sendError(400, &quot;Invalid URI&quot;);
        }
    }

    MessageBytes decodedURI = req.decodedURI();

    if (undecodedURI.getType() == MessageBytes.T_BYTES) {
        // Copy the raw URI to the decodedURI
        decodedURI.duplicate(undecodedURI);

        // Parse the path parameters. This will:
        //   - strip out the path parameters
        //   - convert the decodedURI to bytes
        parsePathParameters(req, request);

        // URI decoding
        // %xx decoding of the URL
        try {
            req.getURLDecoder().convert(decodedURI, false);
        } catch (IOException ioe) {
            response.sendError(400, &quot;Invalid URI: &quot; + ioe.getMessage());
        }
        // Normalization
        if (!normalize(req.decodedURI())) {
            response.sendError(400, &quot;Invalid URI&quot;);
        }
        // Character decoding
        convertURI(decodedURI, request);
        // Check that the URI is still normalized
        if (!checkNormalize(req.decodedURI())) {
            response.sendError(400, &quot;Invalid URI&quot;);
        }
    } else {
        /* The URI is chars or String, and has been sent using an in-memory
         * protocol handler. The following assumptions are made:
         * - req.requestURI() has been set to the &apos;original&apos; non-decoded,
         *   non-normalized URI
         * - req.decodedURI() has been set to the decoded, normalized form
         *   of req.requestURI()
         */
        decodedURI.toChars();
        // Remove all path parameters; any needed path parameter should be set
        // using the request object rather than passing it in the URL
        CharChunk uriCC = decodedURI.getCharChunk();
        int semicolon = uriCC.indexOf(&apos;;&apos;);
        if (semicolon &gt; 0) {
            decodedURI.setChars(uriCC.getBuffer(), uriCC.getStart(), semicolon);
        }
    }

    // Request mapping.
    MessageBytes serverName;
    if (connector.getUseIPVHosts()) {
        serverName = req.localName();
        if (serverName.isNull()) {
            // well, they did ask for it
            res.action(ActionCode.REQ_LOCAL_NAME_ATTRIBUTE, null);
        }
    } else {
        serverName = req.serverName();
    }

    // Version for the second mapping loop and
    // Context that we expect to get for that version
    String version = null;
    Context versionContext = null;
    boolean mapRequired = true;

    if (response.isError()) {
        // An error this early means the URI is invalid. Ensure invalid data
        // is not passed to the mapper. Note we still want the mapper to
        // find the correct host.
        decodedURI.recycle();
    }

    while (mapRequired) {
</code></pre><pre><code>- // &#x4F7F;&#x7528;Mapper&#x5C06;&#x5F53;&#x524D;request&#x6620;&#x5C04;&#x5230;Host&#x3001;Context&#x3001;Wrapper
    // This will map the the latest version by default
    connector.getService().getMapper().map(serverName, decodedURI,
            version, request.getMappingData());

    // If there is no context at this point, either this is a 404
    // because no ROOT context has been deployed or the URI was invalid
    // so no context could be mapped.
    if (request.getContext() == null) {
        // Don&apos;t overwrite an existing error
        if (!response.isError()) {
            response.sendError(404, &quot;Not found&quot;);
        }
        // Allow processing to continue.
        // If present, the error reporting valve will provide a response
        // body.
        return true;
    }

    // Now we have the context, we can parse the session ID from the URL
    // (if any). Need to do this before we redirect in case we need to
    // include the session id in the redirect
    String sessionID;
    if (request.getServletContext().getEffectiveSessionTrackingModes()
            .contains(SessionTrackingMode.URL)) {

        // Get the session ID if there was one
        sessionID = request.getPathParameter(
                SessionConfig.getSessionUriParamName(
                        request.getContext()));
        if (sessionID != null) {
            request.setRequestedSessionId(sessionID);
            request.setRequestedSessionURL(true);
        }
    }

    // Look for session ID in cookies and SSL session
    parseSessionCookiesId(request);
    parseSessionSslId(request);

    sessionID = request.getRequestedSessionId();

    mapRequired = false;
    if (version != null &amp;&amp; request.getContext() == versionContext) {
        // We got the version that we asked for. That is it.
    } else {
        version = null;
        versionContext = null;

        Context[] contexts = request.getMappingData().contexts;
        // Single contextVersion means no need to remap
        // No session ID means no possibility of remap
        if (contexts != null &amp;&amp; sessionID != null) {
            // Find the context associated with the session
            for (int i = contexts.length; i &gt; 0; i--) {
                Context ctxt = contexts[i - 1];
                if (ctxt.getManager().findSession(sessionID) != null) {
                    // We found a context. Is it the one that has
                    // already been mapped?
                    if (!ctxt.equals(request.getMappingData().context)) {
                        // Set version so second time through mapping
                        // the correct context is found
                        version = ctxt.getWebappVersion();
                        versionContext = ctxt;
                        // Reset mapping
                        request.getMappingData().recycle();
                        mapRequired = true;
                        // Recycle cookies and session info in case the
                        // correct context is configured with different
                        // settings
                        request.recycleSessionInfo();
                        request.recycleCookieInfo(true);
                    }
                    break;
                }
            }
        }
    }

    if (!mapRequired &amp;&amp; request.getContext().getPaused()) {
        // Found a matching context but it is paused. Mapping data will
        // be wrong since some Wrappers may not be registered at this
        // point.
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            // Should never happen
        }
        // Reset mapping
        request.getMappingData().recycle();
        mapRequired = true;
    }
}

// Possible redirect
MessageBytes redirectPathMB = request.getMappingData().redirectPath;
if (!redirectPathMB.isNull()) {
    String redirectPath = URLEncoder.DEFAULT.encode(
            redirectPathMB.toString(), StandardCharsets.UTF_8);
    String query = request.getQueryString();
    if (request.isRequestedSessionIdFromURL()) {
        // This is not optimal, but as this is not very common, it
        // shouldn&apos;t matter
        redirectPath = redirectPath + &quot;;&quot; +
                SessionConfig.getSessionUriParamName(
                    request.getContext()) +
            &quot;=&quot; + request.getRequestedSessionId();
    }
    if (query != null) {
        // This is not optimal, but as this is not very common, it
        // shouldn&apos;t matter
        redirectPath = redirectPath + &quot;?&quot; + query;
    }
    response.sendRedirect(redirectPath);
    request.getContext().logAccess(request, response, 0, true);
    return false;
}

// Filter trace method
if (!connector.getAllowTrace()
        &amp;&amp; req.method().equalsIgnoreCase(&quot;TRACE&quot;)) {
    Wrapper wrapper = request.getWrapper();
    String header = null;
    if (wrapper != null) {
        String[] methods = wrapper.getServletMethods();
        if (methods != null) {
            for (int i=0; i&lt;methods.length; i++) {
                if (&quot;TRACE&quot;.equals(methods[i])) {
                    continue;
                }
                if (header == null) {
                    header = methods[i];
                } else {
                    header += &quot;, &quot; + methods[i];
                }
            }
        }
    }
    res.addHeader(&quot;Allow&quot;, header);
    response.sendError(405, &quot;TRACE method is not allowed&quot;);
    // Safe to skip the remainder of this method.
    return true;
}

doConnectorAuthenticationAuthorization(req, request);

return true;
</code></pre><p>}</p>
<pre><code>- 3.1.1.3.1.4.2) &#xFF08;-&gt;4))Valve#invoke
</code></pre><pre><code>public void invoke(Request request, Response response)
    throws IOException, ServletException;
</code></pre><ul>
<li><p>connector.getService().getContainer().getPipeline().getFirst().invoke() &#x4F1A;&#x5C06;&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x5230; Container &#x5904;&#x7406;&#xFF0C;&#x5F53;&#x7136;&#x4E86; Container &#x5904;&#x7406;&#x4E5F;&#x662F;&#x5728; Worker &#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x6240;&#x4EE5;&#x5355;&#x72EC;&#x5206;&#x51FA;&#x6765;&#x4E00;&#x8282;&#x3002;</p>
</li>
<li><p>&#x7B2C;&#x4E00;&#x4E2A;Container#Valve&#x662F;StandardEngineValve&#x3002;</p>
</li>
<li>&#x6309;&#x7167;&#x8FD9;&#x6837;&#x7684;&#x987A;&#x5E8F;&#xFF1A;engine-&gt;host-&gt;context-&gt;wrapper&#x3002;<ul>
<li>3.1.1.3.1.4.3) Request#finishRequest&#xFF08;&#x975E;&#x5F02;&#x6B65;Servlet&#x88AB;&#x8C03;&#x7528;)</li>
</ul>
</li>
</ul>
<pre><code>public void finishRequest() throws IOException {
    if (response.getStatus() == HttpServletResponse.SC_REQUEST_ENTITY_TOO_LARGE) {
        checkSwallowInput();
    }
}
</code></pre><pre><code>- 3.1.1.3.1.4.4) Response#finishResponse&#xFF08;&#x975E;&#x5F02;&#x6B65;Servlet&#x88AB;&#x8C03;&#x7528;)
</code></pre><pre><code>public void finishResponse() throws IOException {
    // Writing leftover bytes
    outputBuffer.close();
}
</code></pre><pre><code>- 3.1.1.3.1.4.5) Request#recycle&#xFF08;&#x975E;&#x5F02;&#x6B65;Servlet&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#xFF0C;&#x5F85;&#x88AB;&#x590D;&#x7528;)
</code></pre><pre><code>/**
 * Release all object references, and initialize instance variables, in
 * preparation for reuse of this object.
 */
public void recycle() {

    internalDispatcherType = null;
    requestDispatcherPath = null;

    authType = null;
    inputBuffer.recycle();
    usingInputStream = false;
    usingReader = false;
    userPrincipal = null;
    subject = null;
    parametersParsed = false;
    if (parts != null) {
        for (Part part: parts) {
            try {
                part.delete();
            } catch (IOException ignored) {
                // ApplicationPart.delete() never throws an IOEx
            }
        }
        parts = null;
    }
    partsParseException = null;
    locales.clear();
    localesParsed = false;
    secure = false;
    remoteAddr = null;
    remoteHost = null;
    remotePort = -1;
    localPort = -1;
    localAddr = null;
    localName = null;

    attributes.clear();
    sslAttributesParsed = false;
    notes.clear();

    recycleSessionInfo();
    recycleCookieInfo(false);

    if (Globals.IS_SECURITY_ENABLED || Connector.RECYCLE_FACADES) {
        parameterMap = new ParameterMap&lt;&gt;();
    } else {
        parameterMap.setLocked(false);
        parameterMap.clear();
    }

    mappingData.recycle();
    applicationMapping.recycle();

    applicationRequest = null;
    if (Globals.IS_SECURITY_ENABLED || Connector.RECYCLE_FACADES) {
        if (facade != null) {
            facade.clear();
            facade = null;
        }
        if (inputStream != null) {
            inputStream.clear();
            inputStream = null;
        }
        if (reader != null) {
            reader.clear();
            reader = null;
        }
    }

    asyncSupported = null;
    if (asyncContext!=null) {
        asyncContext.recycle();
    }
    asyncContext = null;
}
</code></pre><pre><code>- 3.1.1.3.1.4.6) Response#recycle&#xFF08;&#x975E;&#x5F02;&#x6B65;Servlet&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#xFF0C;&#x5F85;&#x88AB;&#x590D;&#x7528;)
</code></pre><pre><code>/**
 * Release all object references, and initialize instance variables, in
 * preparation for reuse of this object.
 */
public void recycle() {

    cookies.clear();
    outputBuffer.recycle();
    usingOutputStream = false;
    usingWriter = false;
    appCommitted = false;
    included = false;
    isCharacterEncodingSet = false;

    applicationResponse = null;
    if (Globals.IS_SECURITY_ENABLED || Connector.RECYCLE_FACADES) {
        if (facade != null) {
            facade.clear();
            facade = null;
        }
        if (outputStream != null) {
            outputStream.clear();
            outputStream = null;
        }
        if (writer != null) {
            writer.clear();
            writer = null;
        }
    } else if (writer != null) {
        writer.recycle();
    }

}
</code></pre><pre><code>- 3.1.1.3.1.5) endRequest&#xFF08;&#x975E;&#x5F02;&#x6B65;Servlet&#x88AB;&#x8C03;&#x7528;)
</code></pre><pre><code>/*
 * No more input will be passed to the application. Remaining input will be
 * swallowed or the connection dropped depending on the error and
 * expectation status.
 */
private void endRequest() {
    if (getErrorState().isError()) {
        // If we know we are closing the connection, don&apos;t drain
        // input. This way uploading a 100GB file doesn&apos;t tie up the
        // thread if the servlet has rejected it.
        inputBuffer.setSwallowInput(false);
    } else {
        // Need to check this again here in case the response was
        // committed before the error that requires the connection
        // to be closed occurred.
        checkExpectationAndResponseStatus();
    }

    // Finish the handling of the request
    if (getErrorState().isIoAllowed()) {
        try {
            inputBuffer.endRequest();
        } catch (IOException e) {
            setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
        } catch (Throwable t) {
            ExceptionUtils.handleThrowable(t);
            // 500 - Internal Server Error
            // Can&apos;t add a 500 to the access log since that has already been
            // written in the Adapter.service method.
            response.setStatus(500);
            setErrorState(ErrorState.CLOSE_NOW, t);
            log.error(sm.getString(&quot;http11processor.request.finish&quot;), t);
        }
    }
    if (getErrorState().isIoAllowed()) {
        try {
            action(ActionCode.COMMIT, null);
            outputBuffer.end();
        } catch (IOException e) {
            setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
        } catch (Throwable t) {
            ExceptionUtils.handleThrowable(t);
            setErrorState(ErrorState.CLOSE_NOW, t);
            log.error(sm.getString(&quot;http11processor.response.finish&quot;), t);
        }
    }
}
</code></pre><pre><code>- 3.1.1.3.1.5.1) Http11InputBuffer#endRequest
- void endRequest() throws IOException {

if (swallowInput &amp;&amp; (lastActiveFilter != -1)) {
    int extraBytes = (int) activeFilters[lastActiveFilter].end();
    byteBuffer.position(byteBuffer.position() - extraBytes);
}
</code></pre><p>}</p>
<pre><code>- 3.1.1.3.1.5.2) AbstractProcessor#action(COMMIT)
</code></pre><ul>
<li><p>case COMMIT: {
  if (!response.isCommitted()) {</p>
<pre><code>  try {
      // Validate and write response headers
      prepareResponse();
  } catch (IOException e) {
      setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
  }
</code></pre><p>  }
  break;
}</p>
</li>
<li><p>Http11Processor#prepareResponse</p>
<ul>
<li><p>protected final void prepareResponse() throws IOException {</p>
<p>boolean entityBody = true;
contentDelimitation = false;</p>
<p>OutputFilter[] outputFilters = outputBuffer.getFilters();</p>
<p>if (http09 == true) {
  // HTTP/0.9
  outputBuffer.addActiveFilter(outputFilters[Constants.IDENTITY_FILTER]);
  outputBuffer.commit();
  return;
}</p>
<p>int statusCode = response.getStatus();
if (statusCode &lt; 200 || statusCode == 204 || statusCode == 205 ||</p>
<pre><code>  statusCode == 304) {
</code></pre><p>  // No entity body
  outputBuffer.addActiveFilter</p>
<pre><code>  (outputFilters[Constants.VOID_FILTER]);
</code></pre><p>  entityBody = false;
  contentDelimitation = true;
  if (statusCode == 205) {</p>
<pre><code>  // RFC 7231 requires the server to explicitly signal an empty
  // response in this case
  response.setContentLength(0);
</code></pre><p>  } else {</p>
<pre><code>  response.setContentLength(-1);
</code></pre><p>  }
}</p>
<p>MessageBytes methodMB = request.method();
if (methodMB.equals(&quot;HEAD&quot;)) {
  // No entity body
  outputBuffer.addActiveFilter</p>
<pre><code>  (outputFilters[Constants.VOID_FILTER]);
</code></pre><p>  contentDelimitation = true;
}</p>
<p>// Sendfile support
if (protocol.getUseSendfile()) {
  prepareSendfile(outputFilters);
}</p>
<p>// Check for compression</p>
<p>boolean useCompression = false;
if (entityBody &amp;&amp; sendfileData == null) {
  useCompression = protocol.useCompression(request, response);
}</p>
<p>MimeHeaders headers = response.getMimeHeaders();
// A SC_NO_CONTENT response may include entity headers
if (entityBody || statusCode == HttpServletResponse.SC_NO_CONTENT) {
  String contentType = response.getContentType();
  if (contentType != null) {</p>
<pre><code>  headers.setValue(&quot;Content-Type&quot;).setString(contentType);
</code></pre><p>  }
  String contentLanguage = response.getContentLanguage();
  if (contentLanguage != null) {</p>
<pre><code>  headers.setValue(&quot;Content-Language&quot;)
      .setString(contentLanguage);
</code></pre><p>  }
}</p>
<p>long contentLength = response.getContentLengthLong();
boolean connectionClosePresent = false;
if (http11 &amp;&amp; response.getTrailerFields() != null) {
  // If trailer fields are set, always use chunking
  outputBuffer.addActiveFilter(outputFilters[Constants.CHUNKED_FILTER]);
  contentDelimitation = true;
  headers.addValue(Constants.TRANSFERENCODING).setString(Constants.CHUNKED);
} else if (contentLength != -1) {
  headers.setValue(&quot;Content-Length&quot;).setLong(contentLength);
  outputBuffer.addActiveFilter(outputFilters[Constants.IDENTITY_FILTER]);
  contentDelimitation = true;
} else {
  // If the response code supports an entity body and we&apos;re on
  // HTTP 1.1 then we chunk unless we have a Connection: close header
  connectionClosePresent = isConnectionClose(headers);
  if (http11 &amp;&amp; entityBody &amp;&amp; !connectionClosePresent) {</p>
<pre><code>  outputBuffer.addActiveFilter(outputFilters[Constants.CHUNKED_FILTER]);
  contentDelimitation = true;
  headers.addValue(Constants.TRANSFERENCODING).setString(Constants.CHUNKED);
</code></pre><p>  } else {</p>
<pre><code>  outputBuffer.addActiveFilter(outputFilters[Constants.IDENTITY_FILTER]);
</code></pre><p>  }
}</p>
<p>if (useCompression) {
  outputBuffer.addActiveFilter(outputFilters[Constants.GZIP_FILTER]);
}</p>
<p>// Add date header unless application has already set one (e.g. in a
// Caching Filter)
if (headers.getValue(&quot;Date&quot;) == null) {
  headers.addValue(&quot;Date&quot;).setString(</p>
<pre><code>      FastHttpDateFormat.getCurrentDate());
</code></pre><p>}</p>
<p>// FIXME: Add transfer encoding header</p>
<p>if ((entityBody) &amp;&amp; (!contentDelimitation)) {
  // Mark as close the connection after the request, and add the
  // connection: close header
  keepAlive = false;
}</p>
<p>// This may disabled keep-alive to check before working out the
// Connection header.
checkExpectationAndResponseStatus();</p>
<p>// If we know that the request is bad this early, add the
// Connection: close header.
if (keepAlive &amp;&amp; statusDropsConnection(statusCode)) {
  keepAlive = false;
}
if (!keepAlive) {
  // Avoid adding the close header twice
  if (!connectionClosePresent) {</p>
<pre><code>  headers.addValue(Constants.CONNECTION).setString(
          Constants.CLOSE);
</code></pre><p>  }
} else if (!http11 &amp;&amp; !getErrorState().isError()) {
  headers.addValue(Constants.CONNECTION).setString(Constants.KEEPALIVE);
}</p>
<p>// Add server header
String server = protocol.getServer();
if (server == null) {
  if (protocol.getServerRemoveAppProvidedValues()) {</p>
<pre><code>  headers.removeHeader(&quot;server&quot;);
</code></pre><p>  }
} else {
  // server always overrides anything the app might set
  headers.setValue(&quot;Server&quot;).setString(server);
}</p>
<p>// Build the response header
try {
  outputBuffer.sendStatus();</p>
<p>  int size = headers.size();
  for (int i = 0; i &lt; size; i++) {</p>
<pre><code>  outputBuffer.sendHeader(headers.getName(i), headers.getValue(i));
</code></pre><p>  }
  outputBuffer.endHeaders();
} catch (Throwable t) {
  ExceptionUtils.handleThrowable(t);
  // If something goes wrong, reset the header buffer so the error
  // response can be written instead.
  outputBuffer.resetHeaderBuffer();
  throw t;
}</p>
<p>outputBuffer.commit();
}</p>
</li>
</ul>
</li>
<li><p>Http11OutputBuffer#commit</p>
</li>
<li><p>protected void commit() throws IOException {
  response.setCommitted(true);</p>
<p>  if (headerBuffer.position() &gt; 0) {</p>
<pre><code>  // Sending the response header buffer
  headerBuffer.flip();
  try {
      socketWrapper.write(isBlocking(), headerBuffer);
  } finally {
      headerBuffer.position(0).limit(headerBuffer.capacity());
  }
</code></pre><p>  }
}</p>
</li>
</ul>
<pre><code>- 3.1,1,3,1,5,3) Http11OutputBuffer#end
</code></pre><pre><code>public void end() throws IOException {
    if (responseFinished) {
        return;
    }

    if (lastActiveFilter == -1) {
        outputStreamOutputBuffer.end();
    } else {
        activeFilters[lastActiveFilter].end();
    }

    responseFinished = true;
}
</code></pre><h5 id="31132-asyncpostprocess&#xFF08;&#x5F02;&#x6B65;servlet"><a name="31132-asyncpostprocess&#xFF08;&#x5F02;&#x6B65;servlet" class="plugin-anchor" href="#31132-asyncpostprocess&#xFF08;&#x5F02;&#x6B65;servlet"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.1.3.2) asyncPostProcess&#xFF08;&#x5F02;&#x6B65;Servlet)</h5>
<pre><code>public SocketState asyncPostProcess() {
    return asyncStateMachine.asyncPostProcess();
}
</code></pre><pre><code>- 3.1.1.3.2.1) AsyncStateMachine#asyncPostProcess
</code></pre><ul>
<li><p>synchronized SocketState asyncPostProcess() {
  if (state == AsyncState.COMPLETE_PENDING) {</p>
<pre><code>  doComplete();
  return SocketState.ASYNC_END;
</code></pre><p>  } else if (state == AsyncState.DISPATCH_PENDING) {</p>
<pre><code>  doDispatch();
  return SocketState.ASYNC_END;
</code></pre><p>  } else  if (state == AsyncState.STARTING || state == AsyncState.READ_WRITE_OP) {</p>
<pre><code>  state = AsyncState.STARTED;
  return SocketState.LONG;
</code></pre><p>  } else if (state == AsyncState.MUST_COMPLETE || state == AsyncState.COMPLETING) {</p>
<pre><code>  asyncCtxt.fireOnComplete();
  state = AsyncState.DISPATCHED;
  return SocketState.ASYNC_END;
</code></pre><p>  } else if (state == AsyncState.MUST_DISPATCH) {</p>
<pre><code>  state = AsyncState.DISPATCHING;
  return SocketState.ASYNC_END;
</code></pre><p>  } else if (state == AsyncState.DISPATCHING) {</p>
<pre><code>  state = AsyncState.DISPATCHED;
  return SocketState.ASYNC_END;
</code></pre><p>  } else if (state == AsyncState.STARTED) {</p>
<pre><code>  // This can occur if an async listener does a dispatch to an async
  // servlet during onTimeout
  return SocketState.LONG;
</code></pre><p>  } else {</p>
<pre><code>  throw new IllegalStateException(
          sm.getString(&quot;asyncStateMachine.invalidAsyncState&quot;,
                  &quot;asyncPostProcess()&quot;, state));
</code></pre><p>  }
}</p>
</li>
<li><ul>
<li>4) Container#Valve#invoke&#xFF08;&#x5728;Worker&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x6267;&#x884C;)</li>
</ul>
</li>
</ul>
<p>1.- &#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x6BCF;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7684; StandardPipeline &#x4E0A;&#x90FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A;&#x5DF2;&#x6CE8;&#x518C;&#x7684; Valve&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5173;&#x6CE8;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684; Basic Valve&#x3002;&#x5176;&#x4ED6; Valve &#x90FD;&#x662F;&#x5728; Basic Valve &#x524D;&#x6267;&#x884C;&#x3002;
2.- request.getHost().getPipeline().getFirst().invoke() &#x5148;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684; StandardHost&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x5176; pipeline&#x3002;
3.- request.getContext().getPipeline().getFirst().invoke() &#x5148;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684; StandardContext,&#x5E76;&#x6267;&#x884C;&#x5176; pipeline&#x3002;
4.- request.getWrapper().getPipeline().getFirst().invoke() &#x5148;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684; StandardWrapper&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x5176; pipeline&#x3002;
5.- &#x6700;&#x503C;&#x5F97;&#x8BF4;&#x7684;&#x5C31;&#x662F; StandardWrapper &#x7684; Basic Valve&#xFF0C;StandardWrapperValve
6.- allocate() &#x7528;&#x6765;&#x52A0;&#x8F7D;&#x5E76;&#x521D;&#x59CB;&#x5316; Servlet&#xFF0C;&#x503C;&#x7684;&#x4E00;&#x63D0;&#x7684;&#x662F; Servlet &#x5E76;&#x4E0D;&#x90FD;&#x662F;&#x5355;&#x4F8B;&#x7684;&#xFF0C;&#x5F53; Servlet &#x5B9E;&#x73B0;&#x4E86; SingleThreadModel &#x63A5;&#x53E3;&#x540E;&#xFF0C;StandardWrapper &#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x7EC4; Servlet &#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x662F;&#x4EAB;&#x5143;&#x6A21;&#x5F0F;&#x3002;&#x5F53;&#x7136;&#x4E86; SingleThreadModel &#x5728; Servlet 2.4 &#x4EE5;&#x540E;&#x5C31;&#x5F03;&#x7528;&#x4E86;&#x3002;
7.- createFilterChain() &#x65B9;&#x6CD5;&#x4F1A;&#x4ECE; StandardContext &#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5339;&#x914D; Request URL &#x7684;&#x6240;&#x6709;&#x8FC7;&#x6EE4;&#x5668;&#x6311;&#x9009;&#x51FA;&#x6765;&#x6DFB;&#x52A0;&#x5230; filterChain &#x4E2D;&#x3002;
8.- doFilter() &#x6267;&#x884C;&#x8FC7;&#x6EE4;&#x94FE;,&#x5F53;&#x6240;&#x6709;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x8C03;&#x7528; Servlet &#x7684; service() &#x65B9;&#x6CD5;&#x3002;</p>
<ul>
<li>&#x7B2C;&#x4E00;&#x4E2A;Container#Valve&#x662F;StandardEngineValve&#x3002;</li>
<li>&#x6309;&#x7167;&#x8FD9;&#x6837;&#x7684;&#x987A;&#x5E8F;&#xFF1A;engine-&gt;host-&gt;context-&gt;wrapper&#x3002;</li>
<li>&#x8FD9;&#x56DB;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x7EE7;&#x627F;&#x81EA;ContainerBase&#x3002;<h2 id="containerbase"><a name="containerbase" class="plugin-anchor" href="#containerbase"><i class="fa fa-link" aria-hidden="true"></i></a>ContainerBase</h2>
</li>
</ul>
<pre><code>public abstract class ContainerBase extends LifecycleMBeanBase
        implements Container {
</code></pre><pre><code>/**
 * The Pipeline object with which this Container is associated.
 */
protected final Pipeline pipeline = new StandardPipeline(this);
</code></pre><ul>
<li>}</li>
<li>&#x6301;&#x6709;&#x4E00;&#x4E2A;StandardPipeline&#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<h2 id="pipeline&#xFF08;&#x4E00;&#x4E2A;pipeline&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;container&#x5173;&#x8054;&#xFF0C;&#x591A;&#x5BF9;&#x4E00;"><a name="pipeline&#xFF08;&#x4E00;&#x4E2A;pipeline&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;container&#x5173;&#x8054;&#xFF0C;&#x591A;&#x5BF9;&#x4E00;" class="plugin-anchor" href="#pipeline&#xFF08;&#x4E00;&#x4E2A;pipeline&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;container&#x5173;&#x8054;&#xFF0C;&#x591A;&#x5BF9;&#x4E00;"><i class="fa fa-link" aria-hidden="true"></i></a>Pipeline&#xFF08;&#x4E00;&#x4E2A;pipeline&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;Container&#x5173;&#x8054;&#xFF0C;&#x591A;&#x5BF9;&#x4E00;)</h2>
<ul>
<li>StandardPipeline &#x7EC4;&#x4EF6;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x4E0E; Valve&#xFF08;&#x9600;)&#x7ED3;&#x5408;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x3002; StandardPipeline &#x4E2D;&#x542B;&#x6709;&#x591A;&#x4E2A; Valve&#xFF0C; &#x5F53;&#x9700;&#x8981;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4F1A;&#x9010;&#x4E00;&#x8C03;&#x7528; Valve &#x7684; invoke &#x65B9;&#x6CD5;&#x5BF9; Request &#x548C; Response &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x7279;&#x522B;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684; Valve &#x53EB; basicValve,&#x6BCF;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x5BB9;&#x5668;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684; BasicValve&#xFF0C;&#x4ED6;&#x4EEC;&#x505A;&#x7684;&#x662F;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5DE5;&#x4F5C;&#x3002;</li>
</ul>
<pre><code>public class StandardPipeline extends LifecycleBase implements Pipeline {

    private static final Log log = LogFactory.getLog(StandardPipeline.class);

    // ----------------------------------------------------------- Constructors


    /**
     * Construct a new StandardPipeline instance with no associated Container.
     */
    public StandardPipeline() {

        this(null);

    }


    /**
     * Construct a new StandardPipeline instance that is associated with the
     * specified Container.
     *
     * @param container The container we should be associated with
     */
    public StandardPipeline(Container container) {

        super();
        setContainer(container);

    }


    // ----------------------------------------------------- Instance Variables


    /**
     * The basic Valve (if any) associated with this Pipeline.
     */
    protected Valve basic = null;


    /**
     * The Container with which this Pipeline is associated.
     */
    protected Container container = null;


    /**
     * The first valve associated with this Pipeline.
     */
    protected Valve first = null;
</code></pre><ul>
<li>}<h2 id="valve&#xFF08;&#x4E00;&#x4E2A;pipeline&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;valve&#xFF0C;&#x4E00;&#x5BF9;&#x591A;&#xFF0C;&#x94FE;&#x8868;&#x7ED3;&#x6784;"><a name="valve&#xFF08;&#x4E00;&#x4E2A;pipeline&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;valve&#xFF0C;&#x4E00;&#x5BF9;&#x591A;&#xFF0C;&#x94FE;&#x8868;&#x7ED3;&#x6784;" class="plugin-anchor" href="#valve&#xFF08;&#x4E00;&#x4E2A;pipeline&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;valve&#xFF0C;&#x4E00;&#x5BF9;&#x591A;&#xFF0C;&#x94FE;&#x8868;&#x7ED3;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>Valve&#xFF08;&#x4E00;&#x4E2A;pipeline&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;Valve&#xFF0C;&#x4E00;&#x5BF9;&#x591A;&#xFF0C;&#x94FE;&#x8868;&#x7ED3;&#x6784;)</h2>
</li>
<li>Valve&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x57FA;&#x672C;&#x5B9E;&#x73B0;&#x7684;BaseValve&#x7C7B;&#x3002;</li>
</ul>
<pre><code>public abstract class ValveBase extends LifecycleMBeanBase implements Contained, Valve {

    protected static final StringManager sm = StringManager.getManager(ValveBase.class);


    //------------------------------------------------------ Constructor

    public ValveBase() {
        this(false);
    }


    public ValveBase(boolean asyncSupported) {
        this.asyncSupported = asyncSupported;
    }


    //------------------------------------------------------ Instance Variables

    /**
     * Does this valve support Servlet 3+ async requests?
     */
    protected boolean asyncSupported;


    /**
     * The Container whose pipeline this Valve is a component of.
     */
    protected Container container = null;


    /**
     * Container log
     */
    protected Log containerLog = null;


    /**
     * The next Valve in the pipeline this Valve is a component of.
     */
    protected Valve next = null;
</code></pre><ul>
<li><p>}</p>
<ul>
<li>4.1) StandardEngineValve#invoke</li>
</ul>
</li>
</ul>
<pre><code>public final void invoke(Request request, Response response)
    throws IOException, ServletException {

    // Select the Host to be used for this Request
    Host host = request.getHost();
    if (host == null) {
        response.sendError
            (HttpServletResponse.SC_BAD_REQUEST,
             sm.getString(&quot;standardEngine.noHost&quot;,
                          request.getServerName()));
        return;
    }
    if (request.isAsyncSupported()) {
        request.setAsyncSupported(host.getPipeline().isAsyncSupported());
    }

    // Ask this Host to process this request
    host.getPipeline().getFirst().invoke(request, response);

}
</code></pre><pre><code>- 4.1.1) StandardHostValve#invoke
</code></pre><pre><code>public final void invoke(Request request, Response response)
    throws IOException, ServletException {

    // Select the Context to be used for this Request
    Context context = request.getContext();
    if (context == null) {
        return;
    }

    if (request.isAsyncSupported()) {
        request.setAsyncSupported(context.getPipeline().isAsyncSupported());
    }

    boolean asyncAtStart = request.isAsync();

    try {
        context.bind(Globals.IS_SECURITY_ENABLED, MY_CLASSLOADER);

        if (!asyncAtStart &amp;&amp; !context.fireRequestInitEvent(request.getRequest())) {
            // Don&apos;t fire listeners during async processing (the listener
            // fired for the request that called startAsync()).
            // If a request init listener throws an exception, the request
            // is aborted.
            return;
        }

        // Ask this Context to process this request. Requests that are in
        // async mode and are not being dispatched to this resource must be
        // in error and have been routed here to check for application
        // defined error pages.
        try {
            if (!response.isErrorReportRequired()) {
                context.getPipeline().getFirst().invoke(request, response);
            }
        } catch (Throwable t) {
            ExceptionUtils.handleThrowable(t);
            container.getLogger().error(&quot;Exception Processing &quot; + request.getRequestURI(), t);
            // If a new error occurred while trying to report a previous
            // error allow the original error to be reported.
            if (!response.isErrorReportRequired()) {
                request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, t);
                throwable(request, response, t);
            }
        }

        // Now that the request/response pair is back under container
        // control lift the suspension so that the error handling can
        // complete and/or the container can flush any remaining data
        response.setSuspended(false);

        Throwable t = (Throwable) request.getAttribute(RequestDispatcher.ERROR_EXCEPTION);

        // Protect against NPEs if the context was destroyed during a
        // long running request.
        if (!context.getState().isAvailable()) {
            return;
        }

        // Look for (and render if found) an application level error page
        if (response.isErrorReportRequired()) {
            if (t != null) {
                throwable(request, response, t);
            } else {
                status(request, response);
            }
        }

        if (!request.isAsync() &amp;&amp; !asyncAtStart) {
            context.fireRequestDestroyEvent(request.getRequest());
        }
    } finally {
        // Access a session (if present) to update last accessed time, based
        // on a strict interpretation of the specification
        if (ACCESS_SESSION) {
            request.getSession(false);
        }

        context.unbind(Globals.IS_SECURITY_ENABLED, MY_CLASSLOADER);
    }
}
</code></pre><pre><code>- 4.1.1.1) StandardContextValve#invoke
</code></pre><pre><code>public final void invoke(Request request, Response response)
    throws IOException, ServletException {

    // Disallow any direct access to resources under WEB-INF or META-INF
    MessageBytes requestPathMB = request.getRequestPathMB();
    if ((requestPathMB.startsWithIgnoreCase(&quot;/META-INF/&quot;, 0))
            || (requestPathMB.equalsIgnoreCase(&quot;/META-INF&quot;))
            || (requestPathMB.startsWithIgnoreCase(&quot;/WEB-INF/&quot;, 0))
            || (requestPathMB.equalsIgnoreCase(&quot;/WEB-INF&quot;))) {
        response.sendError(HttpServletResponse.SC_NOT_FOUND);
        return;
    }

    // Select the Wrapper to be used for this Request
    Wrapper wrapper = request.getWrapper();
    if (wrapper == null || wrapper.isUnavailable()) {
        response.sendError(HttpServletResponse.SC_NOT_FOUND);
        return;
    }

    // Acknowledge the request
    try {
        response.sendAcknowledgement();
    } catch (IOException ioe) {
        container.getLogger().error(sm.getString(
                &quot;standardContextValve.acknowledgeException&quot;), ioe);
        request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, ioe);
        response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
        return;
    }

    if (request.isAsyncSupported()) {
        request.setAsyncSupported(wrapper.getPipeline().isAsyncSupported());
    }
    wrapper.getPipeline().getFirst().invoke(request, response);
}
</code></pre><pre><code>- 4.1.1.1.1) &#xFF08;&#x8C03;&#x7528;Servlet)StandardWrapperValve#invoke
</code></pre><ul>
<li>StandardWrapperValve
1.- allocate() &#x7528;&#x6765;&#x52A0;&#x8F7D;&#x5E76;&#x521D;&#x59CB;&#x5316; Servlet&#xFF0C;&#x503C;&#x7684;&#x4E00;&#x63D0;&#x7684;&#x662F; Servlet &#x5E76;&#x4E0D;&#x90FD;&#x662F;&#x5355;&#x4F8B;&#x7684;&#xFF0C;&#x5F53; Servlet &#x5B9E;&#x73B0;&#x4E86; SingleThreadModel &#x63A5;&#x53E3;&#x540E;&#xFF0C;StandardWrapper &#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x7EC4; Servlet &#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x662F;&#x4EAB;&#x5143;&#x6A21;&#x5F0F;&#x3002;&#x5F53;&#x7136;&#x4E86; SingleThreadModel &#x5728; Servlet 2.4 &#x4EE5;&#x540E;&#x5C31;&#x5F03;&#x7528;&#x4E86;&#x3002;
2.- createFilterChain() &#x65B9;&#x6CD5;&#x4F1A;&#x4ECE; StandardContext &#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5339;&#x914D; Request URL &#x7684;&#x6240;&#x6709;&#x8FC7;&#x6EE4;&#x5668;&#x6311;&#x9009;&#x51FA;&#x6765;&#x6DFB;&#x52A0;&#x5230; filterChain &#x4E2D;&#x3002;
3.- doFilter() &#x6267;&#x884C;&#x8FC7;&#x6EE4;&#x94FE;,&#x5F53;&#x6240;&#x6709;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x8C03;&#x7528; Servlet &#x7684; service() &#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<pre><code>public final void invoke(Request request, Response response)
    throws IOException, ServletException {

    // Initialize local variables we may need
    boolean unavailable = false;
    Throwable throwable = null;
    // This should be a Request attribute...
    long t1=System.currentTimeMillis();
    requestCount.incrementAndGet();
    StandardWrapper wrapper = (StandardWrapper) getContainer();
    Servlet servlet = null;
    Context context = (Context) wrapper.getParent();

    // Check for the application being marked unavailable
    if (!context.getState().isAvailable()) {
        response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE,
                       sm.getString(&quot;standardContext.isUnavailable&quot;));
        unavailable = true;
    }

    // Check for the servlet being marked unavailable
    if (!unavailable &amp;&amp; wrapper.isUnavailable()) {
        container.getLogger().info(sm.getString(&quot;standardWrapper.isUnavailable&quot;,
                wrapper.getName()));
        long available = wrapper.getAvailable();
        if ((available &gt; 0L) &amp;&amp; (available &lt; Long.MAX_VALUE)) {
            response.setDateHeader(&quot;Retry-After&quot;, available);
            response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE,
                    sm.getString(&quot;standardWrapper.isUnavailable&quot;,
                            wrapper.getName()));
        } else if (available == Long.MAX_VALUE) {
            response.sendError(HttpServletResponse.SC_NOT_FOUND,
                    sm.getString(&quot;standardWrapper.notFound&quot;,
                            wrapper.getName()));
        }
        unavailable = true;
    }

    // Allocate a servlet instance to process this request
    try {
        if (!unavailable) {
            servlet = wrapper.allocate();
        }
    } catch (UnavailableException e) {
        container.getLogger().error(
                sm.getString(&quot;standardWrapper.allocateException&quot;,
                        wrapper.getName()), e);
        long available = wrapper.getAvailable();
        if ((available &gt; 0L) &amp;&amp; (available &lt; Long.MAX_VALUE)) {
            response.setDateHeader(&quot;Retry-After&quot;, available);
            response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE,
                       sm.getString(&quot;standardWrapper.isUnavailable&quot;,
                                    wrapper.getName()));
        } else if (available == Long.MAX_VALUE) {
            response.sendError(HttpServletResponse.SC_NOT_FOUND,
                       sm.getString(&quot;standardWrapper.notFound&quot;,
                                    wrapper.getName()));
        }
    } catch (ServletException e) {
        container.getLogger().error(sm.getString(&quot;standardWrapper.allocateException&quot;,
                         wrapper.getName()), StandardWrapper.getRootCause(e));
        throwable = e;
        exception(request, response, e);
    } catch (Throwable e) {
        ExceptionUtils.handleThrowable(e);
        container.getLogger().error(sm.getString(&quot;standardWrapper.allocateException&quot;,
                         wrapper.getName()), e);
        throwable = e;
        exception(request, response, e);
        servlet = null;
    }

    MessageBytes requestPathMB = request.getRequestPathMB();
    DispatcherType dispatcherType = DispatcherType.REQUEST;
    if (request.getDispatcherType()==DispatcherType.ASYNC) dispatcherType = DispatcherType.ASYNC;
    request.setAttribute(Globals.DISPATCHER_TYPE_ATTR,dispatcherType);
    request.setAttribute(Globals.DISPATCHER_REQUEST_PATH_ATTR,
            requestPathMB);
    // Create the filter chain for this request
    ApplicationFilterChain filterChain =
            ApplicationFilterFactory.createFilterChain(request, wrapper, servlet);

    // Call the filter chain for this request
    // NOTE: This also calls the servlet&apos;s service() method
    try {
        if ((servlet != null) &amp;&amp; (filterChain != null)) {
            // Swallow output if needed
            if (context.getSwallowOutput()) {
                try {
                    SystemLogHandler.startCapture();
                    if (request.isAsyncDispatching()) {
                        request.getAsyncContextInternal().doInternalDispatch();
                    } else {
                        filterChain.doFilter(request.getRequest(),
                                response.getResponse());
                    }
                } finally {
                    String log = SystemLogHandler.stopCapture();
                    if (log != null &amp;&amp; log.length() &gt; 0) {
                        context.getLogger().info(log);
                    }
                }
            } else {
                if (request.isAsyncDispatching()) {
                    request.getAsyncContextInternal().doInternalDispatch();
                } else {
                    filterChain.doFilter
                        (request.getRequest(), response.getResponse());
                }
            }

        }
    } catch (ClientAbortException e) {
        throwable = e;
        exception(request, response, e);
    } catch (IOException e) {
        container.getLogger().error(sm.getString(
                &quot;standardWrapper.serviceException&quot;, wrapper.getName(),
                context.getName()), e);
        throwable = e;
        exception(request, response, e);
    } catch (UnavailableException e) {
        container.getLogger().error(sm.getString(
                &quot;standardWrapper.serviceException&quot;, wrapper.getName(),
                context.getName()), e);
        //            throwable = e;
        //            exception(request, response, e);
        wrapper.unavailable(e);
        long available = wrapper.getAvailable();
        if ((available &gt; 0L) &amp;&amp; (available &lt; Long.MAX_VALUE)) {
            response.setDateHeader(&quot;Retry-After&quot;, available);
            response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE,
                       sm.getString(&quot;standardWrapper.isUnavailable&quot;,
                                    wrapper.getName()));
        } else if (available == Long.MAX_VALUE) {
            response.sendError(HttpServletResponse.SC_NOT_FOUND,
                        sm.getString(&quot;standardWrapper.notFound&quot;,
                                    wrapper.getName()));
        }
        // Do not save exception in &apos;throwable&apos;, because we
        // do not want to do exception(request, response, e) processing
    } catch (ServletException e) {
        Throwable rootCause = StandardWrapper.getRootCause(e);
        if (!(rootCause instanceof ClientAbortException)) {
            container.getLogger().error(sm.getString(
                    &quot;standardWrapper.serviceExceptionRoot&quot;,
                    wrapper.getName(), context.getName(), e.getMessage()),
                    rootCause);
        }
        throwable = e;
        exception(request, response, e);
    } catch (Throwable e) {
        ExceptionUtils.handleThrowable(e);
        container.getLogger().error(sm.getString(
                &quot;standardWrapper.serviceException&quot;, wrapper.getName(),
                context.getName()), e);
        throwable = e;
        exception(request, response, e);
    }

    // Release the filter chain (if any) for this request
    if (filterChain != null) {
        filterChain.release();
    }

    // Deallocate the allocated servlet instance
    try {
        if (servlet != null) {
            wrapper.deallocate(servlet);
        }
    } catch (Throwable e) {
        ExceptionUtils.handleThrowable(e);
        container.getLogger().error(sm.getString(&quot;standardWrapper.deallocateException&quot;,
                         wrapper.getName()), e);
        if (throwable == null) {
            throwable = e;
            exception(request, response, e);
        }
    }

    // If this servlet has been marked permanently unavailable,
    // unload it and release this instance
    try {
        if ((servlet != null) &amp;&amp;
            (wrapper.getAvailable() == Long.MAX_VALUE)) {
            wrapper.unload();
        }
    } catch (Throwable e) {
        ExceptionUtils.handleThrowable(e);
        container.getLogger().error(sm.getString(&quot;standardWrapper.unloadException&quot;,
                         wrapper.getName()), e);
        if (throwable == null) {
            throwable = e;
            exception(request, response, e);
        }
    }
    long t2=System.currentTimeMillis();

    long time=t2-t1;
    processingTime += time;
    if( time &gt; maxTime) maxTime=time;
    if( time &lt; minTime) minTime=time;

}
</code></pre><pre><code>- 4.1.1.1.1.1) StandardWrapper#allocate&#xFF08;&#x521B;&#x5EFA;servlet&#x5B9E;&#x4F8B;)
</code></pre><pre><code>public Servlet allocate() throws ServletException {

    // If we are currently unloading this servlet, throw an exception
    if (unloading) {
        throw new ServletException(sm.getString(&quot;standardWrapper.unloading&quot;, getName()));
    }

    boolean newInstance = false;

    // If not SingleThreadedModel, return the same instance every time
    if (!singleThreadModel) {
        // Load and initialize our instance if necessary
        if (instance == null || !instanceInitialized) {
            synchronized (this) {
                if (instance == null) {
                    try {
                        if (log.isDebugEnabled()) {
                            log.debug(&quot;Allocating non-STM instance&quot;);
                        }

                        // Note: We don&apos;t know if the Servlet implements
                        // SingleThreadModel until we have loaded it.
                        instance = loadServlet();
                        newInstance = true;
                        if (!singleThreadModel) {
                            // For non-STM, increment here to prevent a race
                            // condition with unload. Bug 43683, test case
                            // #3
                            countAllocated.incrementAndGet();
                        }
                    } catch (ServletException e) {
                        throw e;
                    } catch (Throwable e) {
                        ExceptionUtils.handleThrowable(e);
                        throw new ServletException(sm.getString(&quot;standardWrapper.allocate&quot;), e);
                    }
                }
                if (!instanceInitialized) {
                    initServlet(instance);
                }
            }
        }

        if (singleThreadModel) {
            if (newInstance) {
                // Have to do this outside of the sync above to prevent a
                // possible deadlock
                synchronized (instancePool) {
                    instancePool.push(instance);
                    nInstances++;
                }
            }
        } else {
            if (log.isTraceEnabled()) {
                log.trace(&quot;  Returning non-STM instance&quot;);
            }
            // For new instances, count will have been incremented at the
            // time of creation
            if (!newInstance) {
                countAllocated.incrementAndGet();
            }
            return instance;
        }
    }

    synchronized (instancePool) {
        while (countAllocated.get() &gt;= nInstances) {
            // Allocate a new instance if possible, or else wait
            if (nInstances &lt; maxInstances) {
                try {
                    instancePool.push(loadServlet());
                    nInstances++;
                } catch (ServletException e) {
                    throw e;
                } catch (Throwable e) {
                    ExceptionUtils.handleThrowable(e);
                    throw new ServletException(sm.getString(&quot;standardWrapper.allocate&quot;), e);
                }
            } else {
                try {
                    instancePool.wait();
                } catch (InterruptedException e) {
                    // Ignore
                }
            }
        }
        if (log.isTraceEnabled()) {
            log.trace(&quot;  Returning allocated STM instance&quot;);
        }
        countAllocated.incrementAndGet();
        return instancePool.pop();
    }
}
</code></pre><pre><code>- 4.1.1.1.1.1.1) StandardWrapper#loadServlet
</code></pre><pre><code>public synchronized Servlet loadServlet() throws ServletException {

    // Nothing to do if we already have an instance or an instance pool
    if (!singleThreadModel &amp;&amp; (instance != null))
        return instance;

    PrintStream out = System.out;
    if (swallowOutput) {
        SystemLogHandler.startCapture();
    }

    Servlet servlet;
    try {
        long t1=System.currentTimeMillis();
        // Complain if no servlet class has been specified
        if (servletClass == null) {
            unavailable(null);
            throw new ServletException
                (sm.getString(&quot;standardWrapper.notClass&quot;, getName()));
        }

        InstanceManager instanceManager = ((StandardContext)getParent()).getInstanceManager();
        try {
            servlet = (Servlet) instanceManager.newInstance(servletClass);
        } catch (ClassCastException e) {
            unavailable(null);
            // Restore the context ClassLoader
            throw new ServletException
                (sm.getString(&quot;standardWrapper.notServlet&quot;, servletClass), e);
        } catch (Throwable e) {
            e = ExceptionUtils.unwrapInvocationTargetException(e);
            ExceptionUtils.handleThrowable(e);
            unavailable(null);

            // Added extra log statement for Bugzilla 36630:
            // http://bz.apache.org/bugzilla/show_bug.cgi?id=36630
            if(log.isDebugEnabled()) {
                log.debug(sm.getString(&quot;standardWrapper.instantiate&quot;, servletClass), e);
            }

            // Restore the context ClassLoader
            throw new ServletException
                (sm.getString(&quot;standardWrapper.instantiate&quot;, servletClass), e);
        }

        if (multipartConfigElement == null) {
            MultipartConfig annotation =
                    servlet.getClass().getAnnotation(MultipartConfig.class);
            if (annotation != null) {
                multipartConfigElement =
                        new MultipartConfigElement(annotation);
            }
        }

        // Special handling for ContainerServlet instances
        // Note: The InstanceManager checks if the application is permitted
        //       to load ContainerServlets
        if (servlet instanceof ContainerServlet) {
            ((ContainerServlet) servlet).setWrapper(this);
        }

        classLoadTime=(int) (System.currentTimeMillis() -t1);

        if (servlet instanceof SingleThreadModel) {
            if (instancePool == null) {
                instancePool = new Stack&lt;&gt;();
            }
            singleThreadModel = true;
        }

        initServlet(servlet);

        fireContainerEvent(&quot;load&quot;, this);

        loadTime=System.currentTimeMillis() -t1;
    } finally {
        if (swallowOutput) {
            String log = SystemLogHandler.stopCapture();
            if (log != null &amp;&amp; log.length() &gt; 0) {
                if (getServletContext() != null) {
                    getServletContext().log(log);
                } else {
                    out.println(log);
                }
            }
        }
    }
    return servlet;

}
</code></pre><pre><code>- 4.1.1.1.1.1.1.1) StandardWrapper#initServlet
</code></pre><pre><code>private synchronized void initServlet(Servlet servlet)
        throws ServletException {

    if (instanceInitialized &amp;&amp; !singleThreadModel) return;

    // Call the initialization method of this servlet
    try {
        if( Globals.IS_SECURITY_ENABLED) {
            boolean success = false;
            try {
                Object[] args = new Object[] { facade };
                SecurityUtil.doAsPrivilege(&quot;init&quot;,
                                           servlet,
                                           classType,
                                           args);
                success = true;
            } finally {
                if (!success) {
                    // destroy() will not be called, thus clear the reference now
                    SecurityUtil.remove(servlet);
                }
            }
        } else {
            servlet.init(facade);
        }

        instanceInitialized = true;
    } catch (UnavailableException f) {
        unavailable(f);
        throw f;
    } catch (ServletException f) {
        // If the servlet wanted to be unavailable it would have
        // said so, so do not call unavailable(null).
        throw f;
    } catch (Throwable f) {
        ExceptionUtils.handleThrowable(f);
        getServletContext().log(&quot;StandardWrapper.Throwable&quot;, f );
        // If the servlet wanted to be unavailable it would have
        // said so, so do not call unavailable(null).
        throw new ServletException
            (sm.getString(&quot;standardWrapper.initException&quot;, getName()), f);
    }
}
</code></pre><pre><code>- 4.1.1.1.1.2) ApplicationFilterFactory#createFilterChain
</code></pre><pre><code>public static ApplicationFilterChain createFilterChain(ServletRequest request,
        Wrapper wrapper, Servlet servlet) {

    // If there is no servlet to execute, return null
    if (servlet == null)
        return null;

    // Create and initialize a filter chain object
    ApplicationFilterChain filterChain = null;
    if (request instanceof Request) {
        Request req = (Request) request;
        if (Globals.IS_SECURITY_ENABLED) {
            // Security: Do not recycle
            filterChain = new ApplicationFilterChain();
        } else {
            filterChain = (ApplicationFilterChain) req.getFilterChain();
            if (filterChain == null) {
                filterChain = new ApplicationFilterChain();
                req.setFilterChain(filterChain);
            }
        }
    } else {
        // Request dispatcher in use
        filterChain = new ApplicationFilterChain();
    }

    filterChain.setServlet(servlet);
    filterChain.setServletSupportsAsync(wrapper.isAsyncSupported());

    // Acquire the filter mappings for this Context
    StandardContext context = (StandardContext) wrapper.getParent();
    FilterMap filterMaps[] = context.findFilterMaps();

    // If there are no filter mappings, we are done
    if ((filterMaps == null) || (filterMaps.length == 0))
        return filterChain;

    // Acquire the information we will need to match filter mappings
    DispatcherType dispatcher =
            (DispatcherType) request.getAttribute(Globals.DISPATCHER_TYPE_ATTR);

    String requestPath = null;
    Object attribute = request.getAttribute(Globals.DISPATCHER_REQUEST_PATH_ATTR);
    if (attribute != null){
        requestPath = attribute.toString();
    }

    String servletName = wrapper.getName();

    // Add the relevant path-mapped filters to this filter chain
    for (int i = 0; i &lt; filterMaps.length; i++) {
        if (!matchDispatcher(filterMaps[i] ,dispatcher)) {
            continue;
        }
        if (!matchFiltersURL(filterMaps[i], requestPath))
            continue;
        ApplicationFilterConfig filterConfig = (ApplicationFilterConfig)
            context.findFilterConfig(filterMaps[i].getFilterName());
        if (filterConfig == null) {
            // FIXME - log configuration problem
            continue;
        }
        filterChain.addFilter(filterConfig);
    }

    // Add filters that match on servlet name second
    for (int i = 0; i &lt; filterMaps.length; i++) {
        if (!matchDispatcher(filterMaps[i] ,dispatcher)) {
            continue;
        }
        if (!matchFiltersServlet(filterMaps[i], servletName))
            continue;
        ApplicationFilterConfig filterConfig = (ApplicationFilterConfig)
            context.findFilterConfig(filterMaps[i].getFilterName());
        if (filterConfig == null) {
            // FIXME - log configuration problem
            continue;
        }
        filterChain.addFilter(filterConfig);
    }

    // Return the completed filter chain
    return filterChain;
}
</code></pre><pre><code>- 4.1.1.1.1.3) ApplicationFilterChain#doFilter
</code></pre><pre><code>public void doFilter(ServletRequest request, ServletResponse response)
    throws IOException, ServletException {

    if( Globals.IS_SECURITY_ENABLED ) {
        final ServletRequest req = request;
        final ServletResponse res = response;
        try {
            java.security.AccessController.doPrivileged(
                new java.security.PrivilegedExceptionAction&lt;Void&gt;() {
                    @Override
                    public Void run()
                        throws ServletException, IOException {
                        internalDoFilter(req,res);
                        return null;
                    }
                }
            );
        } catch( PrivilegedActionException pe) {
            Exception e = pe.getException();
            if (e instanceof ServletException)
                throw (ServletException) e;
            else if (e instanceof IOException)
                throw (IOException) e;
            else if (e instanceof RuntimeException)
                throw (RuntimeException) e;
            else
                throw new ServletException(e.getMessage(), e);
        }
    } else {
        internalDoFilter(request,response);
    }
}
</code></pre><pre><code>- 4.1.1.1.1.3.1) ApplicationFilterChain#internalDoFilter&#xFF08;&#x8FD9;&#x91CC;&#x662F;&#x8D77;&#x4E2A;&#x5934;&#xFF0C;&#x540E;&#x7EED;doFilter&#x662F;&#x5728;&#x7528;&#x6237;Filter&#x4E2D;&#x8C03;&#x7528;&#x7684;)
</code></pre><pre><code>private void internalDoFilter(ServletRequest request,
                              ServletResponse response)
    throws IOException, ServletException {

    // Call the next filter if there is one
    if (pos &lt; n) {
        ApplicationFilterConfig filterConfig = filters[pos++];
        try {
            Filter filter = filterConfig.getFilter();

            if (request.isAsyncSupported() &amp;&amp; &quot;false&quot;.equalsIgnoreCase(
                    filterConfig.getFilterDef().getAsyncSupported())) {
                request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR, Boolean.FALSE);
            }
            if( Globals.IS_SECURITY_ENABLED ) {
                final ServletRequest req = request;
                final ServletResponse res = response;
                Principal principal =
                    ((HttpServletRequest) req).getUserPrincipal();

                Object[] args = new Object[]{req, res, this};
                SecurityUtil.doAsPrivilege (&quot;doFilter&quot;, filter, classType, args, principal);
            } else {
                filter.doFilter(request, response, this);
            }
        } catch (IOException | ServletException | RuntimeException e) {
            throw e;
        } catch (Throwable e) {
            e = ExceptionUtils.unwrapInvocationTargetException(e);
            ExceptionUtils.handleThrowable(e);
            throw new ServletException(sm.getString(&quot;filterChain.filter&quot;), e);
        }
        return;
    }

    // We fell off the end of the chain -- call the servlet instance
    try {
        if (ApplicationDispatcher.WRAP_SAME_OBJECT) {
            lastServicedRequest.set(request);
            lastServicedResponse.set(response);
        }

        if (request.isAsyncSupported() &amp;&amp; !servletSupportsAsync) {
            request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR,
                    Boolean.FALSE);
        }
        // Use potentially wrapped request from this point
        if ((request instanceof HttpServletRequest) &amp;&amp;
                (response instanceof HttpServletResponse) &amp;&amp;
                Globals.IS_SECURITY_ENABLED ) {
            final ServletRequest req = request;
            final ServletResponse res = response;
            Principal principal =
                ((HttpServletRequest) req).getUserPrincipal();
            Object[] args = new Object[]{req, res};
            SecurityUtil.doAsPrivilege(&quot;service&quot;,
                                       servlet,
                                       classTypeUsedInService,
                                       args,
                                       principal);
        } else {
            servlet.service(request, response);
        }
    } catch (IOException | ServletException | RuntimeException e) {
        throw e;
    } catch (Throwable e) {
        e = ExceptionUtils.unwrapInvocationTargetException(e);
        ExceptionUtils.handleThrowable(e);
        throw new ServletException(sm.getString(&quot;filterChain.servlet&quot;), e);
    } finally {
        if (ApplicationDispatcher.WRAP_SAME_OBJECT) {
            lastServicedRequest.set(null);
            lastServicedResponse.set(null);
        }
    }
}
</code></pre><pre><code>- 4.1.1.1.1.3.1.1) DefaultServlet#service&#xFF08;&#x5904;&#x7406;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x4F55;servlet&#x90FD;&#x65E0;&#x6CD5;&#x5339;&#x914D;&#xFF0C;&#x5219;&#x8F6C;&#x5411;&#x8BE5;servlet)
</code></pre><ul>
<li><p>protected void service(HttpServletRequest req, HttpServletResponse resp)</p>
<pre><code>  throws ServletException, IOException {
</code></pre><p>  if (req.getDispatcherType() == DispatcherType.ERROR) {</p>
<pre><code>  doGet(req, resp);
</code></pre><p>  } else {</p>
<pre><code>  super.service(req, resp);
</code></pre><p>  }
}</p>
</li>
<li><p>protected void doGet(HttpServletRequest request,</p>
<pre><code>               HttpServletResponse response)
</code></pre><p>  throws IOException, ServletException {</p>
<p>  // Serve the requested resource, including the data content
  serveResource(request, response, true, fileEncoding);</p>
</li>
</ul>
<p>}</p>
<pre><code>- 4.1.1.1.1.3.1.1.1) DefaultServlet#serveResource
</code></pre><ul>
<li>&#x9996;&#x5148;&#x4F1A;&#x5224;&#x65AD;&#x8981;&#x8BF7;&#x6C42;&#x7684;&#x8D44;&#x6E90;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x53EF;&#x8BFB;&#xFF0C;&#x4E4B;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x8D44;&#x6E90;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x8BBE;&#x7F6E;&#x54CD;&#x5E94;&#x5934;&#x7684;content-type&#xFF0C;&#x5224;&#x65AD;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7B49;&#xFF0C;&#x6700;&#x7EC8;&#x662F;&#x6D41;&#x7684;&#x8BFB;&#x5199;&#x3002;</li>
</ul>
<pre><code>/**
 * Serve the specified resource, optionally including the data content.
 *
 * @param request  The servlet request we are processing
 * @param response The servlet response we are creating
 * @param content  Should the content be included?
 * @param encoding The encoding to use if it is necessary to access the
 *                 source as characters rather than as bytes
 *
 * @exception IOException if an input/output error occurs
 * @exception ServletException if a servlet-specified error occurs
 */
protected void serveResource(HttpServletRequest request,
                             HttpServletResponse response,
                             boolean content,
                             String encoding)
    throws IOException, ServletException {

    boolean serveContent = content;

    // Identify the requested resource path
    String path = getRelativePath(request, true);

    if (debug &gt; 0) {
        if (serveContent)
            log(&quot;DefaultServlet.serveResource:  Serving resource &apos;&quot; +
                path + &quot;&apos; headers and data&quot;);
        else
            log(&quot;DefaultServlet.serveResource:  Serving resource &apos;&quot; +
                path + &quot;&apos; headers only&quot;);
    }

    if (path.length() == 0) {
        // Context root redirect
        doDirectoryRedirect(request, response);
        return;
    }

    WebResource resource = resources.getResource(path);
    boolean isError = DispatcherType.ERROR == request.getDispatcherType();

    if (!resource.exists()) {
        // Check if we&apos;re included so we can return the appropriate
        // missing resource name in the error
        String requestUri = (String) request.getAttribute(
                RequestDispatcher.INCLUDE_REQUEST_URI);
        if (requestUri == null) {
            requestUri = request.getRequestURI();
        } else {
            // We&apos;re included
            // SRV.9.3 says we must throw a FNFE
            throw new FileNotFoundException(sm.getString(
                    &quot;defaultServlet.missingResource&quot;, requestUri));
        }

        if (isError) {
            response.sendError(((Integer) request.getAttribute(
                    RequestDispatcher.ERROR_STATUS_CODE)).intValue());
        } else {
            response.sendError(HttpServletResponse.SC_NOT_FOUND, requestUri);
        }
        return;
    }

    if (!resource.canRead()) {
        // Check if we&apos;re included so we can return the appropriate
        // missing resource name in the error
        String requestUri = (String) request.getAttribute(
                RequestDispatcher.INCLUDE_REQUEST_URI);
        if (requestUri == null) {
            requestUri = request.getRequestURI();
        } else {
            // We&apos;re included
            // Spec doesn&apos;t say what to do in this case but a FNFE seems
            // reasonable
            throw new FileNotFoundException(sm.getString(
                    &quot;defaultServlet.missingResource&quot;, requestUri));
        }

        if (isError) {
            response.sendError(((Integer) request.getAttribute(
                    RequestDispatcher.ERROR_STATUS_CODE)).intValue());
        } else {
            response.sendError(HttpServletResponse.SC_FORBIDDEN, requestUri);
        }
        return;
    }

    // If the resource is not a collection, and the resource path
    // ends with &quot;/&quot; or &quot;\&quot;, return NOT FOUND
    if (resource.isFile() &amp;&amp; (path.endsWith(&quot;/&quot;) || path.endsWith(&quot;\\&quot;))) {
        // Check if we&apos;re included so we can return the appropriate
        // missing resource name in the error
        String requestUri = (String) request.getAttribute(
                RequestDispatcher.INCLUDE_REQUEST_URI);
        if (requestUri == null) {
            requestUri = request.getRequestURI();
        }
        response.sendError(HttpServletResponse.SC_NOT_FOUND, requestUri);
        return;
    }

    boolean included = false;
    // Check if the conditions specified in the optional If headers are
    // satisfied.
    if (resource.isFile()) {
        // Checking If headers
        included = (request.getAttribute(
                RequestDispatcher.INCLUDE_CONTEXT_PATH) != null);
        if (!included &amp;&amp; !isError &amp;&amp; !checkIfHeaders(request, response, resource)) {
            return;
        }
    }

    // Find content type.
    String contentType = resource.getMimeType();
    if (contentType == null) {
        contentType = getServletContext().getMimeType(resource.getName());
        resource.setMimeType(contentType);
    }

    // These need to reflect the original resource, not the potentially
    // precompressed version of the resource so get them now if they are going to
    // be needed later
    String eTag = null;
    String lastModifiedHttp = null;
    if (resource.isFile() &amp;&amp; !isError) {
        eTag = resource.getETag();
        lastModifiedHttp = resource.getLastModifiedHttp();
    }


    // Serve a precompressed version of the file if present
    boolean usingPrecompressedVersion = false;
    if (compressionFormats.length &gt; 0 &amp;&amp; !included &amp;&amp; resource.isFile() &amp;&amp;
            !pathEndsWithCompressedExtension(path)) {
        List&lt;PrecompressedResource&gt; precompressedResources =
                getAvailablePrecompressedResources(path);
        if (!precompressedResources.isEmpty()) {
            Collection&lt;String&gt; varyHeaders = response.getHeaders(&quot;Vary&quot;);
            boolean addRequired = true;
            for (String varyHeader : varyHeaders) {
                if (&quot;*&quot;.equals(varyHeader) ||
                        &quot;accept-encoding&quot;.equalsIgnoreCase(varyHeader)) {
                    addRequired = false;
                    break;
                }
            }
            if (addRequired) {
                response.addHeader(&quot;Vary&quot;, &quot;accept-encoding&quot;);
            }
            PrecompressedResource bestResource =
                    getBestPrecompressedResource(request, precompressedResources);
            if (bestResource != null) {
                response.addHeader(&quot;Content-Encoding&quot;, bestResource.format.encoding);
                resource = bestResource.resource;
                usingPrecompressedVersion = true;
            }
        }
    }

    ArrayList&lt;Range&gt; ranges = null;
    long contentLength = -1L;

    if (resource.isDirectory()) {
        if (!path.endsWith(&quot;/&quot;)) {
            doDirectoryRedirect(request, response);
            return;
        }

        // Skip directory listings if we have been configured to
        // suppress them
        if (!listings) {
            response.sendError(HttpServletResponse.SC_NOT_FOUND,
                               request.getRequestURI());
            return;
        }
        contentType = &quot;text/html;charset=UTF-8&quot;;
    } else {
        if (!isError) {
            if (useAcceptRanges) {
                // Accept ranges header
                response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;);
            }

            // Parse range specifier
            ranges = parseRange(request, response, resource);

            // ETag header
            response.setHeader(&quot;ETag&quot;, eTag);

            // Last-Modified header
            response.setHeader(&quot;Last-Modified&quot;, lastModifiedHttp);
        }

        // Get content length
        contentLength = resource.getContentLength();
        // Special case for zero length files, which would cause a
        // (silent) ISE when setting the output buffer size
        if (contentLength == 0L) {
            serveContent = false;
        }
    }

    ServletOutputStream ostream = null;
    PrintWriter writer = null;

    if (serveContent) {
        // Trying to retrieve the servlet output stream
        try {
            ostream = response.getOutputStream();
        } catch (IllegalStateException e) {
            // If it fails, we try to get a Writer instead if we&apos;re
            // trying to serve a text file
            if (!usingPrecompressedVersion &amp;&amp;
                    ((contentType == null) ||
                            (contentType.startsWith(&quot;text&quot;)) ||
                            (contentType.endsWith(&quot;xml&quot;)) ||
                            (contentType.contains(&quot;/javascript&quot;)))
                    ) {
                writer = response.getWriter();
                // Cannot reliably serve partial content with a Writer
                ranges = FULL;
            } else {
                throw e;
            }
        }
    }

    // Check to see if a Filter, Valve of wrapper has written some content.
    // If it has, disable range requests and setting of a content length
    // since neither can be done reliably.
    ServletResponse r = response;
    long contentWritten = 0;
    while (r instanceof ServletResponseWrapper) {
        r = ((ServletResponseWrapper) r).getResponse();
    }
    if (r instanceof ResponseFacade) {
        contentWritten = ((ResponseFacade) r).getContentWritten();
    }
    if (contentWritten &gt; 0) {
        ranges = FULL;
    }

    if (resource.isDirectory() ||
            isError ||
            ( (ranges == null || ranges.isEmpty())
                    &amp;&amp; request.getHeader(&quot;Range&quot;) == null ) ||
            ranges == FULL ) {

        // Set the appropriate output headers
        if (contentType != null) {
            if (debug &gt; 0)
                log(&quot;DefaultServlet.serveFile:  contentType=&apos;&quot; +
                    contentType + &quot;&apos;&quot;);
            response.setContentType(contentType);
        }
        if (resource.isFile() &amp;&amp; contentLength &gt;= 0 &amp;&amp;
                (!serveContent || ostream != null)) {
            if (debug &gt; 0)
                log(&quot;DefaultServlet.serveFile:  contentLength=&quot; +
                    contentLength);
            // Don&apos;t set a content length if something else has already
            // written to the response.
            if (contentWritten == 0) {
                response.setContentLengthLong(contentLength);
            }
        }

        if (serveContent) {
            try {
                response.setBufferSize(output);
            } catch (IllegalStateException e) {
                // Silent catch
            }
            InputStream renderResult = null;
            if (ostream == null) {
                // Output via a writer so can&apos;t use sendfile or write
                // content directly.
                if (resource.isDirectory()) {
                    renderResult = render(getPathPrefix(request), resource, encoding);
                } else {
                    renderResult = resource.getInputStream();
                }
                copy(resource, renderResult, writer, encoding);
            } else {
                // Output is via an InputStream
                if (resource.isDirectory()) {
                    renderResult = render(getPathPrefix(request), resource, encoding);
                } else {
                    // Output is content of resource
                    if (!checkSendfile(request, response, resource,
                            contentLength, null)) {
                        // sendfile not possible so check if resource
                        // content is available directly
                        byte[] resourceBody = resource.getContent();
                        if (resourceBody == null) {
                            // Resource content not available, use
                            // inputstream
                            renderResult = resource.getInputStream();
                        } else {
                            // Use the resource content directly
                            ostream.write(resourceBody);
                        }
                    }
                }
                // If a stream was configured, it needs to be copied to
                // the output (this method closes the stream)
                if (renderResult != null) {
                    copy(resource, renderResult, ostream);
                }
            }
        }

    } else {

        if ((ranges == null) || (ranges.isEmpty()))
            return;

        // Partial content response.

        response.setStatus(HttpServletResponse.SC_PARTIAL_CONTENT);

        if (ranges.size() == 1) {

            Range range = ranges.get(0);
            response.addHeader(&quot;Content-Range&quot;, &quot;bytes &quot;
                               + range.start
                               + &quot;-&quot; + range.end + &quot;/&quot;
                               + range.length);
            long length = range.end - range.start + 1;
            response.setContentLengthLong(length);

            if (contentType != null) {
                if (debug &gt; 0)
                    log(&quot;DefaultServlet.serveFile:  contentType=&apos;&quot; +
                        contentType + &quot;&apos;&quot;);
                response.setContentType(contentType);
            }

            if (serveContent) {
                try {
                    response.setBufferSize(output);
                } catch (IllegalStateException e) {
                    // Silent catch
                }
                if (ostream != null) {
                    if (!checkSendfile(request, response, resource,
                            range.end - range.start + 1, range))
                        copy(resource, ostream, range);
                } else {
                    // we should not get here
                    throw new IllegalStateException();
                }
            }
        } else {
            response.setContentType(&quot;multipart/byteranges; boundary=&quot;
                                    + mimeSeparation);
            if (serveContent) {
                try {
                    response.setBufferSize(output);
                } catch (IllegalStateException e) {
                    // Silent catch
                }
                if (ostream != null) {
                    copy(resource, ostream, ranges.iterator(), contentType);
                } else {
                    // we should not get here
                    throw new IllegalStateException();
                }
            }
        }
    }
}
</code></pre><ul>
<li></li>
</ul>
<h1 id="mapper"><a name="mapper" class="plugin-anchor" href="#mapper"><i class="fa fa-link" aria-hidden="true"></i></a>Mapper</h1>
<ul>
<li>&#x5728;Tomcat&#x4E2D;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;&#x8BE5;&#x8BF7;&#x6C42;&#x6700;&#x7EC8;&#x7531;&#x54EA;&#x4E2A;Servlet&#x6765;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x662F;&#x7531;Mapper&#x8DEF;&#x7531;&#x6620;&#x5C04;&#x5668;&#x5B8C;&#x6210;&#x7684;&#x3002;Mapper&#x662F;&#x7531;Service&#x7BA1;&#x7406;&#x3002;<h1 id="&#x5B58;&#x50A8;&#x7ED3;&#x6784;"><a name="&#x5B58;&#x50A8;&#x7ED3;&#x6784;" class="plugin-anchor" href="#&#x5B58;&#x50A8;&#x7ED3;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B58;&#x50A8;&#x7ED3;&#x6784;</h1>
</li>
</ul>
<h1 id="mapelement&#xFF08;&#x57FA;&#x7C7B;"><a name="mapelement&#xFF08;&#x57FA;&#x7C7B;" class="plugin-anchor" href="#mapelement&#xFF08;&#x57FA;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>MapElement&#xFF08;&#x57FA;&#x7C7B;)</h1>
<pre><code>protected abstract static class MapElement&lt;T&gt; {

    public final String name;
    public final T object;

    public MapElement(String name, T object) {
        this.name = name;
        this.object = object;
    }
}
</code></pre><h1 id="mappedhost"><a name="mappedhost" class="plugin-anchor" href="#mappedhost"><i class="fa fa-link" aria-hidden="true"></i></a>MappedHost</h1>
<pre><code>protected static final class MappedHost extends MapElement&lt;Host&gt; {

    public volatile ContextList contextList;

    /**
     * Link to the &quot;real&quot; MappedHost, shared by all aliases.
     */
    private final MappedHost realHost;

    /**
     * Links to all registered aliases, for easy enumeration. This field
     * is available only in the &quot;real&quot; MappedHost. In an alias this field
     * is &lt;code&gt;null&lt;/code&gt;.
     */
    private final List&lt;MappedHost&gt; aliases;

    /**
     * Constructor used for the primary Host
     *
     * @param name The name of the virtual host
     * @param host The host
     */
    public MappedHost(String name, Host host) {
        super(name, host);
        realHost = this;
        contextList = new ContextList();
        aliases = new CopyOnWriteArrayList&lt;&gt;();
    }
</code></pre><ul>
<li>}</li>
</ul>
<h1 id="mappedcontext"><a name="mappedcontext" class="plugin-anchor" href="#mappedcontext"><i class="fa fa-link" aria-hidden="true"></i></a>MappedContext</h1>
<pre><code>protected static final class MappedContext extends MapElement&lt;Void&gt; {
    public volatile ContextVersion[] versions;

    public MappedContext(String name, ContextVersion firstVersion) {
        super(name, null);
        this.versions = new ContextVersion[] { firstVersion };
    }
}
</code></pre><ul>
<li>&#x5176;&#x4E2D;ContextVersion&#x5305;&#x542B;&#x4E86;Context&#x4E0B;&#x7684;&#x6240;&#x6709;Servlet&#xFF0C;&#x6709;&#x591A;&#x79CD;&#x6620;&#x5C04;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;&#x7CBE;&#x786E;&#x7684;map&#xFF0C;&#x901A;&#x914D;&#x7B26;&#x7684;map&#xFF0C;&#x6269;&#x5C55;&#x540D;&#x7684;map&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<pre><code>protected static final class ContextVersion extends MapElement&lt;Context&gt; {
    public final String path;
    public final int slashCount;
    public final WebResourceRoot resources;
    public String[] welcomeResources;
    public MappedWrapper defaultWrapper = null;
</code></pre><pre><code>// &#x7CBE;&#x786E;&#x5339;&#x914D;
    public MappedWrapper[] exactWrappers = new MappedWrapper[0];
</code></pre><pre><code>// &#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;
    public MappedWrapper[] wildcardWrappers = new MappedWrapper[0];
</code></pre><pre><code>// &#x57FA;&#x4E8E;&#x6269;&#x5C55;&#x540D;&#x7684;&#x5339;&#x914D;
    public MappedWrapper[] extensionWrappers = new MappedWrapper[0];
    public int nesting = 0;
    private volatile boolean paused;

    public ContextVersion(String version, String path, int slashCount,
            Context context, WebResourceRoot resources,
            String[] welcomeResources) {
        super(version, context);
        this.path = path;
        this.slashCount = slashCount;
        this.resources = resources;
        this.welcomeResources = welcomeResources;
    }
</code></pre><ul>
<li>}</li>
</ul>
<h1 id="mappedwrapper"><a name="mappedwrapper" class="plugin-anchor" href="#mappedwrapper"><i class="fa fa-link" aria-hidden="true"></i></a>MappedWrapper</h1>
<pre><code>protected static class MappedWrapper extends MapElement&lt;Wrapper&gt; {

    public final boolean jspWildCard;
    public final boolean resourceOnly;

    public MappedWrapper(String name, Wrapper wrapper, boolean jspWildCard,
            boolean resourceOnly) {
        super(name, wrapper);
        this.jspWildCard = jspWildCard;
        this.resourceOnly = resourceOnly;
    }
}
</code></pre><h1 id="mapper"><a name="mapper" class="plugin-anchor" href="#mapper"><i class="fa fa-link" aria-hidden="true"></i></a>Mapper</h1>
<ul>
<li>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;Mapper&#x4E2D;&#x4EE5;&#x6570;&#x7EC4;&#x7684;&#x5F62;&#x5F0F;&#x4FDD;&#x5B58;&#x4E86;host, context, wrapper, &#x4E14;&#x4ED6;&#x4EEC;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x6709;&#x5E8F;&#x7684;&#xFF0C;Mapper&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x7684;url&#xFF0C;&#x901A;&#x8FC7;&#x4E8C;&#x5206;&#x6CD5;&#x67E5;&#x627E;&#x5B9A;&#x4F4D;&#x5230;wrapper&#x3002;</li>
</ul>
<pre><code>public final class Mapper {


    private static final Log log = LogFactory.getLog(Mapper.class);

    private static final StringManager sm = StringManager.getManager(Mapper.class);

    // ----------------------------------------------------- Instance Variables


    /**
     * Array containing the virtual hosts definitions.
     */
    // Package private to facilitate testing
</code></pre><pre><code>// host&#x6570;&#x7EC4;&#xFF0C;host&#x91CC;&#x9762;&#x53C8;&#x5305;&#x62EC;&#x4E86;context&#x548C;wrapper&#x6570;&#x7EC4;
    volatile MappedHost[] hosts = new MappedHost[0];


    /**
     * Default host name.
     */
    private String defaultHostName = null;
    private volatile MappedHost defaultHost = null;


    /**
     * Mapping from Context object to Context version to support
     * RequestDispatcher mappings.
     */
    private final Map&lt;Context, ContextVersion&gt; contextObjectToContextVersionMap =
            new ConcurrentHashMap&lt;&gt;();
</code></pre><ul>
<li>}</li>
<li>Mapper#addHost</li>
</ul>
<pre><code>public synchronized void addHost(String name, String[] aliases,
                                 Host host) {
    name = renameWildcardHost(name);
    MappedHost[] newHosts = new MappedHost[hosts.length + 1];
    MappedHost newHost = new MappedHost(name, host);
    if (insertMap(hosts, newHosts, newHost)) {
        hosts = newHosts;
        if (newHost.name.equals(defaultHostName)) {
            defaultHost = newHost;
        }
        if (log.isDebugEnabled()) {
            log.debug(sm.getString(&quot;mapper.addHost.success&quot;, name));
        }
    } else {
        MappedHost duplicate = hosts[find(hosts, name)];
        if (duplicate.object == host) {
            // The host is already registered in the mapper.
            // E.g. it might have been added by addContextVersion()
            if (log.isDebugEnabled()) {
                log.debug(sm.getString(&quot;mapper.addHost.sameHost&quot;, name));
            }
            newHost = duplicate;
        } else {
            log.error(sm.getString(&quot;mapper.duplicateHost&quot;, name,
                    duplicate.getRealHostName()));
            // Do not add aliases, as removeHost(hostName) won&apos;t be able to
            // remove them
            return;
        }
    }
    List&lt;MappedHost&gt; newAliases = new ArrayList&lt;&gt;(aliases.length);
    for (String alias : aliases) {
        alias = renameWildcardHost(alias);
        MappedHost newAlias = new MappedHost(alias, newHost);
        if (addHostAliasImpl(newAlias)) {
            newAliases.add(newAlias);
        }
    }
    newHost.addAliases(newAliases);
}
</code></pre><ul>
<li>Mapper#addContextVersion</li>
</ul>
<pre><code>public void addContextVersion(String hostName, Host host, String path,
        String version, Context context, String[] welcomeResources,
        WebResourceRoot resources, Collection&lt;WrapperMappingInfo&gt; wrappers) {

    hostName = renameWildcardHost(hostName);

    MappedHost mappedHost  = exactFind(hosts, hostName);
    if (mappedHost == null) {
        addHost(hostName, new String[0], host);
        mappedHost = exactFind(hosts, hostName);
        if (mappedHost == null) {
            log.error(&quot;No host found: &quot; + hostName);
            return;
        }
    }
    if (mappedHost.isAlias()) {
        log.error(&quot;No host found: &quot; + hostName);
        return;
    }
    int slashCount = slashCount(path);
    synchronized (mappedHost) {
        ContextVersion newContextVersion = new ContextVersion(version,
                path, slashCount, context, resources, welcomeResources);
        if (wrappers != null) {
            addWrappers(newContextVersion, wrappers);
        }

        ContextList contextList = mappedHost.contextList;
        MappedContext mappedContext = exactFind(contextList.contexts, path);
        if (mappedContext == null) {
            mappedContext = new MappedContext(path, newContextVersion);
            ContextList newContextList = contextList.addContext(
                    mappedContext, slashCount);
            if (newContextList != null) {
                updateContextList(mappedHost, newContextList);
                contextObjectToContextVersionMap.put(context, newContextVersion);
            }
        } else {
            ContextVersion[] contextVersions = mappedContext.versions;
            ContextVersion[] newContextVersions = new ContextVersion[contextVersions.length + 1];
            if (insertMap(contextVersions, newContextVersions,
                    newContextVersion)) {
                mappedContext.versions = newContextVersions;
                contextObjectToContextVersionMap.put(context, newContextVersion);
            } else {
                // Re-registration after Context.reload()
                // Replace ContextVersion with the new one
                int pos = find(contextVersions, version);
                if (pos &gt;= 0 &amp;&amp; contextVersions[pos].name.equals(version)) {
                    contextVersions[pos] = newContextVersion;
                    contextObjectToContextVersionMap.put(context, newContextVersion);
                }
            }
        }
    }

}
</code></pre><ul>
<li>Mapper#addWrapper</li>
</ul>
<pre><code>public void addWrapper(String hostName, String contextPath, String version,
                       String path, Wrapper wrapper, boolean jspWildCard,
                       boolean resourceOnly) {
    hostName = renameWildcardHost(hostName);
    ContextVersion contextVersion = findContextVersion(hostName,
            contextPath, version, false);
    if (contextVersion == null) {
        return;
    }
    addWrapper(contextVersion, path, wrapper, jspWildCard, resourceOnly);
}
</code></pre><pre><code>protected void addWrapper(ContextVersion context, String path,
        Wrapper wrapper, boolean jspWildCard, boolean resourceOnly) {

    synchronized (context) {
        if (path.endsWith(&quot;/*&quot;)) {
            // Wildcard wrapper
            String name = path.substring(0, path.length() - 2);
            MappedWrapper newWrapper = new MappedWrapper(name, wrapper,
                    jspWildCard, resourceOnly);
            MappedWrapper[] oldWrappers = context.wildcardWrappers;
            MappedWrapper[] newWrappers = new MappedWrapper[oldWrappers.length + 1];
            if (insertMap(oldWrappers, newWrappers, newWrapper)) {
                context.wildcardWrappers = newWrappers;
                int slashCount = slashCount(newWrapper.name);
                if (slashCount &gt; context.nesting) {
                    context.nesting = slashCount;
                }
            }
        } else if (path.startsWith(&quot;*.&quot;)) {
            // Extension wrapper
            String name = path.substring(2);
            MappedWrapper newWrapper = new MappedWrapper(name, wrapper,
                    jspWildCard, resourceOnly);
            MappedWrapper[] oldWrappers = context.extensionWrappers;
            MappedWrapper[] newWrappers =
                new MappedWrapper[oldWrappers.length + 1];
            if (insertMap(oldWrappers, newWrappers, newWrapper)) {
                context.extensionWrappers = newWrappers;
            }
        } else if (path.equals(&quot;/&quot;)) {
            // Default wrapper
            MappedWrapper newWrapper = new MappedWrapper(&quot;&quot;, wrapper,
                    jspWildCard, resourceOnly);
            context.defaultWrapper = newWrapper;
        } else {
            // Exact wrapper
            final String name;
            if (path.length() == 0) {
                // Special case for the Context Root mapping which is
                // treated as an exact match
                name = &quot;/&quot;;
            } else {
                name = path;
            }
            MappedWrapper newWrapper = new MappedWrapper(name, wrapper,
                    jspWildCard, resourceOnly);
            MappedWrapper[] oldWrappers = context.exactWrappers;
            MappedWrapper[] newWrappers = new MappedWrapper[oldWrappers.length + 1];
            if (insertMap(oldWrappers, newWrappers, newWrapper)) {
                context.exactWrappers = newWrappers;
            }
        }
    }
}
</code></pre><ul>
<li>Mapper#find&#xFF08;&#x67E5;&#x627E;MapElement)</li>
<li>// &#x6839;&#x636E;name&#xFF0C;&#x67E5;&#x627E;&#x4E00;&#x4E2A;MapElement&#xFF08;host, context, &#x6216;&#x8005;wrapper)</li>
</ul>
<pre><code>/**
 * Find a map element given its name in a sorted array of map elements.
 * This will return the index for the closest inferior or equal item in the
 * given array.
 */
private static final &lt;T&gt; int find(MapElement&lt;T&gt;[] map, CharChunk name) {
    return find(map, name, name.getStart(), name.getEnd());
}
</code></pre><pre><code>/**
 * Find a map element given its name in a sorted array of map elements.
 * This will return the index for the closest inferior or equal item in the
 * given array.
 */
private static final &lt;T&gt; int find(MapElement&lt;T&gt;[] map, CharChunk name,
                              int start, int end) {

    int a = 0;
    int b = map.length - 1;

    // Special cases: -1 and 0
    if (b == -1) {
        return -1;
    }

    if (compare(name, start, end, map[0].name) &lt; 0 ) {
        return -1;
    }
    if (b == 0) {
        return 0;
    }

    int i = 0;
    while (true) {
        i = (b + a) &gt;&gt;&gt; 1;
        int result = compare(name, start, end, map[i].name);
        if (result == 1) {
            a = i;
        } else if (result == 0) {
            return i;
        } else {
            b = i;
        }
        if ((b - a) == 1) {
            int result2 = compare(name, start, end, map[b].name);
            if (result2 &lt; 0) {
                return a;
            } else {
                return b;
            }
        }
    }
}
</code></pre><pre><code>/**
 * Compare given char chunk with String.
 * Return -1, 0 or +1 if inferior, equal, or superior to the String.
 */
private static final int compare(CharChunk name, int start, int end,
                                 String compareTo) {
    int result = 0;
    char[] c = name.getBuffer();
    int len = compareTo.length();
    if ((end - start) &lt; len) {
        len = end - start;
    }
    for (int i = 0; (i &lt; len) &amp;&amp; (result == 0); i++) {
        if (c[i + start] &gt; compareTo.charAt(i)) {
            result = 1;
        } else if (c[i + start] &lt; compareTo.charAt(i)) {
            result = -1;
        }
    }
    if (result == 0) {
        if (compareTo.length() &gt; (end - start)) {
            result = -1;
        } else if (compareTo.length() &lt; (end - start)) {
            result = 1;
        }
    }
    return result;
}
</code></pre><ul>
<li>Mapper#exactFind&#xFF08;&#x7CBE;&#x786E;&#x67E5;&#x627E;MapElement)</li>
</ul>
<pre><code>private static final &lt;T, E extends MapElement&lt;T&gt;&gt; E exactFind(E[] map,
        String name) {
    int pos = find(map, name);
    if (pos &gt;= 0) {
        E result = map[pos];
        if (name.equals(result.name)) {
            return result;
        }
    }
    return null;
}
</code></pre><ul>
<li>Mapper#map</li>
</ul>
<pre><code>public void map(MessageBytes host, MessageBytes uri, String version,
                MappingData mappingData) throws IOException {

    if (host.isNull()) {
        host.getCharChunk().append(defaultHostName);
    }
    host.toChars();
    uri.toChars();
    internalMap(host.getCharChunk(), uri.getCharChunk(), version,
            mappingData);
}
</code></pre><ul>
<li>MappingData&#x662F;Request&#x4E2D;&#x7684;&#x57DF;<h2 id="internalmap&#xFF08;&#x67E5;&#x627E;host&#x548C;context"><a name="internalmap&#xFF08;&#x67E5;&#x627E;host&#x548C;context" class="plugin-anchor" href="#internalmap&#xFF08;&#x67E5;&#x627E;host&#x548C;context"><i class="fa fa-link" aria-hidden="true"></i></a>internalMap&#xFF08;&#x67E5;&#x627E;host&#x548C;context)</h2>
</li>
</ul>
<pre><code>private final void internalMap(CharChunk host, CharChunk uri,
        String version, MappingData mappingData) throws IOException {

    if (mappingData.host != null) {
        // The legacy code (dating down at least to Tomcat 4.1) just
        // skipped all mapping work in this case. That behaviour has a risk
        // of returning an inconsistent result.
        // I do not see a valid use case for it.
        throw new AssertionError();
    }

    // Virtual host mapping
    MappedHost[] hosts = this.hosts;
    MappedHost mappedHost = exactFindIgnoreCase(hosts, host);
    if (mappedHost == null) {
        // Note: Internally, the Mapper does not use the leading * on a
        //       wildcard host. This is to allow this shortcut.
        int firstDot = host.indexOf(&apos;.&apos;);
        if (firstDot &gt; -1) {
            int offset = host.getOffset();
            try {
                host.setOffset(firstDot + offset);
                mappedHost = exactFindIgnoreCase(hosts, host);
            } finally {
                // Make absolutely sure this gets reset
                host.setOffset(offset);
            }
        }
        if (mappedHost == null) {
            mappedHost = defaultHost;
            if (mappedHost == null) {
                return;
            }
        }
    }
</code></pre><pre><code>- // &#x8BBE;&#x7F6E;host
mappingData.host = mappedHost.object;

if (uri.isNull()) {
    // Can&apos;t map context or wrapper without a uri
    return;
}

uri.setLimit(-1);

// Context mapping
ContextList contextList = mappedHost.contextList;
MappedContext[] contexts = contextList.contexts;
int pos = find(contexts, uri);
if (pos == -1) {
    return;
}

int lastSlash = -1;
int uriEnd = uri.getEnd();
int length = -1;
boolean found = false;
MappedContext context = null;
while (pos &gt;= 0) {
    context = contexts[pos];
    if (uri.startsWith(context.name)) {
        length = context.name.length();
        if (uri.getLength() == length) {
            found = true;
            break;
        } else if (uri.startsWithIgnoreCase(&quot;/&quot;, length)) {
            found = true;
            break;
        }
    }
    if (lastSlash == -1) {
        lastSlash = nthSlash(uri, contextList.nesting + 1);
    } else {
        lastSlash = lastSlash(uri);
    }
    uri.setEnd(lastSlash);
    pos = find(contexts, uri);
}
uri.setEnd(uriEnd);

if (!found) {
    if (contexts[0].name.equals(&quot;&quot;)) {
        context = contexts[0];
    } else {
        context = null;
    }
}
if (context == null) {
    return;
}

mappingData.contextPath.setString(context.name);

ContextVersion contextVersion = null;
ContextVersion[] contextVersions = context.versions;
final int versionCount = contextVersions.length;
if (versionCount &gt; 1) {
    Context[] contextObjects = new Context[contextVersions.length];
    for (int i = 0; i &lt; contextObjects.length; i++) {
        contextObjects[i] = contextVersions[i].object;
    }
    mappingData.contexts = contextObjects;
    if (version != null) {
        contextVersion = exactFind(contextVersions, version);
    }
}
if (contextVersion == null) {
    // Return the latest version
    // The versions array is known to contain at least one element
    contextVersion = contextVersions[versionCount - 1];
}
mappingData.context = contextVersion.object;
mappingData.contextSlashCount = contextVersion.slashCount;

// Wrapper mapping
if (!contextVersion.isPaused()) {
    internalMapWrapper(contextVersion, uri, mappingData);
}
</code></pre><p>}</p>
<h3 id="internalmapwrapper&#xFF08;&#x67E5;&#x627E;wrapper"><a name="internalmapwrapper&#xFF08;&#x67E5;&#x627E;wrapper" class="plugin-anchor" href="#internalmapwrapper&#xFF08;&#x67E5;&#x627E;wrapper"><i class="fa fa-link" aria-hidden="true"></i></a>internalMapWrapper&#xFF08;&#x67E5;&#x627E;Wrapper)</h3>
<pre><code>private final void internalMapWrapper(ContextVersion contextVersion,
                                      CharChunk path,
                                      MappingData mappingData) throws IOException {

    int pathOffset = path.getOffset();
    int pathEnd = path.getEnd();
    boolean noServletPath = false;

    int length = contextVersion.path.length();
    if (length == (pathEnd - pathOffset)) {
        noServletPath = true;
    }
    int servletPath = pathOffset + length;
    path.setOffset(servletPath);

    // Rule 1 -- Exact Match
    MappedWrapper[] exactWrappers = contextVersion.exactWrappers;
    internalMapExactWrapper(exactWrappers, path, mappingData);

    // Rule 2 -- Prefix Match
    boolean checkJspWelcomeFiles = false;
    MappedWrapper[] wildcardWrappers = contextVersion.wildcardWrappers;
    if (mappingData.wrapper == null) {
        internalMapWildcardWrapper(wildcardWrappers, contextVersion.nesting,
                                   path, mappingData);
        if (mappingData.wrapper != null &amp;&amp; mappingData.jspWildCard) {
            char[] buf = path.getBuffer();
            if (buf[pathEnd - 1] == &apos;/&apos;) {
                /*
                 * Path ending in &apos;/&apos; was mapped to JSP servlet based on
                 * wildcard match (e.g., as specified in url-pattern of a
                 * jsp-property-group.
                 * Force the context&apos;s welcome files, which are interpreted
                 * as JSP files (since they match the url-pattern), to be
                 * considered. See Bugzilla 27664.
                 */
                mappingData.wrapper = null;
                checkJspWelcomeFiles = true;
            } else {
                // See Bugzilla 27704
                mappingData.wrapperPath.setChars(buf, path.getStart(),
                                                 path.getLength());
                mappingData.pathInfo.recycle();
            }
        }
    }

    if(mappingData.wrapper == null &amp;&amp; noServletPath &amp;&amp;
            contextVersion.object.getMapperContextRootRedirectEnabled()) {
        // The path is empty, redirect to &quot;/&quot;
        path.append(&apos;/&apos;);
        pathEnd = path.getEnd();
        mappingData.redirectPath.setChars
            (path.getBuffer(), pathOffset, pathEnd - pathOffset);
        path.setEnd(pathEnd - 1);
        return;
    }

    // Rule 3 -- Extension Match
    MappedWrapper[] extensionWrappers = contextVersion.extensionWrappers;
    if (mappingData.wrapper == null &amp;&amp; !checkJspWelcomeFiles) {
        internalMapExtensionWrapper(extensionWrappers, path, mappingData,
                true);
    }

    // Rule 4 -- Welcome resources processing for servlets
    if (mappingData.wrapper == null) {
        boolean checkWelcomeFiles = checkJspWelcomeFiles;
        if (!checkWelcomeFiles) {
            char[] buf = path.getBuffer();
            checkWelcomeFiles = (buf[pathEnd - 1] == &apos;/&apos;);
        }
        if (checkWelcomeFiles) {
            for (int i = 0; (i &lt; contextVersion.welcomeResources.length)
                     &amp;&amp; (mappingData.wrapper == null); i++) {
                path.setOffset(pathOffset);
                path.setEnd(pathEnd);
                path.append(contextVersion.welcomeResources[i], 0,
                        contextVersion.welcomeResources[i].length());
                path.setOffset(servletPath);

                // Rule 4a -- Welcome resources processing for exact macth
                internalMapExactWrapper(exactWrappers, path, mappingData);

                // Rule 4b -- Welcome resources processing for prefix match
                if (mappingData.wrapper == null) {
                    internalMapWildcardWrapper
                        (wildcardWrappers, contextVersion.nesting,
                         path, mappingData);
                }

                // Rule 4c -- Welcome resources processing
                //            for physical folder
                if (mappingData.wrapper == null
                    &amp;&amp; contextVersion.resources != null) {
                    String pathStr = path.toString();
                    WebResource file =
                            contextVersion.resources.getResource(pathStr);
                    if (file != null &amp;&amp; file.isFile()) {
                        internalMapExtensionWrapper(extensionWrappers, path,
                                                    mappingData, true);
                        if (mappingData.wrapper == null
                            &amp;&amp; contextVersion.defaultWrapper != null) {
                            mappingData.wrapper =
                                contextVersion.defaultWrapper.object;
                            mappingData.requestPath.setChars
                                (path.getBuffer(), path.getStart(),
                                 path.getLength());
                            mappingData.wrapperPath.setChars
                                (path.getBuffer(), path.getStart(),
                                 path.getLength());
                            mappingData.requestPath.setString(pathStr);
                            mappingData.wrapperPath.setString(pathStr);
                        }
                    }
                }
            }

            path.setOffset(servletPath);
            path.setEnd(pathEnd);
        }

    }

    /* welcome file processing - take 2
     * Now that we have looked for welcome files with a physical
     * backing, now look for an extension mapping listed
     * but may not have a physical backing to it. This is for
     * the case of index.jsf, index.do, etc.
     * A watered down version of rule 4
     */
    if (mappingData.wrapper == null) {
        boolean checkWelcomeFiles = checkJspWelcomeFiles;
        if (!checkWelcomeFiles) {
            char[] buf = path.getBuffer();
            checkWelcomeFiles = (buf[pathEnd - 1] == &apos;/&apos;);
        }
        if (checkWelcomeFiles) {
            for (int i = 0; (i &lt; contextVersion.welcomeResources.length)
                     &amp;&amp; (mappingData.wrapper == null); i++) {
                path.setOffset(pathOffset);
                path.setEnd(pathEnd);
                path.append(contextVersion.welcomeResources[i], 0,
                            contextVersion.welcomeResources[i].length());
                path.setOffset(servletPath);
                internalMapExtensionWrapper(extensionWrappers, path,
                                            mappingData, false);
            }

            path.setOffset(servletPath);
            path.setEnd(pathEnd);
        }
    }


    // Rule 7 -- Default servlet
    if (mappingData.wrapper == null &amp;&amp; !checkJspWelcomeFiles) {
        if (contextVersion.defaultWrapper != null) {
            mappingData.wrapper = contextVersion.defaultWrapper.object;
            mappingData.requestPath.setChars
                (path.getBuffer(), path.getStart(), path.getLength());
            mappingData.wrapperPath.setChars
                (path.getBuffer(), path.getStart(), path.getLength());
            mappingData.matchType = MappingMatch.DEFAULT;
        }
        // Redirection to a folder
        char[] buf = path.getBuffer();
        if (contextVersion.resources != null &amp;&amp; buf[pathEnd -1 ] != &apos;/&apos;) {
            String pathStr = path.toString();
            WebResource file;
            // Handle context root
            if (pathStr.length() == 0) {
                file = contextVersion.resources.getResource(&quot;/&quot;);
            } else {
                file = contextVersion.resources.getResource(pathStr);
            }
            if (file != null &amp;&amp; file.isDirectory() &amp;&amp;
                    contextVersion.object.getMapperDirectoryRedirectEnabled()) {
                // Note: this mutates the path: do not do any processing
                // after this (since we set the redirectPath, there
                // shouldn&apos;t be any)
                path.setOffset(pathOffset);
                path.append(&apos;/&apos;);
                mappingData.redirectPath.setChars
                    (path.getBuffer(), path.getStart(), path.getLength());
            } else {
                mappingData.requestPath.setString(pathStr);
                mappingData.wrapperPath.setString(pathStr);
            }
        }
    }

    path.setOffset(pathOffset);
    path.setEnd(pathEnd);
}
</code></pre><h4 id="internalmapexactwrapper&#xFF08;url&#x7CBE;&#x786E;&#x5339;&#x914D;"><a name="internalmapexactwrapper&#xFF08;url&#x7CBE;&#x786E;&#x5339;&#x914D;" class="plugin-anchor" href="#internalmapexactwrapper&#xFF08;url&#x7CBE;&#x786E;&#x5339;&#x914D;"><i class="fa fa-link" aria-hidden="true"></i></a>internalMapExactWrapper&#xFF08;URL&#x7CBE;&#x786E;&#x5339;&#x914D;)</h4>
<pre><code>private final void internalMapExactWrapper
    (MappedWrapper[] wrappers, CharChunk path, MappingData mappingData) {
    MappedWrapper wrapper = exactFind(wrappers, path);
    if (wrapper != null) {
        mappingData.requestPath.setString(wrapper.name);
        mappingData.wrapper = wrapper.object;
        if (path.equals(&quot;/&quot;)) {
            // Special handling for Context Root mapped servlet
            mappingData.pathInfo.setString(&quot;/&quot;);
            mappingData.wrapperPath.setString(&quot;&quot;);
            // This seems wrong but it is what the spec says...
            mappingData.contextPath.setString(&quot;&quot;);
            mappingData.matchType = MappingMatch.CONTEXT_ROOT;
        } else {
            mappingData.wrapperPath.setString(wrapper.name);
            mappingData.matchType = MappingMatch.EXACT;
        }
    }
}
</code></pre><pre><code>private static final &lt;T, E extends MapElement&lt;T&gt;&gt; E exactFind(E[] map,
        CharChunk name) {
    int pos = find(map, name);
    if (pos &gt;= 0) {
        E result = map[pos];
        if (name.equals(result.name)) {
            return result;
        }
    }
    return null;
}
</code></pre><ul>
<li><h1 id="tomcat&#x7C7B;&#x52A0;&#x8F7D;&#x5668;"><a name="tomcat&#x7C7B;&#x52A0;&#x8F7D;&#x5668;" class="plugin-anchor" href="#tomcat&#x7C7B;&#x52A0;&#x8F7D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>Tomcat&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</h1>
</li>
<li><p>Tomcat&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3002;servlet&#x5E94;&#x8BE5;&#x53EA;&#x5141;&#x8BB8;&#x52A0;&#x8F7D;WEB-INF/classes&#x76EE;&#x5F55;&#x53CA;&#x5176;&#x5B50;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x7C7B;&#xFF0C;&#x548C;&#x4ECE;&#x90E8;&#x7F72;&#x7684;&#x5E93;&#x5230;WEB-INF/lib&#x76EE;&#x5F55;&#x52A0;&#x8F7D;&#x7C7B;&#xFF0C;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x4E4B;&#x95F4;&#x7684;&#x9694;&#x79BB;&#x3002;&#x53E6;&#x4E00;&#x4E2A;&#x8981;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x70ED;&#x52A0;&#x8F7D;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5982;&#x679C;WEB-INF/classes&#x6216;WEB-INF/lib&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x7C7B;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;Tomcat&#x5E94;&#x8BE5;&#x4F1A;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x7C7B;&#x3002;&#x5728;Tomcat&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x4E2D;&#xFF0C;&#x7C7B;&#x52A0;&#x8F7D;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x65AD;&#x68C0;&#x67E5;servlet&#x7C7B;&#x548C;&#x5176;&#x4ED6;&#x7C7B;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x3002;Tomcat&#x6240;&#x6709;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5FC5;&#x987B;&#x5B9E;&#x73B0;Loader&#x63A5;&#x53E3;&#xFF0C;&#x652F;&#x6301;&#x70ED;&#x52A0;&#x8F7D;&#x7684;&#x8FD8;&#x9700;&#x8981;&#x5B9E;&#x73B0;Reloader&#x63A5;&#x53E3;&#x3002;</p>
</li>
<li><p>Tomcat&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</p>
</li>
<li><p>commonLoader&#x3001;catalinaLoader&#x548C;sharedLoader&#x662F;&#x5728;Tomcat&#x5BB9;&#x5668;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x3002;catalinaLoader&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;Tomcat&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;catalinaLoader&#x52A0;&#x8F7D;Tomcat&#x5BB9;&#x5668;&#x81EA;&#x8EAB;&#x7684;class&#x3002;</p>
</li>
<li><p>&#x5B83;&#x4EEC;&#x4E09;&#x4E2A;&#x90FD;&#x662F;URLClassLoader&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x53EA;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x8DEF;&#x5F84;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x5728;tomcat/conf/catalina.properties&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;</p>
</li>
<li>(common.loader,server.loader,shared.loader).<h1 id="&#x5E94;&#x7528;&#x9694;&#x79BB;"><a name="&#x5E94;&#x7528;&#x9694;&#x79BB;" class="plugin-anchor" href="#&#x5E94;&#x7528;&#x9694;&#x79BB;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5E94;&#x7528;&#x9694;&#x79BB;</h1>
</li>
<li><p>&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;webapp&#x5E94;&#x7528;&#xFF0C;&#x90FD;&#x4F1A;&#x5BF9;&#x5E94;&#x552F;&#x4E00;&#x7684;StandContext&#xFF0C;&#x5728;StandContext&#x4E2D;&#x4F1A;&#x5F15;&#x7528;WebappLoader&#xFF0C;&#x8BE5;&#x7C7B;&#x53C8;&#x4F1A;&#x5F15;&#x7528;WebappClassLoader&#xFF0C;WebappClassLoader&#x5C31;&#x662F;&#x771F;&#x6B63;&#x52A0;&#x8F7D;webapp&#x7684;classloader&#x3002;</p>
</li>
<li><p>WebappClassLoader&#x52A0;&#x8F7D;class&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;
1.- &#x5148;&#x68C0;&#x67E5;webappclassloader&#x7684;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x6709;&#x8BE5;&#x7C7B;
2.- &#x4E3A;&#x9632;&#x6B62;webapp&#x8986;&#x76D6;java se&#x7C7B;&#xFF0C;&#x5C1D;&#x8BD5;&#x7528;application classloader&#xFF08;&#x5E94;&#x7528;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;)&#x52A0;&#x8F7D;
3.- &#x5C1D;&#x8BD5;WebappClassLoader&#x81EA;&#x5DF1;&#x52A0;&#x8F7D;class
4.- &#x6700;&#x540E;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x59D4;&#x6258;&#x7ED9;&#x7236;&#x52A0;&#x8F7D;&#x5668; common classloader&#xFF0C;&#x52A0;&#x8F7D;CATALINA_HOME/lib&#x4E0B;&#x7684;&#x7C7B;
5.- &#x5982;&#x679C;&#x90FD;&#x6CA1;&#x6709;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x629B;&#x51FA;ClassNotFoundException&#x5F02;&#x5E38;</p>
</li>
<li><p>WebappClassLoader#loadClass</p>
</li>
<li>&#x4E0D;&#x540C;&#x7684;StandardContext&#x6709;&#x4E0D;&#x540C;&#x7684;WebappClassLoader&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x540C;&#x7684;webapp&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5C31;&#x662F;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x4E0D;&#x4E00;&#x81F4;&#x5E26;&#x6765;&#x4E86;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6240;&#x4EE5;webapp&#x4E4B;&#x95F4;&#x662F;&#x76F8;&#x4E92;&#x9694;&#x79BB;&#x7684;&#x3002;</li>
</ul>
<pre><code>public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException {
    return loadClass(name, false);
}
</code></pre><pre><code>public Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException {

    synchronized (getClassLoadingLock(name)) {
        if (log.isDebugEnabled())
            log.debug(&quot;loadClass(&quot; + name + &quot;, &quot; + resolve + &quot;)&quot;);
        Class&lt;?&gt; clazz = null;

        // Log access to stopped class loader
        checkStateForClassLoading(name);

        // (0) Check our previously loaded local class cache
        clazz = findLoadedClass0(name);
        if (clazz != null) {
            if (log.isDebugEnabled())
                log.debug(&quot;  Returning class from cache&quot;);
            if (resolve)
                resolveClass(clazz);
            return clazz;
        }

        // (0.1) Check our previously loaded class cache
        clazz = findLoadedClass(name);
        if (clazz != null) {
            if (log.isDebugEnabled())
                log.debug(&quot;  Returning class from cache&quot;);
            if (resolve)
                resolveClass(clazz);
            return clazz;
        }

        // (0.2) Try loading the class with the system class loader, to prevent
        //       the webapp from overriding Java SE classes. This implements
        //       SRV.10.7.2
        String resourceName = binaryNameToPath(name, false);

        ClassLoader javaseLoader = getJavaseClassLoader();
        boolean tryLoadingFromJavaseLoader;
        try {
            // Use getResource as it won&apos;t trigger an expensive
            // ClassNotFoundException if the resource is not available from
            // the Java SE class loader. However (see
            // https://bz.apache.org/bugzilla/show_bug.cgi?id=58125 for
            // details) when running under a security manager in rare cases
            // this call may trigger a ClassCircularityError.
            // See https://bz.apache.org/bugzilla/show_bug.cgi?id=61424 for
            // details of how this may trigger a StackOverflowError
            // Given these reported errors, catch Throwable to ensure any
            // other edge cases are also caught
            tryLoadingFromJavaseLoader = (javaseLoader.getResource(resourceName) != null);
        } catch (Throwable t) {
            // Swallow all exceptions apart from those that must be re-thrown
            ExceptionUtils.handleThrowable(t);
            // The getResource() trick won&apos;t work for this class. We have to
            // try loading it directly and accept that we might get a
            // ClassNotFoundException.
            tryLoadingFromJavaseLoader = true;
        }
        // &#x4F7F;&#x7528;System ClassLoader&#x52A0;&#x8F7D;J2SE&#x7684;&#x7C7B;
        if (tryLoadingFromJavaseLoader) {
            try {
                clazz = javaseLoader.loadClass(name);
                if (clazz != null) {
                    if (resolve)
                        resolveClass(clazz);
                    return clazz;
                }
            } catch (ClassNotFoundException e) {
                // Ignore
            }
        }

        // (0.5) Permission to access this class when using a SecurityManager
        if (securityManager != null) {
            int i = name.lastIndexOf(&apos;.&apos;);
            if (i &gt;= 0) {
                try {
                    securityManager.checkPackageAccess(name.substring(0,i));
                } catch (SecurityException se) {
                    String error = &quot;Security Violation, attempt to use &quot; +
                        &quot;Restricted Class: &quot; + name;
                    log.info(error, se);
                    throw new ClassNotFoundException(error, se);
                }
            }
        }

        boolean delegateLoad = delegate || filter(name, true);

        // (1) Delegate to our parent if requested
        if (delegateLoad) {
            if (log.isDebugEnabled())
                log.debug(&quot;  Delegating to parent classloader1 &quot; + parent);
            try {
                clazz = Class.forName(name, false, parent);
                if (clazz != null) {
                    if (log.isDebugEnabled())
                        log.debug(&quot;  Loading class from parent&quot;);
                    if (resolve)
                        resolveClass(clazz);
                    return clazz;
                }
            } catch (ClassNotFoundException e) {
                // Ignore
            }
        }

        // (2) Search local repositories
        if (log.isDebugEnabled())
            log.debug(&quot;  Searching local repositories&quot;);
        try {
            clazz = findClass(name);
            if (clazz != null) {
                if (log.isDebugEnabled())
                    log.debug(&quot;  Loading class from local repository&quot;);
                if (resolve)
                    resolveClass(clazz);
                return clazz;
            }
        } catch (ClassNotFoundException e) {
            // Ignore
        }

        // (3) Delegate to parent unconditionally
        if (!delegateLoad) {
            if (log.isDebugEnabled())
                log.debug(&quot;  Delegating to parent classloader at end: &quot; + parent);
            try {
                clazz = Class.forName(name, false, parent);
                if (clazz != null) {
                    if (log.isDebugEnabled())
                        log.debug(&quot;  Loading class from parent&quot;);
                    if (resolve)
                        resolveClass(clazz);
                    return clazz;
                }
            } catch (ClassNotFoundException e) {
                // Ignore
            }
        }
    }

    throw new ClassNotFoundException(name);
}
</code></pre><h1 id="&#x70ED;&#x90E8;&#x7F72;"><a name="&#x70ED;&#x90E8;&#x7F72;" class="plugin-anchor" href="#&#x70ED;&#x90E8;&#x7F72;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x70ED;&#x90E8;&#x7F72;</h1>
<ul>
<li>&#x540E;&#x53F0;&#x7684;&#x5B9A;&#x671F;&#x68C0;&#x67E5;&#xFF0C;&#x8BE5;&#x5B9A;&#x671F;&#x68C0;&#x67E5;&#x662F;StandardContext&#x7684;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F1A;&#x505A;reload&#x7684;check&#xFF0C;&#x8FC7;&#x671F;session&#x6E05;&#x7406;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;modified&#x5B9E;&#x9645;&#x4E0A;&#x8C03;&#x7528;&#x4E86;WebappClassLoader&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x4EE5;&#x5224;&#x65AD;&#x8FD9;&#x4E2A;class&#x662F;&#x4E0D;&#x662F;&#x5DF2;&#x7ECF;&#x4FEE;&#x6539;&#x3002;&#x6CE8;&#x610F;&#x5230;&#x5B83;&#x8C03;&#x7528;&#x4E86;StandardContext&#x7684;reload&#x65B9;&#x6CD5;&#x3002;</li>
<li>StandardContext#backgroundProcess</li>
</ul>
<pre><code>public void backgroundProcess() {

    if (!getState().isAvailable())
        return;

    Loader loader = getLoader();
    if (loader != null) {
        try {
            loader.backgroundProcess();
        } catch (Exception e) {
            log.warn(sm.getString(
                    &quot;standardContext.backgroundProcess.loader&quot;, loader), e);
        }
    }
    Manager manager = getManager();
    if (manager != null) {
        try {
            manager.backgroundProcess();
        } catch (Exception e) {
            log.warn(sm.getString(
                    &quot;standardContext.backgroundProcess.manager&quot;, manager),
                    e);
        }
    }
    WebResourceRoot resources = getResources();
    if (resources != null) {
        try {
            resources.backgroundProcess();
        } catch (Exception e) {
            log.warn(sm.getString(
                    &quot;standardContext.backgroundProcess.resources&quot;,
                    resources), e);
        }
    }
    InstanceManager instanceManager = getInstanceManager();
    if (instanceManager != null) {
        try {
            instanceManager.backgroundProcess();
        } catch (Exception e) {
            log.warn(sm.getString(
                    &quot;standardContext.backgroundProcess.instanceManager&quot;,
                    resources), e);
        }
    }
    super.backgroundProcess();
}
</code></pre><ul>
<li>WebappLoader#backgroundProcess</li>
</ul>
<pre><code>public void backgroundProcess() {
    if (reloadable &amp;&amp; modified()) {
        try {
            Thread.currentThread().setContextClassLoader
                (WebappLoader.class.getClassLoader());
            if (context != null) {
                context.reload();
            }
        } finally {
            if (context != null &amp;&amp; context.getLoader() != null) {
                Thread.currentThread().setContextClassLoader
                    (context.getLoader().getClassLoader());
            }
        }
    }
}
</code></pre><ul>
<li>StandardContext#reload</li>
<li>Tomcat lifecycle&#x4E2D;&#x6807;&#x51C6;&#x7684;&#x542F;&#x505C;&#x65B9;&#x6CD5;stop&#x548C;start&#xFF0C;&#x522B;&#x5FD8;&#x4E86;&#xFF0C;start&#x65B9;&#x6CD5;&#x4F1A;&#x91CD;&#x65B0;&#x9020;&#x4E00;&#x4E2A;WebappClassLoader&#x5E76;&#x4E14;&#x91CD;&#x590D;loadOnStartup&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4ECE;&#x800C;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x4E86;webapp&#x4E2D;&#x7684;&#x7C7B;&#xFF0C;&#x6CE8;&#x610F;&#x5230;&#x4E00;&#x822C;&#x5E94;&#x7528;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x70ED;&#x90E8;&#x7F72;&#x901A;&#x5E38;&#x4F1A;&#x62A5;outofmemory: permgen space not enough&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x52A0;&#x8F7D;&#x8FDB;&#x6765;&#x7684;class&#x8FD8;&#x6CA1;&#x6709;&#x6E05;&#x9664;&#x800C;&#x65B9;&#x6CD5;&#x533A;&#x5185;&#x5B58;&#x53C8;&#x4E0D;&#x591F;&#x7684;&#x539F;&#x56E0;</li>
</ul>
<pre><code>public synchronized void reload() {

    // Validate our current component state
    if (!getState().isAvailable())
        throw new IllegalStateException
            (sm.getString(&quot;standardContext.notStarted&quot;, getName()));

    if(log.isInfoEnabled())
        log.info(sm.getString(&quot;standardContext.reloadingStarted&quot;,
                getName()));

    // Stop accepting requests temporarily.
    setPaused(true);

    try {
        stop();
    } catch (LifecycleException e) {
        log.error(
            sm.getString(&quot;standardContext.stoppingContext&quot;, getName()), e);
    }

    try {
        start();
    } catch (LifecycleException e) {
        log.error(
            sm.getString(&quot;standardContext.startingContext&quot;, getName()), e);
    }

    setPaused(false);

    if(log.isInfoEnabled())
        log.info(sm.getString(&quot;standardContext.reloadingCompleted&quot;,
                getName()));

}
</code></pre><h1 id="&#x5F02;&#x6B65;servlet"><a name="&#x5F02;&#x6B65;servlet" class="plugin-anchor" href="#&#x5F02;&#x6B65;servlet"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5F02;&#x6B65;Servlet</h1>
<ul>
<li>&#x5165;&#x53E3;&#x70B9;&#x662F;Request#startAsync</li>
<li>Request#startAsync&#xFF08;&#x5F00;&#x542F;&#x5F02;&#x6B65;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x4E4B;&#x540E;Tomct&#x56DE;&#x6536;Worker&#x7EBF;&#x7A0B;)</li>
</ul>
<pre><code>public AsyncContext startAsync() {
    return startAsync(getRequest(),response.getResponse());
}
</code></pre><pre><code>public AsyncContext startAsync(ServletRequest request,
        ServletResponse response) {
    if (!isAsyncSupported()) {
        IllegalStateException ise =
                new IllegalStateException(sm.getString(&quot;request.asyncNotSupported&quot;));
        log.warn(sm.getString(&quot;coyoteRequest.noAsync&quot;,
                StringUtils.join(getNonAsyncClassNames())), ise);
        throw ise;
    }

    if (asyncContext == null) {
        asyncContext = new AsyncContextImpl(this);
    }

    asyncContext.setStarted(getContext(), request, response,
            request==getRequest() &amp;&amp; response==getResponse().getResponse());
    asyncContext.setTimeout(getConnector().getAsyncTimeout());

    return asyncContext;
}
</code></pre><pre><code>- 1) AsyncContextImpl#construactor
</code></pre><ul>
<li>&#x6210;&#x5458;&#x53D8;&#x91CF;</li>
<li>Tomcat&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5728;Request#startAsync&#x4E4B;&#x540E;&#xFF0C;&#x628A;&#x8BE5;&#x5F02;&#x6B65;servlet&#x7684;&#x540E;&#x7EED;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;Tomcat&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x4E86;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x7EBF;&#x7A0B;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x4FDD;&#x5B58;&#x8BB0;&#x5F55;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
<pre><code>public class AsyncContextImpl implements AsyncContext, AsyncContextCallback {

    private static final Log log = LogFactory.getLog(AsyncContextImpl.class);

    protected static final StringManager sm =
        StringManager.getManager(Constants.Package);

    /* When a request uses a sequence of multiple start(); dispatch() with
     * non-container threads it is possible for a previous dispatch() to
     * interfere with a following start(). This lock prevents that from
     * happening. It is a dedicated object as user code may lock on the
     * AsyncContext so if container code also locks on that object deadlocks may
     * occur.
     */
    private final Object asyncContextLock = new Object();

    private volatile ServletRequest servletRequest = null;
    private volatile ServletResponse servletResponse = null;
    private final List&lt;AsyncListenerWrapper&gt; listeners = new ArrayList&lt;&gt;();
    private boolean hasOriginalRequestAndResponse = true;
    private volatile Runnable dispatch = null;
    private Context context = null;
    // Default of 30000 (30s) is set by the connector
    private long timeout = -1;
    private AsyncEvent event = null;
    private volatile Request request;
    private volatile InstanceManager instanceManager;
</code></pre><ul>
<li>}</li>
</ul>
<pre><code>public AsyncContextImpl(Request request) {
    if (log.isDebugEnabled()) {
        logDebug(&quot;Constructor&quot;);
    }
    this.request = request;
}
</code></pre><pre><code>- 2) AsyncContextImpl#setStarted
</code></pre><pre><code>public void setStarted(Context context, ServletRequest request,
        ServletResponse response, boolean originalRequestResponse) {

    synchronized (asyncContextLock) {
        this.request.getCoyoteRequest().action(
                ActionCode.ASYNC_START, this);

        this.context = context;
        this.servletRequest = request;
        this.servletResponse = response;
        this.hasOriginalRequestAndResponse = originalRequestResponse;
        this.event = new AsyncEvent(this, request, response);

        List&lt;AsyncListenerWrapper&gt; listenersCopy = new ArrayList&lt;&gt;();
        listenersCopy.addAll(listeners);
        listeners.clear();
        for (AsyncListenerWrapper listener : listenersCopy) {
            try {
                listener.fireOnStartAsync(event);
            } catch (Throwable t) {
                ExceptionUtils.handleThrowable(t);
                log.warn(&quot;onStartAsync() failed for listener of type [&quot; +
                        listener.getClass().getName() + &quot;]&quot;, t);
            }
        }
    }
}
</code></pre><ul>
<li>AbstractProcessor#action</li>
<li><p>case ASYNC_START: {
  asyncStateMachine.asyncStart((AsyncContextCallback) param);
  break;
}</p>
</li>
<li><p>AsyncStateMachine#asyncStart</p>
</li>
<li><p>synchronized void asyncStart(AsyncContextCallback asyncCtxt) {
  if (state == AsyncState.DISPATCHED) {</p>
<pre><code>  state = AsyncState.STARTING;
  this.asyncCtxt = asyncCtxt;
  lastAsyncStart = System.currentTimeMillis();
</code></pre><p>  } else {</p>
<pre><code>  throw new IllegalStateException(
          sm.getString(&quot;asyncStateMachine.invalidAsyncState&quot;,
                  &quot;asyncStart()&quot;, state));
</code></pre><p>  }
}</p>
<ul>
<li>3) AsyncContextImpl#setTimeout</li>
</ul>
</li>
</ul>
<pre><code>public void setTimeout(long timeout) {
    check();
    this.timeout = timeout;
    request.getCoyoteRequest().action(ActionCode.ASYNC_SETTIMEOUT,
            Long.valueOf(timeout));
}
</code></pre><ul>
<li>AsyncContext#complete&#xFF08;&#x7ED3;&#x675F;)</li>
</ul>
<pre><code>public void complete() {
    if (log.isDebugEnabled()) {
        logDebug(&quot;complete   &quot;);
    }
    check();
    request.getCoyoteRequest().action(ActionCode.ASYNC_COMPLETE, null);
}
</code></pre><ul>
<li>case ASYNC_COMPLETE: {
  clearDispatches();
  if (asyncStateMachine.asyncComplete()) {<pre><code>  processSocketEvent(SocketEvent.OPEN_READ, true);
</code></pre>  }
  break;
}</li>
</ul>
<ul>
<li>protected void processSocketEvent(SocketEvent event, boolean dispatch) {
  SocketWrapperBase&lt;?&gt; socketWrapper = getSocketWrapper();
  if (socketWrapper != null) {<pre><code>  socketWrapper.processSocket(event, dispatch);
</code></pre>  }
}</li>
</ul>
<pre><code>public void processSocket(SocketEvent socketStatus, boolean dispatch) {
    endpoint.processSocket(this, socketStatus, dispatch);
}
</code></pre><pre><code>- &#x89C1;2.2.1) AbstractEndpoint#processSocket
</code></pre><ul>
<li>&#x76F8;&#x5F53;&#x4E8E;&#x91CD;&#x65B0;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5E26;&#x7740;SocketWrapper&#xFF0C;&#x53C8;&#x6765;&#x4E00;&#x904D;&#x5BB9;&#x5668;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x800C;&#x8FD9;&#x4E00;&#x904D;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;Servlet&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x8FC7;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x7565;&#x8FC7;servlet&#x7684;&#x6267;&#x884C;&#x76F4;&#x63A5;&#x5C06;&#x540E;&#x7EED;&#x7684;&#x5904;&#x7406;&#x8D70;&#x5B8C;&#xFF0C;&#x5305;&#x62EC;&#x6700;&#x540E;response&#x7684;&#x6536;&#x5C3E;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x6E05;&#x7A7A;&#x7B49;&#x7B49;&#x3002;</li>
<li>&#x4F46;&#x662F;&#x5F02;&#x6B65;Servlet&#x6B64;&#x65F6;&#x4E0D;&#x4F1A;&#x91CD;&#x65B0;&#x8DD1;&#x4E00;&#x6B21;Servlet&#xFF0C;&#x76F4;&#x63A5;&#x8DF3;&#x5230;response&#x6536;&#x5C3E;&#x3002;</li>
<li>AsyncContext#dispatch&#xFF08;&#x8F6C;&#x53D1;)</li>
</ul>

<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="二十、Spring源码解析.html" class="navigation navigation-prev " aria-label="Previous page: 二十、Spring源码解析">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="五、JVM.html" class="navigation navigation-next " aria-label="Next page: 五、JVM">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"二十一、Tomcat源码解析","level":"1.17.9","depth":2,"next":{"title":"五、JVM","level":"1.17.10","depth":2,"path":"zother5-Java-Interview/五、JVM.md","ref":"zother5-Java-Interview/五、JVM.md","articles":[]},"previous":{"title":"二十、Spring源码解析","level":"1.17.8","depth":2,"path":"zother5-Java-Interview/二十、Spring源码解析.md","ref":"zother5-Java-Interview/二十、Spring源码解析.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","-highlight","baidu","splitter","sitemap","back-to-top-button","code","splitter","-lunr","-search","search-pro","theme-comscore","popup","hide-element","anchors","nocache","page-toc-button"],"ignores":["friends","tags","categories","about"],"root":".deploy/content","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"nocache":{},"github":{"url":"https://github.com/zhaoda/webpack-handbook"},"editlink":{"base":"https://github.com/zhaoda/webpack-handbook/blob/master/content","label":"编辑本页"},"splitter":{},"search-pro":{},"popup":{},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"sitemap":{"hostname":"http://zhaoda.net/"},"theme-comscore":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"back-to-top-button":{},"baidu":{"token":"a9787f0ab45d5e237bab522431d0a7ec"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"SUMMARY.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"java实用笔记","language":"zh-hans","output.name":"site","catalog":["./source/_posts"],"links":{"sidebar":{"Home":"http://blog.liangqingxiang.top/"}},"gitbook":"3.2.3","description":"学习笔记"},"file":{"path":"zother5-Java-Interview/二十一、Tomcat源码解析.md","mtime":"2020-08-13T09:37:25.550Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-13T09:37:46.772Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-baidu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-nocache/nocache.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

